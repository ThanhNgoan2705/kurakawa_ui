"use strict";(self.webpackChunkthingsboard=self.webpackChunkthingsboard||[]).push([[5262],{55262:(f,u,e)=>{e.r(u),e.d(u,{TbCanvasDigitalGauge:()=>c});var S=e(13032),d=e(97323),n=e(27997),g=e(36075),r=e(10421),m=e(60177),h=e(96771),M=e(42415);class c{constructor(i,s){this.ctx=i;const a=M("#"+s,i.$container)[0],t=i.settings;this.localSettings={},this.localSettings.minValue=t.minValue||0,this.localSettings.maxValue=t.maxValue||100,this.localSettings.gaugeType=t.gaugeType||"arc",this.localSettings.neonGlowBrightness=t.neonGlowBrightness||0,this.localSettings.dashThickness=t.dashThickness||0,this.localSettings.roundedLineCap=!0===t.roundedLineCap;const l=i.data[0].dataKey,o=t.defaultColor||l.color;this.localSettings.unitTitle=!0===t.showUnitTitle?t.unitTitle&&t.unitTitle.length>0?t.unitTitle:l.label:"",this.localSettings.showUnitTitle=!0===t.showUnitTitle,this.localSettings.showTimestamp=!0===t.showTimestamp,this.localSettings.timestampFormat=t.timestampFormat&&t.timestampFormat.length?t.timestampFormat:"yyyy-MM-dd HH:mm:ss",this.localSettings.gaugeWidthScale=t.gaugeWidthScale||.75,this.localSettings.gaugeColor=t.gaugeColor||(0,d.A)(o).setAlpha(.2).toRgbString(),(0,S.PO)(t,o),this.localSettings.barColor=t.barColor,this.localSettings.showTicks=t.showTicks||!1,this.localSettings.ticks=[],this.localSettings.ticksValue=t.ticksValue||[],this.localSettings.tickWidth=t.tickWidth||4,this.localSettings.colorTicks=t.colorTicks||"#666",this.localSettings.decimals=(0,n.O9)(l.decimals)?l.decimals:(0,n.f1)(t.decimals)?t.decimals:i.decimals,this.localSettings.units=l.units&&l.units.length?l.units:(0,n.O9)(t.units)&&t.units.length>0?t.units:i.units,this.localSettings.hideValue=!0!==t.showValue,this.localSettings.hideMinMax=!0!==t.showMinMax,this.localSettings.donutStartAngle=(0,n.f1)(t.donutStartAngle)?-c.toRadians(t.donutStartAngle):null,this.localSettings.title=!0===t.showTitle?t.title&&t.title.length>0?t.title:l.label:"",!this.localSettings.unitTitle&&this.localSettings.showTimestamp&&(this.localSettings.unitTitle=" "),this.localSettings.titleFont=(0,g.M)(t.titleFont,{size:12,style:"normal",weight:"500",color:o}),this.localSettings.valueFont=(0,g.M)(t.valueFont,{size:18,style:"normal",weight:"500",color:o}),this.localSettings.minMaxFont=(0,g.M)(t.minMaxFont,{size:10,style:"normal",weight:"500",color:o}),this.localSettings.labelFont=(0,g.M)(t.labelFont,{size:8,style:"normal",weight:"500",color:o}),this.barColorProcessor=h.U9.fromSettings(t.barColor,this.ctx);const T={renderTo:a,gaugeWidthScale:this.localSettings.gaugeWidthScale,gaugeColor:this.localSettings.gaugeColor,barColorProcessor:this.barColorProcessor,colorTicks:this.localSettings.colorTicks,tickWidth:this.localSettings.tickWidth,ticks:this.localSettings.ticks,title:this.localSettings.title,fontTitleSize:this.localSettings.titleFont.size,fontTitleStyle:this.localSettings.titleFont.style,fontTitleWeight:this.localSettings.titleFont.weight,colorTitle:this.localSettings.titleFont.color,fontTitle:this.localSettings.titleFont.family,fontValueSize:this.localSettings.valueFont.size,fontValueStyle:this.localSettings.valueFont.style,fontValueWeight:this.localSettings.valueFont.weight,colorValue:this.localSettings.valueFont.color,fontValue:this.localSettings.valueFont.family,fontMinMaxSize:this.localSettings.minMaxFont.size,fontMinMaxStyle:this.localSettings.minMaxFont.style,fontMinMaxWeight:this.localSettings.minMaxFont.weight,colorMinMax:this.localSettings.minMaxFont.color,fontMinMax:this.localSettings.minMaxFont.family,fontLabelSize:this.localSettings.labelFont.size,fontLabelStyle:this.localSettings.labelFont.style,fontLabelWeight:this.localSettings.labelFont.weight,colorLabel:this.localSettings.labelFont.color,fontLabel:this.localSettings.labelFont.family,minValue:this.localSettings.minValue,maxValue:this.localSettings.maxValue,gaugeType:this.localSettings.gaugeType,dashThickness:this.localSettings.dashThickness,roundedLineCap:this.localSettings.roundedLineCap,symbol:this.localSettings.units,unitTitle:this.localSettings.unitTitle,showUnitTitle:this.localSettings.showUnitTitle,showTimestamp:this.localSettings.showTimestamp,hideValue:this.localSettings.hideValue,hideMinMax:this.localSettings.hideMinMax,donutStartAngle:this.localSettings.donutStartAngle,valueDec:this.localSettings.decimals,neonGlowBrightness:this.localSettings.neonGlowBrightness,animation:!1!==t.animation&&!i.isMobile,animationDuration:(0,n.f1)(t.animationDuration)?t.animationDuration:500,animationRule:t.animationRule||"linear",isMobile:i.isMobile};this.gauge=new r.CanvasDigitalGauge(T).draw(),this.init()}static toRadians(i){return i*(Math.PI/180)}init(){let i=!1;this.localSettings.showTicks&&this.localSettings.ticksValue?.length&&(this.localSettings.ticks=this.localSettings.ticksValue.map(s=>s.type===h.j2.constant&&isFinite(s.value)?s.value:null),(0,h.zY)(this.ctx,this.localSettings.ticksValue,this.updateAttribute.bind(this)).subscribe(s=>{this.ticksSourcesSubscription=s}),i=!0),i&&this.updateSetting(),this.barColorProcessor.colorUpdated?.subscribe(()=>{this.gauge.update({})})}updateAttribute(i){for(const s of i.data)if(s&&s.data&&s.data[0]){const a=s.data[0][1];if(isFinite(a))for(const t of s.dataKey.settings.indexes)this.localSettings.ticks[t]=a}this.updateSetting()}updateSetting(){this.gauge.options.ticks=this.localSettings.ticks,this.gauge.options=r.CanvasDigitalGauge.configure(this.gauge.options),this.gauge.update({})}update(){if(this.ctx.data.length>0){const i=this.ctx.data[0];if(i.data.length>0){const s=i.data[i.data.length-1];let a;if(this.localSettings.showTimestamp){a=s[0];const l=this.ctx.$injector.get(m.DatePipe);this.gauge.options.labelTimestamp=l.transform(a,this.localSettings.timestampFormat)}const t=parseFloat(s[1]);t!==this.gauge.value?(this.gauge.options.animation?delete this.gauge._value:this.gauge._value=t,this.gauge.value=t):this.localSettings.showTimestamp&&this.gauge.timestamp!==a&&(this.gauge.timestamp=a)}}}mobileModeChanged(){const i=!1!==this.ctx.settings.animation&&!this.ctx.isMobile;this.gauge.update({animation:i,isMobile:this.ctx.isMobile})}resize(){this.gauge.update({width:this.ctx.width,height:this.ctx.height})}destroy(){this.gauge.destroy(),this.barColorProcessor.destroy(),this.ticksSourcesSubscription&&this.ctx.subscriptionApi.removeSubscription(this.ticksSourcesSubscription.id),this.gauge=null}}}}]);