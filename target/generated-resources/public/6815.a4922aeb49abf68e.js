"use strict";(self.webpackChunkthingsboard=self.webpackChunkthingsboard||[]).push([[6815],{6815:(CS,Or,d)=>{d.r(Or),d.d(Or,{HomePagesModule:()=>Go});var e=d(93953),p=d(60177),b=d(7901),de=d(69749),s=d(89417),Re=d(52734),Zi=d(96955),$=d(78502),_=d(27997),fe=d(18530),Se=d(27468),j=d(56977),J=d(81184),mr=d(86884),on=d(35524),ct=d(67336),C=d(9310),u=d(73955),be=d(37441),x=d(88834),rn=d(65571),Te=d(82765),E=d(99213),D=d(25596),K=d(67575),L=d(59042),v=d(53719),ce=d(82798),z=d(86600),pe=d(30450),U=d(9454),Ie=d(36471),ur=d(9361),Rr=d(19267);function Ks(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",32)}function Ys(a,t){1&a&&e.\u0275\u0275element(0,"div",33)}function Qs(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.mail-from-required")," "))}function Js(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",34),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){let i;const n=t.$implicit,o=e.\u0275\u0275nextContext();e.\u0275\u0275property("value",n),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",(null==(i=o.templates.get(n))?null:i.name)||"Custom"," ")}}function Zs(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",34),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit;e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",i.toUpperCase()," ")}}function Xs(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.smtp-host-required")," "))}function el(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.smtp-port-required")," "))}function tl(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.smtp-port-invalid")," "))}function nl(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.timeout-required")," "))}function il(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.timeout-invalid")," "))}function al(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",34),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit;e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",i," ")}}function ol(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-form-field",46)(1,"mat-label",13),e.\u0275\u0275text(2,"admin.tls-version"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"mat-select",47),e.\u0275\u0275template(4,al,2,2,"mat-option",17),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",i.tlsVersions)}}function rl(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.proxy-host-required")," "))}function sl(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.proxy-port-required")," "))}function ll(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.proxy-port-range")," "))}function dl(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div")(1,"div",48)(2,"mat-form-field",37)(3,"mat-label",13),e.\u0275\u0275text(4,"admin.proxy-host"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"input",49),e.\u0275\u0275template(6,rl,3,3,"mat-error",15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"mat-form-field",39)(8,"mat-label",13),e.\u0275\u0275text(9,"admin.proxy-port"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(10,"input",50),e.\u0275\u0275template(11,sl,3,3,"mat-error",15)(12,ll,3,3,"mat-error",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(13,"div",51)(14,"mat-form-field",46)(15,"mat-label",13),e.\u0275\u0275text(16,"admin.proxy-user"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(17,"input",52),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"mat-form-field",46)(19,"mat-label",13),e.\u0275\u0275text(20,"admin.proxy-password"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(21,"input",53)(22,"tb-toggle-password",54),e.\u0275\u0275elementEnd()()()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",i.mailSettings.get("proxyHost").hasError("required")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.mailSettings.get("proxyPort").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.mailSettings.get("proxyPort").hasError("pattern")||i.mailSettings.get("proxyPort").hasError("min")||i.mailSettings.get("proxyPort").hasError("max"))}}function cl(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-form-field",12)(1,"mat-label",13),e.\u0275\u0275text(2,"admin.smtp-protocol"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"mat-select",35),e.\u0275\u0275template(4,Zs,2,2,"mat-option",17),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",36)(6,"mat-form-field",37)(7,"mat-label",13),e.\u0275\u0275text(8,"admin.smtp-host"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"input",38),e.\u0275\u0275template(10,Xs,3,3,"mat-error",15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"mat-form-field",39)(12,"mat-label",13),e.\u0275\u0275text(13,"admin.smtp-port"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(14,"input",40,0),e.\u0275\u0275elementStart(16,"mat-hint",41),e.\u0275\u0275text(17),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(18,el,3,3,"mat-error",15)(19,tl,3,3,"mat-error",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(20,"mat-form-field",12)(21,"mat-label",13),e.\u0275\u0275text(22,"admin.timeout-msec"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(23,"input",42,1),e.\u0275\u0275elementStart(25,"mat-hint",41),e.\u0275\u0275text(26),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(27,nl,3,3,"mat-error",15)(28,il,3,3,"mat-error",15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(29,"mat-slide-toggle",43),e.\u0275\u0275text(30),e.\u0275\u0275pipe(31,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(32,ol,5,1,"mat-form-field",44),e.\u0275\u0275elementStart(33,"mat-slide-toggle",45),e.\u0275\u0275text(34),e.\u0275\u0275pipe(35,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(36,dl,23,3,"div",15)),2&a){const i=e.\u0275\u0275reference(15),n=e.\u0275\u0275reference(24),o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",o.smtpProtocols),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",o.mailSettings.get("smtpHost").hasError("required")),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate1("",(null==i.value?null:i.value.length)||0,"/5"),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.mailSettings.get("smtpPort").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.mailSettings.get("smtpPort").hasError("pattern")||o.mailSettings.get("smtpPort").hasError("maxlength")),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate1("",(null==n.value?null:n.value.length)||0,"/6"),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.mailSettings.get("timeout").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.mailSettings.get("timeout").hasError("pattern")||o.mailSettings.get("timeout").hasError("maxlength")),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(31,12,"admin.enable-tls")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",o.mailSettings.get("enableTls").value),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(35,14,"admin.enable-proxy")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",o.mailSettings.get("enableProxy").value)}}function pl(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",55),e.\u0275\u0275element(1,"div",56),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("tb-help",i.helpLink)}}function ml(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-checkbox",59),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.change-password")," "))}function ul(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-form-field",12)(1,"mat-label",13),e.\u0275\u0275text(2,"common.password"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"input",60),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275element(5,"tb-toggle-password",54),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(4,1,"common.enter-password")))}function gl(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"section"),e.\u0275\u0275template(1,ml,3,3,"mat-checkbox",57)(2,ul,6,3,"mat-form-field",58),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.showChangePassword),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.mailSettings.get("changePassword").value||!i.showChangePassword)}}function fl(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.client-id-required")," "))}function hl(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.client-id-max-length")," "))}function bl(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.client-secret-required")," "))}function yl(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.client-secret-max-length")," "))}function vl(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.microsoft-tenant-id-required")," "))}function Cl(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-form-field",46)(1,"mat-label",13),e.\u0275\u0275text(2,"admin.oauth2.microsoft-tenant-id"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"input",74),e.\u0275\u0275template(4,vl,3,3,"mat-error",15),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",i.mailSettings.get("providerTenantId").hasError("required"))}}function xl(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.access-token-uri-required")," "))}function _l(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.uri-pattern-error")," "))}function Sl(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.access-token-uri-required")," "))}function Tl(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.uri-pattern-error")," "))}function Il(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-chip-row",81),e.\u0275\u0275listener("removed",function(){const o=e.\u0275\u0275restoreView(i).index,r=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(r.removeScope(o))}),e.\u0275\u0275text(1),e.\u0275\u0275elementStart(2,"mat-icon",82),e.\u0275\u0275text(3,"cancel"),e.\u0275\u0275elementEnd()()}if(2&a){const i=t.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",i," ")}}function wl(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.scope-required")," "))}function El(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",51)(1,"mat-form-field",46)(2,"mat-label",13),e.\u0275\u0275text(3,"admin.oauth2.authorization-uri"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"input",75),e.\u0275\u0275elementStart(5,"button",76),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(o.toggleEditMode("authUri"))}),e.\u0275\u0275elementStart(6,"mat-icon",77),e.\u0275\u0275text(7,"create"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(8,xl,3,3,"mat-error",15)(9,_l,3,3,"mat-error",15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"mat-form-field",46)(11,"mat-label",13),e.\u0275\u0275text(12,"admin.oauth2.token-uri"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(13,"input",78),e.\u0275\u0275elementStart(14,"button",76),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(o.toggleEditMode("tokenUri"))}),e.\u0275\u0275elementStart(15,"mat-icon",77),e.\u0275\u0275text(16,"create"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(17,Sl,3,3,"mat-error",15)(18,Tl,3,3,"mat-error",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(19,"mat-form-field",46)(20,"mat-label",13),e.\u0275\u0275text(21,"admin.oauth2.scope"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(22,"mat-chip-grid",null,2),e.\u0275\u0275template(24,Il,4,1,"mat-chip-row",79),e.\u0275\u0275elementStart(25,"input",80),e.\u0275\u0275listener("matChipInputTokenEnd",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(r.addScope(o))}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(26,wl,3,3,"mat-error",15),e.\u0275\u0275elementEnd()}if(2&a){const i=e.\u0275\u0275reference(23),n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(8),e.\u0275\u0275property("ngIf",n.mailSettings.get("authUri").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.mailSettings.get("authUri").hasError("pattern")),e.\u0275\u0275advance(8),e.\u0275\u0275property("ngIf",n.mailSettings.get("tokenUri").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.mailSettings.get("tokenUri").hasError("pattern")),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",n.mailSettings.get("scope").value)("ngForTrackBy",n.trackByParams),e.\u0275\u0275advance(),e.\u0275\u0275property("matChipInputFor",i)("matChipInputSeparatorKeyCodes",n.separatorKeysCodes),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.mailSettings.get("scope").hasError("required"))}}function Ml(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",34),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275pipe(3,"uppercase"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,4,e.\u0275\u0275pipeBind1(2,2,n.domainSchemaTranslations.get(i)))," ")}}function Nl(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.error-verification-url")," "))}function Al(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.domain-name-max-length")," "))}function Fl(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.domain-name-unique")," "))}function Dl(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"section")(1,"div",51)(2,"mat-form-field",46)(3,"mat-label",13),e.\u0275\u0275text(4,"admin.oauth2.client-id"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"input",61),e.\u0275\u0275template(6,fl,3,3,"mat-error",15)(7,hl,3,3,"mat-error",15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"mat-form-field",46)(9,"mat-label",13),e.\u0275\u0275text(10,"admin.oauth2.client-secret"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(11,"input",62),e.\u0275\u0275template(12,bl,3,3,"mat-error",15)(13,yl,3,3,"mat-error",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(14,Cl,5,1,"mat-form-field",44),e.\u0275\u0275elementStart(15,"mat-expansion-panel",63)(16,"mat-expansion-panel-header")(17,"mat-panel-description",64),e.\u0275\u0275text(18," tenant-profile.advanced-settings "),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(19,El,27,9,"ng-template",20),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"fieldset",21)(21,"legend",22),e.\u0275\u0275text(22,"admin.oauth2.redirect-uri"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(23,"div",65)(24,"div",66)(25,"div",67)(26,"mat-form-field",68)(27,"mat-label",13),e.\u0275\u0275text(28,"admin.oauth2.protocol"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(29,"mat-select",69),e.\u0275\u0275template(30,Ml,4,6,"mat-option",17),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(31,"mat-form-field",46)(32,"mat-label",13),e.\u0275\u0275text(33,"admin.domain-name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(34,"input",70),e.\u0275\u0275template(35,Nl,3,3,"mat-error",15)(36,Al,3,3,"mat-error",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(37,Fl,3,3,"mat-error",15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(38,"div",71)(39,"mat-form-field",46)(40,"mat-label",13),e.\u0275\u0275text(41,"admin.oauth2.redirect-uri-template"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(42,"input",72)(43,"tb-copy-button",73),e.\u0275\u0275pipe(44,"translate"),e.\u0275\u0275elementEnd()()()()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",i.mailSettings.get("clientId").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.mailSettings.get("clientId").hasError("maxlen gth")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.mailSettings.get("clientSecret").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.mailSettings.get("clientSecret").hasError("maxlength")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.mailSettings.get("providerId").value===i.mailServerOauth2Provider.OFFICE_365),e.\u0275\u0275advance(),e.\u0275\u0275property("expanded",i.mailSettings.get("providerId").value===i.mailServerOauth2Provider.CUSTOM),e.\u0275\u0275advance(9),e.\u0275\u0275property("formGroup",i.domainForm),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",i.protocols),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.domainForm.get("name").hasError("pattern")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.domainForm.get("name").hasError("maxlength")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.domainForm.hasError("unique")),e.\u0275\u0275advance(6),e.\u0275\u0275propertyInterpolate("tooltipText",e.\u0275\u0275pipeBind1(44,13,"admin.oauth2.copy-redirect-uri")),e.\u0275\u0275property("copyText",i.mailSettings.get("redirectUri").value)}}function Pl(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"section",83)(1,"div")(2,"span",84),e.\u0275\u0275text(3,"admin.oauth2.access-token-status"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"span"),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"button",85),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.generateAccessToken())}),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate1(" ",i.accessTokenStatus," "),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(7,3,i.isLoading$)||i.mailSettings.invalid||i.domainForm.invalid||i.mailSettings.dirty||i.domainForm.dirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",i.accessTokenButtonName," ")}}class Xi extends de.H{constructor(t,i,n,o,r,l,c,m){super(t),this.store=t,this.router=i,this.route=n,this.adminService=o,this.authService=r,this.translate=l,this.fb=c,this.window=m,this.smtpProtocols=Object.values(Re.zt),this.showChangePassword=!1,this.protocols=Object.values(J.a5).filter(h=>h!==J.a5.MIXED),this.domainSchemaTranslations=J.WT,this.mailServerOauth2Provider=Re.XW,this.tlsVersions=["TLSv1","TLSv1.1","TLSv1.2","TLSv1.3"],this.templates=new Map,this.templateProvider=["CUSTOM"],this.separatorKeysCodes=[ct.ENTER,ct.COMMA],this.destroy$=new fe.B,this.DOMAIN_AND_PORT_REGEXP=/^(?:\w+(?::\w+)?@)?[^\s/]+(?::\d+)?$/,this.URL_REGEXP=/^[A-Za-z][A-Za-z\d.+-]*:\/*(?:\w+(?::\w+)?@)?[^\s/]+(?::\d+)?(?:\/[\w#!:.,?+=&%@\-/]*)?$/,this.mailSettings=this.fb.group({mailFrom:["",[s.Validators.required]],smtpProtocol:[Re.zt.SMTP],smtpHost:["localhost",[s.Validators.required]],smtpPort:[25,[s.Validators.required,s.Validators.pattern(Re.am),s.Validators.maxLength(5)]],timeout:[1e4,[s.Validators.required,s.Validators.pattern(/^[0-9]{1,6}$/),s.Validators.maxLength(6)]],enableTls:[!1],tlsVersion:[{value:null,disabled:!0}],enableProxy:[!1],proxyHost:[{value:"",disabled:!0},[s.Validators.required]],proxyPort:[{value:null,disabled:!0},[s.Validators.required,s.Validators.min(1),s.Validators.max(65535)]],proxyUser:[{value:"",disabled:!0}],proxyPassword:[{value:"",disabled:!0}],username:[""],changePassword:[!1],password:[""],enableOauth2:[!1],providerId:["CUSTOM",[s.Validators.required]],clientId:[{value:"",disabled:!0},[s.Validators.required,s.Validators.maxLength(255)]],clientSecret:[{value:"",disabled:!0},[s.Validators.required,s.Validators.maxLength(2048)]],providerTenantId:[{value:"",disabled:!0},[s.Validators.required]],authUri:[{value:"",disabled:!0},[s.Validators.required,s.Validators.pattern(this.URL_REGEXP)]],tokenUri:[{value:"",disabled:!0},[s.Validators.required,s.Validators.pattern(this.URL_REGEXP)]],scope:[],redirectUri:[{value:"",disabled:!0}]}),this.defaultConfiguration={providerId:"CUSTOM",smtpProtocol:Re.zt.SMTP,smtpHost:"",smtpPort:null,timeout:null,enableTls:!1,tlsVersion:null,enableProxy:!1,proxyHost:"",proxyPort:null,proxyUser:"",proxyPassword:"",enableOauth2:!1,clientId:"",clientSecret:"",providerTenantId:"",authUri:"",tokenUri:"",scope:[],redirectUri:""},this.domainForm=this.fb.group({name:[this.window.location.hostname,[s.Validators.required,s.Validators.maxLength(255),s.Validators.pattern(this.DOMAIN_AND_PORT_REGEXP)]],scheme:[J.a5.HTTPS,s.Validators.required]})}ngOnInit(){this.mailServerSettingsForm(),this.domainFormConfiguration(),(0,Se.p)([this.adminService.getLoginProcessingUrl(),this.adminService.getMailConfigTemplate(),this.adminService.getAdminSettings("mail")]).subscribe(([t,i,n])=>{this.loginProcessingUrl=t,this.initTemplates(i),this.adminSettings=n,this.adminSettings.jsonValue&&(0,_.Kg)(this.adminSettings.jsonValue.enableTls)&&(this.adminSettings.jsonValue.enableTls="true"===this.adminSettings.jsonValue.enableTls),this.showChangePassword=!(0,_.f1)(this.adminSettings.jsonValue.showChangePassword)||this.adminSettings.jsonValue.showChangePassword,delete this.adminSettings.jsonValue.showChangePassword,this.adminSettings.jsonValue.providerId||(this.adminSettings.jsonValue.providerId="CUSTOM"),this.mailSettings.reset(this.adminSettings.jsonValue,{emitEvent:!1}),this.enableMailPassword(!this.showChangePassword),this.enableProxyChanged(),this.enableTls(this.adminSettings.jsonValue.enableTls),this.helpLink=this.templates.get(this.adminSettings.jsonValue.providerId)?.helpLink||null,this.adminSettings.jsonValue.enableOauth2?(this.enableOauth2(!!this.adminSettings.jsonValue.enableOauth2),this.enableProviderTenantIdChanged(this.adminSettings.jsonValue.providerId),this.parseUrl(this.adminSettings.jsonValue.redirectUri),this.mailSettings.get("redirectUri").patchValue(this.adminSettings.jsonValue.redirectUri,{emitEvent:!1})):this.mailSettings.get("enableOauth2").patchValue(!1,{emitEvent:!1})})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),super.ngOnDestroy()}initTemplates(t){t.map(i=>{delete i.additionalInfo,this.templates.set(i.providerId,i)}),this.templateProvider.push(...Array.from(this.templates.keys())),this.templateProvider.sort()}mailServerSettingsForm(){this.registerDisableOnLoadFormControl(this.mailSettings.get("smtpProtocol")),this.registerDisableOnLoadFormControl(this.mailSettings.get("enableTls")),this.registerDisableOnLoadFormControl(this.mailSettings.get("enableProxy")),this.registerDisableOnLoadFormControl(this.mailSettings.get("changePassword")),this.mailSettings.get("enableTls").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(t=>this.enableTls(t)),this.mailSettings.get("enableProxy").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(()=>{this.enableProxyChanged()}),this.mailSettings.get("changePassword").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(t=>{this.enableMailPassword(t)}),this.mailSettings.get("enableOauth2").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(t=>{this.enableOauth2(t),this.enableProviderTenantIdChanged(this.mailSettings.get("providerId").value),t&&!this.mailSettings.get("redirectUri").value&&this.mailSettings.get("redirectUri").patchValue(this.redirectURI(),{emitEvent:!1})}),this.mailSettings.get("providerTenantId").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(t=>{const i=this.templates.get(this.mailServerOauth2Provider.OFFICE_365).authorizationUri.replace("%s",`${t}`),n=this.templates.get(this.mailServerOauth2Provider.OFFICE_365).accessTokenUri.replace("%s",`${t}`);this.mailSettings.get("authUri").patchValue(i,{emitEvent:!1}),this.mailSettings.get("tokenUri").patchValue(n,{emitEvent:!1})}),this.mailSettings.get("providerId").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(t=>{if(t!==this.mailServerOauth2Provider.CUSTOM&&t){const i=this.templates.get(t);this.helpLink=i.helpLink,this.mailSettings.patchValue({smtpProtocol:Re.zt[i.smtpProtocol],smtpHost:i.smtpHost,smtpPort:i.smtpPort,timeout:i.timeout,enableTls:i.enableTls,tlsVersion:i.tlsVersion,authUri:i.authorizationUri,tokenUri:i.accessTokenUri,scope:i.scope,enableOauth2:!1,enableProxy:!1,proxyHost:"",proxyPort:null,proxyUser:"",proxyPassword:"",clientId:"",clientSecret:"",providerTenantId:"",redirectUri:""},{emitEvent:!1})}else this.mailSettings.reset({...this.adminSettings.jsonValue,...this.defaultConfiguration},{emitEvent:!1});this.enableTls(this.mailSettings.get("enableTls").value),this.enableOauth2(this.mailSettings.get("enableOauth2").value),this.enableProviderTenantIdChanged(t)})}domainFormConfiguration(){this.domainForm.get("name").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(t=>this.mailSettings.get("redirectUri").patchValue(this.redirectURI(this.domainForm.get("scheme").value,t),{emitEvent:!1})),this.domainForm.get("scheme").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(t=>this.mailSettings.get("redirectUri").patchValue(this.redirectURI(t),{emitEvent:!1}))}enableOauth2(t){t?(this.mailSettings.get("clientId").enable({emitEvent:!1}),this.mailSettings.get("clientSecret").enable({emitEvent:!1}),this.mailSettings.get("redirectUri").enable({emitEvent:!1}),this.mailSettings.get("providerId").value===this.mailServerOauth2Provider.CUSTOM?(this.mailSettings.get("authUri").enable({emitEvent:!1}),this.mailSettings.get("tokenUri").enable({emitEvent:!1})):(this.mailSettings.get("authUri").disable({emitEvent:!1}),this.mailSettings.get("tokenUri").disable({emitEvent:!1}))):(this.mailSettings.get("clientId").disable({emitEvent:!1}),this.mailSettings.get("clientSecret").disable({emitEvent:!1}),this.mailSettings.get("redirectUri").disable({emitEvent:!1}),this.mailSettings.get("authUri").disable({emitEvent:!1}),this.mailSettings.get("tokenUri").disable({emitEvent:!1}))}enableProviderTenantIdChanged(t){t===this.mailServerOauth2Provider.OFFICE_365&&this.mailSettings.get("enableOauth2").value?this.mailSettings.get("providerTenantId").enable({emitEvent:!1}):this.mailSettings.get("providerTenantId").disable({emitEvent:!1})}enableProxyChanged(){this.mailSettings.get("enableProxy").value?(this.mailSettings.get("proxyHost").enable({emitEvent:!1}),this.mailSettings.get("proxyPort").enable({emitEvent:!1}),this.mailSettings.get("proxyUser").enable({emitEvent:!1}),this.mailSettings.get("proxyPassword").enable({emitEvent:!1})):(this.mailSettings.get("proxyHost").disable({emitEvent:!1}),this.mailSettings.get("proxyPort").disable({emitEvent:!1}),this.mailSettings.get("proxyUser").disable({emitEvent:!1}),this.mailSettings.get("proxyPassword").disable({emitEvent:!1}))}enableMailPassword(t){t?this.mailSettings.get("password").enable({emitEvent:!1}):this.mailSettings.get("password").disable({emitEvent:!1})}enableTls(t){t?this.mailSettings.get("tlsVersion").enable({emitEvent:!1}):this.mailSettings.get("tlsVersion").disable({emitEvent:!1})}sendTestMail(){this.adminSettings.jsonValue={...this.adminSettings.jsonValue,...this.mailSettingsFormValue},this.adminService.sendTestMail(this.adminSettings).subscribe({next:()=>this.store.dispatch(new $.xo({message:this.translate.instant("admin.test-mail-sent"),type:"success"})),error:t=>this.store.dispatch(new $.xo({message:t.error.message,type:"error"}))})}save(){this.adminSettings.jsonValue={...this.adminSettings.jsonValue,...this.mailSettingsFormValue},this.adminService.saveAdminSettings(this.adminSettings).subscribe(t=>{this.adminSettings=t,this.showChangePassword=!0,this.mailSettings.reset(this.adminSettings.jsonValue,{emitEvent:!1}),this.domainForm.reset(this.domainForm.value),this.parseUrl(this.adminSettings.jsonValue.redirectUri)})}generateAccessToken(){this.adminService.generateAccessToken().subscribe(t=>this.window.location.href=t)}redirectURI(t,i){const n=this.domainForm.value;if(""!==n.name){return`${(0,_.O9)(t)?t.toLowerCase():n.scheme.toLowerCase()}://${(0,_.O9)(i)?i:n.name}${this.loginProcessingUrl}`}return""}parseUrl(t){if(t){const i=new URL(t);this.domainForm.get("scheme").patchValue(i.protocol.startsWith("https")?J.a5.HTTPS:J.a5.HTTP,{emitEvent:!1}),this.domainForm.get("name").patchValue(i.host,{emitEvent:!1})}}get accessTokenButtonName(){return this.translate.instant(this.adminSettings.jsonValue.tokenGenerated?"admin.oauth2.update-access-token":"admin.oauth2.generate-access-token")}get accessTokenStatus(){return this.translate.instant(this.adminSettings.jsonValue.tokenGenerated?"admin.oauth2.token-status-generated":"admin.oauth2.token-status-not-generated")}confirmForm(){return this.mailSettings}get mailSettingsFormValue(){const t=this.mailSettings.getRawValue();return delete t.changePassword,(0,_.f1)(t.password)||delete t.password,t}trackByParams(t){return t}removeScope(t){const i=this.mailSettings.get("scope");i.removeAt(t),i.markAsTouched(),i.markAsDirty()}addScope(t){const i=t.chipInput.inputElement,n=t.value,o=this.mailSettings.get("scope");""!==n.trim()&&(o.push(this.fb.control(n.trim())),o.markAsDirty()),i&&(i.value="")}toggleEditMode(t){this.mailSettings.get(t).disabled?this.mailSettings.get(t).enable():this.mailSettings.get(t).disable()}static{this.\u0275fac=function(i){return new(i||Xi)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(b.ActivatedRoute),e.\u0275\u0275directiveInject(Zi.z),e.\u0275\u0275directiveInject(on.u),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(s.FormBuilder),e.\u0275\u0275directiveInject(mr.jf))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Xi,selectors:[["tb-mail-server"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:60,vars:42,consts:[["smtpPortInput",""],["timeoutInput",""],["scopeList",""],["appearance","outlined",1,"settings-card"],["translate","",1,"mat-headline-5"],[1,"flex-1"],["tb-help","outgoingMailSettings"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[2,"padding-top","16px"],[3,"ngSubmit","formGroup"],[3,"disabled"],[1,"mat-block"],["translate",""],["matInput","","formControlName","mailFrom","required",""],[4,"ngIf"],["formControlName","providerId"],[3,"value",4,"ngFor","ngForOf"],[1,"configuration-panel","mat-elevation-z0",3,"expanded"],["translate","",1,"flex","items-center","justify-start"],["matExpansionPanelContent",""],[1,"fields-group","flex","flex-col"],["translate","",1,"group-title"],["matInput","","formControlName","username","autocomplete","new-username",3,"placeholder"],[1,"flex","items-center","justify-between",2,"height","50px","padding-bottom","20px"],["formControlName","enableOauth2",1,"tb-notification-unread-toggle-group",2,"width","250px"],[1,"flex-1",3,"value"],["class","details-buttons",4,"ngIf"],["class","flex flex-row pb-3 xs:flex-col gt-xs:items-center gt-xs:justify-between",4,"ngIf"],[1,"flex","flex-row","items-center","justify-end","gap-4","xs:flex-col","xs:items-stretch"],["mat-raised-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[3,"value"],["formControlName","smtpProtocol"],[1,"gt-sm:flex","gt-sm:flex-row","gt-sm:gap-2.5"],[1,"mat-block","flex-full","gt-sm:max-w-60%"],["matInput","","formControlName","smtpHost","placeholder","localhost","required",""],[1,"mat-block","flex-full","gt-sm:max-w-40%"],["matInput","","formControlName","smtpPort","placeholder","25","maxlength","5","required",""],["align","end"],["matInput","","formControlName","timeout","placeholder","10000","maxlength","6","required",""],["formControlName","enableTls",1,"flex-1",2,"display","block","padding-bottom","22px"],["class","mat-block flex-1",4,"ngIf"],["formControlName","enableProxy",2,"display","block","padding-bottom","22px"],[1,"mat-block","flex-1"],["formControlName","tlsVersion"],[1,"gt-sm:flex","gt-sm:flex-row","gt-sm:gap-2"],["matInput","","required","","formControlName","proxyHost"],["matInput","","required","","formControlName","proxyPort","type","number","step","1","min","1","max","65535"],[1,"flex","flex-row","xs:flex-col","gt-xs:gap-2"],["matInput","","formControlName","proxyUser"],["matInput","","type","password","formControlName","proxyPassword","autocomplete","new-proxy-password"],["matSuffix",""],[1,"details-buttons"],[3,"tb-help"],["formControlName","changePassword","style","padding-bottom: 16px;",4,"ngIf"],["class","mat-block",4,"ngIf"],["formControlName","changePassword",2,"padding-bottom","16px"],["matInput","","formControlName","password","type","password","autocomplete","new-password",3,"placeholder"],["matInput","","formControlName","clientId","required",""],["matInput","","formControlName","clientSecret","required",""],[1,"mat-elevation-z0",3,"expanded"],["translate","",1,"flex","items-stretch","justify-end"],[1,"flex","flex-1","flex-row","gap-2","xs:flex-col"],[1,"flex","flex-col","sm:max-w-60%","sm:flex-full","gt-sm:max-w-50%","gt-sm:flex-full",3,"formGroup"],[1,"flex","flex-row","gap-2","xs:flex-col","md:flex-col","md:gap-0"],[1,"mat-block","max-w-30%","flex-full","xs:max-w-full","xs:flex-1","md:max-w-full","md:flex-1"],["formControlName","scheme"],["matInput","","formControlName","name","required",""],[1,"flex","flex-1","flex-col"],["matInput","","formControlName","redirectUri","readonly",""],["matSuffix","","color","primary","tooltipPosition","above","icon","mdi:clipboard-arrow-left",3,"copyText","tooltipText"],["matInput","","formControlName","providerTenantId","required",""],["matInput","","formControlName","authUri","required",""],["mat-icon-button","","matSuffix","","type","button",3,"click"],[1,"material-icons"],["matInput","","formControlName","tokenUri","required",""],["removable","",3,"removed",4,"ngFor","ngForOf","ngForTrackBy"],["matChipInputAddOnBlur","",3,"matChipInputTokenEnd","matChipInputFor","matChipInputSeparatorKeyCodes"],["removable","",3,"removed"],["matChipRemove",""],[1,"flex","flex-row","pb-3","xs:flex-col","gt-xs:items-center","gt-xs:justify-between"],["translate","",1,"token-status"],["mat-raised-button","","type","button","color","primary",3,"click","disabled"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div")(1,"mat-card",3)(2,"mat-card-header")(3,"mat-card-title")(4,"span",4),e.\u0275\u0275text(5,"admin.outgoing-mail-settings"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(6,"span",5)(7,"div",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(8,Ks,1,0,"mat-progress-bar",7),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275template(10,Ys,1,0,"div",8),e.\u0275\u0275pipe(11,"async"),e.\u0275\u0275elementStart(12,"mat-card-content",9)(13,"form",10),e.\u0275\u0275listener("ngSubmit",function(){return n.save()}),e.\u0275\u0275elementStart(14,"fieldset",11),e.\u0275\u0275pipe(15,"async"),e.\u0275\u0275elementStart(16,"mat-form-field",12)(17,"mat-label",13),e.\u0275\u0275text(18,"admin.mail-from"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(19,"input",14),e.\u0275\u0275template(20,Qs,3,3,"mat-error",15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"mat-form-field",12)(22,"mat-label",13),e.\u0275\u0275text(23,"admin.oauth2.smtp-provider"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(24,"mat-select",16),e.\u0275\u0275template(25,Js,2,2,"mat-option",17),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(26,"mat-expansion-panel",18)(27,"mat-expansion-panel-header")(28,"mat-panel-title",19),e.\u0275\u0275text(29," admin.connection-settings "),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(30,cl,37,16,"ng-template",20),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(31,"fieldset",21)(32,"legend",22),e.\u0275\u0275text(33,"admin.oauth2.authentication"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(34,"mat-form-field",12)(35,"mat-label",13),e.\u0275\u0275text(36,"common.username"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(37,"input",23),e.\u0275\u0275pipe(38,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(39,"div",24)(40,"mat-button-toggle-group",25)(41,"mat-button-toggle",26),e.\u0275\u0275text(42),e.\u0275\u0275pipe(43,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(44,"mat-button-toggle",26),e.\u0275\u0275text(45),e.\u0275\u0275pipe(46,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(47,pl,2,1,"div",27),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(48,gl,3,2,"section",15)(49,Dl,45,15,"section",15)(50,Pl,9,5,"section",28),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(51,"div",29)(52,"button",30),e.\u0275\u0275pipe(53,"async"),e.\u0275\u0275listener("click",function(){return n.sendTestMail()}),e.\u0275\u0275text(54),e.\u0275\u0275pipe(55,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(56,"button",31),e.\u0275\u0275pipe(57,"async"),e.\u0275\u0275text(58),e.\u0275\u0275pipe(59,"translate"),e.\u0275\u0275elementEnd()()()()()()()),2&i&&(e.\u0275\u0275advance(8),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(9,22,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(11,24,n.isLoading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("formGroup",n.mailSettings),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(15,26,n.isLoading$)),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.mailSettings.get("mailFrom").hasError("required")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",n.templateProvider),e.\u0275\u0275advance(),e.\u0275\u0275property("expanded",n.mailSettings.get("providerId").value===n.mailServerOauth2Provider.CUSTOM),e.\u0275\u0275advance(11),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(38,28,"common.enter-username")),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden","SENDGRID"===n.mailSettings.get("providerId").value),e.\u0275\u0275advance(2),e.\u0275\u0275property("value",!1),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(43,30,"admin.oauth2.basic")),e.\u0275\u0275advance(2),e.\u0275\u0275property("value",!0),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(46,32,"admin.oauth2.oauth2")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.helpLink&&n.mailSettings.get("enableOauth2").value),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n.mailSettings.get("enableOauth2").value),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.mailSettings.get("enableOauth2").value),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.mailSettings.get("enableOauth2").value),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(53,34,n.isLoading$)||n.mailSettings.get("enableOauth2").value?n.mailSettings.invalid||n.domainForm.invalid||n.mailSettings.dirty||n.domainForm.dirty:n.mailSettings.invalid),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(55,36,"admin.send-test-mail")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(57,38,n.isLoading$)||n.mailSettings.invalid||n.domainForm.invalid||!n.mailSettings.dirty&&!n.domainForm.dirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(59,40,"action.save")," "))},dependencies:[p.NgForOf,p.NgIf,be.HelpComponent,x.MatButton,x.MatIconButton,rn.MatButtonToggleGroup,rn.MatButtonToggle,Te.MatCheckbox,E.MatIcon,D.MatCard,D.MatCardContent,D.MatCardHeader,D.MatCardTitle,K.MatProgressBar,L.MatInput,v.MatFormField,v.MatLabel,v.MatHint,v.MatError,v.MatSuffix,ce.MatSelect,z.MatOption,pe.MatSlideToggle,U.MatExpansionPanel,U.MatExpansionPanelHeader,U.MatExpansionPanelTitle,U.MatExpansionPanelDescription,U.MatExpansionPanelContent,Ie.MatChipGrid,Ie.MatChipInput,Ie.MatChipRemove,Ie.MatChipRow,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NumberValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.MaxLengthValidator,s.MinValidator,s.MaxValidator,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,ur.CopyButtonComponent,Rr.TogglePasswordComponent,p.AsyncPipe,p.UpperCasePipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 8px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{margin-bottom:8px;color:#000000b3;width:fit-content}[_nghost-%COMP%]   .token-status[_ngcontent-%COMP%]{font:400 14px/16px Roboto,Helvetica Neue,sans-serif;color:#0009;letter-spacing:.25px;padding:8px 0}[_nghost-%COMP%]     .mat-expansion-panel .mat-expansion-panel-header{height:48px;padding:0 12px}[_nghost-%COMP%]     .mat-expansion-panel .mat-expansion-panel-header.mat-expanded{height:48px}[_nghost-%COMP%]     .mat-expansion-panel .mat-expansion-panel-body{padding:0 12px}[_nghost-%COMP%]     .mat-expansion-panel.configuration-panel{border:1px solid rgba(0,0,0,.2)}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group.mat-button-toggle-group-appearance-standard{border:none;border-radius:14px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group.mat-button-toggle-group-appearance-standard .mat-button-toggle+.mat-button-toggle{border-left:none}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle{background:#0000000f;height:28px;align-items:center;display:flex}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle .mat-button-toggle-ripple{inset:2px;border-radius:12px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-button{color:#959595}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-focus-overlay{border-radius:14px;margin:2px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-checked .mat-button-toggle-button{background-color:#305680;color:#fff;border-radius:14px;margin-left:2px;margin-right:2px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-appearance-standard .mat-button-toggle-label-content{line-height:24px;font-size:16px;font-weight:500}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-appearance-standard .mat-button-toggle-label-content .mat-pseudo-checkbox{display:none}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-checked.mat-button-toggle-appearance-standard:not(.mat-button-toggle-disabled):hover .mat-button-toggle-focus-overlay{opacity:.01}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']})}}var P=d(86057),g=d(9437),sn=d(29772),ea=d(18409),Vr=d(86941);const ln=a=>({protocol:a});function kl(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",25)}function Ll(a,t){1&a&&e.\u0275\u0275element(0,"div",26)}function Ol(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.base-url-required")," "))}function Rl(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",25)}function Vl(a,t){1&a&&e.\u0275\u0275element(0,"div",26)}function Bl(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function Gl(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function jl(a,t){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Bl,1,0,"ng-container",27)(2,Gl,1,0,"ng-container",27),e.\u0275\u0275elementContainerEnd()),2&a){const i=e.\u0275\u0275nextContext(),n=e.\u0275\u0275reference(63);e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(4,ln,i.protocol)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(6,ln,i.protocol+"s"))}}function Ul(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function ql(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function Wl(a,t){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Ul,1,0,"ng-container",27)(2,ql,1,0,"ng-container",27),e.\u0275\u0275elementContainerEnd()),2&a){const i=e.\u0275\u0275nextContext(),n=e.\u0275\u0275reference(63);e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(4,ln,i.protocol)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(6,ln,i.protocol+"s"))}}function $l(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function zl(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function Hl(a,t){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,$l,1,0,"ng-container",27)(2,zl,1,0,"ng-container",27),e.\u0275\u0275elementContainerEnd()),2&a){const i=e.\u0275\u0275nextContext(),n=e.\u0275\u0275reference(63);e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(4,ln,i.protocol)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(6,ln,i.protocol+"s"))}}function Kl(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.device-connectivity.port-pattern")," "))}function Yl(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.device-connectivity.port-range")," "))}function Ql(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",28)(1,"mat-slide-toggle",29),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",30)(5,"mat-form-field",31)(6,"mat-label",9),e.\u0275\u0275text(7,"admin.device-connectivity.host"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(8,"input",32),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"mat-form-field",31)(10,"mat-label",9),e.\u0275\u0275text(11,"admin.device-connectivity.port"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(12,"input",33),e.\u0275\u0275template(13,Kl,3,3,"mat-error",11)(14,Yl,3,3,"mat-error",11),e.\u0275\u0275elementEnd()()()),2&a){const i=t.protocol,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("formGroupName",i),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,4,"admin.device-connectivity."+i)," "),e.\u0275\u0275advance(11),e.\u0275\u0275property("ngIf",n.deviceConnectivitySettingsForm.get(i+".port").hasError("pattern")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.deviceConnectivitySettingsForm.get(i+".port").hasError("min")||n.deviceConnectivitySettingsForm.get(i+".port").hasError("max"))}}class ta extends de.H{constructor(t,i,n){super(t),this.store=t,this.adminService=i,this.fb=n,this.protocol="http",this.destroy$=new fe.B,this.buildGeneralServerSettingsForm(),this.adminService.getAdminSettings("general").subscribe(o=>this.processGeneralSettings(o)),this.buildDeviceConnectivitySettingsForm(),this.adminService.getAdminSettings("connectivity").subscribe(o=>this.processDeviceConnectivitySettings(o))}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}buildGeneralServerSettingsForm(){this.generalSettings=this.fb.group({baseUrl:["",[s.Validators.required]],prohibitDifferentUrl:["",[]]})}buildDeviceConnectivitySettingsForm(){this.deviceConnectivitySettingsForm=this.fb.group({http:this.buildDeviceConnectivityInfoForm(),https:this.buildDeviceConnectivityInfoForm(),mqtt:this.buildDeviceConnectivityInfoForm(),mqtts:this.buildDeviceConnectivityInfoForm(),coap:this.buildDeviceConnectivityInfoForm(),coaps:this.buildDeviceConnectivityInfoForm()})}buildDeviceConnectivityInfoForm(){const t=this.fb.group({enabled:[!1,[]],host:[{value:"",disabled:!0}],port:[{value:null,disabled:!0},[s.Validators.min(1),s.Validators.max(65535),s.Validators.pattern("[0-9]*")]]});return t.get("enabled").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(i=>{i?(t.get("host").enable({emitEvent:!1}),t.get("port").enable({emitEvent:!1})):(t.get("host").disable({emitEvent:!1}),t.get("port").disable({emitEvent:!1}))}),t}save(){this.adminSettings.jsonValue={...this.adminSettings.jsonValue,...this.generalSettings.value},this.adminService.saveAdminSettings(this.adminSettings).subscribe(t=>this.processGeneralSettings(t))}saveDeviceConnectivitySettings(){this.deviceConnectivitySettings.jsonValue={...this.deviceConnectivitySettings.jsonValue,...this.deviceConnectivitySettingsForm.getRawValue()},this.adminService.saveAdminSettings(this.deviceConnectivitySettings).subscribe(t=>this.processDeviceConnectivitySettings(t))}discardGeneralSettings(){this.generalSettings.reset(this.adminSettings.jsonValue)}discardDeviceConnectivitySettings(){this.deviceConnectivitySettingsForm.reset(this.deviceConnectivitySettings.jsonValue)}processGeneralSettings(t){this.adminSettings=t,this.generalSettings.reset(this.adminSettings.jsonValue)}processDeviceConnectivitySettings(t){this.deviceConnectivitySettings=t,this.deviceConnectivitySettingsForm.reset(this.deviceConnectivitySettings.jsonValue)}confirmForm(){return this.generalSettings.dirty?this.generalSettings:this.deviceConnectivitySettingsForm}static{this.\u0275fac=function(i){return new(i||ta)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(Zi.z),e.\u0275\u0275directiveInject(s.FormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:ta,selectors:[["tb-general-settings"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:72,vars:60,consts:[["connectivitySettings",""],["appearance","outlined",1,"settings-card"],[1,"flex","flex-row"],["translate","",1,"mat-headline-5"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[1,"tb-form-panel","no-border","no-padding",3,"ngSubmit","formGroup"],[3,"disabled"],[1,"mat-block"],["translate",""],["matInput","","formControlName","baseUrl","required",""],[4,"ngIf"],[1,"tb-form-row",3,"tb-hint-tooltip-icon"],["formControlName","prohibitDifferentUrl",1,"mat-slide","margin"],[1,"flex","flex-row","flex-wrap","items-center","justify-end","gap-2"],["mat-button","","color","primary","type","button",3,"click","disabled"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],[1,"tb-form-panel","no-border","no-padding"],[1,"tb-form-panel","no-border","no-padding","toggle-group"],["appearance","fill",3,"ngModelChange","ngModel"],["value","http"],["value","mqtt"],["value","coap"],[1,"tb-form-hint","tb-primary-fill"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"tb-form-panel","stroked","no-padding-bottom",3,"formGroupName"],["formControlName","enabled",1,"mat-slide"],[1,"tb-form-row","column-xs","no-border","no-padding","tb-standard-fields"],[1,"flex-1"],["matInput","","formControlName","host"],["matInput","","type","number","min","0","max","65535","formControlName","port"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-card",1)(1,"mat-card-header")(2,"mat-card-title")(3,"div",2)(4,"span",3),e.\u0275\u0275text(5,"admin.general-settings"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275template(6,kl,1,0,"mat-progress-bar",4),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275template(8,Ll,1,0,"div",5),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275elementStart(10,"mat-card-content")(11,"form",6),e.\u0275\u0275listener("ngSubmit",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.save())}),e.\u0275\u0275elementStart(12,"fieldset",7),e.\u0275\u0275pipe(13,"async"),e.\u0275\u0275elementStart(14,"div")(15,"mat-form-field",8)(16,"mat-label",9),e.\u0275\u0275text(17,"admin.base-url"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(18,"input",10),e.\u0275\u0275template(19,Ol,3,3,"mat-error",11),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"div",12),e.\u0275\u0275pipe(21,"translate"),e.\u0275\u0275elementStart(22,"mat-slide-toggle",13),e.\u0275\u0275text(23),e.\u0275\u0275pipe(24,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(25,"div",14)(26,"button",15),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.discardGeneralSettings())}),e.\u0275\u0275text(27),e.\u0275\u0275pipe(28,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(29,"button",16),e.\u0275\u0275pipe(30,"async"),e.\u0275\u0275text(31),e.\u0275\u0275pipe(32,"translate"),e.\u0275\u0275elementEnd()()()()(),e.\u0275\u0275elementStart(33,"mat-card",1)(34,"mat-card-header")(35,"mat-card-title")(36,"div",3),e.\u0275\u0275text(37,"admin.device-connectivity.device-connectivity"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(38,Rl,1,0,"mat-progress-bar",4),e.\u0275\u0275pipe(39,"async"),e.\u0275\u0275template(40,Vl,1,0,"div",5),e.\u0275\u0275pipe(41,"async"),e.\u0275\u0275elementStart(42,"mat-card-content")(43,"section",17)(44,"div",18)(45,"tb-toggle-select",19),e.\u0275\u0275twoWayListener("ngModelChange",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275twoWayBindingSet(n.protocol,l)||(n.protocol=l),e.\u0275\u0275resetView(l)}),e.\u0275\u0275elementStart(46,"tb-toggle-option",20),e.\u0275\u0275text(47),e.\u0275\u0275pipe(48,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(49,"tb-toggle-option",21),e.\u0275\u0275text(50),e.\u0275\u0275pipe(51,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(52,"tb-toggle-option",22),e.\u0275\u0275text(53),e.\u0275\u0275pipe(54,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(55,"div",23),e.\u0275\u0275text(56),e.\u0275\u0275pipe(57,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(58,"form",6),e.\u0275\u0275listener("ngSubmit",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.saveDeviceConnectivitySettings())}),e.\u0275\u0275template(59,jl,3,8,"ng-container",11)(60,Wl,3,8,"ng-container",11)(61,Hl,3,8,"ng-container",11)(62,Ql,15,6,"ng-template",null,0,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(64,"div",14)(65,"button",15),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.discardDeviceConnectivitySettings())}),e.\u0275\u0275text(66),e.\u0275\u0275pipe(67,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(68,"button",24),e.\u0275\u0275pipe(69,"async"),e.\u0275\u0275text(70),e.\u0275\u0275pipe(71,"translate"),e.\u0275\u0275elementEnd()()()()()()}2&i&&(e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(7,26,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(9,28,n.isLoading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("formGroup",n.generalSettings),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(13,30,n.isLoading$)),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",n.generalSettings.get("baseUrl").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("tb-hint-tooltip-icon",e.\u0275\u0275pipeBind1(21,32,"admin.prohibit-different-url-hint")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(24,34,"admin.prohibit-different-url")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",n.generalSettings.pristine),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(28,36,"action.undo")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(30,38,n.isLoading$)||n.generalSettings.invalid||!n.generalSettings.dirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(32,40,"action.save")," "),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(39,42,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(41,44,n.isLoading$)),e.\u0275\u0275advance(5),e.\u0275\u0275twoWayProperty("ngModel",n.protocol),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(48,46,"admin.device-connectivity.http-s")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(51,48,"admin.device-connectivity.mqtt-s")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(54,50,"admin.device-connectivity.coap-s")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(57,52,"admin.device-connectivity.hint")),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.deviceConnectivitySettingsForm),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","http"===n.protocol),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","mqtt"===n.protocol),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","coap"===n.protocol),e.\u0275\u0275advance(4),e.\u0275\u0275property("disabled",n.deviceConnectivitySettingsForm.pristine),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(67,54,"action.undo")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(69,56,n.isLoading$)||n.deviceConnectivitySettingsForm.invalid||!n.deviceConnectivitySettingsForm.dirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(71,58,"action.save")," "))},dependencies:[p.NgIf,p.NgTemplateOutlet,x.MatButton,D.MatCard,D.MatCardContent,D.MatCardHeader,D.MatCardTitle,K.MatProgressBar,L.MatInput,v.MatFormField,v.MatLabel,v.MatError,pe.MatSlideToggle,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NumberValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.MinValidator,s.MaxValidator,s.NgModel,s.FormGroupDirective,s.FormControlName,s.FormGroupName,u.TranslateDirective,sn.ToggleOption,ea.ToggleSelectComponent,Vr.HintTooltipIconComponent,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]   .settings-card[_ngcontent-%COMP%]   .toggle-group[_ngcontent-%COMP%]{max-width:670px;width:100%;margin:0 auto}[_nghost-%COMP%]   .settings-card[_ngcontent-%COMP%]   .toggle-group[_ngcontent-%COMP%]   .tb-form-hint[_ngcontent-%COMP%]{text-align:center}@media screen and (max-width: 599px){[_nghost-%COMP%]   .settings-card[_ngcontent-%COMP%]   .tb-form-row[_ngcontent-%COMP%]{gap:0}}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']})}}var Z=d(73028),ne=d(88141),Ce=d(80216),H=d(7673);function Jl(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",47)}function Zl(a,t){1&a&&e.\u0275\u0275element(0,"div",48)}function Xl(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.minimum-max-failed-login-attempts-range")," "))}function ed(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.user-activation-token-ttl-range")," "))}function td(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.user-activation-token-ttl-range")," "))}function nd(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.password-reset-token-ttl-range")," "))}function id(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.password-reset-token-ttl-range")," "))}function ad(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.mobile-secret-key-length-range")," "))}function od(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.minimum-password-length-required")," "))}function rd(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.minimum-password-length-range")," "))}function sd(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.minimum-password-length-range")," "))}function ld(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.maximum-password-length-min")," "))}function dd(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.maximum-password-length-less-min")," "))}function cd(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.minimum-uppercase-letters-range")," "))}function pd(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.minimum-lowercase-letters-range")," "))}function md(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.minimum-digits-range")," "))}function ud(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.minimum-special-characters-range")," "))}function gd(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.password-expiration-period-days-range")," "))}function fd(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.password-reuse-frequency-days-range")," "))}function hd(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.jwt.issuer-name-required")," "))}function bd(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.jwt.signings-key-required")," "))}function yd(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.jwt.signings-key-base64")," "))}function vd(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.jwt.signings-key-min-length")," "))}function Cd(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.jwt.expiration-time-required")," "))}function xd(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.jwt.expiration-time-pattern")," "))}function _d(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.jwt.expiration-time-min")," "))}function Sd(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.jwt.refresh-expiration-time-required")," "))}function Td(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.jwt.refresh-expiration-time-pattern")," "))}function Id(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.jwt.refresh-expiration-time-min")," "))}function wd(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.jwt.refresh-expiration-time-less-token")," "))}class na extends de.H{constructor(t,i,n,o,r,l,c){super(t),this.store=t,this.router=i,this.adminService=n,this.authService=o,this.dialogService=r,this.translate=l,this.fb=c,this.showMainLoadingBar=!1,this.buildSecuritySettingsForm(),this.buildJwtSecuritySettingsForm(),this.adminService.getSecuritySettings().subscribe(m=>this.processSecuritySettings(m)),this.adminService.getJwtSettings().subscribe(m=>this.processJwtSettings(m))}buildSecuritySettingsForm(){this.securitySettingsFormGroup=this.fb.group({maxFailedLoginAttempts:[null,[s.Validators.min(0)]],userLockoutNotificationEmail:["",[]],userActivationTokenTtl:[24,[s.Validators.required,s.Validators.min(1),s.Validators.max(24)]],passwordResetTokenTtl:[24,[s.Validators.required,s.Validators.min(1),s.Validators.max(24)]],mobileSecretKeyLength:[null,[s.Validators.min(1)]],passwordPolicy:this.fb.group({minimumLength:[null,[s.Validators.required,s.Validators.min(6),s.Validators.max(50)]],maximumLength:[null,[s.Validators.min(6),this.maxPasswordValidation()]],minimumUppercaseLetters:[null,s.Validators.min(0)],minimumLowercaseLetters:[null,s.Validators.min(0)],minimumDigits:[null,s.Validators.min(0)],minimumSpecialCharacters:[null,s.Validators.min(0)],passwordExpirationPeriodDays:[null,s.Validators.min(0)],passwordReuseFrequencyDays:[null,s.Validators.min(0)],allowWhitespaces:[!0],forceUserToResetPasswordIfNotValid:[!1]})})}buildJwtSecuritySettingsForm(){this.jwtSecuritySettingsFormGroup=this.fb.group({tokenIssuer:["",s.Validators.required],tokenSigningKey:["",[s.Validators.required,this.base64Format]],tokenExpirationTime:[0,[s.Validators.required,s.Validators.pattern("[0-9]*"),s.Validators.min(60)]],refreshTokenExpTime:[0,[s.Validators.required,s.Validators.pattern("[0-9]*"),s.Validators.min(900)]]},{validators:this.refreshTokenTimeGreatTokenTime.bind(this)}),this.jwtSecuritySettingsFormGroup.get("tokenExpirationTime").valueChanges.subscribe(()=>this.jwtSecuritySettingsFormGroup.get("refreshTokenExpTime").updateValueAndValidity({onlySelf:!0}))}save(){this.securitySettings={...this.securitySettings,...this.securitySettingsFormGroup.value},this.adminService.saveSecuritySettings(this.securitySettings).subscribe(t=>this.processSecuritySettings(t))}saveJwtSettings(){const t=this.jwtSecuritySettingsFormGroup.value;this.confirmChangeJWTSettings().pipe((0,Z.Z)(i=>i?this.adminService.saveJwtSettings(t).pipe((0,ne.M)(n=>this.authService.setUserFromJwtToken(n.token,n.refreshToken,!1)),(0,Z.Z)(()=>this.adminService.getJwtSettings()),(0,ne.M)(n=>this.processJwtSettings(n))):(0,H.of)(null))).subscribe(()=>{})}maxPasswordValidation(){return t=>{const i=t.value;return i&&i<t.parent.value?.minimumLength?{lessMin:!0}:null}}discardSetting(){this.securitySettingsFormGroup.reset(this.securitySettings)}discardJwtSetting(){this.jwtSecuritySettingsFormGroup.reset(this.jwtSettings)}markAsTouched(){this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").markAsTouched()}confirmChangeJWTSettings(){return this.jwtSecuritySettingsFormGroup.get("tokenIssuer").value!==(this.jwtSettings?.tokenIssuer||"")||this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").value!==(this.jwtSettings?.tokenSigningKey||"")?this.dialogService.confirm(this.translate.instant("admin.jwt.info-header"),`<div style="max-width: 640px">${this.translate.instant("admin.jwt.info-message")}</div>`,this.translate.instant("action.discard-changes"),this.translate.instant("action.confirm")):(0,H.of)(!0)}generateSigningKey(){this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").setValue(btoa((0,_.N8)(64))),this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").pristine&&(this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").markAsDirty(),this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").markAsTouched())}processSecuritySettings(t){this.securitySettings=t,this.securitySettingsFormGroup.reset(this.securitySettings)}processJwtSettings(t){this.jwtSettings=t,this.jwtSecuritySettingsFormGroup.reset(t)}refreshTokenTimeGreatTokenTime(t){if(t){if(t.value.tokenExpirationTime>=t.value.refreshTokenExpTime)return t.get("refreshTokenExpTime").untouched&&t.get("refreshTokenExpTime").markAsTouched(),t.get("refreshTokenExpTime").setErrors({lessToken:!0}),{lessToken:!0}}return null}base64Format(t){if(""===t.value||"thingsboardDefaultSigningKey"===t.value)return null;try{return atob(t.value).length<64?{minLength:!0}:null}catch{return{base64:!0}}}confirmForm(){return this.securitySettingsFormGroup.dirty?this.securitySettingsFormGroup:this.jwtSecuritySettingsFormGroup}static{this.\u0275fac=function(i){return new(i||na)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(Zi.z),e.\u0275\u0275directiveInject(on.u),e.\u0275\u0275directiveInject(Ce.o),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:na,selectors:[["tb-security-settings"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:166,vars:71,consts:[["appearance","outlined",1,"settings-card"],["translate","",1,"mat-headline-5"],[1,"flex-1"],["tb-help","securitySettings"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["autocomplete","off",3,"ngSubmit","formGroup"],[3,"disabled"],[1,"fields-group"],["translate","",1,"group-title"],[1,"mat-block"],["translate",""],["matInput","","type","number","formControlName","maxFailedLoginAttempts","step","1","min","0"],[4,"ngIf"],["matInput","","type","email","formControlName","userLockoutNotificationEmail"],["matInput","","type","number","formControlName","userActivationTokenTtl","step","1","min","1","max","24"],["matInput","","type","number","formControlName","passwordResetTokenTtl","step","1","min","1","max","24"],["matInput","","type","number","formControlName","mobileSecretKeyLength","step","1","min","1"],["formGroupName","passwordPolicy"],[1,"flex","flex-row","xs:flex-col","gt-xs:gap-2"],[1,"mat-block","flex-1"],["matInput","","type","number","formControlName","minimumLength","step","1","min","6","max","50","required",""],["subscriptSizing","dynamic",1,"mat-block","flex-1"],["matInput","","type","number","formControlName","maximumLength","step","1","min","6"],["matInput","","type","number","formControlName","minimumUppercaseLetters","step","1","min","0"],["matInput","","type","number","formControlName","minimumLowercaseLetters","step","1","min","0"],["matInput","","type","number","formControlName","minimumDigits","step","1","min","0"],["matInput","","type","number","formControlName","minimumSpecialCharacters","step","1","min","0"],["matInput","","type","number","formControlName","passwordExpirationPeriodDays","step","1","min","0"],["matInput","","type","number","formControlName","passwordReuseFrequencyDays","step","1","min","0"],["formControlName","allowWhitespaces",1,"flex-1",2,"margin-bottom","16px"],["formControlName","forceUserToResetPasswordIfNotValid",1,"flex-1",2,"margin-bottom","16px"],[3,"tb-hint-tooltip-icon"],[1,"flex","flex-row","flex-wrap","items-center","justify-end","gap-2",2,"margin-top","16px"],["mat-button","","color","primary","type","button",3,"click","disabled"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["tb-help","jwtSecuritySettings"],[2,"padding-top","16px"],[1,"flex","flex-col","gap-2",3,"disabled"],[1,"flex","flex-row","gap-2","xs:flex-col"],["matInput","","required","","formControlName","tokenIssuer"],["matInput","","required","","formControlName","tokenSigningKey",3,"focus"],["type","button","matSuffix","","mat-button","","color","primary",2,"line-height","32px",3,"click"],["matInput","","type","number","required","","formControlName","tokenExpirationTime","step","1","min","0"],["matInput","","type","number","required","","formControlName","refreshTokenExpTime","step","1","min","0"],[1,"flex","flex-row","flex-wrap","items-center","justify-end","gap-2"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title")(3,"span",1),e.\u0275\u0275text(4,"admin.security-settings"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(5,"span",2)(6,"div",3),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(7,Jl,1,0,"mat-progress-bar",4),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275template(9,Zl,1,0,"div",5),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275elementStart(11,"mat-card-content")(12,"form",6),e.\u0275\u0275listener("ngSubmit",function(){return n.save()}),e.\u0275\u0275elementStart(13,"fieldset",7),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275elementStart(15,"fieldset",8)(16,"legend",9),e.\u0275\u0275text(17,"admin.general-policy"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"mat-form-field",10)(19,"mat-label",11),e.\u0275\u0275text(20,"admin.max-failed-login-attempts"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(21,"input",12),e.\u0275\u0275template(22,Xl,3,3,"mat-error",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(23,"mat-form-field",10)(24,"mat-label",11),e.\u0275\u0275text(25,"admin.user-lockout-notification-email"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(26,"input",14),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(27,"mat-form-field",10)(28,"mat-label",11),e.\u0275\u0275text(29,"admin.user-activation-token-ttl"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(30,"input",15),e.\u0275\u0275template(31,ed,3,3,"mat-error",13)(32,td,3,3,"mat-error",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(33,"mat-form-field",10)(34,"mat-label",11),e.\u0275\u0275text(35,"admin.password-reset-token-ttl"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(36,"input",16),e.\u0275\u0275template(37,nd,3,3,"mat-error",13)(38,id,3,3,"mat-error",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(39,"mat-form-field",10)(40,"mat-label",11),e.\u0275\u0275text(41,"admin.mobile-secret-key-length"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(42,"input",17),e.\u0275\u0275template(43,ad,3,3,"mat-error",13),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(44,"fieldset",8)(45,"legend",9),e.\u0275\u0275text(46,"admin.password-policy"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(47,"section",18)(48,"div",19)(49,"mat-form-field",20)(50,"mat-label",11),e.\u0275\u0275text(51,"admin.minimum-password-length"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(52,"input",21),e.\u0275\u0275template(53,od,3,3,"mat-error",13)(54,rd,3,3,"mat-error",13)(55,sd,3,3,"mat-error",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(56,"mat-form-field",22)(57,"mat-label",11),e.\u0275\u0275text(58,"admin.maximum-password-length"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(59,"input",23)(60,"mat-hint"),e.\u0275\u0275template(61,ld,3,3,"mat-error",13)(62,dd,3,3,"mat-error",13),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(63,"div",19)(64,"mat-form-field",20)(65,"mat-label",11),e.\u0275\u0275text(66,"admin.minimum-uppercase-letters"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(67,"input",24),e.\u0275\u0275template(68,cd,3,3,"mat-error",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(69,"mat-form-field",20)(70,"mat-label",11),e.\u0275\u0275text(71,"admin.minimum-lowercase-letters"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(72,"input",25),e.\u0275\u0275template(73,pd,3,3,"mat-error",13),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(74,"div",19)(75,"mat-form-field",20)(76,"mat-label",11),e.\u0275\u0275text(77,"admin.minimum-digits"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(78,"input",26),e.\u0275\u0275template(79,md,3,3,"mat-error",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(80,"mat-form-field",20)(81,"mat-label",11),e.\u0275\u0275text(82,"admin.minimum-special-characters"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(83,"input",27),e.\u0275\u0275template(84,ud,3,3,"mat-error",13),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(85,"div",19)(86,"mat-form-field",20)(87,"mat-label",11),e.\u0275\u0275text(88,"admin.password-expiration-period-days"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(89,"input",28),e.\u0275\u0275template(90,gd,3,3,"mat-error",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(91,"mat-form-field",20)(92,"mat-label",11),e.\u0275\u0275text(93,"admin.password-reuse-frequency-days"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(94,"input",29),e.\u0275\u0275template(95,fd,3,3,"mat-error",13),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(96,"div",19)(97,"mat-checkbox",30)(98,"mat-label",11),e.\u0275\u0275text(99,"admin.allow-whitespace"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(100,"mat-checkbox",31)(101,"mat-label",32),e.\u0275\u0275pipe(102,"translate"),e.\u0275\u0275text(103),e.\u0275\u0275pipe(104,"translate"),e.\u0275\u0275elementEnd()()()()(),e.\u0275\u0275elementStart(105,"div",33)(106,"button",34),e.\u0275\u0275listener("click",function(){return n.discardSetting()}),e.\u0275\u0275text(107),e.\u0275\u0275pipe(108,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(109,"button",35),e.\u0275\u0275pipe(110,"async"),e.\u0275\u0275text(111),e.\u0275\u0275pipe(112,"translate"),e.\u0275\u0275elementEnd()()()()()(),e.\u0275\u0275elementStart(113,"mat-card",0)(114,"mat-card-header")(115,"mat-card-title")(116,"span",1),e.\u0275\u0275text(117,"admin.jwt.security-settings"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(118,"span",2)(119,"div",36),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(120,"mat-card-content",37)(121,"form",6),e.\u0275\u0275listener("ngSubmit",function(){return n.saveJwtSettings()}),e.\u0275\u0275elementStart(122,"fieldset",38),e.\u0275\u0275pipe(123,"async"),e.\u0275\u0275elementStart(124,"div",39)(125,"mat-form-field",20)(126,"mat-label",11),e.\u0275\u0275text(127,"admin.jwt.issuer-name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(128,"input",40),e.\u0275\u0275template(129,hd,3,3,"mat-error",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(130,"mat-form-field",20)(131,"mat-label",11),e.\u0275\u0275text(132,"admin.jwt.signings-key"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(133,"input",41),e.\u0275\u0275listener("focus",function(){return n.markAsTouched()}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(134,"button",42),e.\u0275\u0275listener("click",function(){return n.generateSigningKey()}),e.\u0275\u0275text(135),e.\u0275\u0275pipe(136,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(137,"mat-hint",11),e.\u0275\u0275text(138,"admin.jwt.signings-key-hint"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(139,bd,3,3,"mat-error",13)(140,yd,3,3,"mat-error",13)(141,vd,3,3,"mat-error",13),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(142,"div",39)(143,"mat-form-field",20)(144,"mat-label",11),e.\u0275\u0275text(145,"admin.jwt.expiration-time"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(146,"input",43),e.\u0275\u0275template(147,Cd,3,3,"mat-error",13)(148,xd,3,3,"mat-error",13)(149,_d,3,3,"mat-error",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(150,"mat-form-field",20)(151,"mat-label",11),e.\u0275\u0275text(152,"admin.jwt.refresh-expiration-time"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(153,"input",44),e.\u0275\u0275template(154,Sd,3,3,"mat-error",13)(155,Td,3,3,"mat-error",13)(156,Id,3,3,"mat-error",13)(157,wd,3,3,"mat-error",13),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(158,"div",45)(159,"button",34),e.\u0275\u0275listener("click",function(){return n.discardJwtSetting()}),e.\u0275\u0275text(160),e.\u0275\u0275pipe(161,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(162,"button",46),e.\u0275\u0275pipe(163,"async"),e.\u0275\u0275text(164),e.\u0275\u0275pipe(165,"translate"),e.\u0275\u0275elementEnd()()()()()()),2&i&&(e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(8,45,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(10,47,n.isLoading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("formGroup",n.securitySettingsFormGroup),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(14,49,n.isLoading$)),e.\u0275\u0275advance(9),e.\u0275\u0275property("ngIf",n.securitySettingsFormGroup.get("maxFailedLoginAttempts").hasError("min")),e.\u0275\u0275advance(9),e.\u0275\u0275property("ngIf",n.securitySettingsFormGroup.get("userActivationTokenTtl").hasError("min")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.securitySettingsFormGroup.get("userActivationTokenTtl").hasError("max")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",n.securitySettingsFormGroup.get("passwordResetTokenTtl").hasError("min")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.securitySettingsFormGroup.get("passwordResetTokenTtl").hasError("max")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",n.securitySettingsFormGroup.get("mobileSecretKeyLength").hasError("min")),e.\u0275\u0275advance(10),e.\u0275\u0275property("ngIf",n.securitySettingsFormGroup.get("passwordPolicy.minimumLength").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.securitySettingsFormGroup.get("passwordPolicy.minimumLength").hasError("min")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.securitySettingsFormGroup.get("passwordPolicy.minimumLength").hasError("max")),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.securitySettingsFormGroup.get("passwordPolicy.maximumLength").hasError("min")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.securitySettingsFormGroup.get("passwordPolicy.maximumLength").hasError("lessMin")),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.securitySettingsFormGroup.get("passwordPolicy.minimumUppercaseLetters").hasError("min")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",n.securitySettingsFormGroup.get("passwordPolicy.minimumLowercaseLetters").hasError("min")),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.securitySettingsFormGroup.get("passwordPolicy.minimumDigits").hasError("min")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",n.securitySettingsFormGroup.get("passwordPolicy.minimumSpecialCharacters").hasError("min")),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.securitySettingsFormGroup.get("passwordPolicy.passwordExpirationPeriodDays").hasError("min")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",n.securitySettingsFormGroup.get("passwordPolicy.passwordReuseFrequencyDays").hasError("min")),e.\u0275\u0275advance(6),e.\u0275\u0275propertyInterpolate("tb-hint-tooltip-icon",e.\u0275\u0275pipeBind1(102,51,"admin.force-reset-password-if-no-valid-hint")),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(104,53,"admin.force-reset-password-if-no-valid")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",n.securitySettingsFormGroup.pristine),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(108,55,"action.undo")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(110,57,n.isLoading$)||n.securitySettingsFormGroup.invalid||!n.securitySettingsFormGroup.dirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(112,59,"action.save")," "),e.\u0275\u0275advance(10),e.\u0275\u0275property("formGroup",n.jwtSecuritySettingsFormGroup),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(123,61,n.isLoading$)),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",n.jwtSecuritySettingsFormGroup.get("tokenIssuer").hasError("required")),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(136,63,"admin.jwt.generate-key")," "),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",n.jwtSecuritySettingsFormGroup.get("tokenSigningKey").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.jwtSecuritySettingsFormGroup.get("tokenSigningKey").hasError("base64")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.jwtSecuritySettingsFormGroup.get("tokenSigningKey").hasError("minLength")),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.jwtSecuritySettingsFormGroup.get("tokenExpirationTime").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.jwtSecuritySettingsFormGroup.get("tokenExpirationTime").hasError("pattern")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.jwtSecuritySettingsFormGroup.get("tokenExpirationTime").hasError("min")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",n.jwtSecuritySettingsFormGroup.get("refreshTokenExpTime").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.jwtSecuritySettingsFormGroup.get("refreshTokenExpTime").hasError("pattern")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.jwtSecuritySettingsFormGroup.get("refreshTokenExpTime").hasError("min")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.jwtSecuritySettingsFormGroup.get("refreshTokenExpTime").hasError("lessToken")),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",n.jwtSecuritySettingsFormGroup.pristine),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(161,65,"action.undo")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(163,67,n.isLoading$)||n.jwtSecuritySettingsFormGroup.invalid||!n.jwtSecuritySettingsFormGroup.dirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(165,69,"action.save")," "))},dependencies:[p.NgIf,be.HelpComponent,x.MatButton,Te.MatCheckbox,D.MatCard,D.MatCardContent,D.MatCardHeader,D.MatCardTitle,K.MatProgressBar,L.MatInput,v.MatFormField,v.MatLabel,v.MatHint,v.MatError,v.MatSuffix,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NumberValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.MinValidator,s.MaxValidator,s.FormGroupDirective,s.FormControlName,s.FormGroupName,u.TranslateDirective,Vr.HintTooltipIconComponent,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-headline-5[_ngcontent-%COMP%]{margin-bottom:8px}[_nghost-%COMP%]   .mat-mdc-card-title[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:8px 16px 0;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']})}}var S=d(34006),se=d(56542),pt=d(915),ae=d(55911),jo=d(43567);function Ed(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",17)}function Md(a,t){1&a&&e.\u0275\u0275element(0,"div",18)}function Nd(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.sms-message-required")," "))}function Ad(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.sms-message-max-length")," "))}class ia extends se.m{constructor(t,i,n,o,r,l,c){super(t,i,l),this.store=t,this.router=i,this.data=n,this.adminService=o,this.translate=r,this.dialogRef=l,this.fb=c,this.phoneNumberPattern=Re.MT,this.smsProviderConfiguration=this.data.smsProviderConfiguration}ngOnInit(){this.sendTestSmsFormGroup=this.fb.group({numberTo:[null,[s.Validators.required,s.Validators.pattern(Re.MT)]],message:[null,[s.Validators.required,s.Validators.maxLength(1600)]]})}close(){this.dialogRef.close()}sendTestSms(){const t={providerConfiguration:this.smsProviderConfiguration,numberTo:this.sendTestSmsFormGroup.value.numberTo,message:this.sendTestSmsFormGroup.value.message};this.adminService.sendTestSms(t).subscribe(()=>{this.store.dispatch(new $.xo({message:this.translate.instant("admin.test-sms-sent"),target:"sendTestSmsDialogContent",verticalPosition:"bottom",horizontalPosition:"left",type:"success"}))})}static{this.\u0275fac=function(i){return new(i||ia)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(S.MAT_DIALOG_DATA),e.\u0275\u0275directiveInject(Zi.z),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(S.MatDialogRef),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:ia,selectors:[["tb-send-test-sms-dialog"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:32,vars:29,consts:[[2,"min-width","500px","position","relative",3,"formGroup"],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","","toastTarget","sendTestSmsDialogContent"],[3,"disabled"],["required","","formControlName","numberTo",3,"enableFlagsSelect","label"],[1,"mat-block"],["required","","matInput","","rows","3","formControlName","message",3,"maxLength"],[4,"ngIf"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"form",0)(1,"mat-toolbar",1)(2,"h2",2),e.\u0275\u0275text(3,"admin.send-test-sms"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"span",3),e.\u0275\u0275elementStart(5,"button",4),e.\u0275\u0275listener("click",function(){return n.close()}),e.\u0275\u0275elementStart(6,"mat-icon",5),e.\u0275\u0275text(7,"close"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(8,Ed,1,0,"mat-progress-bar",6),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275template(10,Md,1,0,"div",7),e.\u0275\u0275pipe(11,"async"),e.\u0275\u0275elementStart(12,"div",8)(13,"fieldset",9),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275element(15,"tb-phone-input",10),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementStart(17,"mat-form-field",11)(18,"mat-label",2),e.\u0275\u0275text(19,"admin.sms-message"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(20,"textarea",12),e.\u0275\u0275template(21,Nd,3,3,"mat-error",13)(22,Ad,3,3,"mat-error",13),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(23,"div",14)(24,"button",15),e.\u0275\u0275pipe(25,"async"),e.\u0275\u0275listener("click",function(){return n.close()}),e.\u0275\u0275text(26),e.\u0275\u0275pipe(27,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(28,"button",16),e.\u0275\u0275pipe(29,"async"),e.\u0275\u0275listener("click",function(){return n.sendTestSms()}),e.\u0275\u0275text(30),e.\u0275\u0275pipe(31,"translate"),e.\u0275\u0275elementEnd()()()),2&i&&(e.\u0275\u0275property("formGroup",n.sendTestSmsFormGroup),e.\u0275\u0275advance(8),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(9,13,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(11,15,n.isLoading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(14,17,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(16,19,"admin.number-to")),e.\u0275\u0275property("enableFlagsSelect",!1),e.\u0275\u0275advance(5),e.\u0275\u0275property("maxLength",1600),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.sendTestSmsFormGroup.get("message").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.sendTestSmsFormGroup.get("message").hasError("maxLength")),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(25,21,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(27,23,"action.close")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(29,25,n.isLoading$)||n.sendTestSmsFormGroup.invalid),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(31,27,"admin.send-test-sms")," "))},dependencies:[p.NgIf,pt.ToastDirective,x.MatButton,x.MatIconButton,E.MatIcon,K.MatProgressBar,L.MatInput,v.MatFormField,v.MatLabel,v.MatError,ae.MatToolbar,S.MatDialogActions,S.MatDialogContent,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,jo.U,p.AsyncPipe,u.TranslatePipe],encapsulation:2})}}var Ke=d(40283),q=d(63729),gr=d(92973),Fd=d(76010);function Dd(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",22)}function Pd(a,t){1&a&&e.\u0275\u0275element(0,"div",23)}function kd(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-card",16)(1,"mat-card-header")(2,"mat-card-title")(3,"span",3),e.\u0275\u0275text(4,"admin.sms-provider-settings"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(5,"span",4)(6,"div",17),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(7,Dd,1,0,"mat-progress-bar",6),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275template(9,Pd,1,0,"div",7),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275elementStart(11,"mat-card-content")(12,"form",1),e.\u0275\u0275listener("ngSubmit",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.save())}),e.\u0275\u0275element(13,"tb-sms-provider-configuration",18),e.\u0275\u0275elementStart(14,"div",19)(15,"button",20),e.\u0275\u0275pipe(16,"async"),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.sendTestSms())}),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"button",21),e.\u0275\u0275pipe(20,"async"),e.\u0275\u0275text(21),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275elementEnd()()()()()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(8,7,i.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(10,9,i.isLoading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("formGroup",i.smsProvider),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(16,11,i.isLoading$)||i.smsProvider.invalid),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(18,13,"admin.send-test-sms")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(20,15,i.isLoading$)||i.smsProvider.invalid||!i.smsProvider.dirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(22,17,"action.save")," ")}}function Ld(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",22)}function Od(a,t){1&a&&e.\u0275\u0275element(0,"div",23)}function Rd(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-card-header")(1,"mat-card-title")(2,"span",3),e.\u0275\u0275text(3,"admin.mobile-settings"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(4,"span",4),e.\u0275\u0275elementEnd())}function Vd(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-card-content",24)(1,"tb-file-input",25),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275listener("fileNameChanged",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(null==r.notificationSettingsForm?null:r.notificationSettingsForm.get("deliveryMethodsConfigs.MOBILE_APP.firebaseServiceAccountCredentialsFileName").patchValue(o))}),e.\u0275\u0275elementEnd()()}if(2&a){let i;const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("dropLabel",e.\u0275\u0275pipeBind1(2,3,"admin.select-firebase-service-account-file")),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(3,5,"admin.firebase-service-account-file")),e.\u0275\u0275property("existingFileName",null==(i=n.notificationSettingsForm.get("deliveryMethodsConfigs.MOBILE_APP.firebaseServiceAccountCredentialsFileName"))?null:i.value)}}class aa extends de.H{constructor(t,i,n,o,r,l){super(t),this.store=t,this.router=i,this.adminService=n,this.notificationService=o,this.dialog=r,this.fb=l,this.authUser=(0,q.rx)(this.store),this.buildSmsProviderForm(),this.buildGeneralServerSettingsForm(),this.notificationService.getNotificationSettings().subscribe(c=>{this.notificationSettings=c,this.notificationSettingsForm.reset(this.notificationSettings)}),this.isSysAdmin()&&this.adminService.getAdminSettings("sms",{ignoreErrors:!0}).subscribe({next:c=>{this.adminSettings=c,this.smsProvider.reset({configuration:this.adminSettings.jsonValue})},error:()=>{this.adminSettings={key:"sms",jsonValue:null},this.smsProvider.reset({configuration:this.adminSettings.jsonValue})}})}buildSmsProviderForm(){this.smsProvider=this.fb.group({configuration:[null,[s.Validators.required]]}),this.registerDisableOnLoadFormControl(this.smsProvider.get("configuration"))}sendTestSms(){this.dialog.open(ia,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{smsProviderConfiguration:this.smsProvider.value.configuration}})}save(){this.adminSettings.jsonValue=this.smsProvider.value.configuration,this.adminService.saveAdminSettings(this.adminSettings).subscribe(t=>{this.adminSettings=t,this.smsProvider.reset({configuration:this.adminSettings.jsonValue})})}confirmForm(){return this.smsProvider.dirty?this.smsProvider:this.notificationSettingsForm}buildGeneralServerSettingsForm(){this.notificationSettingsForm=this.fb.group({deliveryMethodsConfigs:this.fb.group({SLACK:this.fb.group({botToken:[""]}),MOBILE_APP:this.fb.group({firebaseServiceAccountCredentialsFileName:[""],firebaseServiceAccountCredentials:[""]})})}),this.registerDisableOnLoadFormControl(this.notificationSettingsForm.get("deliveryMethodsConfigs"))}saveNotification(){this.notificationSettings=(0,_.XU)({...this.notificationSettings,...this.notificationSettingsForm.value});for(const t in this.notificationSettings.deliveryMethodsConfigs)Object.keys(this.notificationSettings.deliveryMethodsConfigs[t]).some(n=>!(0,_.Q8)(this.notificationSettings.deliveryMethodsConfigs[t][n]))?delete this.notificationSettings.deliveryMethodsConfigs[t]:this.notificationSettings.deliveryMethodsConfigs[t].method=t;this.notificationService.saveNotificationSettings(this.notificationSettings).subscribe(t=>{this.notificationSettings=t,this.notificationSettingsForm.reset(this.notificationSettings)})}isSysAdmin(){return this.authUser.authority===g.s.SYS_ADMIN}static{this.\u0275fac=function(i){return new(i||aa)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(Zi.z),e.\u0275\u0275directiveInject(Ke.J),e.\u0275\u0275directiveInject(S.MatDialog),e.\u0275\u0275directiveInject(s.FormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:aa,selectors:[["tb-sms-provider"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:25,vars:16,consts:[["appearance","outlined","class","settings-card",4,"ngIf"],[3,"ngSubmit","formGroup"],["appearance","outlined","formGroupName","deliveryMethodsConfigs",1,"settings-card"],["translate","",1,"mat-headline-5"],[1,"flex-1"],["tb-help","slackSettings"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["formGroupName","SLACK"],["subscriptSizing","dynamic",1,"mat-block"],["translate",""],["matInput","","formControlName","botToken"],[4,"ngIf"],["formGroupName","MOBILE_APP",4,"ngIf"],[1,"flex","items-center","justify-end","xs:flex-col","xs:items-stretch"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["appearance","outlined",1,"settings-card"],["tb-help","smsProviderSettings"],["required","","formControlName","configuration"],[1,"flex","flex-row","items-center","justify-end","gap-4","xs:flex-col","xs:items-stretch"],["mat-raised-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],["formGroupName","MOBILE_APP"],["formControlName","firebaseServiceAccountCredentials","accept",".json,application/json","allowedExtensions","json",3,"fileNameChanged","dropLabel","label","existingFileName"]],template:function(i,n){1&i&&(e.\u0275\u0275template(0,kd,23,19,"mat-card",0),e.\u0275\u0275elementStart(1,"form",1),e.\u0275\u0275listener("ngSubmit",function(){return n.saveNotification()}),e.\u0275\u0275elementStart(2,"mat-card",2)(3,"mat-card-header")(4,"mat-card-title")(5,"span",3),e.\u0275\u0275text(6,"admin.slack-settings"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(7,"span",4)(8,"div",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(9,Ld,1,0,"mat-progress-bar",6),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275template(11,Od,1,0,"div",7),e.\u0275\u0275pipe(12,"async"),e.\u0275\u0275elementStart(13,"mat-card-content",8)(14,"mat-form-field",9)(15,"mat-label",10),e.\u0275\u0275text(16,"admin.slack-api-token"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(17,"input",11),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(18,Rd,5,0,"mat-card-header",12)(19,Vd,4,7,"mat-card-content",13),e.\u0275\u0275elementStart(20,"mat-card-actions",14)(21,"button",15),e.\u0275\u0275pipe(22,"async"),e.\u0275\u0275text(23),e.\u0275\u0275pipe(24,"translate"),e.\u0275\u0275elementEnd()()()()),2&i&&(e.\u0275\u0275property("ngIf",n.isSysAdmin()),e.\u0275\u0275advance(),e.\u0275\u0275property("formGroup",n.notificationSettingsForm),e.\u0275\u0275advance(8),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(10,8,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(12,10,n.isLoading$)),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",n.isSysAdmin()),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.isSysAdmin()),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(22,12,n.isLoading$)||n.notificationSettingsForm.invalid||!n.notificationSettingsForm.dirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(24,14,"action.save")," "))},dependencies:[p.NgIf,be.HelpComponent,x.MatButton,D.MatCard,D.MatCardActions,D.MatCardContent,D.MatCardHeader,D.MatCardTitle,K.MatProgressBar,L.MatInput,v.MatFormField,v.MatLabel,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,s.FormGroupName,gr.FileInputComponent,u.TranslateDirective,Fd.SmsProviderConfigurationComponent,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]{align-items:center;min-height:64px}[_nghost-%COMP%]   .mdc-card__actions[_ngcontent-%COMP%]{padding:16px}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']})}}var Br=d(85568),Bd=d(57125),oa=d(23593);function Gd(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",13)}function jd(a,t){1&a&&e.\u0275\u0275element(0,"div",14)}class ra extends de.H{constructor(t,i,n,o){super(t),this.store=t,this.router=i,this.dashboardService=n,this.fb=o}ngOnInit(){this.homeSettings=this.fb.group({dashboardId:[null],hideDashboardToolbar:[!0]}),this.dashboardService.getTenantHomeDashboardInfo().subscribe(t=>{this.setHomeDashboardInfo(t)})}save(){const t=this.homeSettings.get("dashboardId").value,o={dashboardId:t?new Bd.C(t):null,hideDashboardToolbar:this.homeSettings.get("hideDashboardToolbar").value};this.dashboardService.setTenantHomeDashboardInfo(o).subscribe(()=>{this.setHomeDashboardInfo(o)})}confirmForm(){return this.homeSettings}setHomeDashboardInfo(t){this.homeSettings.reset({dashboardId:t?.dashboardId?.id,hideDashboardToolbar:!(0,_.f1)(t?.hideDashboardToolbar)||t?.hideDashboardToolbar})}static{this.\u0275fac=function(i){return new(i||ra)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(Br.I),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:ra,selectors:[["tb-home-settings"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:26,vars:24,consts:[["appearance","outlined",1,"settings-card"],["translate","",1,"mat-headline-5"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[2,"padding-top","16px"],[3,"ngSubmit","formGroup"],[3,"disabled"],[1,"tb-default-dashboard","flex","flex-1","flex-col"],[1,"flex","flex-1","flex-col","gt-sm:flex-row"],["formControlName","dashboardId",1,"flex-1",3,"label","dashboardsScope","selectFirstDashboard"],["formControlName","hideDashboardToolbar",1,"flex-1"],[1,"flex","w-full","flex-row","flex-wrap","items-center","justify-end"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div")(1,"mat-card",0)(2,"mat-card-header")(3,"mat-card-title")(4,"span",1),e.\u0275\u0275text(5,"admin.home-settings"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(6,Gd,1,0,"mat-progress-bar",2),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275template(8,jd,1,0,"div",3),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275elementStart(10,"mat-card-content",4)(11,"form",5),e.\u0275\u0275listener("ngSubmit",function(){return n.save()}),e.\u0275\u0275elementStart(12,"fieldset",6),e.\u0275\u0275pipe(13,"async"),e.\u0275\u0275elementStart(14,"section",7)(15,"section",8),e.\u0275\u0275element(16,"tb-dashboard-autocomplete",9),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementStart(18,"mat-checkbox",10),e.\u0275\u0275text(19),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(21,"div",11)(22,"button",12),e.\u0275\u0275pipe(23,"async"),e.\u0275\u0275text(24),e.\u0275\u0275pipe(25,"translate"),e.\u0275\u0275elementEnd()()()()()()()),2&i&&(e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(7,10,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!1===e.\u0275\u0275pipeBind1(9,12,n.isLoading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("formGroup",n.homeSettings),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(13,14,n.isLoading$)),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(17,16,"dashboard.home-dashboard")),e.\u0275\u0275property("dashboardsScope","tenant")("selectFirstDashboard",!1),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(20,18,"dashboard.home-dashboard-hide-toolbar")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(23,20,n.isLoading$)||n.homeSettings.invalid||!n.homeSettings.dirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(25,22,"action.save")," "))},dependencies:[p.NgIf,oa.DashboardAutocompleteComponent,x.MatButton,Te.MatCheckbox,D.MatCard,D.MatCardContent,D.MatCardHeader,D.MatCardTitle,K.MatProgressBar,s.\u0275NgNoValidate,s.NgControlStatus,s.NgControlStatusGroup,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-right:12px}}@media screen and (max-width: 959px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-bottom:12px}}@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:16px}}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']})}}var G=d(8968),y=d(12054),me=d(38985),f=d(25967),R=d(39519),Ud=d(73216),xe=d(81365),sa=d(99172),we=d(89692);function qd(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",16),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.resourceTypesTranslationMap.get(i))," ")}}function Wd(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"resource.title-required")," "))}function $d(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"resource.title-max-length")," "))}function zd(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-form-field",10)(1,"mat-label",6),e.\u0275\u0275text(2,"resource.title"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"input",17),e.\u0275\u0275template(4,Wd,3,3,"mat-error",18)(5,$d,3,3,"mat-error",18),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",i.entityForm.get("title").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.entityForm.get("title").hasError("maxlength"))}}function Hd(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tb-file-input",19),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275listener("fileNameChanged",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(null==r.entityForm?null:r.entityForm.get("fileName").patchValue(o))}),e.\u0275\u0275elementEnd()}if(2&a){let i;const n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(1,10,n.entityForm.get("resourceType").value===n.resourceType.LWM2M_MODEL?"resource.resource-files":"resource.resource-file")),e.\u0275\u0275propertyInterpolate("dropLabel",e.\u0275\u0275pipeBind1(2,12,"resource.drop-resource-file-or")),e.\u0275\u0275property("required",n.isAdd)("readAsBinary",!0)("maxSizeByte",n.maxResourceSize)("allowedExtensions",n.getAllowedExtensions())("contentConvertFunction",n.convertToBase64File)("accept",n.getAcceptType())("multipleFile",n.entityForm.get("resourceType").value===n.resourceType.LWM2M_MODEL)("existingFileName",null==(i=n.entityForm.get("fileName"))?null:i.value)}}function Kd(a,t){1&a&&(e.\u0275\u0275elementStart(0,"div",20)(1,"mat-form-field",21)(2,"mat-label",6),e.\u0275\u0275text(3,"resource.file-name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"input",22),e.\u0275\u0275elementEnd()())}class la extends xe.l{constructor(t,i,n,o,r,l){super(t,r,n,o,l),this.store=t,this.translate=i,this.entityValue=n,this.entitiesTableConfigValue=o,this.fb=r,this.cd=l,this.resourceType=me.vt,this.resourceTypes=Object.values(this.resourceType),this.resourceTypesTranslationMap=me.WT,this.maxResourceSize=(0,q.rW)(this.store).maxResourceSize,this.destroy$=new fe.B}ngOnInit(){super.ngOnInit(),this.isAdd&&this.observeResourceTypeChange()}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}hideDelete(){return!!this.entitiesTableConfig&&!this.entitiesTableConfig.deleteEnabled(this.entity)}buildForm(t){return this.fb.group({title:[t?t.title:"",[s.Validators.required,s.Validators.maxLength(255)]],resourceType:[t?.resourceType?t.resourceType:me.vt.JS_MODULE,s.Validators.required],fileName:[t?t.fileName:null,s.Validators.required],data:[t?t.data:null,this.isAdd?[s.Validators.required]:[]]})}updateForm(t){this.entityForm.patchValue(t)}updateFormState(){super.updateFormState(),this.isEdit&&this.entityForm&&!this.isAdd&&(this.entityForm.get("resourceType").disable({emitEvent:!1}),this.entityForm.get("resourceType").value!==me.vt.JS_MODULE&&this.entityForm.get("fileName").disable({emitEvent:!1}))}prepareFormValue(t){return this.isEdit&&!(0,_.f1)(t.data)&&delete t.data,super.prepareFormValue(t)}getAllowedExtensions(){try{return me.yL.get(this.entityForm.get("resourceType").value)}catch{return""}}getAcceptType(){try{return me.q1.get(this.entityForm.get("resourceType").value)}catch{return"*/*"}}convertToBase64File(t){return window.btoa(t)}onResourceIdCopied(){this.store.dispatch(new $.xo({message:this.translate.instant("resource.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}observeResourceTypeChange(){this.entityForm.get("resourceType").valueChanges.pipe((0,sa.Z)(me.vt.JS_MODULE),(0,j.Q)(this.destroy$)).subscribe(t=>this.onResourceTypeChange(t))}onResourceTypeChange(t){t===this.resourceType.LWM2M_MODEL?(this.entityForm.get("title").disable({emitEvent:!1}),this.entityForm.patchValue({title:""},{emitEvent:!1})):this.entityForm.get("title").enable({emitEvent:!1}),this.entityForm.patchValue({data:null,fileName:null},{emitEvent:!1})}static{this.\u0275fac=function(i){return new(i||la)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject("entity"),e.\u0275\u0275directiveInject("entitiesTableConfig"),e.\u0275\u0275directiveInject(s.FormBuilder),e.\u0275\u0275directiveInject(e.ChangeDetectorRef))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:la,selectors:[["tb-resources-library"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:30,vars:35,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",1,"xs:flex-1",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["formControlName","resourceType","required",""],[3,"value",4,"ngFor","ngForOf"],["class","mat-block",4,"ngIf"],["formControlName","data",3,"required","label","readAsBinary","maxSizeByte","allowedExtensions","contentConvertFunction","accept","multipleFile","dropLabel","existingFileName","fileNameChanged",4,"ngIf"],["class","flex flex-row xs:flex-col sm:gap-2 md:flex-col gt-md:gap-2",4,"ngIf"],[3,"value"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["formControlName","data",3,"fileNameChanged","required","label","readAsBinary","maxSizeByte","allowedExtensions","contentConvertFunction","accept","multipleFile","dropLabel","existingFileName"],[1,"flex","flex-row","xs:flex-col","sm:gap-2","md:flex-col","gt-md:gap-2"],[1,"flex-1"],["matInput","","formControlName","fileName","type","text"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"button",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"open")}),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",2),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"downloadResource")}),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"button",2),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"delete")}),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"div",3)(14,"button",4),e.\u0275\u0275listener("cbOnSuccess",function(){return n.onResourceIdCopied()}),e.\u0275\u0275element(15,"mat-icon",5),e.\u0275\u0275elementStart(16,"span",6),e.\u0275\u0275text(17,"resource.copyId"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(18,"div",7)(19,"form",8)(20,"fieldset",9),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275elementStart(22,"mat-form-field",10)(23,"mat-label",6),e.\u0275\u0275text(24,"resource.resource-type"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(25,"mat-select",11),e.\u0275\u0275template(26,qd,3,4,"mat-option",12),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(27,zd,6,2,"mat-form-field",13)(28,Hd,3,14,"tb-file-input",14)(29,Kd,5,0,"div",15),e.\u0275\u0275elementEnd()()()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",n.isEdit||n.isDetailsPage),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(2,21,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,23,"common.open-details-page")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(6,25,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(8,27,"resource.download")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.hideDelete()||n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(10,29,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(12,31,"resource.delete")," "),e.\u0275\u0275advance(3),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("cbContent",null==n.entity||null==n.entity.id?null:n.entity.id.id),e.\u0275\u0275advance(5),e.\u0275\u0275property("formGroup",n.entityForm),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(21,33,n.isLoading$)||!n.isEdit),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",n.resourceTypes),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("resourceType").value!==n.resourceType.LWM2M_MODEL||!n.isAdd),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.isAdd||n.isEdit&&n.entityForm.get("resourceType").value===n.resourceType.JS_MODULE),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!(n.isAdd||n.isEdit&&n.entityForm.get("resourceType").value===n.resourceType.JS_MODULE)))},dependencies:[p.NgForOf,p.NgIf,x.MatButton,E.MatIcon,L.MatInput,v.MatFormField,v.MatLabel,v.MatError,ce.MatSelect,z.MatOption,we.Uo,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,gr.FileInputComponent,u.TranslateDirective,p.AsyncPipe,u.TranslatePipe],encapsulation:2})}}var ie=d(96354),Ne=d(5986);function Yd(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",5),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.resourceTypesTranslationMap.get(i))," ")}}class da extends Ne.M{constructor(t){super(t),this.store=t,this.resourceTypes=Object.values(me.vt),this.resourceTypesTranslationMap=me.WT}resourceTypeChanged(t){this.entitiesTableConfig.componentsData.resourceType=t,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}static{this.\u0275fac=function(i){return new(i||da)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:da,selectors:[["tb-resources-table-header"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:9,vars:8,consts:[["subscriptSizing","dynamic",1,"mat-block"],["translate",""],[3,"ngModelChange","ngModel","placeholder"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"mat-form-field",0)(1,"mat-label",1),e.\u0275\u0275text(2,"resource.resource-type"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"mat-select",2),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275listener("ngModelChange",function(r){return n.resourceTypeChanged(r)}),e.\u0275\u0275elementStart(5,"mat-option",3),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(8,Yd,3,4,"mat-option",4),e.\u0275\u0275elementEnd()()),2&i&&(e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(4,4,"resource.resource-type")),e.\u0275\u0275property("ngModel",n.entitiesTableConfig.componentsData.resourceType),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(7,6,"resource.all-types")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",n.resourceTypes))},dependencies:[p.NgForOf,v.MatFormField,v.MatLabel,ce.MatSelect,z.MatOption,s.NgControlStatus,s.NgModel,u.TranslateDirective,u.TranslatePipe],encapsulation:2})}}class Ft{constructor(t,i,n,o,r){this.store=t,this.resourceService=i,this.translate=n,this.router=o,this.datePipe=r,this.config=new y.M7,this.resourceTypesTranslationMap=me.WT,this.config.entityType=f.ck.TB_RESOURCE,this.config.entityComponent=la,this.config.entityTranslations=f.Mi.get(f.ck.TB_RESOURCE),this.config.entityResources=f.BT.get(f.ck.TB_RESOURCE),this.config.headerComponent=da,this.config.entityTitle=l=>l?l.title:"",this.config.columns.push(new y.Qr("createdTime","common.created-time",this.datePipe,"150px"),new y.KK("title","resource.title","60%"),new y.KK("resourceType","resource.resource-type","40%",l=>this.translate.instant(this.resourceTypesTranslationMap.get(l.resourceType))),new y.KK("tenantId","resource.system","60px",l=>(0,y.ov)(l.tenantId.id===R.k))),this.config.cellActionDescriptors.push({name:this.translate.instant("resource.download"),icon:"file_download",isEnabled:()=>!0,onAction:(l,c)=>this.downloadResource(l,c)}),this.config.deleteEntityTitle=l=>this.translate.instant("resource.delete-resource-title",{resourceTitle:l.title}),this.config.deleteEntityContent=()=>this.translate.instant("resource.delete-resource-text"),this.config.deleteEntitiesTitle=l=>this.translate.instant("resource.delete-resources-title",{count:l}),this.config.deleteEntitiesContent=()=>this.translate.instant("resource.delete-resources-text"),this.config.entitiesFetchFunction=l=>this.resourceService.getResources(l,this.config.componentsData.resourceType),this.config.loadEntity=l=>this.resourceService.getResourceInfo(l.id),this.config.saveEntity=l=>this.saveResource(l),this.config.deleteEntity=l=>this.resourceService.deleteResource(l.id),this.config.onEntityAction=l=>this.onResourceAction(l)}saveResource(t){if(Array.isArray(t.data)){const i=[];return t.data.forEach((n,o)=>{i.push({resourceType:t.resourceType,data:n,fileName:t.fileName[o],title:t.title})}),this.resourceService.saveResources(i,{resendRequest:!0}).pipe((0,ie.T)(n=>n[0]))}return this.resourceService.saveResource(t)}resolve(){this.config.tableTitle=this.translate.instant("resource.resources-library"),this.config.componentsData={resourceType:""};const t=(0,q.rx)(this.store);return this.config.deleteEnabled=i=>this.isResourceEditable(i,t.authority),this.config.entitySelectionEnabled=i=>this.isResourceEditable(i,t.authority),this.config.detailsReadonly=i=>this.detailsReadonly(i,t.authority),this.config}openResource(t,i){t&&t.stopPropagation();const n=this.router.createUrlTree(["resources","resources-library",i.id.id]);this.router.navigateByUrl(n).then(()=>{})}downloadResource(t,i){t&&t.stopPropagation(),this.resourceService.downloadResource(i.id.id).subscribe()}onResourceAction(t){switch(t.action){case"open":return this.openResource(t.event,t.entity),!0;case"downloadResource":return this.downloadResource(t.event,t.entity),!0}return!1}detailsReadonly(t,i){return t?.resourceType===me.vt.LWM2M_MODEL||!this.isResourceEditable(t,i)}isResourceEditable(t,i){return i===g.s.TENANT_ADMIN?t&&t.tenantId&&t.tenantId.id!==R.k:i===g.s.SYS_ADMIN}static{this.\u0275fac=function(i){return new(i||Ft)(e.\u0275\u0275inject(C.Store),e.\u0275\u0275inject(Ud.Q),e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(b.Router),e.\u0275\u0275inject(p.DatePipe))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Ft,factory:Ft.\u0275fac})}}var X=d(75402);const ee=(a,t,i)=>{switch(i.entitiesTableConfig.entityType){case f.ck.TB_RESOURCE:case f.ck.OTA_PACKAGE:return i.entity?.title;default:return i.entity?.name}};var Uo=d(44464),ca=d(81147),Dt=d(74172),mt=d(76364),Ve=d(96697),Qd=d(94158);class pa extends xe.l{constructor(t,i,n,o,r,l){super(t,l,n,o,r),this.store=t,this.translate=i,this.entityValue=n,this.entitiesTableConfigValue=o,this.cd=r,this.fb=l,this.entityType=f.ck,this.submitStrategies=[],this.processingStrategies=[]}ngOnInit(){super.ngOnInit()}buildForm(t){return this.fb.group({queue:[t]})}hideDelete(){return!!this.entitiesTableConfig&&!this.entitiesTableConfig.deleteEnabled(this.entity)}updateForm(t){this.entityForm.patchValue({queue:t},{emitEvent:!1})}prepareFormValue(t){return super.prepareFormValue(t.queue)}onQueueIdCopied(t){this.store.dispatch(new $.xo({message:this.translate.instant("queue.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}static{this.\u0275fac=function(i){return new(i||pa)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject("entity"),e.\u0275\u0275directiveInject("entitiesTableConfig"),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:pa,selectors:[["tb-queue"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:16,vars:22,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",1,"xs:flex-1",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col",3,"formGroup"],["formControlName","queue",3,"newQueue","systemQueue"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"button",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"open")}),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",2),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"delete")}),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"div",3)(10,"button",4),e.\u0275\u0275listener("cbOnSuccess",function(r){return n.onQueueIdCopied(r)}),e.\u0275\u0275element(11,"mat-icon",5),e.\u0275\u0275elementStart(12,"span",6),e.\u0275\u0275text(13,"queue.copyId"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(14,"div",7),e.\u0275\u0275element(15,"tb-queue-form",8),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",n.isEdit||n.isDetailsPage),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(2,14,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,16,"common.open-details-page")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.hideDelete()||n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(6,18,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(8,20,"queue.delete")," "),e.\u0275\u0275advance(3),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("cbContent",null==n.entity||null==n.entity.id?null:n.entity.id.id),e.\u0275\u0275advance(4),e.\u0275\u0275property("formGroup",n.entityForm),e.\u0275\u0275advance(),e.\u0275\u0275property("newQueue",n.isAdd)("systemQueue",!0))},dependencies:[x.MatButton,E.MatIcon,we.Uo,s.NgControlStatus,s.NgControlStatusGroup,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,Qd.QueueFormComponent,p.AsyncPipe,u.TranslatePipe],encapsulation:2})}}var Jd=d(50584);class Pt{constructor(t,i,n,o,r,l,c,m){this.store=t,this.broadcast=i,this.queueService=n,this.customerService=o,this.dialogService=r,this.homeDialogs=l,this.router=c,this.translate=m,this.queueType=Uo.C0.TB_RULE_ENGINE,this.config=new y.M7,this.config.entityType=f.ck.QUEUE,this.config.entityComponent=pa,this.config.entityTranslations=f.Mi.get(f.ck.QUEUE),this.config.entityResources=f.BT.get(f.ck.QUEUE),this.config.deleteEntityTitle=h=>this.translate.instant("queue.delete-queue-title",{queueName:h.name}),this.config.deleteEntityContent=()=>this.translate.instant("queue.delete-queue-text"),this.config.deleteEntitiesTitle=h=>this.translate.instant("queue.delete-queues-title",{count:h}),this.config.deleteEntitiesContent=()=>this.translate.instant("queue.delete-queues-text"),this.config.onEntityAction=h=>this.onQueueAction(h)}resolve(t){return this.config.componentsData={queueType:this.queueType},this.store.pipe((0,C.select)(q.SW),(0,Ve.s)(1)).pipe((0,ie.T)(()=>(this.config.tableTitle=this.translate.instant("admin.queues"),this.config.columns=this.configureColumns(),this.configureEntityFunctions(),this.config)))}configureColumns(){return[new y.KK("name","admin.queue-name","25%"),new y.KK("partitions","admin.queue-partitions","25%"),new y.KK("submitStrategy","admin.queue-submit-strategy","25%",t=>this.translate.instant(Uo.YN.get(t.submitStrategy.type).label),()=>({}),!1),new y.KK("processingStrategy","admin.queue-processing-strategy","25%",t=>this.translate.instant(Uo.pH.get(t.processingStrategy.type).label),()=>({}),!1)]}configureEntityFunctions(){this.config.entitiesFetchFunction=t=>this.queueService.getTenantQueuesByServiceType(t,this.queueType),this.config.loadEntity=t=>this.queueService.getQueueById(t.id),this.config.saveEntity=t=>this.queueService.saveQueue(t,this.queueType).pipe((0,Z.Z)(i=>this.queueService.getQueueById(i.id.id))),this.config.deleteEntity=t=>this.queueService.deleteQueue(t.id),this.config.deleteEnabled=t=>t&&"Main"!==t.name,this.config.entitySelectionEnabled=t=>t&&"Main"!==t.name}onQueueAction(t){return"open"===t.action&&(this.openQueue(t.event,t.entity),!0)}openQueue(t,i){t&&t.stopPropagation();const n=this.router.createUrlTree(["settings","queues",i.id.id]);this.router.navigateByUrl(n)}static{this.\u0275fac=function(i){return new(i||Pt)(e.\u0275\u0275inject(C.Store),e.\u0275\u0275inject(ca.D),e.\u0275\u0275inject(Jd.F),e.\u0275\u0275inject(Dt.m),e.\u0275\u0275inject(Ce.o),e.\u0275\u0275inject(mt.k),e.\u0275\u0275inject(b.Router),e.\u0275\u0275inject(u.TranslateService))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Pt,factory:Pt.\u0275fac})}}var Gr=d(14192);const Zd=["repositorySettingsComponent"];class ma extends de.H{constructor(t){super(t),this.store=t}ngOnInit(){}confirmForm(){return this.repositorySettingsComponent?.repositorySettingsForm}static{this.\u0275fac=function(i){return new(i||ma)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:ma,selectors:[["tb-repository-admin-settings"]],viewQuery:function(i,n){if(1&i&&e.\u0275\u0275viewQuery(Zd,5),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.repositorySettingsComponent=o.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:0,consts:[["repositorySettingsComponent",""]],template:function(i,n){1&i&&e.\u0275\u0275element(0,"tb-repository-settings",null,0)},dependencies:[Gr.h],encapsulation:2})}}var Xd=d(79093);const ec=["repositorySettingsComponent"],tc=["autoCommitSettingsComponent"];function nc(a,t){1&a&&e.\u0275\u0275element(0,"tb-repository-settings",null,1)}function ic(a,t){1&a&&e.\u0275\u0275element(0,"tb-auto-commit-settings",null,2)}class ua extends de.H{constructor(t){super(t),this.store=t,this.hasRepository$=this.store.pipe((0,C.select)(q.vu))}ngOnInit(){}confirmForm(){return this.repositorySettingsComponent?this.repositorySettingsComponent?.repositorySettingsForm:this.autoCommitSettingsComponent?.autoCommitSettingsForm}static{this.\u0275fac=function(i){return new(i||ua)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:ua,selectors:[["tb-auto-commit-admin-settings"]],viewQuery:function(i,n){if(1&i&&(e.\u0275\u0275viewQuery(ec,5),e.\u0275\u0275viewQuery(tc,5)),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.repositorySettingsComponent=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.autoCommitSettingsComponent=o.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:4,vars:4,consts:[["autoCommitSettings",""],["repositorySettingsComponent",""],["autoCommitSettingsComponent",""],[4,"ngIf","ngIfElse"]],template:function(i,n){if(1&i&&(e.\u0275\u0275template(0,nc,2,0,"tb-repository-settings",3),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275template(2,ic,2,0,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)),2&i){const o=e.\u0275\u0275reference(3);e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(1,2,n.hasRepository$))("ngIfElse",o)}},dependencies:[p.NgIf,Gr.h,Xd.F,p.AsyncPipe],encapsulation:2})}}var kt=d(72581),W=d(78916),Ye=d(71997);function ac(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",25)}function oc(a,t){1&a&&e.\u0275\u0275element(0,"div",26)}function rc(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.2fa.issuer-name-required")," "))}function sc(a,t){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"mat-form-field",13)(2,"mat-label",14),e.\u0275\u0275text(3,"admin.2fa.issuer-name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"input",32),e.\u0275\u0275template(5,rc,3,3,"mat-error",16),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&a){const i=e.\u0275\u0275nextContext(2).$implicit;e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.get("issuerName").hasError("required")||i.get("issuerName").hasError("pattern"))}}function lc(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.2fa.verification-message-template-required")," "))}function dc(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.2fa.verification-message-template-pattern")," "))}function cc(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.2fa.verification-code-lifetime-required")," "))}function pc(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.2fa.verification-code-lifetime-pattern")," "))}function mc(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",33)(1,"mat-form-field",13)(2,"mat-label",14),e.\u0275\u0275text(3,"admin.2fa.verification-message-template"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"input",34),e.\u0275\u0275template(5,lc,3,3,"mat-error",16)(6,dc,3,3,"mat-error",16),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"mat-form-field",13)(8,"mat-label",14),e.\u0275\u0275text(9,"admin.2fa.verification-code-lifetime"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(10,"input",35),e.\u0275\u0275template(11,cc,3,3,"mat-error",16)(12,pc,3,3,"mat-error",16),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(2).$implicit;e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.get("smsVerificationMessageTemplate").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.get("smsVerificationMessageTemplate").hasError("pattern")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.get("verificationCodeLifetime").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.get("verificationCodeLifetime").hasError("min")||i.get("verificationCodeLifetime").hasError("pattern"))}}function uc(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.2fa.verification-code-lifetime-required")," "))}function gc(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.2fa.verification-code-lifetime-pattern")," "))}function fc(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div")(1,"mat-form-field",13)(2,"mat-label",14),e.\u0275\u0275text(3,"admin.2fa.verification-code-lifetime"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"input",35),e.\u0275\u0275template(5,uc,3,3,"mat-error",16)(6,gc,3,3,"mat-error",16),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(2).$implicit;e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.get("verificationCodeLifetime").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.get("verificationCodeLifetime").hasError("min")||i.get("verificationCodeLifetime").hasError("pattern"))}}function hc(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.2fa.number-of-codes-required")," "))}function bc(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.2fa.number-of-codes-pattern")," "))}function yc(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div")(1,"mat-form-field",13)(2,"mat-label",14),e.\u0275\u0275text(3,"admin.2fa.number-of-codes"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"input",36),e.\u0275\u0275template(5,hc,3,3,"mat-error",16)(6,bc,3,3,"mat-error",16),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(2).$implicit;e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.get("codesQuantity").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.get("codesQuantity").hasError("min")||i.get("codesQuantity").hasError("pattern"))}}function vc(a,t){if(1&a&&(e.\u0275\u0275elementContainerStart(0,29),e.\u0275\u0275template(1,sc,6,1,"ng-container",30)(2,mc,13,4,"div",31)(3,fc,7,2,"div",30)(4,yc,7,2,"div",30),e.\u0275\u0275elementContainerEnd()),2&a){const i=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngSwitch",i.get("providerType").value),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",n.twoFactorAuthProviderType.TOTP),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",n.twoFactorAuthProviderType.SMS),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",n.twoFactorAuthProviderType.EMAIL),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",n.twoFactorAuthProviderType.BACKUP_CODE)}}function Cc(a,t){1&a&&e.\u0275\u0275element(0,"mat-divider")}function xc(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"mat-expansion-panel",27)(2,"mat-expansion-panel-header")(3,"mat-panel-title",20)(4,"mat-slide-toggle",28),e.\u0275\u0275listener("mousedown",function(o){const r=e.\u0275\u0275restoreView(i),l=r.$implicit,c=r.index,m=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(m.toggleExtensionPanel(o,c,l.get("enable").value))}),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(7,vc,5,5,"ng-template",22),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(8,Cc,1,0,"mat-divider",16),e.\u0275\u0275elementContainerEnd()}if(2&a){const i=t.$implicit,n=t.index,o=t.last,r=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("formGroupName",n),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(6,3,r.twoFactorAuthProvidersData.get(i.value.providerType).name)," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!o)}}function _c(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.2fa.total-allowed-time-for-verification-required")," "))}function Sc(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.2fa.total-allowed-time-for-verification-pattern")," "))}function Tc(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.2fa.retry-verification-code-period-required")," "))}function Ic(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.2fa.retry-verification-code-period-pattern")," "))}function wc(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.2fa.max-verification-failures-before-user-lockout-pattern")," "))}function Ec(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.2fa.number-of-checking-attempts-required")," "))}function Mc(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.2fa.number-of-checking-attempts-pattern")," "))}function Nc(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.2fa.within-time-required")," "))}function Ac(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.2fa.within-time-pattern")," "))}function Fc(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",33)(1,"mat-form-field",13)(2,"mat-label",14),e.\u0275\u0275text(3,"admin.2fa.number-of-checking-attempts"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"input",37),e.\u0275\u0275template(5,Ec,3,3,"mat-error",16)(6,Mc,3,3,"mat-error",16),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"mat-form-field",13)(8,"mat-label",14),e.\u0275\u0275text(9,"admin.2fa.within-time"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(10,"input",38),e.\u0275\u0275template(11,Nc,3,3,"mat-error",16)(12,Ac,3,3,"mat-error",16),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.twoFaFormGroup.get("verificationCodeCheckRateLimitNumber").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.twoFaFormGroup.get("verificationCodeCheckRateLimitNumber").hasError("pattern")||i.twoFaFormGroup.get("verificationCodeCheckRateLimitNumber").hasError("min")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.twoFaFormGroup.get("verificationCodeCheckRateLimitTime").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.twoFaFormGroup.get("verificationCodeCheckRateLimitTime").hasError("pattern")||i.twoFaFormGroup.get("verificationCodeCheckRateLimitTime").hasError("min"))}}class ga extends de.H{constructor(t,i,n){super(t),this.store=t,this.twoFaService=i,this.fb=n,this.destroy$=new fe.B,this.posIntValidation=[s.Validators.required,s.Validators.min(1),s.Validators.pattern(/^\d*$/)],this.twoFactorAuthProviderType=W.LB,this.twoFactorAuthProvidersData=W.yD,this.showMainLoadingBar=!1}ngOnInit(){this.build2faSettingsForm(),this.twoFaService.getTwoFaSettings().subscribe(t=>{this.setAuthConfigFormValue(t)})}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}confirmForm(){return this.twoFaFormGroup}save(){if(this.twoFaFormGroup.valid){const t=this.twoFaFormGroup.getRawValue();this.joinRateLimit(t,"verificationCodeCheckRateLimit");const i=t.providers.filter(o=>o.enable);i.forEach(o=>delete o.enable);const n=Object.assign(t,{providers:i});this.twoFaService.saveTwoFaSettings(n).subscribe(o=>{this.setAuthConfigFormValue(o),this.twoFaFormGroup.markAsUntouched(),this.twoFaFormGroup.markAsPristine()})}else Object.keys(this.twoFaFormGroup.controls).forEach(t=>{this.twoFaFormGroup.get(t).markAsTouched({onlySelf:!0})})}toggleExtensionPanel(t,i,n){t&&t.stopPropagation(),n?this.getByIndexPanel(i).open():this.getByIndexPanel(i).close()}trackByElement(t,i){return i}get providersForm(){return this.twoFaFormGroup.get("providers")}build2faSettingsForm(){this.twoFaFormGroup=this.fb.group({maxVerificationFailuresBeforeUserLockout:[30,[s.Validators.pattern(/^\d*$/),s.Validators.min(0),s.Validators.max(65535)]],totalAllowedTimeForVerification:[3600,[s.Validators.required,s.Validators.min(60),s.Validators.pattern(/^\d*$/)]],verificationCodeCheckRateLimitEnable:[!1],verificationCodeCheckRateLimitNumber:[{value:3,disabled:!0},this.posIntValidation],verificationCodeCheckRateLimitTime:[{value:900,disabled:!0},this.posIntValidation],minVerificationCodeSendPeriod:["30",[s.Validators.required,s.Validators.min(5),s.Validators.pattern(/^\d*$/)]],providers:this.fb.array([])}),Object.values(W.LB).forEach(t=>{this.buildProvidersSettingsForm(t)}),this.twoFaFormGroup.get("verificationCodeCheckRateLimitEnable").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(t=>{t?(this.twoFaFormGroup.get("verificationCodeCheckRateLimitNumber").enable({emitEvent:!1}),this.twoFaFormGroup.get("verificationCodeCheckRateLimitTime").enable({emitEvent:!1})):(this.twoFaFormGroup.get("verificationCodeCheckRateLimitNumber").disable({emitEvent:!1}),this.twoFaFormGroup.get("verificationCodeCheckRateLimitTime").disable({emitEvent:!1}))}),this.providersForm.valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(t=>{const i=t.filter(o=>o.enable),n=Object.values(W.LB).indexOf(W.LB.BACKUP_CODE);!i.length||1===i.length&&i[0].providerType===W.LB.BACKUP_CODE?(this.providersForm.at(n).get("enable").setValue(!1,{emitEvent:!1}),this.providersForm.at(n).disable({emitEvent:!1}),this.providersForm.at(n).get("providerType").enable({emitEvent:!1})):this.providersForm.at(n).get("enable").enable({emitEvent:!1})})}setAuthConfigFormValue(t){const[i,n]=this.splitRateLimit(t?.verificationCodeCheckRateLimit),o=t?.providers.map(l=>l.providerType)||[],r=Object.assign({},t,{verificationCodeCheckRateLimitEnable:i>0,verificationCodeCheckRateLimitNumber:i||3,verificationCodeCheckRateLimitTime:n||900,providers:[]});i>0&&this.getByIndexPanel(this.providersForm.length).open(),Object.values(W.LB).forEach((l,c)=>{const m=o.indexOf(l);m>-1?(r.providers.push(Object.assign(t.providers[m],{enable:!0})),this.getByIndexPanel(c).open()):r.providers.push({enable:!1})}),this.twoFaFormGroup.patchValue(r)}buildProvidersSettingsForm(t){const i={providerType:[t],enable:[!1]};switch(t){case W.LB.TOTP:i.issuerName=[{value:"ThingsBoard",disabled:!0},[s.Validators.required,s.Validators.pattern(/^(?!^\s+$).*$/)]];break;case W.LB.SMS:i.smsVerificationMessageTemplate=[{value:"Verification code: ${code}",disabled:!0},[s.Validators.required,s.Validators.pattern(/\${code}/)]],i.verificationCodeLifetime=[{value:120,disabled:!0},this.posIntValidation];break;case W.LB.EMAIL:i.verificationCodeLifetime=[{value:120,disabled:!0},this.posIntValidation];break;case W.LB.BACKUP_CODE:i.codesQuantity=[{value:10,disabled:!0},this.posIntValidation]}const n=this.fb.group(i);n.get("enable").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(o=>{o?n.enable({emitEvent:!1}):(n.disable({emitEvent:!1}),n.get("enable").enable({emitEvent:!1}),n.get("providerType").enable({emitEvent:!1}))}),this.providersForm.push(n,{emitEvent:!1})}getByIndexPanel(t){return this.expansionPanel.find((i,n)=>n===t)}splitRateLimit(t){if((0,_.Q8)(t)){const[i,n]=t.split(":");return[parseInt(i,10),parseInt(n,10)]}return[0,0]}joinRateLimit(t,i){t[`${i}Enable`]&&(t[i]=[t[`${i}Number`],t[`${i}Time`]].join(":")),delete t[`${i}Enable`],delete t[`${i}Number`],delete t[`${i}Time`]}static{this.\u0275fac=function(i){return new(i||ga)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(kt.Z),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:ga,selectors:[["tb-2fa-settings"]],viewQuery:function(i,n){if(1&i&&e.\u0275\u0275viewQuery(U.MatExpansionPanel,5),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.expansionPanel=o)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:54,vars:26,consts:[["appearance","outlined",1,"settings-card"],["translate","",1,"mat-headline-5"],[1,"flex-1"],["tb-help","twoFactorAuthentication"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[3,"ngSubmit","formGroup"],[3,"disabled"],["formArrayName","providers",1,"fields-group"],["translate","",1,"group-title"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"fields-group"],[1,"input-row","flex","flex-row","xs:flex-col","gt-xs:gap-2"],[1,"mat-block","flex-1"],["translate",""],["matInput","","required","","formControlName","totalAllowedTimeForVerification","type","number","step","1","min","60"],[4,"ngIf"],["matInput","","required","","formControlName","minVerificationCodeSendPeriod","type","number","step","1","min","5"],["matInput","","formControlName","maxVerificationFailuresBeforeUserLockout","type","number","step","1","min","0","max","65535"],[1,"provider"],[1,"flex","items-center","justify-start"],["formControlName","verificationCodeCheckRateLimitEnable",3,"mousedown"],["matExpansionPanelContent",""],[1,"flex","flex-row","items-center","justify-end","gap-2"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[1,"provider",3,"formGroupName"],["formControlName","enable",3,"mousedown"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","flex flex-row xs:flex-col gt-xs:gap-2",4,"ngSwitchCase"],["matInput","","formControlName","issuerName","required",""],[1,"flex","flex-row","xs:flex-col","gt-xs:gap-2"],["matInput","","formControlName","smsVerificationMessageTemplate","required",""],["matInput","","formControlName","verificationCodeLifetime","type","number","step","1","min","1","required",""],["matInput","","formControlName","codesQuantity","type","number","step","1","min","1","required",""],["matInput","","formControlName","verificationCodeCheckRateLimitNumber","required","","type","number","step","1","min","1"],["matInput","","formControlName","verificationCodeCheckRateLimitTime","required","","type","number","step","1","min","1"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div")(1,"mat-card",0)(2,"mat-card-header")(3,"mat-card-title")(4,"span",1),e.\u0275\u0275text(5,"admin.2fa.2fa"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(6,"span",2)(7,"div",3),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(8,ac,1,0,"mat-progress-bar",4),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275template(10,oc,1,0,"div",5),e.\u0275\u0275pipe(11,"async"),e.\u0275\u0275elementStart(12,"mat-card-content")(13,"form",6),e.\u0275\u0275listener("ngSubmit",function(){return n.save()}),e.\u0275\u0275elementStart(14,"fieldset",7),e.\u0275\u0275pipe(15,"async"),e.\u0275\u0275elementStart(16,"div")(17,"fieldset",8)(18,"legend",9),e.\u0275\u0275text(19,"admin.2fa.available-providers"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(20,xc,9,5,"ng-container",10),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"fieldset",11)(22,"legend",9),e.\u0275\u0275text(23,"admin.2fa.verification-limitations"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(24,"div",12)(25,"mat-form-field",13)(26,"mat-label",14),e.\u0275\u0275text(27,"admin.2fa.total-allowed-time-for-verification"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(28,"input",15),e.\u0275\u0275template(29,_c,3,3,"mat-error",16)(30,Sc,3,3,"mat-error",16),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(31,"mat-form-field",13)(32,"mat-label",14),e.\u0275\u0275text(33,"admin.2fa.retry-verification-code-period"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(34,"input",17),e.\u0275\u0275template(35,Tc,3,3,"mat-error",16)(36,Ic,3,3,"mat-error",16),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(37,"mat-form-field",13)(38,"mat-label",14),e.\u0275\u0275text(39,"admin.2fa.max-verification-failures-before-user-lockout"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(40,"input",18),e.\u0275\u0275template(41,wc,3,3,"mat-error",16),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(42,"mat-expansion-panel",19)(43,"mat-expansion-panel-header")(44,"mat-panel-title",20)(45,"mat-slide-toggle",21),e.\u0275\u0275listener("mousedown",function(r){return n.toggleExtensionPanel(r,n.providersForm.length,n.twoFaFormGroup.get("verificationCodeCheckRateLimitEnable").value)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(46),e.\u0275\u0275pipe(47,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(48,Fc,13,4,"ng-template",22),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(49,"div",23)(50,"button",24),e.\u0275\u0275pipe(51,"async"),e.\u0275\u0275text(52),e.\u0275\u0275pipe(53,"translate"),e.\u0275\u0275elementEnd()()()()()()()),2&i&&(e.\u0275\u0275advance(8),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(9,14,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(11,16,n.isLoading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("formGroup",n.twoFaFormGroup),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(15,18,n.isLoading$)),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",n.providersForm.controls)("ngForTrackBy",n.trackByElement),e.\u0275\u0275advance(9),e.\u0275\u0275property("ngIf",n.twoFaFormGroup.get("totalAllowedTimeForVerification").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.twoFaFormGroup.get("totalAllowedTimeForVerification").hasError("pattern")||n.twoFaFormGroup.get("totalAllowedTimeForVerification").hasError("min")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",n.twoFaFormGroup.get("minVerificationCodeSendPeriod").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.twoFaFormGroup.get("minVerificationCodeSendPeriod").hasError("pattern")||n.twoFaFormGroup.get("minVerificationCodeSendPeriod").hasError("min")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",n.twoFaFormGroup.get("maxVerificationFailuresBeforeUserLockout").hasError("pattern")||n.twoFaFormGroup.get("maxVerificationFailuresBeforeUserLockout").hasError("min")||n.twoFaFormGroup.get("maxVerificationFailuresBeforeUserLockout").hasError("max")),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(47,20,"admin.2fa.verification-code-check-rate-limit")," "),e.\u0275\u0275advance(4),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(51,22,n.isLoading$)||n.twoFaFormGroup.invalid||!n.twoFaFormGroup.dirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(53,24,"action.save")," "))},dependencies:[p.NgForOf,p.NgIf,p.NgSwitch,p.NgSwitchCase,be.HelpComponent,x.MatButton,D.MatCard,D.MatCardContent,D.MatCardHeader,D.MatCardTitle,K.MatProgressBar,L.MatInput,v.MatFormField,v.MatLabel,v.MatError,Ye.MatDivider,pe.MatSlideToggle,U.MatExpansionPanel,U.MatExpansionPanelHeader,U.MatExpansionPanelTitle,U.MatExpansionPanelContent,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NumberValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.MinValidator,s.MaxValidator,s.FormGroupDirective,s.FormControlName,s.FormGroupName,s.FormArrayName,u.TranslateDirective,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}','@charset "UTF-8";@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:90%}}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{margin:8px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px;position:relative;padding-bottom:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3;width:fit-content;margin:0 8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   .input-row[_ngcontent-%COMP%]{padding:8px 8px 0}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]{box-shadow:none;margin:1px 0 0}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel.provider[_ngcontent-%COMP%]{overflow:inherit}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel.provider[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%]{padding:0 24px 0 8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel.provider[_ngcontent-%COMP%]   .mat-expansion-panel-header.mat-expanded[_ngcontent-%COMP%]{height:48px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel.provider[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin-right:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel.provider[_ngcontent-%COMP%]   .mat-expansion-panel-header-title[_ngcontent-%COMP%]{height:40px}[_nghost-%COMP%]     .mat-mdc-form-field .mat-mdc-form-field-infix{width:100%}[_nghost-%COMP%]     .mat-expansion-panel .mat-expansion-panel-content{font-size:16px}[_nghost-%COMP%]     .mat-expansion-panel.provider .mat-expansion-panel-header>.mat-content{overflow:inherit}[_nghost-%COMP%]     .mat-expansion-panel.provider .mat-expansion-panel-body{padding:0 16px 8px 8px}']})}}var Ae=d(19104),qo=d(24261),ut=d(46107),Pe=d(67496),Ee=d(61172),Q=d(96850),ke=d(40810);function Dc(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-tab",2,0),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementStart(3,"tb-version-control",3),e.\u0275\u0275listener("versionRestored",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.entitiesTableConfig.updateData())}),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"version-control.version-control")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.title)("externalEntityId",n.entity.externalId||n.entity.id)}}class fa extends Ee.P{constructor(t){super(t),this.store=t}isTenantWidgetsBundle(){return this.entity&&this.entity.tenantId.id!==R.k}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(i){return new(i||fa)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:fa,selectors:[["tb-widgets-bundle-tabs"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(i,n){1&i&&e.\u0275\u0275template(0,Dc,4,7,"mat-tab",1),2&i&&e.\u0275\u0275property("ngIf",n.isTenantWidgetsBundle()&&n.authUser.authority===n.authorities.TENANT_ADMIN)},dependencies:[p.NgIf,Q.MatTab,ke.d,u.TranslatePipe],encapsulation:2})}}class Lt{constructor(t,i,n,o,r,l,c){this.store=t,this.dialogService=i,this.widgetsService=n,this.translate=o,this.importExport=r,this.datePipe=l,this.router=c,this.config=new y.M7,this.config.entityType=f.ck.WIDGETS_BUNDLE,this.config.entityComponent=qo.B,this.config.entityTabsComponent=fa,this.config.entityTranslations=f.Mi.get(f.ck.WIDGETS_BUNDLE),this.config.entityResources=f.BT.get(f.ck.WIDGETS_BUNDLE),this.config.defaultSortOrder={property:"title",direction:Pe.O.ASC},this.config.rowPointer=!0,this.config.entityTitle=m=>m?m.title:"",this.config.columns.push(new y.Qr("createdTime","common.created-time",this.datePipe,"150px"),new y.KK("title","widgets-bundle.title","100%"),new y.KK("tenantId","widgets-bundle.system","60px",m=>(0,y.ov)(m.tenantId.id===R.k))),this.config.addActionDescriptors.push({name:this.translate.instant("widgets-bundle.create-new-widgets-bundle"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:m=>this.config.getTable().addEntity(m)},{name:this.translate.instant("widgets-bundle.import"),icon:"file_upload",isEnabled:()=>!0,onAction:m=>this.importWidgetsBundle(m)}),this.config.cellActionDescriptors.push({name:this.translate.instant("widgets-bundle.export"),icon:"file_download",isEnabled:()=>!0,onAction:(m,h)=>this.exportWidgetsBundle(m,h)},{name:this.translate.instant("widgets-bundle.widgets-bundle-details"),icon:"edit",isEnabled:()=>!0,onAction:(m,h)=>this.config.toggleEntityDetails(m,h)}),this.config.deleteEntityTitle=m=>this.translate.instant("widgets-bundle.delete-widgets-bundle-title",{widgetsBundleTitle:m.title}),this.config.deleteEntityContent=()=>this.translate.instant("widgets-bundle.delete-widgets-bundle-text"),this.config.deleteEntitiesTitle=m=>this.translate.instant("widgets-bundle.delete-widgets-bundles-title",{count:m}),this.config.deleteEntitiesContent=()=>this.translate.instant("widgets-bundle.delete-widgets-bundles-text"),this.config.loadEntity=m=>this.widgetsService.getWidgetsBundle(m.id),this.config.saveEntity=m=>this.widgetsService.saveWidgetsBundle(m),this.config.deleteEntity=m=>this.widgetsService.deleteWidgetsBundle(m.id),this.config.onEntityAction=m=>this.onWidgetsBundleAction(m,this.config),this.config.handleRowClick=(m,h)=>(this.config.isDetailsOpen()?this.config.toggleEntityDetails(m,h):this.openWidgetsBundle(m,h),!0),this.config.entityAdded=m=>{this.openWidgetsBundle(null,m)}}resolve(){this.config.tableTitle=this.translate.instant("widgets-bundle.widgets-bundles");const t=(0,q.rx)(this.store);this.config.deleteEnabled=n=>this.isWidgetsBundleEditable(n,t.authority),this.config.entitySelectionEnabled=n=>this.isWidgetsBundleEditable(n,t.authority),this.config.detailsReadonly=n=>!this.isWidgetsBundleEditable(n,t.authority);(0,q.rW)(this.store);return this.config.entitiesFetchFunction=n=>this.widgetsService.getWidgetBundles(n),this.config}isWidgetsBundleEditable(t,i){return i===g.s.TENANT_ADMIN?t&&t.tenantId&&t.tenantId.id!==R.k:i===g.s.SYS_ADMIN}importWidgetsBundle(t){this.importExport.importWidgetsBundle().subscribe(i=>{i&&this.config.updateData()})}openWidgetsBundle(t,i){t&&t.stopPropagation(),this.router.navigateByUrl(`resources/widgets-bundles/${i.id.id}/widgetTypes`)}openWidgetsBundleDetails(t,i,n){t&&t.stopPropagation();const o=this.router.createUrlTree(["details",i.id.id],{relativeTo:n.getActivatedRoute()});this.router.navigateByUrl(o)}exportWidgetsBundle(t,i){t&&t.stopPropagation(),this.importExport.exportWidgetsBundle(i.id.id)}onWidgetsBundleAction(t,i){switch(t.action){case"open":return this.openWidgetsBundle(t.event,t.entity),!0;case"openDetails":return this.openWidgetsBundleDetails(t.event,t.entity,i),!0;case"export":return this.exportWidgetsBundle(t.event,t.entity),!0}return!1}static{this.\u0275fac=function(i){return new(i||Lt)(e.\u0275\u0275inject(C.Store),e.\u0275\u0275inject(Ce.o),e.\u0275\u0275inject(Ae.C),e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(ut.ImportExportService),e.\u0275\u0275inject(p.DatePipe),e.\u0275\u0275inject(b.Router))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Lt,factory:Lt.\u0275fac})}}var jr=d(87891),he=d(57665),Me=d(60890),fr=d(20429),Ur=d(3408),Pc=d(72085),kc=d(2869);function Lc(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",16)}function Oc(a,t){1&a&&e.\u0275\u0275element(0,"div",17)}function Rc(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"widget.title-required")," "))}class dn extends se.m{constructor(t,i,n,o,r){super(t,i,o),this.store=t,this.router=i,this.data=n,this.dialogRef=o,this.fb=r,this.dialogTitle="widget.save-widget-as",this.saveAsActionTitle="action.saveAs",(0,q.rx)(t).authority===g.s.TENANT_ADMIN?this.bundlesScope="tenant":this.bundlesScope="system",this.data?.dialogTitle&&(this.dialogTitle=this.data.dialogTitle),this.data?.saveAsActionTitle&&(this.saveAsActionTitle=this.data.saveAsActionTitle)}ngOnInit(){this.saveWidgetTypeAsFormGroup=this.fb.group({title:[this.data?.title,[s.Validators.required]],widgetsBundle:[null]})}cancel(){this.dialogRef.close(null)}saveAs(){const t=this.saveWidgetTypeAsFormGroup.get("title").value,i=this.saveWidgetTypeAsFormGroup.get("widgetsBundle").value?.id?.id,n={widgetName:t,widgetBundleId:i};this.dialogRef.close(n)}static{this.\u0275fac=function(i){return new(i||dn)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(S.MAT_DIALOG_DATA),e.\u0275\u0275directiveInject(S.MatDialogRef),e.\u0275\u0275directiveInject(s.FormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:dn,selectors:[["tb-save-widget-type-as-dialog"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:30,vars:23,consts:[[2,"min-width","360px",3,"ngSubmit","formGroup"],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content",""],[1,"mat-block"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["formControlName","widgetsBundle","createNew","",3,"bundlesScope"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"form",0),e.\u0275\u0275listener("ngSubmit",function(){return n.saveAs()}),e.\u0275\u0275elementStart(1,"mat-toolbar",1)(2,"h2",2),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"span",3),e.\u0275\u0275elementStart(5,"button",4),e.\u0275\u0275listener("click",function(){return n.cancel()}),e.\u0275\u0275elementStart(6,"mat-icon",5),e.\u0275\u0275text(7,"close"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(8,Lc,1,0,"mat-progress-bar",6),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275template(10,Oc,1,0,"div",7),e.\u0275\u0275pipe(11,"async"),e.\u0275\u0275elementStart(12,"div",8)(13,"span",2),e.\u0275\u0275text(14),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"mat-form-field",9)(16,"mat-label",2),e.\u0275\u0275text(17,"widget.title"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(18,"input",10),e.\u0275\u0275template(19,Rc,3,3,"mat-error",11),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(20,"tb-widgets-bundle-select",12),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"div",13)(22,"button",14),e.\u0275\u0275pipe(23,"async"),e.\u0275\u0275listener("click",function(){return n.cancel()}),e.\u0275\u0275text(24),e.\u0275\u0275pipe(25,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(26,"button",15),e.\u0275\u0275pipe(27,"async"),e.\u0275\u0275text(28),e.\u0275\u0275pipe(29,"translate"),e.\u0275\u0275elementEnd()()()),2&i&&(e.\u0275\u0275property("formGroup",n.saveWidgetTypeAsFormGroup),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(n.dialogTitle),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(9,11,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(11,13,n.isLoading$)),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(n.dialogTitle),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",n.saveWidgetTypeAsFormGroup.get("title").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("bundlesScope",n.bundlesScope),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(23,15,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(25,17,"action.cancel")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(27,19,n.isLoading$)||n.saveWidgetTypeAsFormGroup.invalid||!n.saveWidgetTypeAsFormGroup.dirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(29,21,n.saveAsActionTitle)," "))},dependencies:[p.NgIf,kc.WidgetsBundleSelectComponent,x.MatButton,x.MatIconButton,E.MatIcon,K.MatProgressBar,L.MatInput,v.MatFormField,v.MatLabel,v.MatError,ae.MatToolbar,S.MatDialogActions,S.MatDialogContent,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,p.AsyncPipe,u.TranslatePipe],encapsulation:2})}}var hr=d(18810),Wo=d(55987),qr=d(19022),Vc=d(12285);const Bc={self:{description:"Built-in variable <b>self</b> that is a reference to the widget instance",type:'<a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/modules/home/models/widget-component.models.ts#L350" target="_blank">WidgetTypeInstance</a>',meta:"object",children:{onInit:{description:"The first function which is called when widget is ready for initialization.<br>Should be used to prepare widget DOM, process widget settings and initial subscription information.",meta:"function"},onDataUpdated:{description:'Called when the new data is available from the widget subscription.<br>Latest data can be accessed from the <code>defaultSubscription</code> property of <a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/modules/home/models/widget-component.models.ts#L83" target="_blank">widget context (<code>ctx</code>)</a>.',meta:"function"},onResize:{description:'Called when widget container is resized. Latest <code>width</code> and <code>height</code> can be obtained from <a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/modules/home/models/widget-component.models.ts#L83" target="_blank">widget context (<code>ctx</code>)</a>.',meta:"function"},onEditModeChanged:{description:'Called when dashboard editing mode is changed. Latest mode is handled by <code>isEdit</code> property of <a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/modules/home/models/widget-component.models.ts#L83" target="_blank">widget context (<code>ctx</code>)</a>.',meta:"function"},onMobileModeChanged:{description:'Called when dashboard view width crosses mobile breakpoint. Latest state is handled by <code>isMobile</code> property of <a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/modules/home/models/widget-component.models.ts#L83" target="_blank">widget context (<code>ctx</code>)</a>.',meta:"function"},onDestroy:{description:"Called when widget element is destroyed. Should be used to cleanup all resources if necessary.",meta:"function"},getSettingsSchema:{description:'Optional function returning widget settings schema json as alternative to <b>Settings tab</b> of <a href="https://thingsboard.io/docs/user-guide/contribution/widgets-development/#settings-schema-section" target="_blank">Settings schema section</a>.',meta:"function",return:{description:"An widget settings schema json",type:"object"}},getDataKeySettingsSchema:{description:'Optional function returning particular data key settings schema json as alternative to <b>Data key settings schema</b> of <a href="https://thingsboard.io/docs/user-guide/contribution/widgets-development/#settings-schema-section" target="_blank">Settings schema section</a>.',meta:"function",return:{description:"A particular data key settings schema json",type:"object"}},typeParameters:{description:"Returns object describing widget datasource parameters.",meta:"function",return:{description:"An object describing widget datasource parameters.",type:'<a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/shared/models/widget.models.ts#L146" target="_blank">WidgetTypeParameters</a>'}},actionSources:{description:"Returns map describing available widget action sources used to define user actions.",meta:"function",return:{description:"A map of action sources by action source id.",type:'{[actionSourceId: string]: <a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/shared/models/widget.models.ts#L118" target="_blank">WidgetActionSource</a>}'}},...qr.P}},...qr.P,...Vc.pl},Gc=new Wo.P(Bc);var cn=d(99437),pn=d(96778),ha=d(21626),Wr=d(62901),jc=d(98711),$r=d(61499),Uc=d(63950),zr=d(9160),ba=d(77177),Be=d(59115),_e=d(14823),$o=d(9183),qc=d(4958),br=d(86763),Wc=d(42415);const $c=["topPanel"],zc=["topLeftPanel"],Hc=["topRightPanel"],Kc=["bottomPanel"],Yc=["javascriptPanel"],Qc=["framePanel"],Jc=["htmlInput"],Zc=["cssInput"],Xc=["settingsJsonInput"],ep=["dataKeySettingsJsonInput"],tp=["latestDataKeySettingsJsonInput"],np=["javascriptInput"],ip=["widgetIFrame"],ap=()=>({maxWidth:"1200px"});function op(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",70),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.widgetTypesDataMap.get(n.widgetTypes[i]).name)," ")}}function rp(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",29),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.saveWidget())}),e.\u0275\u0275elementStart(3,"mat-icon"),e.\u0275\u0275text(4,"save"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"span",26),e.\u0275\u0275text(6,"action.save"),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate1("matTooltip","",e.\u0275\u0275pipeBind1(1,4,"widget.save")," (CTRL + S)"),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(2,6,i.isLoading$)||i.saveDisabled())("tb-circular-progress",i.saveWidgetPending)}}function sp(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",34),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.saveWidget())}),e.\u0275\u0275elementStart(2,"mat-icon"),e.\u0275\u0275text(3,"save"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"span",26),e.\u0275\u0275text(5,"action.save"),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(1,1,i.isLoading$)||i.saveDisabled())}}function lp(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",71)(1,"tb-resource-autocomplete",72),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275twoWayListener("ngModelChange",function(o){const r=e.\u0275\u0275restoreView(i).$implicit;return e.\u0275\u0275twoWayBindingSet(r.url,o)||(r.url=o),e.\u0275\u0275resetView(o)}),e.\u0275\u0275listener("ngModelChange",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.isDirty=!0)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"mat-checkbox",73),e.\u0275\u0275twoWayListener("ngModelChange",function(o){const r=e.\u0275\u0275restoreView(i).$implicit;return e.\u0275\u0275twoWayBindingSet(r.isModule,o)||(r.isModule=o),e.\u0275\u0275resetView(o)}),e.\u0275\u0275listener("ngModelChange",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.isDirty=!0)}),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"button",74),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275listener("click",function(){const o=e.\u0275\u0275restoreView(i).index,r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.removeResource(o))}),e.\u0275\u0275elementStart(9,"mat-icon"),e.\u0275\u0275text(10,"close"),e.\u0275\u0275elementEnd()()()}if(2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(2,7,"widget.resource-url")),e.\u0275\u0275property("allowAutocomplete",i.isModule),e.\u0275\u0275twoWayProperty("ngModel",i.url),e.\u0275\u0275advance(2),e.\u0275\u0275twoWayProperty("ngModel",i.isModule),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,9,"widget.resource-is-module")," "),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(7,11,"widget.remove-resource")),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(8,13,n.isLoading$))}}function dp(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-form-field",53)(1,"mat-label",26),e.\u0275\u0275text(2,"widget.latest-data-key-settings-form-selector"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"input",59),e.\u0275\u0275twoWayListener("ngModelChange",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275twoWayBindingSet(r.widget.latestDataKeySettingsDirective,o)||(r.widget.latestDataKeySettingsDirective=o),e.\u0275\u0275resetView(o)}),e.\u0275\u0275listener("ngModelChange",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.isDirty=!0)}),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275twoWayProperty("ngModel",i.widget.latestDataKeySettingsDirective)}}function cp(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-form-field",53)(1,"mat-label",26),e.\u0275\u0275text(2,"widget.basic-mode-form-selector"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"input",59),e.\u0275\u0275twoWayListener("ngModelChange",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275twoWayBindingSet(r.widget.basicModeDirective,o)||(r.widget.basicModeDirective=o),e.\u0275\u0275resetView(o)}),e.\u0275\u0275listener("ngModelChange",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.isDirty=!0)}),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275twoWayProperty("ngModel",i.widget.basicModeDirective)}}function pp(a,t){1&a&&(e.\u0275\u0275elementStart(0,"div",75),e.\u0275\u0275element(1,"mat-spinner",76),e.\u0275\u0275elementEnd())}class ya extends de.H{get isDirty(){return this._isDirty||this.isEditModeWidget}set isDirty(t){t||(this.isEditModeWidget=!1),this._isDirty=t}constructor(t,i,n,o,r,l,c,m){super(t),this.store=t,this.window=i,this.route=n,this.router=o,this.widgetService=r,this.translate=l,this.raf=c,this.dialog=m,this.widgetTypes=he.t_,this.allWidgetTypes=Object.keys(he.t_),this.widgetTypesDataMap=he.WT,this.isEditModeWidget=!1,this._isDirty=!1,this.fullscreen=!1,this.htmlFullscreen=!1,this.cssFullscreen=!1,this.jsonSettingsFullscreen=!1,this.jsonDataKeySettingsFullscreen=!1,this.jsonLatestDataKeySettingsFullscreen=!1,this.javascriptFullscreen=!1,this.iFrameFullscreen=!1,this.aceEditors=[],this.editorsResizeCafs={},this.onWindowMessageListener=this.onWindowMessage.bind(this),this.iframeWidgetEditModeInited=!1,this.saveWidgetPending=!1,this.saveWidgetAsPending=!1,this.gotError=!1,this.errorMarkers=[],this.errorAnnotationId=-1,this.hotKeys=[],this.updateBreadcrumbs=new e.EventEmitter,this.rxSubscriptions=new Array,this.authUser=(0,q.rx)(t),this.rxSubscriptions.push(this.route.data.subscribe(h=>{this.init(h)})),this.initHotKeys()}init(t){if(this.widgetTypeDetails=t.widgetEditorData.widgetTypeDetails,this.widget=t.widgetEditorData.widget,this.authUser.authority===g.s.TENANT_ADMIN?this.isReadOnly=this.widgetTypeDetails&&this.widgetTypeDetails.tenantId.id===R.k:this.isReadOnly=this.authUser.authority!==g.s.SYS_ADMIN,this.widgetTypeDetails){const i=JSON.parse(this.widget.defaultConfig);this.widget.defaultConfig=JSON.stringify(i)}this.origWidget=(0,_.Go)(this.widget),this.widgetTypeDetails||(this.isDirty=!0)}ngOnInit(){this.initSplitLayout(),this.initAceEditors(),this.iframe=Wc(this.widgetIFrameElmRef.nativeElement),this.window.addEventListener("message",this.onWindowMessageListener),this.iframe.attr("data-widget",JSON.stringify(this.widget)),this.iframe.attr("src","/widget-editor")}ngOnDestroy(){this.window.removeEventListener("message",this.onWindowMessageListener),this.aceEditors.forEach(t=>t.destroy()),this.aceResize$.disconnect(),this.rxSubscriptions.forEach(t=>{t.unsubscribe()}),this.rxSubscriptions.length=0}initHotKeys(){this.hotKeys.push(new Me.t5("ctrl+q",t=>(!(0,fr.aM)(this.store)&&!this.undoDisabled()&&(t.preventDefault(),this.undoWidget()),!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("widget.undo"))),this.hotKeys.push(new Me.t5("ctrl+s",t=>(!(0,fr.aM)(this.store)&&!this.saveDisabled()&&(t.preventDefault(),this.saveWidget()),!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("widget.save"))),this.hotKeys.push(new Me.t5("shift+ctrl+s",t=>(!(0,fr.aM)(this.store)&&!this.saveAsDisabled()&&(t.preventDefault(),this.saveWidgetAs()),!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("widget.saveAs"))),this.hotKeys.push(new Me.t5("shift+ctrl+f",t=>(t.preventDefault(),this.fullscreen=!this.fullscreen,!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("widget.toggle-fullscreen"))),this.hotKeys.push(new Me.t5("ctrl+enter",t=>(t.preventDefault(),this.applyWidgetScript(),!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("widget.run")))}initSplitLayout(){Split([this.topPanelElmRef.nativeElement,this.bottomPanelElmRef.nativeElement],{sizes:[35,65],gutterSize:8,cursor:"row-resize",direction:"vertical"}),Split([this.topLeftPanelElmRef.nativeElement,this.topRightPanelElmRef.nativeElement],{sizes:[50,50],gutterSize:8,cursor:"col-resize"}),Split([this.javascriptPanelElmRef.nativeElement,this.framePanelElmRef.nativeElement],{sizes:[50,50],gutterSize:8,cursor:"col-resize"})}initAceEditors(){this.aceResize$=new ResizeObserver(i=>{i.forEach(n=>{const o=this.aceEditors.find(r=>r.container===n.target);this.onAceEditorResize(o)})});const t=[];t.push(this.createAceEditor(this.htmlInputElmRef,"html").pipe((0,ne.M)(i=>{this.htmlEditor=i,this.htmlEditor.on("input",()=>{const n=this.htmlEditor.getValue();this.widget.templateHtml!==n&&(this.widget.templateHtml=n,this.isDirty=!0)})}))),t.push(this.createAceEditor(this.cssInputElmRef,"css").pipe((0,ne.M)(i=>{this.cssEditor=i,this.cssEditor.on("input",()=>{const n=this.cssEditor.getValue();this.widget.templateCss!==n&&(this.widget.templateCss=n,this.isDirty=!0)})}))),t.push(this.createAceEditor(this.settingsJsonInputElmRef,"json").pipe((0,ne.M)(i=>{this.jsonSettingsEditor=i,this.jsonSettingsEditor.on("input",()=>{const n=this.jsonSettingsEditor.getValue();this.widget.settingsSchema!==n&&(this.widget.settingsSchema=n,this.isDirty=!0)})}))),t.push(this.createAceEditor(this.dataKeySettingsJsonInputElmRef,"json").pipe((0,ne.M)(i=>{this.dataKeyJsonSettingsEditor=i,this.dataKeyJsonSettingsEditor.on("input",()=>{const n=this.dataKeyJsonSettingsEditor.getValue();this.widget.dataKeySettingsSchema!==n&&(this.widget.dataKeySettingsSchema=n,this.isDirty=!0)})}))),t.push(this.createAceEditor(this.latestDataKeySettingsJsonInputElmRef,"json").pipe((0,ne.M)(i=>{this.latestDataKeyJsonSettingsEditor=i,this.latestDataKeyJsonSettingsEditor.on("input",()=>{const n=this.latestDataKeyJsonSettingsEditor.getValue();this.widget.latestDataKeySettingsSchema!==n&&(this.widget.latestDataKeySettingsSchema=n,this.isDirty=!0)})}))),t.push(this.createAceEditor(this.javascriptInputElmRef,"javascript").pipe((0,ne.M)(i=>{this.jsEditor=i,this.jsEditor.on("input",()=>{const n=this.jsEditor.getValue();this.widget.controllerScript!==n&&(this.widget.controllerScript=n,this.isDirty=!0)}),this.jsEditor.on("change",()=>{this.cleanupJsErrors()}),this.jsEditor.completers=[Gc,...this.jsEditor.completers||[]]}))),(0,Se.p)(t).subscribe(()=>{this.setAceEditorValues()})}setAceEditorValues(){this.htmlEditor.setValue(this.widget.templateHtml?this.widget.templateHtml:"",-1),this.cssEditor.setValue(this.widget.templateCss?this.widget.templateCss:"",-1),this.jsonSettingsEditor.setValue(this.widget.settingsSchema?this.widget.settingsSchema:"",-1),this.dataKeyJsonSettingsEditor.setValue(this.widget.dataKeySettingsSchema?this.widget.dataKeySettingsSchema:"",-1),this.latestDataKeyJsonSettingsEditor.setValue(this.widget.latestDataKeySettingsSchema?this.widget.latestDataKeySettingsSchema:"",-1),this.jsEditor.setValue(this.widget.controllerScript?this.widget.controllerScript:"",-1)}createAceEditor(t,i){const n=t.nativeElement;let o={mode:`ace/mode/${i}`,showGutter:!0,showPrintMargin:!0};return o={...o,enableSnippets:!0,enableBasicAutocompletion:!0,enableLiveAutocompletion:!0},(0,Ur.eB)().pipe((0,ie.T)(l=>{const c=l.edit(n,o);return c.session.setUseWrapMode(!0),this.aceEditors.push(c),this.aceResize$.observe(n),c}))}onAceEditorResize(t){this.editorsResizeCafs[t.id]&&(this.editorsResizeCafs[t.id](),delete this.editorsResizeCafs[t.id]),this.editorsResizeCafs[t.id]=this.raf.raf(()=>{t.resize(),t.renderer.updateFull()})}onWindowMessage(t){let i;if(t.data)try{i=JSON.parse(t.data)}catch{}if(i)switch(i.type){case"widgetException":this.onWidgetException(i.data);break;case"widgetEditModeInited":this.onWidgetEditModeInited();break;case"widgetEditUpdated":this.onWidgetEditUpdated(i.data),this.onWidgetEditModeToggled(!1);break;case"widgetEditModeToggle":this.onWidgetEditModeToggled(i.data)}}onWidgetEditModeInited(){this.iframeWidgetEditModeInited=!0,(this.saveWidgetPending||this.saveWidgetAsPending)&&(this.saveWidgetTimeout||(this.saveWidgetTimeout=setTimeout(()=>{this.gotError?(this.store.dispatch(new $.xo({message:this.translate.instant("widget.unable-to-save-widget-error"),type:"error"})),this.saveWidgetPending=!1,this.saveWidgetAsPending=!1):this.saveWidgetPending?this.commitSaveWidget():this.saveWidgetAsPending&&this.commitSaveWidgetAs(),this.saveWidgetTimeout=void 0},1500)))}onWidgetEditUpdated(t){this.widget.sizeX=t.sizeX/2,this.widget.sizeY=t.sizeY/2,this.widget.defaultConfig=JSON.stringify(t.config),this.iframe.attr("data-widget",JSON.stringify(this.widget)),this.isDirty=!0}onWidgetEditModeToggled(t){this.isEditModeWidget=t}onWidgetException(t){if(!this.gotError){this.gotError=!0;let i="Error:";if(t.message&&(i+=" "+t.message),t.lineNumber&&(i+="<br>Line "+t.lineNumber,t.columnNumber&&(i+=" column "+t.columnNumber),i+=" of script."),!this.saveWidgetPending&&!this.saveWidgetAsPending&&this.store.dispatch(new $.xo({message:i,type:"error",target:"javascriptPanel"})),t.lineNumber){const n=t.lineNumber-1;let o=0;t.columnNumber&&(o=t.columnNumber);const r=this.jsEditor.session.addMarker(new Ur.Q6(n,0,n,1/0),"ace_active-line","screenLine");this.errorMarkers.push(r);const l=this.jsEditor.session.getAnnotations(),c={row:n,column:o,text:t.message,type:"error"};this.errorAnnotationId=l.push(c)-1,this.jsEditor.session.setAnnotations(l)}}}cleanupJsErrors(){if(this.store.dispatch(new $.g$({})),this.errorMarkers.forEach(t=>{this.jsEditor.session.removeMarker(t)}),this.errorMarkers.length=0,this.errorAnnotationId>-1){const t=this.jsEditor.session.getAnnotations();t.splice(this.errorAnnotationId,1),this.jsEditor.session.setAnnotations(t),this.errorAnnotationId=-1}}commitSaveWidget(){const t=this.widgetTypeDetails&&this.widgetTypeDetails.id?this.widgetTypeDetails.id:void 0,i=this.widgetTypeDetails?.version??null,n=this.widgetTypeDetails&&this.widgetTypeDetails.createdTime?this.widgetTypeDetails.createdTime:void 0;this.saveWidgetPending=!1,this.widgetService.saveWidgetTypeDetails(this.widget,t,n,i).pipe((0,Z.Z)(o=>{this.saveWidgetPending=!0;const r=this.route.snapshot.params.widgetsBundleId;return r&&!t?this.widgetService.addWidgetFqnToWidgetBundle(r,o.fqn).pipe((0,ie.T)(()=>o)):(0,H.of)(o)}),(0,cn.W)(o=>t&&o.status===ha.HttpStatusCode.Conflict?this.widgetService.getWidgetTypeById(t.id):(0,hr.$)(()=>o))).subscribe({next:o=>{this.saveWidgetPending=!1,this.widgetTypeDetails?.id?this.setWidgetTypeDetails(o):(this.isDirty=!1,this.router.navigate(["..",o.id.id],{relativeTo:this.route})),this.store.dispatch(new $.xo({message:this.translate.instant("widget.widget-saved"),type:"success",duration:500}))},error:()=>{this.saveWidgetPending=!1}})}commitSaveWidgetAs(){this.dialog.open(dn,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"]}).afterClosed().subscribe(t=>{if(t){this.widget.widgetName=t.widgetName,this.widget.fullFqn=void 0;const i=JSON.parse(this.widget.defaultConfig);i.title=this.widget.widgetName,this.widget.defaultConfig=JSON.stringify(i),this.isDirty=!1,this.widgetService.saveWidgetTypeDetails(this.widget,void 0,void 0,void 0).pipe((0,Z.Z)(n=>t.widgetBundleId?this.widgetService.addWidgetFqnToWidgetBundle(t.widgetBundleId,n.fqn).pipe((0,ie.T)(()=>n)):(0,H.of)(n))).subscribe({next:n=>{this.saveWidgetAsPending=!1,t.widgetBundleId?this.router.navigate(["resources","widgets-library","widgets-bundles",t.widgetBundleId,n.id.id]):this.router.navigate(["resources","widgets-library","widget-types",n.id.id])},error:()=>{this.saveWidgetAsPending=!1}})}else this.saveWidgetAsPending=!1})}setWidgetTypeDetails(t){this.widgetTypeDetails=t,this.widget=(0,jr.MX)(this.widgetTypeDetails);const i=JSON.parse(this.widget.defaultConfig);this.widget.defaultConfig=JSON.stringify(i),this.origWidget=(0,_.Go)(this.widget),this.isDirty=!1,this.updateBreadcrumbs.emit()}applyWidgetScript(){this.cleanupJsErrors(),this.gotError=!1,this.iframeWidgetEditModeInited=!1;const t=JSON.parse(this.widget.defaultConfig);t.title||(t.title=this.widget.widgetName),this.widget.defaultConfig=JSON.stringify(t),this.iframe.attr("data-widget",JSON.stringify(this.widget)),this.iframe[0].contentWindow.location.reload(!0)}undoWidget(){this.widget=(0,_.Go)(this.origWidget),this.setAceEditorValues(),this.isDirty=!1,this.applyWidgetScript()}saveWidget(){this.widget.widgetName?(this.saveWidgetPending=!0,this.applyWidgetScript()):this.store.dispatch(new $.xo({message:this.translate.instant("widget.missing-widget-title-error"),type:"error"}))}saveWidgetAs(){this.saveWidgetAsPending=!0,this.applyWidgetScript()}undoDisabled(){return!this._isDirty||!this.iframeWidgetEditModeInited||this.saveWidgetPending||this.saveWidgetAsPending}saveDisabled(){return this.isReadOnly||!this._isDirty||!this.iframeWidgetEditModeInited||this.saveWidgetPending||this.saveWidgetAsPending}saveAsDisabled(){return!this.iframeWidgetEditModeInited||this.saveWidgetPending||this.saveWidgetAsPending}beautifyCss(){(0,pn.rm)(this.widget.templateCss,{indent_size:4}).subscribe(t=>{this.widget.templateCss!==t&&(this.isDirty=!0,this.widget.templateCss=t,this.cssEditor.setValue(this.widget.templateCss?this.widget.templateCss:"",-1))})}beautifyHtml(){(0,pn.p_)(this.widget.templateHtml,{indent_size:4,wrap_line_length:60}).subscribe(t=>{this.widget.templateHtml!==t&&(this.isDirty=!0,this.widget.templateHtml=t,this.htmlEditor.setValue(this.widget.templateHtml?this.widget.templateHtml:"",-1))})}beautifyJson(){(0,pn.hh)(this.widget.settingsSchema,{indent_size:4}).subscribe(t=>{this.widget.settingsSchema!==t&&(this.isDirty=!0,this.widget.settingsSchema=t,this.jsonSettingsEditor.setValue(this.widget.settingsSchema?this.widget.settingsSchema:"",-1))})}beautifyDataKeyJson(){(0,pn.hh)(this.widget.dataKeySettingsSchema,{indent_size:4}).subscribe(t=>{this.widget.dataKeySettingsSchema!==t&&(this.isDirty=!0,this.widget.dataKeySettingsSchema=t,this.dataKeyJsonSettingsEditor.setValue(this.widget.dataKeySettingsSchema?this.widget.dataKeySettingsSchema:"",-1))})}beautifyLatestDataKeyJson(){(0,pn.hh)(this.widget.latestDataKeySettingsSchema,{indent_size:4}).subscribe(t=>{this.widget.latestDataKeySettingsSchema!==t&&(this.isDirty=!0,this.widget.latestDataKeySettingsSchema=t,this.latestDataKeyJsonSettingsEditor.setValue(this.widget.latestDataKeySettingsSchema?this.widget.latestDataKeySettingsSchema:"",-1))})}beautifyJs(){(0,pn.hh)(this.widget.controllerScript,{indent_size:4,wrap_line_length:60}).subscribe(t=>{this.widget.controllerScript!==t&&(this.isDirty=!0,this.widget.controllerScript=t,this.jsEditor.setValue(this.widget.controllerScript?this.widget.controllerScript:"",-1))})}removeResource(t){t>-1&&this.widget.resources.splice(t,1).length>0&&(this.isDirty=!0)}addResource(){this.widget.resources.push({url:""}),this.isDirty=!0}widgetTypeChanged(){const t=JSON.parse(this.widget.defaultConfig);this.widget.type!==he.t_.rpc&&this.widget.type!==he.t_.alarm?(t.targetDevice&&delete t.targetDevice,t.alarmSource&&delete t.alarmSource,t.datasources||(t.datasources=[]),t.timewindow||(t.timewindow={realtime:{timewindowMs:6e4}})):this.widget.type===he.t_.rpc?(t.datasources&&delete t.datasources,t.alarmSource&&delete t.alarmSource,t.timewindow&&delete t.timewindow,t.targetDevice||(t.targetDevice={type:he.QQ.device})):(t.datasources&&delete t.datasources,t.targetDevice&&delete t.targetDevice,t.alarmSource||(t.alarmSource={}),t.timewindow||(t.timewindow={realtime:{timewindowMs:864e5}})),this.widget.defaultConfig=JSON.stringify(t),this.isDirty=!0}get confirmOnExitMessage(){return this.isEditModeWidget&&!this._isDirty?this.translate.instant("widget.confirm-to-exit-editor-html"):""}static{this.\u0275fac=function(i){return new(i||ya)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(mr.jf),e.\u0275\u0275directiveInject(b.ActivatedRoute),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(Ae.C),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(Pc.f),e.\u0275\u0275directiveInject(S.MatDialog))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:ya,selectors:[["tb-widget-editor"]],viewQuery:function(i,n){if(1&i&&(e.\u0275\u0275viewQuery($c,7),e.\u0275\u0275viewQuery(zc,7),e.\u0275\u0275viewQuery(Hc,7),e.\u0275\u0275viewQuery(Kc,7),e.\u0275\u0275viewQuery(Yc,7),e.\u0275\u0275viewQuery(Qc,7),e.\u0275\u0275viewQuery(Jc,7),e.\u0275\u0275viewQuery(Zc,7),e.\u0275\u0275viewQuery(Xc,7),e.\u0275\u0275viewQuery(ep,7),e.\u0275\u0275viewQuery(tp,7),e.\u0275\u0275viewQuery(np,7),e.\u0275\u0275viewQuery(ip,7)),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.topPanelElmRef=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.topLeftPanelElmRef=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.topRightPanelElmRef=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.bottomPanelElmRef=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.javascriptPanelElmRef=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.framePanelElmRef=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.htmlInputElmRef=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.cssInputElmRef=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.settingsJsonInputElmRef=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.dataKeySettingsJsonInputElmRef=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.latestDataKeySettingsJsonInputElmRef=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.javascriptInputElmRef=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.widgetIFrameElmRef=o.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:216,vars:165,consts:[["cheatSheetComponent",""],["widgetEditMenu","matMenu"],["topPanel",""],["topLeftPanel",""],["htmlInput",""],["cssInput",""],["topRightPanel",""],["settingsJsonInput",""],["dataKeySettingsJsonInput",""],["latestDataKeySettingsJsonInput",""],["descriptionInput",""],["bottomPanel",""],["javascriptPanel",""],["javascriptInput",""],["framePanel",""],["widgetIFrame",""],[1,"flex","flex-1","flex-col"],["tb-fullscreen","",1,"flex","flex-1","flex-col",3,"fullscreen","tb-hotkeys","cheatSheet"],[1,"mat-elevation-z1","tb-edit-toolbar","mat-hue-3","gap-4","lt-xl:gap-2"],[1,"tb-widget-title","tb-appearance-transparent"],["matInput","","required","","maxlength","255",3,"ngModelChange","disabled","ngModel","placeholder"],[1,"tb-appearance-transparent"],[3,"ngModelChange","disabled","placeholder","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"flex-1"],["mat-button","","matTooltipPosition","below",1,"lt-md:!hidden",3,"click","disabled","matTooltip"],["translate",""],["mat-raised-button","","matTooltipPosition","below",1,"lt-md:!hidden",3,"click","disabled","matTooltip"],["mat-raised-button","","class","lt-md:!hidden","matTooltipPosition","below",3,"disabled","tb-circular-progress","matTooltip","click",4,"ngIf"],["mat-raised-button","","matTooltipPosition","below",1,"lt-md:!hidden",3,"click","disabled","tb-circular-progress","matTooltip"],["mat-button","","matTooltipPosition","below",1,"lt-lg:!hidden",3,"click","matTooltip"],["mat-icon-button","","matTooltipPosition","below",1,"lt-md:!hidden","gt-md:!hidden",3,"click","matTooltip"],["mat-icon-button","",1,"gt-md:!hidden",3,"matMenuTriggerFor"],["xPosition","before"],["mat-menu-item","",3,"click","disabled"],["mat-menu-item","",3,"disabled","click",4,"ngIf"],[1,"flex-1",2,"position","relative"],[1,"tb-editor","tb-absolute-fill"],[1,"tb-split","tb-split-vertical"],[1,"tb-split","tb-content"],["mat-stretch-tabs","false","selectedIndex","1","dynamicHeight","true",2,"width","100%","height","100%"],[3,"label"],[1,"tb-resize-container",2,"background-color","#fff"],[1,"mat-padding"],["class","flex flex-1 flex-row items-center justify-start","style","max-height: 40px;",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","matTooltipPosition","above",2,"margin-top","8px",3,"click","disabled","matTooltip"],["tb-fullscreen","",1,"tb-resize-container",3,"fullscreen"],[1,"tb-editor-area-title-panel"],["mat-button","",3,"click"],["mat-icon-button","","matTooltipPosition","above",1,"tb-mat-32",3,"click","matTooltip"],["mat-stretch-tabs","false","dynamicHeight","true",2,"width","100%","height","100%"],[3,"aria-labelledby","label"],[1,"flex-1",3,"ngModelChange","label","ngModel"],[1,"mat-block"],["matInput","","rows","2","maxlength","255",3,"ngModelChange","ngModel"],["align","end"],[3,"ngModelChange","label","ngModel"],[1,"flex","flex-col","gap-4",2,"padding-bottom","16px"],[1,"mat-block",3,"ngModelChange","ngModel"],["matInput","",3,"ngModelChange","ngModel"],["class","mat-block",4,"ngIf"],[1,"mat-block",2,"padding-bottom","16px",3,"ngModelChange","ngModel"],["tb-toast","","toastTarget","javascriptPanel",1,"tb-split","tb-content"],["tb-help-popup","widget/editor/widget_js_fn","tb-help-popup-placement","top",3,"tb-help-popup-style"],[1,"tb-split","tb-content",2,"overflow-y","hidden","position","relative"],["class","mat-content tb-progress-cover flex flex-1 flex-col items-center justify-center",4,"ngIf"],["tb-fullscreen","",2,"width","100%","height","100%",3,"fullscreen"],["height","100%","width","100%",2,"border","0"],[2,"position","absolute","top","10px","left","10px","bottom","initial"],["mat-icon-button","","matTooltipPosition","above",1,"tb-fullscreen-button-style",3,"click","matTooltip"],[3,"value"],[1,"flex","flex-1","flex-row","items-center","justify-start",2,"max-height","40px"],["hideRequiredMarker","","required","","subscriptSizing","dynamic",1,"mat-block","resource-field","flex-1",3,"ngModelChange","allowAutocomplete","ngModel","placeholder"],[3,"ngModelChange","ngModel"],["mat-icon-button","","color","primary","matTooltipPosition","above",3,"click","disabled","matTooltip"],[1,"mat-content","tb-progress-cover","flex","flex-1","flex-col","items-center","justify-center"],["diameter","100","mode","indeterminate","color","warn"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",16)(1,"div",17),e.\u0275\u0275element(2,"tb-hotkeys-cheatsheet",null,0),e.\u0275\u0275elementStart(4,"mat-toolbar",18)(5,"mat-form-field",19)(6,"input",20),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275twoWayListener("ngModelChange",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275twoWayBindingSet(n.widget.widgetName,l)||(n.widget.widgetName=l),e.\u0275\u0275resetView(l)}),e.\u0275\u0275listener("ngModelChange",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.isDirty=!0)}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(8,"mat-form-field",21)(9,"mat-select",22),e.\u0275\u0275pipe(10,"translate"),e.\u0275\u0275twoWayListener("ngModelChange",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275twoWayBindingSet(n.widget.type,l)||(n.widget.type=l),e.\u0275\u0275resetView(l)}),e.\u0275\u0275listener("ngModelChange",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.widgetTypeChanged())}),e.\u0275\u0275template(11,op,3,4,"mat-option",23),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(12,"span",24),e.\u0275\u0275elementStart(13,"button",25),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.applyWidgetScript())}),e.\u0275\u0275elementStart(15,"mat-icon"),e.\u0275\u0275text(16,"play_arrow"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"span",26),e.\u0275\u0275text(18,"action.run"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(19,"button",27),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.undoWidget())}),e.\u0275\u0275elementStart(22,"mat-icon"),e.\u0275\u0275text(23,"undo"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(24,"span",26),e.\u0275\u0275text(25,"action.undo"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(26,rp,7,8,"button",28),e.\u0275\u0275elementStart(27,"button",29),e.\u0275\u0275pipe(28,"translate"),e.\u0275\u0275pipe(29,"async"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.saveWidgetAs())}),e.\u0275\u0275elementStart(30,"mat-icon"),e.\u0275\u0275text(31,"save_as"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(32,"span",26),e.\u0275\u0275text(33,"action.saveAs"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(34,"button",30),e.\u0275\u0275pipe(35,"translate"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.fullscreen=!n.fullscreen)}),e.\u0275\u0275elementStart(36,"mat-icon"),e.\u0275\u0275text(37),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(38,"span",26),e.\u0275\u0275text(39,"widget.toggle-fullscreen"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(40,"button",31),e.\u0275\u0275pipe(41,"translate"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.fullscreen=!n.fullscreen)}),e.\u0275\u0275elementStart(42,"mat-icon"),e.\u0275\u0275text(43),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(44,"button",32)(45,"mat-icon"),e.\u0275\u0275text(46,"more_vert"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(47,"mat-menu",33,1)(49,"button",34),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.applyWidgetScript())}),e.\u0275\u0275elementStart(50,"mat-icon"),e.\u0275\u0275text(51,"play_arrow"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(52,"span",26),e.\u0275\u0275text(53,"action.run"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(54,"button",34),e.\u0275\u0275pipe(55,"async"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.undoWidget())}),e.\u0275\u0275elementStart(56,"mat-icon"),e.\u0275\u0275text(57,"undo"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(58,"span",26),e.\u0275\u0275text(59,"action.undo"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(60,sp,6,3,"button",35),e.\u0275\u0275elementStart(61,"button",34),e.\u0275\u0275pipe(62,"async"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.saveWidgetAs())}),e.\u0275\u0275elementStart(63,"mat-icon"),e.\u0275\u0275text(64,"save_as"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(65,"span",26),e.\u0275\u0275text(66,"action.saveAs"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(67,"div",36)(68,"div",37)(69,"div",38,2)(71,"div",39,3)(73,"mat-tab-group",40)(74,"mat-tab",41),e.\u0275\u0275pipe(75,"translate"),e.\u0275\u0275elementStart(76,"div",42)(77,"div",43),e.\u0275\u0275template(78,lp,11,15,"div",44),e.\u0275\u0275elementStart(79,"button",45),e.\u0275\u0275pipe(80,"translate"),e.\u0275\u0275pipe(81,"async"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.addResource())}),e.\u0275\u0275elementStart(82,"span",26),e.\u0275\u0275text(83,"action.add"),e.\u0275\u0275elementEnd()()()()(),e.\u0275\u0275elementStart(84,"mat-tab",41),e.\u0275\u0275pipe(85,"translate"),e.\u0275\u0275elementStart(86,"div",46)(87,"div",47)(88,"button",48),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.beautifyHtml())}),e.\u0275\u0275text(89),e.\u0275\u0275pipe(90,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(91,"button",49),e.\u0275\u0275pipe(92,"translate"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.htmlFullscreen=!n.htmlFullscreen)}),e.\u0275\u0275elementStart(93,"mat-icon"),e.\u0275\u0275text(94),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(95,"div",null,4),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(97,"mat-tab",41),e.\u0275\u0275pipe(98,"translate"),e.\u0275\u0275elementStart(99,"div",46)(100,"div",47)(101,"button",48),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.beautifyCss())}),e.\u0275\u0275text(102),e.\u0275\u0275pipe(103,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(104,"button",49),e.\u0275\u0275pipe(105,"translate"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.cssFullscreen=!n.cssFullscreen)}),e.\u0275\u0275elementStart(106,"mat-icon"),e.\u0275\u0275text(107),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(108,"div",null,5),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(110,"div",39,6)(112,"mat-tab-group",50)(113,"mat-tab",41),e.\u0275\u0275pipe(114,"translate"),e.\u0275\u0275elementStart(115,"div",46)(116,"div",47)(117,"button",48),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.beautifyJson())}),e.\u0275\u0275text(118),e.\u0275\u0275pipe(119,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(120,"button",49),e.\u0275\u0275pipe(121,"translate"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.jsonSettingsFullscreen=!n.jsonSettingsFullscreen)}),e.\u0275\u0275elementStart(122,"mat-icon"),e.\u0275\u0275text(123),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(124,"div",null,7),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(126,"mat-tab",41),e.\u0275\u0275pipe(127,"translate"),e.\u0275\u0275elementStart(128,"div",46)(129,"div",47)(130,"button",48),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.beautifyDataKeyJson())}),e.\u0275\u0275text(131),e.\u0275\u0275pipe(132,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(133,"button",49),e.\u0275\u0275pipe(134,"translate"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.jsonDataKeySettingsFullscreen=!n.jsonDataKeySettingsFullscreen)}),e.\u0275\u0275elementStart(135,"mat-icon"),e.\u0275\u0275text(136),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(137,"div",null,8),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(139,"mat-tab",51),e.\u0275\u0275pipe(140,"translate"),e.\u0275\u0275elementStart(141,"div",46)(142,"div",47)(143,"button",48),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.beautifyLatestDataKeyJson())}),e.\u0275\u0275text(144),e.\u0275\u0275pipe(145,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(146,"button",49),e.\u0275\u0275pipe(147,"translate"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.jsonLatestDataKeySettingsFullscreen=!n.jsonLatestDataKeySettingsFullscreen)}),e.\u0275\u0275elementStart(148,"mat-icon"),e.\u0275\u0275text(149),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(150,"div",null,9),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(152,"mat-tab",41),e.\u0275\u0275pipe(153,"translate"),e.\u0275\u0275elementStart(154,"div",42)(155,"div",43)(156,"tb-gallery-image-input",52),e.\u0275\u0275pipe(157,"translate"),e.\u0275\u0275twoWayListener("ngModelChange",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275twoWayBindingSet(n.widget.image,l)||(n.widget.image=l),e.\u0275\u0275resetView(l)}),e.\u0275\u0275listener("ngModelChange",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.isDirty=!0)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(158,"mat-form-field",53)(159,"mat-label",26),e.\u0275\u0275text(160,"widget.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(161,"textarea",54,10),e.\u0275\u0275twoWayListener("ngModelChange",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275twoWayBindingSet(n.widget.description,l)||(n.widget.description=l),e.\u0275\u0275resetView(l)}),e.\u0275\u0275listener("ngModelChange",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.isDirty=!0)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(163,"mat-hint",55),e.\u0275\u0275text(164),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(165,"tb-string-items-list",56),e.\u0275\u0275pipe(166,"translate"),e.\u0275\u0275twoWayListener("ngModelChange",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275twoWayBindingSet(n.widget.tags,l)||(n.widget.tags=l),e.\u0275\u0275resetView(l)}),e.\u0275\u0275listener("ngModelChange",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.isDirty=!0)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(167,"div",57)(168,"mat-slide-toggle",58),e.\u0275\u0275twoWayListener("ngModelChange",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275twoWayBindingSet(n.widget.scada,l)||(n.widget.scada=l),e.\u0275\u0275resetView(l)}),e.\u0275\u0275listener("ngModelChange",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.isDirty=!0)}),e.\u0275\u0275text(169),e.\u0275\u0275pipe(170,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(171,"mat-slide-toggle",58),e.\u0275\u0275twoWayListener("ngModelChange",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275twoWayBindingSet(n.widget.deprecated,l)||(n.widget.deprecated=l),e.\u0275\u0275resetView(l)}),e.\u0275\u0275listener("ngModelChange",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.isDirty=!0)}),e.\u0275\u0275text(172),e.\u0275\u0275pipe(173,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(174,"mat-form-field",53)(175,"mat-label",26),e.\u0275\u0275text(176,"widget.settings-form-selector"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(177,"input",59),e.\u0275\u0275twoWayListener("ngModelChange",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275twoWayBindingSet(n.widget.settingsDirective,l)||(n.widget.settingsDirective=l),e.\u0275\u0275resetView(l)}),e.\u0275\u0275listener("ngModelChange",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.isDirty=!0)}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(178,"mat-form-field",53)(179,"mat-label",26),e.\u0275\u0275text(180,"widget.data-key-settings-form-selector"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(181,"input",59),e.\u0275\u0275twoWayListener("ngModelChange",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275twoWayBindingSet(n.widget.dataKeySettingsDirective,l)||(n.widget.dataKeySettingsDirective=l),e.\u0275\u0275resetView(l)}),e.\u0275\u0275listener("ngModelChange",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.isDirty=!0)}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(182,dp,4,1,"mat-form-field",60),e.\u0275\u0275elementStart(183,"mat-slide-toggle",61),e.\u0275\u0275twoWayListener("ngModelChange",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275twoWayBindingSet(n.widget.hasBasicMode,l)||(n.widget.hasBasicMode=l),e.\u0275\u0275resetView(l)}),e.\u0275\u0275listener("ngModelChange",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.isDirty=!0)}),e.\u0275\u0275text(184),e.\u0275\u0275pipe(185,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(186,cp,4,1,"mat-form-field",60),e.\u0275\u0275elementEnd()()()()()(),e.\u0275\u0275elementStart(187,"div",38,11)(189,"div",62,12)(191,"div",46)(192,"div",47)(193,"label",26),e.\u0275\u0275text(194,"widget.javascript"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(195,"button",48),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.beautifyJs())}),e.\u0275\u0275text(196),e.\u0275\u0275pipe(197,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(198,"span",63),e.\u0275\u0275elementStart(199,"button",49),e.\u0275\u0275pipe(200,"translate"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.javascriptFullscreen=!n.javascriptFullscreen)}),e.\u0275\u0275elementStart(201,"mat-icon"),e.\u0275\u0275text(202),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(203,"div",null,13),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(205,"div",64,14),e.\u0275\u0275template(207,pp,2,0,"div",65),e.\u0275\u0275elementStart(208,"div",66),e.\u0275\u0275element(209,"iframe",67,15),e.\u0275\u0275elementStart(211,"div",68)(212,"button",69),e.\u0275\u0275pipe(213,"translate"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.iFrameFullscreen=!n.iFrameFullscreen)}),e.\u0275\u0275elementStart(214,"mat-icon"),e.\u0275\u0275text(215),e.\u0275\u0275elementEnd()()()()()()()()()()}if(2&i){const o=e.\u0275\u0275reference(3),r=e.\u0275\u0275reference(48),l=e.\u0275\u0275reference(162);e.\u0275\u0275advance(),e.\u0275\u0275property("fullscreen",n.fullscreen)("tb-hotkeys",n.hotKeys)("cheatSheet",o),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(7,88,"widget.widget-title")),e.\u0275\u0275property("disabled",n.isReadOnly),e.\u0275\u0275twoWayProperty("ngModel",n.widget.widgetName),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(10,90,"widget.type")),e.\u0275\u0275property("disabled",n.isReadOnly),e.\u0275\u0275twoWayProperty("ngModel",n.widget.type),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",n.allWidgetTypes),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate1("matTooltip","",e.\u0275\u0275pipeBind1(14,92,"widget.run")," (CTRL + Return)"),e.\u0275\u0275property("disabled",!n.iframeWidgetEditModeInited),e.\u0275\u0275advance(6),e.\u0275\u0275propertyInterpolate1("matTooltip","",e.\u0275\u0275pipeBind1(20,94,"widget.undo")," (CTRL + Q)"),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(21,96,n.isLoading$)||n.undoDisabled()),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",!n.isReadOnly),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate1("matTooltip","",e.\u0275\u0275pipeBind1(28,98,"widget.saveAs")," (Shift + CTRL + S)"),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(29,100,n.isLoading$)||n.saveAsDisabled())("tb-circular-progress",n.saveWidgetAsPending),e.\u0275\u0275advance(7),e.\u0275\u0275propertyInterpolate1("matTooltip","",e.\u0275\u0275pipeBind1(35,102,"widget.toggle-fullscreen")," (Shift + CTRL + F)"),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(n.fullscreen?"fullscreen_exit":"fullscreen"),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate1("matTooltip","",e.\u0275\u0275pipeBind1(41,104,"widget.toggle-fullscreen")," (Shift + CTRL + F)"),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(n.fullscreen?"fullscreen_exit":"fullscreen"),e.\u0275\u0275advance(),e.\u0275\u0275property("matMenuTriggerFor",r),e.\u0275\u0275advance(5),e.\u0275\u0275property("disabled",!n.iframeWidgetEditModeInited),e.\u0275\u0275advance(5),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(55,106,n.isLoading$)||n.undoDisabled()),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",!n.isReadOnly),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(62,108,n.isLoading$)||n.saveAsDisabled()),e.\u0275\u0275advance(13),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(75,110,"widget.resources")),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",n.widget.resources),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(80,112,"widget.add-resource")),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(81,114,n.isLoading$)),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(85,116,"widget.html")),e.\u0275\u0275advance(2),e.\u0275\u0275property("fullscreen",n.htmlFullscreen),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(90,118,"widget.tidy")," "),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(92,120,n.htmlFullscreen?"fullscreen.exit":"fullscreen.expand")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(n.htmlFullscreen?"fullscreen_exit":"fullscreen"),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(98,122,"widget.css")),e.\u0275\u0275advance(2),e.\u0275\u0275property("fullscreen",n.cssFullscreen),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(103,124,"widget.tidy")," "),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(105,126,n.cssFullscreen?"fullscreen.exit":"fullscreen.expand")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(n.cssFullscreen?"fullscreen_exit":"fullscreen"),e.\u0275\u0275advance(6),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(114,128,"widget.settings-schema")),e.\u0275\u0275advance(2),e.\u0275\u0275property("fullscreen",n.jsonSettingsFullscreen),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(119,130,"widget.tidy")," "),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(121,132,n.jsonSettingsFullscreen?"fullscreen.exit":"fullscreen.expand")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(n.jsonSettingsFullscreen?"fullscreen_exit":"fullscreen"),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(127,134,"widget.datakey-settings-schema")),e.\u0275\u0275advance(2),e.\u0275\u0275property("fullscreen",n.jsonDataKeySettingsFullscreen),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(132,136,"widget.tidy")," "),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(134,138,n.jsonDataKeySettingsFullscreen?"fullscreen.exit":"fullscreen.expand")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(n.jsonDataKeySettingsFullscreen?"fullscreen_exit":"fullscreen"),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(140,140,"widget.latest-datakey-settings-schema")),e.\u0275\u0275property("aria-labelledby",n.widget.type!==n.widgetTypes.timeseries?"hidden":""),e.\u0275\u0275advance(2),e.\u0275\u0275property("fullscreen",n.jsonLatestDataKeySettingsFullscreen),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(145,142,"widget.tidy")," "),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(147,144,n.jsonLatestDataKeySettingsFullscreen?"fullscreen.exit":"fullscreen.expand")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(n.jsonLatestDataKeySettingsFullscreen?"fullscreen_exit":"fullscreen"),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(153,146,"widget.widget-settings")),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(157,148,"widget.image-preview")),e.\u0275\u0275twoWayProperty("ngModel",n.widget.image),e.\u0275\u0275advance(5),e.\u0275\u0275twoWayProperty("ngModel",n.widget.description),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",(null==l.value?null:l.value.length)||0,"/255"),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(166,150,"widget.tags")),e.\u0275\u0275twoWayProperty("ngModel",n.widget.tags),e.\u0275\u0275advance(3),e.\u0275\u0275twoWayProperty("ngModel",n.widget.scada),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(170,152,"widget.scada")," "),e.\u0275\u0275advance(2),e.\u0275\u0275twoWayProperty("ngModel",n.widget.deprecated),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(173,154,"widget.deprecated")," "),e.\u0275\u0275advance(5),e.\u0275\u0275twoWayProperty("ngModel",n.widget.settingsDirective),e.\u0275\u0275advance(4),e.\u0275\u0275twoWayProperty("ngModel",n.widget.dataKeySettingsDirective),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.widget.type===n.widgetTypes.timeseries),e.\u0275\u0275advance(),e.\u0275\u0275twoWayProperty("ngModel",n.widget.hasBasicMode),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(185,156,"widget.has-basic-mode")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.widget.hasBasicMode),e.\u0275\u0275advance(5),e.\u0275\u0275property("fullscreen",n.javascriptFullscreen),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(197,158,"widget.tidy")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("tb-help-popup-style",e.\u0275\u0275pureFunction0(164,ap)),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(200,160,n.javascriptFullscreen?"fullscreen.exit":"fullscreen.expand")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(n.javascriptFullscreen?"fullscreen_exit":"fullscreen"),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",!n.iframeWidgetEditModeInited),e.\u0275\u0275advance(),e.\u0275\u0275property("fullscreen",n.iFrameFullscreen),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(213,162,n.iFrameFullscreen?"fullscreen.exit":"fullscreen.expand")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(n.iFrameFullscreen?"fullscreen_exit":"fullscreen")}},dependencies:[p.NgForOf,p.NgIf,pt.ToastDirective,Wr.FullscreenDirective,jc.CircularProgressDirective,$r.TbHotkeysDirective,Uc.HelpPopupComponent,zr.TbCheatSheetComponent,ba.StringItemsListComponent,x.MatButton,x.MatIconButton,Te.MatCheckbox,E.MatIcon,L.MatInput,v.MatFormField,v.MatLabel,v.MatHint,ae.MatToolbar,Be.MatMenu,Be.MatMenuItem,Be.MatMenuTrigger,ce.MatSelect,z.MatOption,_e.MatTooltip,$o.MatProgressSpinner,Q.MatTab,Q.MatTabGroup,pe.MatSlideToggle,s.DefaultValueAccessor,s.NgControlStatus,s.RequiredValidator,s.MaxLengthValidator,s.NgModel,u.TranslateDirective,qc.Y,br.GalleryImageInputComponent,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";tb-widget-editor{flex:1;display:flex;flex-direction:column}.tb-editor .tb-split{box-sizing:border-box;overflow-x:hidden;overflow-y:auto}.tb-editor .resource-field mat-form-field .mat-mdc-text-field-wrapper{padding-bottom:0;height:40px}.tb-editor .resource-field mat-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex{max-height:40px}.tb-editor .resource-field mat-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-form-field-infix{border:0;padding-top:7px;padding-bottom:7px;min-height:32px}.tb-editor .ace_editor{font-size:14px!important}.tb-editor .tb-content{border:1px solid #c0c0c0}.tb-editor .gutter{background-color:transparent;background-repeat:no-repeat;background-position:50%}.tb-editor .gutter.gutter-horizontal{cursor:col-resize;background-image:url(vertical.f18b560a84f60603.png)}.tb-editor .gutter.gutter-vertical{cursor:row-resize;background-image:url(horizontal.d1475b32efe518a2.png)}.tb-editor .tb-split.tb-split-horizontal,.tb-editor .gutter.gutter-horizontal{float:left;height:100%}.tb-editor .tb-split.tb-split-vertical{display:flex}.tb-editor .tb-split.tb-split-vertical .tb-split.tb-content{height:100%}.tb-editor .container{width:100%;height:100%}.tb-editor .mdc-tab[aria-labelledby=hidden]{width:0!important;min-width:0;padding:0;overflow:hidden}.tb-split-vertical .mat-mdc-tab-group .mat-mdc-tab-body-wrapper{height:calc(100% - 49px)}.tb-split-vertical .mat-mdc-tab-group .mat-mdc-tab-body-wrapper .mat-mdc-tab-body{height:100%}.tb-split-vertical .mat-mdc-tab-group .mat-mdc-tab-body-wrapper .mat-mdc-tab-body>div{height:100%}div.tb-editor-area-title-panel{position:absolute;top:5px;right:20px;z-index:5;font-size:.8rem;font-weight:500}div.tb-editor-area-title-panel>*:not(:last-child){margin-right:4px}div.tb-editor-area-title-panel label{padding:4px;color:#00acc1;background:#dcdcdc59;border-radius:5px}div.tb-editor-area-title-panel button.mat-mdc-button-base,div.tb-editor-area-title-panel button.mat-mdc-button-base.tb-mat-32{align-items:center;vertical-align:middle;min-width:32px;min-height:15px;padding:4px;font-size:.8rem;line-height:15px;background:#dcdcdc59}div.tb-editor-area-title-panel button.mat-mdc-button-base:not(.tb-help-popup-button),div.tb-editor-area-title-panel button.mat-mdc-button-base.tb-mat-32:not(.tb-help-popup-button){color:#7b7b7b}div.tb-editor-area-title-panel button.mat-mdc-button-base:not(.mat-mdc-icon-button){height:23px}div.tb-editor-area-title-panel .tb-help-popup-button-loading{background:#f3f3f3}.tb-resize-container{position:relative;width:100%;height:100%;overflow-y:auto}.tb-resize-container .ace_editor{height:100%}mat-toolbar.tb-edit-toolbar{min-height:40px!important;max-height:40px!important}mat-toolbar.tb-edit-toolbar button.mat-mdc-button-base:not(.mat-mdc-icon-button){font-size:12px;line-height:28px;padding:0 8px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;height:28px}mat-toolbar.tb-edit-toolbar button.mat-mdc-button-base:not(.mat-mdc-icon-button) .mat-icon{height:20px;width:20px;font-size:20px}mat-toolbar.tb-edit-toolbar .mat-mdc-form-field input,mat-toolbar.tb-edit-toolbar .mat-mdc-form-field .mat-mdc-select{font-size:1.1rem;font-weight:400;letter-spacing:.005em}mat-toolbar.tb-edit-toolbar .mat-mdc-form-field.tb-widget-title{min-width:250px}@media screen and (max-width: 1279px){mat-toolbar.tb-edit-toolbar .mat-mdc-form-field.tb-widget-title{min-width:0}}\n'],encapsulation:2})}}var va=d(49554);function mp(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"widget.title-required")," "))}function up(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"widget.title-max-length")," "))}class Ca extends xe.l{constructor(t,i,n,o,r){super(t,o,i,n,r),this.store=t,this.entityValue=i,this.entitiesTableConfigValue=n,this.fb=o,this.cd=r}hideDelete(){return!!this.entitiesTableConfig&&!this.entitiesTableConfig.deleteEnabled(this.entity)}buildForm(t){return this.fb.group({name:[t?t.name:"",[s.Validators.required,s.Validators.maxLength(255)]],image:[t?t.image:""],description:[t?t.description:"",s.Validators.maxLength(1024)],tags:[t?t.tags:[]],scada:[!!t&&t.scada],deprecated:[!!t&&t.deprecated]})}updateForm(t){this.entityForm.patchValue({name:t.name,image:t.image,description:t.description,tags:t.tags,scada:t.scada,deprecated:t.deprecated})}static{this.\u0275fac=function(i){return new(i||Ca)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject("entity"),e.\u0275\u0275directiveInject("entitiesTableConfig"),e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(e.ChangeDetectorRef))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Ca,selectors:[["tb-widget-type"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:45,vars:51,consts:[["descriptionInput",""],[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["translate",""],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","image",1,"flex-1",3,"label"],["matInput","","formControlName","description","rows","2","maxlength","1024"],["align","end"],["formControlName","tags",3,"label"],[1,"flex","flex-col","gap-4"],["formControlName","scada"],["formControlName","deprecated"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",1)(1,"button",2),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275listener("click",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.onEntityAction(l,"edit"))}),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",2),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275listener("click",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.onEntityAction(l,"openDetails"))}),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"button",2),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275listener("click",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.onEntityAction(l,"export"))}),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"button",2),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275listener("click",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.onEntityAction(l,"delete"))}),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(17,"div",3)(18,"form",4)(19,"fieldset",5),e.\u0275\u0275pipe(20,"async"),e.\u0275\u0275elementStart(21,"mat-form-field",6)(22,"mat-label",7),e.\u0275\u0275text(23,"widget.title"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(24,"input",8),e.\u0275\u0275template(25,mp,3,3,"mat-error",9)(26,up,3,3,"mat-error",9),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(27,"tb-gallery-image-input",10),e.\u0275\u0275pipe(28,"translate"),e.\u0275\u0275elementStart(29,"mat-form-field",6)(30,"mat-label",7),e.\u0275\u0275text(31,"widget.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(32,"textarea",11,0),e.\u0275\u0275elementStart(34,"mat-hint",12),e.\u0275\u0275text(35),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(36,"tb-string-items-list",13),e.\u0275\u0275pipe(37,"translate"),e.\u0275\u0275elementStart(38,"div",14)(39,"mat-slide-toggle",15),e.\u0275\u0275text(40),e.\u0275\u0275pipe(41,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(42,"mat-slide-toggle",16),e.\u0275\u0275text(43),e.\u0275\u0275pipe(44,"translate"),e.\u0275\u0275elementEnd()()()()()}if(2&i){const o=e.\u0275\u0275reference(33);e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(2,25,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,27,"widget.edit")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||n.isDetailsPage),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(6,29,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(8,31,"common.open-details-page")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(10,33,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(12,35,"widget.export")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.hideDelete()||n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(14,37,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,39,"widget.delete-widget")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("formGroup",n.entityForm),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(20,41,n.isLoading$)||!n.isEdit),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.entityForm.get("name").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("name").hasError("maxlength")),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(28,43,"widget.image-preview")),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate1("",(null==o.value?null:o.value.length)||0,"/1024"),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(37,45,"widget.tags")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(41,47,"widget.scada")," "),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(44,49,"widget.deprecated")," ")}},dependencies:[p.NgIf,ba.StringItemsListComponent,x.MatButton,L.MatInput,v.MatFormField,v.MatLabel,v.MatHint,v.MatError,pe.MatSlideToggle,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.MaxLengthValidator,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,br.GalleryImageInputComponent,p.AsyncPipe,u.TranslatePipe],encapsulation:2})}}function gp(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-tab",2,0),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementStart(3,"tb-version-control",3),e.\u0275\u0275listener("versionRestored",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.entitiesTableConfig.updateData())}),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"version-control.version-control")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}class xa extends Ee.P{constructor(t){super(t),this.store=t}isTenantWidgetType(){return this.entity&&this.entity.tenantId.id!==R.k}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(i){return new(i||xa)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:xa,selectors:[["tb-widget-type-tabs"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(i,n){1&i&&e.\u0275\u0275template(0,gp,4,7,"mat-tab",1),2&i&&e.\u0275\u0275property("ngIf",n.isTenantWidgetType()&&n.authUser.authority===n.authorities.TENANT_ADMIN)},dependencies:[p.NgIf,Q.MatTab,ke.d,u.TranslatePipe],encapsulation:2})}}var zo=d(99691);function fp(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",14)}function hp(a,t){1&a&&e.\u0275\u0275element(0,"div",15)}function bp(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",16),e.\u0275\u0275listener("click",function(){const o=e.\u0275\u0275restoreView(i).$implicit,r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.typeSelected(r.widgetTypes[o]))}),e.\u0275\u0275elementStart(1,"tb-icon",17),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"span",2),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd()()}if(2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",n.widgetTypesDataMap.get(n.widgetTypes[i]).icon," "),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(n.widgetTypesDataMap.get(n.widgetTypes[i]).name)}}class mn extends se.m{constructor(t,i,n){super(t,i,n),this.store=t,this.router=i,this.dialogRef=n,this.widgetTypes=he.t_,this.allWidgetTypes=Object.keys(he.t_),this.widgetTypesDataMap=he.WT}cancel(){this.dialogRef.close(null)}typeSelected(t){this.dialogRef.close(t)}static{this.\u0275fac=function(i){return new(i||mn)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(S.MatDialogRef))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:mn,selectors:[["tb-select-widget-type-dialog"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:22,vars:16,consts:[[2,"width","800px"],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content",""],[3,"disabled"],[1,"flex","flex-col","items-center","justify-center","gap-4","gt-sm:flex-row"],["class","tb-card-button","mat-raised-button","","color","primary","type","button",3,"click",4,"ngFor","ngForOf"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],["mat-raised-button","","color","primary","type","button",1,"tb-card-button",3,"click"],["matButtonIcon","",1,"tb-mat-96"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"form",0)(1,"mat-toolbar",1)(2,"h2",2),e.\u0275\u0275text(3,"widget.select-widget-type"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"span",3),e.\u0275\u0275elementStart(5,"button",4),e.\u0275\u0275listener("click",function(){return n.cancel()}),e.\u0275\u0275elementStart(6,"mat-icon",5),e.\u0275\u0275text(7,"close"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(8,fp,1,0,"mat-progress-bar",6),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275template(10,hp,1,0,"div",7),e.\u0275\u0275pipe(11,"async"),e.\u0275\u0275elementStart(12,"div",8)(13,"fieldset",9),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275elementStart(15,"div",10),e.\u0275\u0275template(16,bp,5,2,"button",11),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(17,"div",12)(18,"button",13),e.\u0275\u0275pipe(19,"async"),e.\u0275\u0275listener("click",function(){return n.cancel()}),e.\u0275\u0275text(20),e.\u0275\u0275pipe(21,"translate"),e.\u0275\u0275elementEnd()()()),2&i&&(e.\u0275\u0275advance(8),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(9,6,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(11,8,n.isLoading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(14,10,n.isLoading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",n.allWidgetTypes),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(19,12,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(21,14,"action.cancel")," "))},dependencies:[p.NgForOf,p.NgIf,x.MatButton,x.MatIconButton,E.MatIcon,K.MatProgressBar,ae.MatToolbar,S.MatDialogActions,S.MatDialogContent,s.\u0275NgNoValidate,s.NgControlStatusGroup,s.NgForm,u.TranslateDirective,zo.TbIconComponent,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]     .mat-mdc-button-base.tb-card-button{width:100%;height:100%;max-width:240px;display:flex;flex-direction:column;align-items:center}[_nghost-%COMP%]     .mat-mdc-button-base.tb-card-button .mat-icon{margin:auto}[_nghost-%COMP%]     .mat-mdc-button-base.tb-card-button span.mdc-button__label{height:18px;min-height:18px;max-height:18px;margin:0 0 20px;font-size:18px;font-weight:400;line-height:18px;white-space:normal}[_nghost-%COMP%]     .mat-mdc-button-base.tb-card-button.mat-mdc-raised-button.mat-primary .mat-ripple-element{opacity:.3;background-color:#ffffff4d}']})}}class Ot{constructor(t,i,n,o,r,l,c){this.store=t,this.dialog=i,this.widgetsService=n,this.translate=o,this.importExport=r,this.datePipe=l,this.router=c,this.config=new y.M7,this.config.entityType=f.ck.WIDGETS_BUNDLE,this.config.entityComponent=Ca,this.config.entityTabsComponent=xa,this.config.entityTranslations=f.Mi.get(f.ck.WIDGET_TYPE),this.config.entityResources=f.BT.get(f.ck.WIDGET_TYPE),this.config.defaultSortOrder={property:"name",direction:Pe.O.ASC},this.config.rowPointer=!0,this.config.entityTitle=m=>m?m.name:"",this.config.columns.push(new y.Qr("createdTime","common.created-time",this.datePipe,"150px"),new y.KK("name","widget.title","100%"),new y.KK("widgetType","widget.type","150px",m=>m?.widgetType?this.translate.instant(he.WT.get(m.widgetType).name):"",void 0,!1),new y.KK("tenantId","widget.system","60px",m=>(0,y.ov)(m.tenantId.id===R.k)),new y.KK("deprecated","widget.deprecated","60px",m=>(0,y.ov)(m.deprecated))),this.config.addActionDescriptors.push({name:this.translate.instant("dashboard.create-new-widget"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:m=>this.addWidgetType(m)},{name:this.translate.instant("widget.import"),icon:"file_upload",isEnabled:()=>!0,onAction:m=>this.importWidgetType(m)}),this.config.cellActionDescriptors.push({name:this.translate.instant("widget.export"),icon:"file_download",isEnabled:()=>!0,onAction:(m,h)=>this.exportWidgetType(m,h)},{name:this.translate.instant("widget.widget-details"),icon:"edit",isEnabled:()=>!0,onAction:(m,h)=>this.config.toggleEntityDetails(m,h)}),this.config.groupActionDescriptors.push({name:this.translate.instant("widget.export-widgets"),icon:"file_download",isEnabled:!0,onAction:(m,h)=>this.exportWidgetTypes(m,h)}),this.config.deleteEntityTitle=m=>this.translate.instant("widget.delete-widget-title",{widgetName:m.name}),this.config.deleteEntityContent=()=>this.translate.instant("widget.delete-widget-text"),this.config.deleteEntitiesTitle=m=>this.translate.instant("widget.delete-widgets-title",{count:m}),this.config.deleteEntitiesContent=()=>this.translate.instant("widget.delete-widgets-text"),this.config.loadEntity=m=>this.widgetsService.getWidgetTypeById(m.id),this.config.saveEntity=m=>this.widgetsService.saveWidgetType(m),this.config.deleteEntity=m=>this.widgetsService.deleteWidgetType(m.id),this.config.onEntityAction=m=>this.onWidgetTypeAction(m,this.config),this.config.handleRowClick=(m,h)=>(this.config.isDetailsOpen()?this.config.toggleEntityDetails(m,h):this.openWidgetEditor(m,h),!0)}resolve(){this.config.tableTitle=this.translate.instant("widget.widgets");const t=(0,q.rx)(this.store);return this.config.deleteEnabled=i=>this.isWidgetTypeEditable(i,t.authority),this.config.entitySelectionEnabled=i=>this.isWidgetTypeEditable(i,t.authority),this.config.detailsReadonly=i=>!this.isWidgetTypeEditable(i,t.authority),this.config.entitiesFetchFunction=i=>this.widgetsService.getWidgetTypes(i),this.config}isWidgetTypeEditable(t,i){return i===g.s.TENANT_ADMIN?t&&t.tenantId&&t.tenantId.id!==R.k:i===g.s.SYS_ADMIN}addWidgetType(t){t&&t.stopPropagation(),this.dialog.open(mn,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"]}).afterClosed().subscribe(i=>{i&&this.router.navigateByUrl(`resources/widgets-library/widget-types/${i}`)})}importWidgetType(t){this.importExport.importWidgetType().subscribe(i=>{i&&this.config.updateData()})}openWidgetEditor(t,i){t&&t.stopPropagation(),this.router.navigateByUrl(`resources/widgets-library/widget-types/${i.id.id}`)}openWidgetTypeDetails(t,i,n){t&&t.stopPropagation();const o=this.router.createUrlTree(["details",i.id.id],{relativeTo:n.getActivatedRoute()});this.router.navigateByUrl(o)}exportWidgetType(t,i){t&&t.stopPropagation(),this.importExport.exportWidgetType(i.id.id)}exportWidgetTypes(t,i){t&&t.stopPropagation(),this.importExport.exportWidgetTypes(i.map(n=>n.id.id)).subscribe(()=>{this.config.getTable().clearSelection()})}onWidgetTypeAction(t,i){switch(t.action){case"edit":return this.openWidgetEditor(t.event,t.entity),!0;case"openDetails":return this.openWidgetTypeDetails(t.event,t.entity,i),!0;case"export":return this.exportWidgetType(t.event,t.entity),!0}return!1}static{this.\u0275fac=function(i){return new(i||Ot)(e.\u0275\u0275inject(C.Store),e.\u0275\u0275inject(S.MatDialog),e.\u0275\u0275inject(Ae.C),e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(ut.ImportExportService),e.\u0275\u0275inject(p.DatePipe),e.\u0275\u0275inject(b.Router))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Ot,factory:Ot.\u0275fac})}}var Qe=d(81391),Ge=d(31635),yp=d(719),Hr=d(70152),yr=d(23294),Ho=d(25558),Kr=d(97647),vp=d(29543),_a=d(29225),Sa=d(60850),Yr=d(91009),Qr=d(68762);const Cp=["widgetTypeInput"],xp=[[["","tb-error",""]],[["","tb-hint",""]]],_p=["[tb-error]","[tb-hint]"],Sp=()=>({preview:!0,emptyUrl:"/assets/widget-preview-empty.svg"}),Tp=a=>({entity:a});function Ip(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-label"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(i.label)}}function wp(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",10),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.clear())}),e.\u0275\u0275elementStart(1,"mat-icon",11),e.\u0275\u0275text(2,"close"),e.\u0275\u0275elementEnd()()}}function Ep(a,t){1&a&&(e.\u0275\u0275elementStart(0,"div",18),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"widget.deprecated")))}function Mp(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",12)(1,"div",13),e.\u0275\u0275element(2,"img",14),e.\u0275\u0275pipe(3,"image"),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275elementStart(5,"div",15),e.\u0275\u0275element(6,"div",16),e.\u0275\u0275pipe(7,"highlight"),e.\u0275\u0275template(8,Ep,3,3,"div",17),e.\u0275\u0275elementEnd()()()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("value",i),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("alt",i.name),e.\u0275\u0275property("src",e.\u0275\u0275pipeBind1(4,8,e.\u0275\u0275pipeBind2(3,5,i.image,e.\u0275\u0275pureFunction0(14,Sp))),e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(4),e.\u0275\u0275property("innerHTML",e.\u0275\u0275pipeBind3(7,10,i.name,n.searchText,!0),e.\u0275\u0275sanitizeHtml),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.deprecated)}}function Np(a,t){1&a&&(e.\u0275\u0275elementStart(0,"div")(1,"span"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()),2&a&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,1,"widget.no-widgets-text")))}function Ap(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,i.translate.get("widget.no-widgets-matching",e.\u0275\u0275pureFunction1(3,Tp,i.searchText)))," ")}}function Fp(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-option",12)(1,"div",19),e.\u0275\u0275listener("click",function(o){return e.\u0275\u0275restoreView(i),e.\u0275\u0275resetView(o.stopPropagation())}),e.\u0275\u0275template(2,Np,4,3,"div",20)(3,Ap,3,5,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275reference(4),n=e.\u0275\u0275nextContext();e.\u0275\u0275property("value",null),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.textIsNotEmpty(n.searchText))("ngIfElse",i)}}class Rt{constructor(t,i,n){this.translate=t,this.widgetService=i,this.fb=n,this.dirty=!1,this.label=this.translate.instant("widget.widget"),this.floatLabel="auto",this.appearance="fill",this.subscriptSizing="fixed",this.searchText="",this.propagateChange=o=>{},this.selectWidgetTypeFormGroup=this.fb.group({widgetType:[null]})}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}ngOnInit(){this.filteredWidgetTypes=this.selectWidgetTypeFormGroup.get("widgetType").valueChanges.pipe((0,Hr.B)(150),(0,ne.M)(t=>{let i;i="string"!=typeof t&&t?t:null,this.updateView(i)}),(0,ie.T)(t=>t?"string"==typeof t?t:t.name:""),(0,yr.F)(),(0,Ho.n)(t=>this.fetchWidgetTypes(t)),(0,Kr.u)())}ngAfterViewInit(){}setDisabledState(t){this.disabled=t,this.disabled?this.selectWidgetTypeFormGroup.disable({emitEvent:!1}):this.selectWidgetTypeFormGroup.enable({emitEvent:!1})}writeValue(t){this.searchText="",null!=t?"string"==typeof t?this.widgetService.getWidgetTypeInfoById(t).subscribe(i=>{this.modelValue=i,this.selectWidgetTypeFormGroup.get("widgetType").patchValue(i,{emitEvent:!1})}):(this.modelValue=t,this.selectWidgetTypeFormGroup.get("widgetType").patchValue(t,{emitEvent:!1})):(this.modelValue=null,this.selectWidgetTypeFormGroup.get("widgetType").patchValue("",{emitEvent:!1})),this.dirty=!0}updateView(t){this.modelValue!==t&&(this.modelValue=t,this.propagateChange(this.modelValue))}displayWidgetTypeFn(t){return t?t.name:void 0}fetchWidgetTypes(t){this.searchText=t;const i=new yp.Ek(10,0,t,{property:"name",direction:Pe.O.ASC});return this.getWidgetTypes(i)}getWidgetTypes(t,i=[]){return this.widgetService.getWidgetTypes(t,!0).pipe((0,cn.W)(()=>(0,H.of)((0,vp.r)())),(0,Ho.n)(n=>{if(this.excludeWidgetTypeIds?.length){const o=n.data.filter(r=>!this.excludeWidgetTypeIds.includes(r.id.id));i=i.concat(o)}else i=n.data;return i.length>=t.pageSize||!this.excludeWidgetTypeIds?.length||!n.hasNext?(0,H.of)(i):this.getWidgetTypes(t.nextPageLink(),i)}))}onFocus(){this.dirty&&(this.selectWidgetTypeFormGroup.get("widgetType").updateValueAndValidity({onlySelf:!0}),this.dirty=!1)}clear(){this.selectWidgetTypeFormGroup.get("widgetType").patchValue(""),setTimeout(()=>{this.widgetTypeInput.nativeElement.blur(),this.widgetTypeInput.nativeElement.focus()},0)}textIsNotEmpty(t){return t&&t.length>0}static{this.\u0275fac=function(i){return new(i||Rt)(e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(Ae.C),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Rt,selectors:[["tb-widget-type-autocomplete"]],viewQuery:function(i,n){if(1&i&&e.\u0275\u0275viewQuery(Cp,7),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.widgetTypeInput=o.first)}},inputs:{label:"label",placeholder:"placeholder",floatLabel:"floatLabel",appearance:"appearance",subscriptSizing:"subscriptSizing",required:"required",disabled:"disabled",excludeWidgetTypeIds:"excludeWidgetTypeIds"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>Rt),multi:!0}])],ngContentSelectors:_p,decls:15,vars:16,consts:[["widgetTypeInput",""],["widgetTypeAutocomplete",""],["searchNotEmpty",""],[1,"mat-block",3,"formGroup","floatLabel","appearance","subscriptSizing"],[4,"ngIf"],["matInput","","type","text","formControlName","widgetType",3,"focusin","placeholder","required","matAutocomplete"],["type","button","matSuffix","","mat-icon-button","","aria-label","Clear",3,"click",4,"ngIf"],[1,"tb-autocomplete","tb-widget-type-autocomplete",3,"displayWith"],[3,"value",4,"ngFor","ngForOf"],[3,"value",4,"ngIf"],["type","button","matSuffix","","mat-icon-button","","aria-label","Clear",3,"click"],[1,"material-icons"],[3,"value"],[1,"tb-widget-type-option-container"],[1,"tb-widget-type-option-image-preview",3,"src","alt"],[1,"tb-widget-type-option-details"],[1,"tb-widget-type-option-text",3,"innerHTML"],["class","tb-widget-type-option-deprecated",4,"ngIf"],[1,"tb-widget-type-option-deprecated"],[3,"click"],[4,"ngIf","ngIfElse"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275projectionDef(xp),e.\u0275\u0275elementStart(0,"mat-form-field",3),e.\u0275\u0275template(1,Ip,2,1,"mat-label",4),e.\u0275\u0275elementStart(2,"input",5,0),e.\u0275\u0275listener("focusin",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.onFocus())}),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(4,wp,3,0,"button",6),e.\u0275\u0275elementStart(5,"mat-autocomplete",7,1),e.\u0275\u0275template(7,Mp,9,15,"mat-option",8),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275template(9,Fp,5,3,"mat-option",9),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"mat-error"),e.\u0275\u0275projection(12),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"mat-hint"),e.\u0275\u0275projection(14,1),e.\u0275\u0275elementEnd()()}if(2&i){let o;const r=e.\u0275\u0275reference(6);e.\u0275\u0275property("formGroup",n.selectWidgetTypeFormGroup)("floatLabel",n.floatLabel)("appearance",n.appearance)("subscriptSizing",n.subscriptSizing),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.label),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("placeholder",n.placeholder),e.\u0275\u0275property("required",n.required)("matAutocomplete",r),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.selectWidgetTypeFormGroup.get("widgetType").value&&!n.disabled),e.\u0275\u0275advance(),e.\u0275\u0275property("displayWith",n.displayWidgetTypeFn),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(8,12,n.filteredWidgetTypes)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!(null!=(o=e.\u0275\u0275pipeBind1(10,14,n.filteredWidgetTypes))&&o.length))}},dependencies:[p.NgForOf,p.NgIf,x.MatIconButton,E.MatIcon,L.MatInput,v.MatFormField,v.MatLabel,v.MatHint,v.MatError,v.MatSuffix,z.MatOption,Sa.MatAutocomplete,Sa.MatAutocompleteTrigger,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,p.AsyncPipe,Yr.HighlightPipe,Qr.ImagePipe,u.TranslatePipe],styles:['@charset "UTF-8";.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text{width:100%}.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text .tb-widget-type-option-container{display:flex;gap:8px;align-items:center}.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text .tb-widget-type-option-image-preview{width:36px;max-height:100%;object-fit:contain;border-radius:6px}.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text .tb-widget-type-option-details{flex:1;display:flex;align-items:center;justify-content:space-between}.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text .tb-widget-type-option-details .tb-widget-type-option-text{font-size:14px;font-weight:400;letter-spacing:.2px}.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text .tb-widget-type-option-details .tb-widget-type-option-deprecated{font-size:13px;font-weight:400;color:#0000008a}\n'],encapsulation:2})}}(0,Ge.__decorate)([(0,_a.coerceBoolean)(),(0,Ge.__metadata)("design:type",Boolean)],Rt.prototype,"required",void 0);const Dp=()=>({preview:!0,emptyUrl:"/assets/widget-preview-empty.svg"});function Pp(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"button",19),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"mat-icon"),e.\u0275\u0275text(4,"add"),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(),n=e.\u0275\u0275reference(14);e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(1,3,"widget.add-new-widget")),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(2,5,i.isLoading$))("matMenuTriggerFor",n)}}function kp(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",20)}function Lp(a,t){1&a&&e.\u0275\u0275element(0,"div",21)}function Op(a,t){1&a&&(e.\u0275\u0275elementStart(0,"div",30),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"widget.deprecated")))}function Rp(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",3),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275listener("click",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext().$implicit,l=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(l.openWidgetEditor(o,r))}),e.\u0275\u0275elementStart(2,"mat-icon"),e.\u0275\u0275text(3,"edit"),e.\u0275\u0275elementEnd()()}2&a&&e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(1,1,"widget.edit"))}function Vp(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",3),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275listener("click",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext().$implicit,l=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(l.exportWidgetType(o,r))}),e.\u0275\u0275elementStart(2,"mat-icon"),e.\u0275\u0275text(3,"file_download"),e.\u0275\u0275elementEnd()()}2&a&&e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(1,1,"widget.export"))}function Bp(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",3),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275listener("click",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext().$implicit,l=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(l.removeWidgetType(o,r))}),e.\u0275\u0275elementStart(2,"mat-icon"),e.\u0275\u0275text(3,"delete"),e.\u0275\u0275elementEnd()()}2&a&&e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(1,1,"widget.remove"))}function Gp(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"button",31),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275elementStart(2,"tb-icon"),e.\u0275\u0275text(3,"drag_indicator"),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275classProp("!hidden",!i.widgets||i.widgets.length<=1),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(1,3,"action.drag"))}}function jp(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",22)(1,"div",23),e.\u0275\u0275element(2,"img",24),e.\u0275\u0275pipe(3,"image"),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275elementStart(5,"div",25)(6,"div",26),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(8,Op,3,3,"div",27),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(9,Rp,4,3,"button",28)(10,Vp,4,3,"button",28)(11,Bp,4,3,"button",28)(12,Gp,4,5,"button",29),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("alt",i.name),e.\u0275\u0275property("src",e.\u0275\u0275pipeBind1(4,11,e.\u0275\u0275pipeBind2(3,8,i.image,e.\u0275\u0275pureFunction0(13,Dp))),e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(i.name),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.deprecated),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n.editMode),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n.editMode),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.editMode&&!n.addMode),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.editMode)}}function Up(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",32),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.addWidgetMode())}),e.\u0275\u0275elementStart(2,"tb-icon",33),e.\u0275\u0275text(3,"add"),e.\u0275\u0275elementEnd()()}2&a&&e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(1,1,"widget.add-existing-widget"))}function qp(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",34)(1,"div",35),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.addWidgetMode())}),e.\u0275\u0275elementStart(2,"tb-icon",33),e.\u0275\u0275text(3,"add"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",36),e.\u0275\u0275text(5,"widget.add-existing-widget"),e.\u0275\u0275elementEnd()()()}}function Wp(a,t){1&a&&(e.\u0275\u0275elementStart(0,"div",37),e.\u0275\u0275element(1,"div",38),e.\u0275\u0275elementStart(2,"div",39),e.\u0275\u0275text(3,"widget.no-widgets"),e.\u0275\u0275elementEnd()())}function $p(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",40),e.\u0275\u0275element(1,"tb-widget-type-autocomplete",41),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementStart(3,"div",42)(4,"button",43),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.cancelAddWidgetMode())}),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275elementEnd()()()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(2,5,"widget.select-widget")),e.\u0275\u0275property("excludeWidgetTypeIds",i.excludeWidgetTypeIds)("formControl",i.addWidgetFormControl),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(5,7,i.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(7,9,"action.cancel")," ")}}function zp(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",43),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.cancel())}),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(1,2,i.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(3,4,"action.cancel")," ")}}function Hp(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",44),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.save())}),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(1,2,i.isLoading$)||!i.isDirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(3,4,"action.save")," ")}}function Kp(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",44),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.edit())}),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(1,2,i.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(3,4,"action.edit")," ")}}class Ta extends de.H{constructor(t,i,n,o,r,l,c){super(t),this.store=t,this.router=i,this.route=n,this.widgetsService=o,this.importExport=r,this.cd=l,this.dialog=c,this.editMode=!1,this.addMode=!1,this.isDirty=!1,this.addWidgetFormControl=new s.FormControl(null,[s.Validators.required]),this.authUser=(0,q.rx)(this.store),this.widgetsBundle=this.route.snapshot.data.widgetsBundle,this.widgets=[...this.route.snapshot.data.widgets],this.authUser.authority===g.s.TENANT_ADMIN?this.isReadOnly=!this.widgetsBundle||this.widgetsBundle.tenantId.id===R.k:this.isReadOnly=this.authUser.authority!==g.s.SYS_ADMIN,!this.isReadOnly&&!this.widgets.length&&(this.editMode=!0),this.addWidgetFormControl.valueChanges.subscribe(m=>{m&&this.addWidget(m)})}ngOnInit(){}trackByWidget(t,i){return i}widgetDrop(t){const i=this.widgets[t.previousIndex];this.widgets.splice(t.previousIndex,1),this.widgets.splice(t.currentIndex,0,i),this.isDirty=!0}addWidgetMode(){this.addWidgetFormControl.patchValue(null,{emitEvent:!1}),this.excludeWidgetTypeIds=this.widgets.map(t=>t.id.id),this.addMode=!0}cancelAddWidgetMode(){this.addMode=!1}addWidget(t){this.widgets.push(t),this.isDirty=!0,this.addMode=!1}openWidgetEditor(t,i){t&&t.stopPropagation(),this.router.navigate([i.id.id],{relativeTo:this.route}).then(()=>{})}exportWidgetType(t,i){t&&t.stopPropagation(),this.importExport.exportWidgetType(i.id.id)}removeWidgetType(t,i){t&&t.stopPropagation();const n=this.widgets.indexOf(i);this.widgets.splice(n,1),this.isDirty=!0}goBack(){this.router.navigate([".."],{relativeTo:this.route})}exportWidgetsBundle(){this.importExport.exportWidgetsBundle(this.widgetsBundle.id.id)}edit(){this.editMode=!0}cancel(){this.isDirty?this.widgetsService.getBundleWidgetTypeInfosList(this.widgetsBundle.id.id).subscribe(t=>{this.widgets=[...t],this.isDirty=!1,this.addMode=!1,this.editMode=!this.widgets.length,this.cd.markForCheck()}):(this.addMode=!1,this.editMode=!this.widgets.length)}save(){const t=this.widgets.map(i=>i.id.id);this.widgetsService.updateWidgetsBundleWidgetTypes(this.widgetsBundle.id.id,t).subscribe(()=>{this.isDirty=!1,this.editMode=!1,this.addMode=!1})}addWidgetType(t){t&&t.stopPropagation(),this.dialog.open(mn,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"]}).afterClosed().subscribe(i=>{i&&this.router.navigate([i],{relativeTo:this.route}).then(()=>{})})}importWidgetType(){this.importExport.importWidgetType().subscribe(t=>{if(t){const i=this.widgets.some(n=>n.id.id===t.id.id);i&&(this.widgets=this.widgets.map(n=>n.id.id!==t.id.id?n:t)),this.editMode?(this.widgets.push(t),this.isDirty=!0,this.cd.markForCheck()):i||this.widgetsService.addWidgetFqnToWidgetBundle(this.widgetsBundle.id.id,t.fqn).subscribe(()=>{this.widgets.push(t),this.cd.markForCheck()})}})}static{this.\u0275fac=function(i){return new(i||Ta)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(b.ActivatedRoute),e.\u0275\u0275directiveInject(Ae.C),e.\u0275\u0275directiveInject(ut.ImportExportService),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(S.MatDialog))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Ta,selectors:[["tb-widgets-bundle-widget"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:46,vars:33,consts:[["addWidgetMenu","matMenu"],["appearance","outlined",1,"tb-bundle-widgets-card"],[1,"title-container"],["mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"],[1,"mat-headline-5"],[1,"flex-1"],["mat-icon-button","","matTooltipPosition","above",3,"disabled","matTooltip","matMenuTriggerFor",4,"ngIf"],["xPosition","before"],["mat-menu-item","",3,"click"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["cdkDropList","","cdkDropListOrientation","vertical",1,"tb-drop-list","tb-bundle-widgets-container",3,"cdkDropListDropped","cdkDropListDisabled"],["cdkDrag","","class","tb-draggable tb-bundle-widget-row",4,"ngFor","ngForOf","ngForTrackBy"],["class","tb-add-widget-button","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["class","tb-add-widget-button-panel",4,"ngIf"],["class","tb-no-data-available",4,"ngIf"],["class","tb-add-bundle-widget-form",4,"ngIf"],["mat-button","","color","primary",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","primary",3,"disabled","click",4,"ngIf"],["mat-icon-button","","matTooltipPosition","above",3,"disabled","matTooltip","matMenuTriggerFor"],["color","warn","mode","indeterminate"],[2,"height","4px"],["cdkDrag","",1,"tb-draggable","tb-bundle-widget-row"],[1,"tb-bundle-widget-row-details"],[1,"tb-bundle-widget-image-preview",3,"src","alt"],[1,"tb-bundle-widget-details"],[1,"tb-bundle-widget-title"],["class","tb-bundle-widget-deprecated",4,"ngIf"],["mat-icon-button","","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["cdkDragHandle","","mat-icon-button","","matTooltipPosition","above","class","tb-drag-handle",3,"!hidden","matTooltip",4,"ngIf"],[1,"tb-bundle-widget-deprecated"],["cdkDragHandle","","mat-icon-button","","matTooltipPosition","above",1,"tb-drag-handle",3,"matTooltip"],["matTooltipPosition","above",1,"tb-add-widget-button",3,"click","matTooltip"],["color","primary",1,"tb-add-widget-icon"],[1,"tb-add-widget-button-panel"],[1,"tb-add-widget-button-with-text",3,"click"],["translate","",1,"tb-add-widget-button-text"],[1,"tb-no-data-available"],[1,"tb-no-data-bg"],["translate","",1,"tb-no-data-text"],[1,"tb-add-bundle-widget-form"],["required","",3,"placeholder","excludeWidgetTypeIds","formControl"],[1,"tb-add-bundle-widget-actions"],["mat-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-card",1)(1,"mat-card-header")(2,"mat-card-title")(3,"div",2)(4,"button",3),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.goBack())}),e.\u0275\u0275elementStart(6,"mat-icon"),e.\u0275\u0275text(7,"arrow_back"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(8,"span",4),e.\u0275\u0275text(9),e.\u0275\u0275pipe(10,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(11,"span",5),e.\u0275\u0275template(12,Pp,5,7,"button",6),e.\u0275\u0275elementStart(13,"mat-menu",7,0)(15,"button",8),e.\u0275\u0275listener("click",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.addWidgetType(l))}),e.\u0275\u0275elementStart(16,"mat-icon"),e.\u0275\u0275text(17,"insert_drive_file"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"span"),e.\u0275\u0275text(19),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(21,"button",8),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.importWidgetType())}),e.\u0275\u0275elementStart(22,"mat-icon"),e.\u0275\u0275text(23,"file_upload"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(24,"span"),e.\u0275\u0275text(25),e.\u0275\u0275pipe(26,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(27,"button",3),e.\u0275\u0275pipe(28,"translate"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.exportWidgetsBundle())}),e.\u0275\u0275elementStart(29,"mat-icon"),e.\u0275\u0275text(30,"file_download"),e.\u0275\u0275elementEnd()()()()(),e.\u0275\u0275template(31,kp,1,0,"mat-progress-bar",9),e.\u0275\u0275pipe(32,"async"),e.\u0275\u0275template(33,Lp,1,0,"div",10),e.\u0275\u0275pipe(34,"async"),e.\u0275\u0275elementStart(35,"mat-card-content")(36,"div",11),e.\u0275\u0275listener("cdkDropListDropped",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.widgetDrop(l))}),e.\u0275\u0275template(37,jp,13,14,"div",12),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(38,Up,4,3,"div",13)(39,qp,6,0,"div",14)(40,Wp,4,0,"div",15)(41,$p,8,11,"div",16),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(42,"mat-card-actions"),e.\u0275\u0275template(43,zp,4,6,"button",17)(44,Hp,4,6,"button",18)(45,Kp,4,6,"button",18),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(5,19,"action.back")),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate2("",n.widgetsBundle.title,": ",e.\u0275\u0275pipeBind1(10,21,"widget.widgets"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!n.isReadOnly),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(20,23,"dashboard.create-new-widget")),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(26,25,"widget.import")),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(28,27,"widgets-bundle.export")),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(32,29,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!1===e.\u0275\u0275pipeBind1(34,31,n.isLoading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("cdkDropListDisabled",!n.editMode||(null==n.widgets?null:n.widgets.length)<2),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",n.widgets)("ngForTrackBy",n.trackByWidget),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.editMode&&!n.addMode&&(null==n.widgets?null:n.widgets.length)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.editMode&&!n.addMode&&!(null!=n.widgets&&n.widgets.length)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.isReadOnly&&!(null!=n.widgets&&n.widgets.length)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.addMode),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.editMode&&((null==n.widgets?null:n.widgets.length)||n.isDirty)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.editMode&&((null==n.widgets?null:n.widgets.length)||n.isDirty)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n.isReadOnly&&!n.editMode))},dependencies:[p.NgForOf,p.NgIf,x.MatButton,x.MatIconButton,E.MatIcon,D.MatCard,D.MatCardActions,D.MatCardContent,D.MatCardHeader,D.MatCardTitle,K.MatProgressBar,Be.MatMenu,Be.MatMenuItem,Be.MatMenuTrigger,_e.MatTooltip,Qe.CdkDropList,Qe.CdkDrag,Qe.CdkDragHandle,s.NgControlStatus,s.RequiredValidator,s.FormControlDirective,u.TranslateDirective,zo.TbIconComponent,Rt,p.AsyncPipe,Qr.ImagePipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:100%;height:100%;padding:8px}[_nghost-%COMP%]     .tb-bundle-widgets-card .mat-mdc-card-header-text{flex:1}.tb-bundle-widgets-card[_ngcontent-%COMP%]{padding:0;width:100%;height:100%;display:flex;flex-direction:column}@media screen and (min-width: 960px) and (max-width: 1279px){.tb-bundle-widgets-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){.tb-bundle-widgets-card[_ngcontent-%COMP%]{width:60%}}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:8px}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]   .mat-headline-5[_ngcontent-%COMP%]{margin:0}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{flex:1;padding:16px;min-height:0;overflow:hidden;display:flex;flex-direction:column;gap:8px}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-widget-button[_ngcontent-%COMP%]{min-height:56px;cursor:pointer;display:flex;flex-direction:column;justify-content:center;align-items:center;background:#fff;padding:8px;border:2px dashed rgba(0,0,0,.08);border-radius:10px}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-widget-button-panel[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-widget-button-panel[_ngcontent-%COMP%]   .tb-add-widget-button-with-text[_ngcontent-%COMP%]{cursor:pointer;display:flex;padding:24px 40px 24px 24px;justify-content:center;align-items:center;gap:8px;border:2px dashed rgba(0,0,0,.12);border-radius:10px}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-widget-button-panel[_ngcontent-%COMP%]   .tb-add-widget-button-with-text[_ngcontent-%COMP%]   .tb-add-widget-button-text[_ngcontent-%COMP%]{font-size:16px;font-style:normal;font-weight:500;line-height:24px;letter-spacing:.25px;color:#305680}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-bundle-widget-form[_ngcontent-%COMP%]{display:flex;padding:16px;flex-direction:column;gap:12px;border-radius:10px;border:1px solid rgba(0,0,0,.05);box-shadow:0 5px 16px #0000000a}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-bundle-widget-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:flex-start;gap:16px}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .mat-mdc-card-actions[_ngcontent-%COMP%]{justify-content:end;gap:8px}.tb-bundle-widgets-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;min-height:0;overflow:auto;padding-top:8px;padding-bottom:8px}.tb-bundle-widget-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;padding:6px 12px 6px 6px;background:#fff;gap:12px;border-radius:10px;border:1px solid rgba(0,0,0,.05);box-shadow:0 5px 16px #0000000a}.tb-bundle-widget-row[_ngcontent-%COMP%]   .tb-bundle-widget-row-details[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:row;align-items:center;gap:12px}.tb-bundle-widget-row[_ngcontent-%COMP%]   .tb-bundle-widget-row-details[_ngcontent-%COMP%]   .tb-bundle-widget-image-preview[_ngcontent-%COMP%]{width:64px;max-height:52px;height:100%;object-fit:contain;border-radius:6px}.tb-bundle-widget-row[_ngcontent-%COMP%]   .tb-bundle-widget-row-details[_ngcontent-%COMP%]   .tb-bundle-widget-details[_ngcontent-%COMP%]{padding:18px 0;flex:1;display:flex;flex-direction:row;align-items:center;justify-content:space-between}.tb-bundle-widget-row[_ngcontent-%COMP%]   .tb-bundle-widget-row-details[_ngcontent-%COMP%]   .tb-bundle-widget-details[_ngcontent-%COMP%]   .tb-bundle-widget-title[_ngcontent-%COMP%]{font-size:14px;font-weight:400;letter-spacing:.2px;color:#000000c2}.tb-bundle-widget-row[_ngcontent-%COMP%]   .tb-bundle-widget-row-details[_ngcontent-%COMP%]   .tb-bundle-widget-details[_ngcontent-%COMP%]   .tb-bundle-widget-deprecated[_ngcontent-%COMP%]{font-size:13px;font-weight:400;color:#0000008a}.tb-bundle-widget-row[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{color:#0000008a}']})}}var F=d(82456);const Jr=[{path:":widgetTypeId",component:ya,canDeactivate:[P.L],data:{auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN],title:"widget.editor",breadcrumb:{labelFunction:(a,t,i)=>i?.widget?.widgetName?i.widget.widgetName+(i.widget.deprecated?` (${t.instant("widget.deprecated")})`:""):"",icon:"insert_chart"},hideTabs:!0},resolve:{widgetEditorData:a=>{const t=a.params.widgetTypeId;if(!t||Object.keys(he.t_).includes(t)){let i=t;return i||(i=he.t_.timeseries),(0,e.inject)(Ae.C).getWidgetTemplate(i).pipe((0,ie.T)(n=>(n.widgetName=null,{widgetTypeDetails:null,widget:n})))}return(0,e.inject)(Ae.C).getWidgetTypeById(t).pipe((0,ie.T)(i=>({widgetTypeDetails:i,widget:(0,jr.MX)(i)})))}}}],em=[{path:"widget-types",data:{breadcrumb:{menuId:F.D8.widget_types}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN],title:"widget.widgets"},resolve:{entitiesTableConfig:Ot}},{path:"details",children:[{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"now_widgets"},auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN],title:"widget.widgets",hideTabs:!0,backNavigationCommands:["../.."]},resolve:{entitiesTableConfig:Ot}}]},...Jr]}],tm=[{path:"widgets-bundles",data:{breadcrumb:{menuId:F.D8.widgets_bundles}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN],title:"widgets-bundle.widgets-bundles"},resolve:{entitiesTableConfig:Lt}},{path:"details",children:[{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"now_widgets"},auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN],title:"widgets-bundle.widgets-bundles",hideTabs:!0,backNavigationCommands:["../.."]},resolve:{entitiesTableConfig:Lt}}]},{path:":widgetsBundleId",data:{breadcrumb:{labelFunction:a=>a.data.widgetsBundle.title,icon:"now_widgets"}},resolve:{widgetsBundle:a=>{const t=a.params.widgetsBundleId;return(0,e.inject)(Ae.C).getWidgetsBundle(t)}},children:[{path:"",component:Ta,canDeactivate:[P.L],data:{auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN],title:"widgets-bundle.widgets-bundle-widgets",hideTabs:!0},resolve:{widgets:a=>{const t=a.params.widgetsBundleId;return(0,e.inject)(Ae.C).getBundleWidgetTypeInfosList(t)}}},...Jr]}]}],nm=[{path:"widgets-library",component:va.V,data:{auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN],breadcrumb:{menuId:F.D8.widget_library}},children:[{path:"",children:[],data:{auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN],redirectTo:"/resources/widgets-library/widget-types"}},...em,...tm]}],im=[{path:"widgets-bundles",pathMatch:"full",redirectTo:"/resources/widgets-library/widgets-bundles"},{path:"resources/widgets-bundles",pathMatch:"full",redirectTo:"/resources/widgets-library/widgets-bundles"},{path:"widgets-bundles/:widgetsBundleId/widgetTypes",pathMatch:"full",redirectTo:"/resources/widgets-library/widgets-bundles/:widgetsBundleId"},{path:"resources/widgets-bundles/:widgetsBundleId/widgetTypes",pathMatch:"full",redirectTo:"/resources/widgets-library/widgets-bundles/:widgetsBundleId"},{path:"widgets-bundles/:widgetsBundleId/widgetTypes/:widgetTypeId",pathMatch:"full",redirectTo:"/resources/widgets-library/widget-types/:widgetTypeId"},{path:"resources/widgets-bundles/:widgetsBundleId/widgetTypes/:widgetTypeId",pathMatch:"full",redirectTo:"/resources/widgets-library/widget-types/:widgetTypeId"},{path:"widgets-bundles/:widgetsBundleId/widgetTypes/add/:widgetType",redirectTo:"/resources/widgets-library/widget-types/:widgetType"},{path:"resources/widgets-bundles/:widgetsBundleId/widgetTypes/add/:widgetType",redirectTo:"/resources/widgets-library/widget-types/:widgetType"}];class un{static{this.\u0275fac=function(i){return new(i||un)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:un})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[Ot,Lt],imports:[b.RouterModule.forChild(im),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(un,{imports:[b.RouterModule],exports:[b.RouterModule]});var je=d(97261);const am=[{path:"auditLogs",component:je.AuditLogTableComponent,data:{auth:[g.s.TENANT_ADMIN],title:"audit-log.audit-logs",breadcrumb:{menuId:F.D8.audit_log},isPage:!0}}],om=[{path:"auditLogs",redirectTo:"/security-settings/auditLogs"}];class gn{static{this.\u0275fac=function(i){return new(i||gn)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:gn})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[b.RouterModule.forChild(om),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(gn,{imports:[b.RouterModule],exports:[b.RouterModule]});var Zr=d(60602),rm=d(58525),Xr=d(38353),Ko=d(37140),sm=d(6559);function lm(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",22)}function dm(a,t){1&a&&e.\u0275\u0275element(0,"div",23)}function cm(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-icon",30),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275text(2," warning "),e.\u0275\u0275elementEnd()),2&a&&e.\u0275\u0275property("matTooltip",e.\u0275\u0275pipeBind1(1,1,"admin.mobile-app.app-package-name-required"))}function pm(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",24)(1,"div",25)(2,"div",26),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"mat-form-field",27),e.\u0275\u0275element(6,"input",28),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275template(8,cm,3,3,"mat-icon",29),e.\u0275\u0275elementEnd()()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,3,"admin.mobile-app.app-package-name")),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(7,5,"admin.mobile-app.set")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.mobileAppSettingsForm.get("androidConfig.appPackage").hasError("required")&&i.mobileAppSettingsForm.get("androidConfig.appPackage").touched)}}function mm(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-icon",30),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275text(2," warning "),e.\u0275\u0275elementEnd()),2&a&&e.\u0275\u0275property("matTooltip",e.\u0275\u0275pipeBind1(1,1,"admin.mobile-app.sha256-certificate-fingerprints-required"))}function um(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",24)(1,"div",25)(2,"div",26),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"mat-form-field",27),e.\u0275\u0275element(6,"input",31),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275template(8,mm,3,3,"mat-icon",29),e.\u0275\u0275elementEnd()()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,3,"admin.mobile-app.sha256-certificate-fingerprints")),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(7,5,"admin.mobile-app.set")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.mobileAppSettingsForm.get("androidConfig.sha256CertFingerprints").hasError("required")&&i.mobileAppSettingsForm.get("androidConfig.sha256CertFingerprints").touched)}}function gm(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-icon",30),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275text(2," warning "),e.\u0275\u0275elementEnd()),2&a&&e.\u0275\u0275property("matTooltip",e.\u0275\u0275pipeBind1(1,1,"admin.mobile-app.google-play-link-required"))}function fm(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",24)(1,"div",25)(2,"div",26),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"mat-form-field",27),e.\u0275\u0275element(6,"input",32),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275template(8,gm,3,3,"mat-icon",29),e.\u0275\u0275elementEnd()()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,3,"admin.mobile-app.google-play-link")),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(7,5,"admin.mobile-app.set")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.mobileAppSettingsForm.get("androidConfig.storeLink").hasError("required")&&i.mobileAppSettingsForm.get("androidConfig.storeLink").touched)}}function hm(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-icon",30),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275text(2," warning "),e.\u0275\u0275elementEnd()),2&a&&e.\u0275\u0275property("matTooltip",e.\u0275\u0275pipeBind1(1,1,"admin.mobile-app.app-id-required"))}function bm(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",24)(1,"div",25)(2,"div",26),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"mat-form-field",27),e.\u0275\u0275element(6,"input",33),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275template(8,hm,3,3,"mat-icon",29),e.\u0275\u0275elementEnd()()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,3,"admin.mobile-app.app-id")),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(7,5,"admin.mobile-app.set")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.mobileAppSettingsForm.get("iosConfig.appId").hasError("required")&&i.mobileAppSettingsForm.get("iosConfig.appId").touched)}}function ym(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-icon",30),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275text(2," warning "),e.\u0275\u0275elementEnd()),2&a&&e.\u0275\u0275property("matTooltip",e.\u0275\u0275pipeBind1(1,1,"admin.mobile-app.app-store-link-required"))}function vm(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",24)(1,"div",25)(2,"div",26),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"mat-form-field",27),e.\u0275\u0275element(6,"input",32),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275template(8,ym,3,3,"mat-icon",29),e.\u0275\u0275elementEnd()()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,3,"admin.mobile-app.app-store-link")),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(7,5,"admin.mobile-app.set")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.mobileAppSettingsForm.get("iosConfig.storeLink").hasError("required")&&i.mobileAppSettingsForm.get("iosConfig.storeLink").touched)}}function Cm(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",10),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit;e.\u0275\u0275property("value",i.key),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,i.value)," ")}}function xm(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",34)(1,"div",35)(2,"mat-slide-toggle",36),e.\u0275\u0275listener("click",function(o){return e.\u0275\u0275restoreView(i),e.\u0275\u0275resetView(o.stopPropagation())}),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"mat-form-field",27)(6,"mat-select",37),e.\u0275\u0275template(7,Cm,3,4,"mat-option",38),e.\u0275\u0275pipe(8,"keyvalue"),e.\u0275\u0275elementEnd()()()()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,2,"admin.mobile-app.badges")," "),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(8,4,i.badgePositionTranslationsMap))}}function _m(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-icon",30),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275text(2," warning "),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("matTooltip",e.\u0275\u0275pipeBind1(1,1,i.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").hasError("required")?"admin.mobile-app.label-required":"admin.mobile-app.label-max-length"))}}function Sm(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",34)(1,"div",35)(2,"mat-slide-toggle",39),e.\u0275\u0275listener("click",function(o){return e.\u0275\u0275restoreView(i),e.\u0275\u0275resetView(o.stopPropagation())}),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"mat-form-field",27),e.\u0275\u0275element(6,"input",40),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275template(8,_m,3,3,"mat-icon",29),e.\u0275\u0275elementEnd()()()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,3,"admin.mobile-app.label")," "),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(7,5,"admin.mobile-app.set")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").touched&&i.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").hasError("required")||i.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").hasError("maxlength"))}}function Tm(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",41)(1,"div",8),e.\u0275\u0275text(2,"admin.mobile-app.preview"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"tb-mobile-app-qrcode-widget",42),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275property("mobileAppSettings",i.mobileAppSettingsForm.getRawValue())}}class Ia extends de.H{constructor(t,i,n){super(t),this.store=t,this.mobileAppService=i,this.fb=n,this.destroy$=new fe.B,this.badgePositionTranslationsMap=Xr.W,this.buildMobileAppSettingsForm(),this.mobileAppService.getMobileAppSettings().subscribe(o=>this.processMobileAppSettings(o)),this.mobileAppSettingsForm.get("useDefaultApp").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(o=>{o?(this.mobileAppSettingsForm.get("androidConfig.appPackage").disable({emitEvent:!1}),this.mobileAppSettingsForm.get("androidConfig.sha256CertFingerprints").disable({emitEvent:!1}),this.mobileAppSettingsForm.get("androidConfig.storeLink").disable({emitEvent:!1}),this.mobileAppSettingsForm.get("iosConfig.appId").disable({emitEvent:!1}),this.mobileAppSettingsForm.get("iosConfig.storeLink").disable({emitEvent:!1})):(this.mobileAppSettingsForm.get("androidConfig.enabled").value&&(this.mobileAppSettingsForm.get("androidConfig.appPackage").enable({emitEvent:!1}),this.mobileAppSettingsForm.get("androidConfig.sha256CertFingerprints").enable({emitEvent:!1}),this.mobileAppSettingsForm.get("androidConfig.storeLink").enable({emitEvent:!1})),this.mobileAppSettingsForm.get("iosConfig.enabled").value&&(this.mobileAppSettingsForm.get("iosConfig.appId").enable({emitEvent:!1}),this.mobileAppSettingsForm.get("iosConfig.storeLink").enable({emitEvent:!1})))}),this.mobileAppSettingsForm.get("androidConfig.enabled").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(o=>{this.androidEnableChanged(o)}),this.mobileAppSettingsForm.get("iosConfig.enabled").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(o=>{this.iosEnableChanged(o)}),this.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(o=>{o?this.mobileAppSettingsForm.get("qrCodeConfig").enable({emitEvent:!1}):(this.mobileAppSettingsForm.get("qrCodeConfig").disable({emitEvent:!1}),this.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").enable({emitEvent:!1})),this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").updateValueAndValidity({onlySelf:!0}),this.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabelEnabled").updateValueAndValidity({onlySelf:!0})}),this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(o=>{o?this.mobileAppSettingsForm.get("androidConfig.enabled").value||this.mobileAppSettingsForm.get("iosConfig.enabled").value?(this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").enable({emitEvent:!1}),this.mobileAppSettingsForm.get("qrCodeConfig.badgePosition").enable({emitEvent:!1})):(this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").disable({emitEvent:!1}),this.mobileAppSettingsForm.get("qrCodeConfig.badgePosition").disable({emitEvent:!1})):this.mobileAppSettingsForm.get("qrCodeConfig.badgePosition").disable({emitEvent:!1})}),this.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabelEnabled").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(o=>{o&&this.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").value?this.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").enable({emitEvent:!1}):this.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").disable({emitEvent:!1})})}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}buildMobileAppSettingsForm(){this.mobileAppSettingsForm=this.fb.group({useDefaultApp:[!0],androidConfig:this.fb.group({enabled:[!0],appPackage:[{value:"",disabled:!0},[s.Validators.required]],sha256CertFingerprints:[{value:"",disabled:!0},[s.Validators.required]],storeLink:["",[s.Validators.required]]}),iosConfig:this.fb.group({enabled:[!0],appId:[{value:"",disabled:!0},[s.Validators.required]],storeLink:["",[s.Validators.required]]}),qrCodeConfig:this.fb.group({showOnHomePage:[!0],badgeEnabled:[!0],badgePosition:[Xr.D.RIGHT],qrCodeLabelEnabled:[!0],qrCodeLabel:["",[s.Validators.required,s.Validators.maxLength(50)]]})})}processMobileAppSettings(t){this.mobileAppSettings={...t},this.mobileAppSettingsForm.reset(this.mobileAppSettings)}androidEnableChanged(t){t?this.mobileAppSettingsForm.get("useDefaultApp").value||(this.mobileAppSettingsForm.get("androidConfig.appPackage").enable({emitEvent:!1}),this.mobileAppSettingsForm.get("androidConfig.sha256CertFingerprints").enable({emitEvent:!1}),this.mobileAppSettingsForm.get("androidConfig.storeLink").enable({emitEvent:!1})):(this.mobileAppSettingsForm.get("androidConfig.appPackage").disable({emitEvent:!1}),this.mobileAppSettingsForm.get("androidConfig.sha256CertFingerprints").disable({emitEvent:!1}),this.mobileAppSettingsForm.get("androidConfig.storeLink").disable({emitEvent:!1})),this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").updateValueAndValidity({onlySelf:!0})}iosEnableChanged(t){t?this.mobileAppSettingsForm.get("useDefaultApp").value||(this.mobileAppSettingsForm.get("iosConfig.appId").enable({emitEvent:!1}),this.mobileAppSettingsForm.get("iosConfig.storeLink").enable({emitEvent:!1})):(this.mobileAppSettingsForm.get("iosConfig.appId").disable({emitEvent:!1}),this.mobileAppSettingsForm.get("iosConfig.storeLink").disable({emitEvent:!1})),this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").updateValueAndValidity({onlySelf:!0})}save(){const t=this.mobileAppSettings.qrCodeConfig.showOnHomePage;this.mobileAppSettings={...this.mobileAppSettings,...this.mobileAppSettingsForm.getRawValue()},this.mobileAppService.saveMobileAppSettings(this.mobileAppSettings).subscribe(i=>{const n=i.qrCodeConfig.showOnHomePage;t!==n&&this.store.dispatch(new Ko.bw({mobileQrEnabled:n})),this.processMobileAppSettings(i)})}confirmForm(){return this.mobileAppSettingsForm}static{this.\u0275fac=function(i){return new(i||Ia)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(rm.i),e.\u0275\u0275directiveInject(s.FormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Ia,selectors:[["tb-mobile-app-settings"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:56,vars:43,consts:[["appearance","outlined",1,"settings-card"],["translate","",1,"mat-headline-5"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[2,"padding-top","16px"],[1,"tb-form-panel","no-border","no-padding",3,"formGroup"],[1,"tb-form-panel"],[1,"tb-form-row","column-xs","no-border","no-padding","space-between"],["translate","",1,"tb-form-panel-title"],["formControlName","useDefaultApp"],[3,"value"],["formGroupName","androidConfig",1,"tb-form-panel","stroked","no-padding","no-gap"],[1,"tb-form-row","no-border","no-padding-bottom"],["formControlName","enabled",1,"mat-slide",3,"click"],["class","tb-form-panel no-border no-padding-top",4,"ngIf"],["formGroupName","iosConfig",1,"tb-form-panel","stroked","no-padding","no-gap"],["formGroupName","qrCodeConfig",1,"tb-form-panel"],["formControlName","showOnHomePage"],["class","tb-form-panel stroked no-padding no-gap",4,"ngIf"],["class","tb-form-panel tb-qrcode-preview",4,"ngIf"],[1,"tb-flex","row","flex-end",2,"margin-top","16px"],["mat-button","","mat-raised-button","","color","primary",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[1,"tb-form-panel","no-border","no-padding-top"],[1,"tb-form-row","column-xs"],[1,"fixed-title-width-230"],["appearance","outline","subscriptSizing","dynamic",1,"flex"],["matInput","","formControlName","appPackage",3,"placeholder"],["matSuffix","","matTooltipPosition","above","matTooltipClass","tb-error-tooltip","class","tb-error",3,"matTooltip",4,"ngIf"],["matSuffix","","matTooltipPosition","above","matTooltipClass","tb-error-tooltip",1,"tb-error",3,"matTooltip"],["matInput","","formControlName","sha256CertFingerprints",3,"placeholder"],["matInput","","formControlName","storeLink",3,"placeholder"],["matInput","","formControlName","appId",3,"placeholder"],[1,"tb-form-panel","stroked","no-padding","no-gap"],[1,"tb-form-row","space-between","no-border","no-padding-bottom","column-xs"],["formControlName","badgeEnabled",1,"mat-slide","fixed-title-width-230",3,"click"],["formControlName","badgePosition","appearance","outline","subscriptSizing","dynamic"],[3,"value",4,"ngFor","ngForOf"],["formControlName","qrCodeLabelEnabled",1,"mat-slide","fixed-title-width-230",3,"click"],["matInput","","formControlName","qrCodeLabel",3,"placeholder"],[1,"tb-form-panel","tb-qrcode-preview"],[3,"mobileAppSettings"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title")(3,"span",1),e.\u0275\u0275text(4,"admin.mobile-app.mobile-app-qr-code-widget-settings"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(5,lm,1,0,"mat-progress-bar",2),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275template(7,dm,1,0,"div",3),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementStart(9,"mat-card-content",4)(10,"div",5)(11,"div",6)(12,"div",7)(13,"div",8),e.\u0275\u0275text(14,"admin.mobile-app.applications"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"tb-toggle-select",9)(16,"tb-toggle-option",10),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"tb-toggle-option",10),e.\u0275\u0275text(20),e.\u0275\u0275pipe(21,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(22,"div",11)(23,"div",12)(24,"mat-slide-toggle",13),e.\u0275\u0275listener("click",function(r){return r.stopPropagation()}),e.\u0275\u0275text(25),e.\u0275\u0275pipe(26,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(27,pm,9,7,"div",14)(28,um,9,7,"div",14)(29,fm,9,7,"div",14),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(30,"div",15)(31,"div",12)(32,"mat-slide-toggle",13),e.\u0275\u0275listener("click",function(r){return r.stopPropagation()}),e.\u0275\u0275text(33),e.\u0275\u0275pipe(34,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(35,bm,9,7,"div",14)(36,vm,9,7,"div",14),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(37,"div",16)(38,"div",7)(39,"div",8),e.\u0275\u0275text(40,"admin.mobile-app.appearance-on-home-page"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(41,"tb-toggle-select",17)(42,"tb-toggle-option",10),e.\u0275\u0275text(43),e.\u0275\u0275pipe(44,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(45,"tb-toggle-option",10),e.\u0275\u0275text(46),e.\u0275\u0275pipe(47,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(48,xm,9,6,"div",18)(49,Sm,9,7,"div",18)(50,Tm,4,1,"div",19),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(51,"div",20)(52,"button",21),e.\u0275\u0275pipe(53,"async"),e.\u0275\u0275listener("click",function(){return n.save()}),e.\u0275\u0275text(54),e.\u0275\u0275pipe(55,"translate"),e.\u0275\u0275elementEnd()()()()),2&i&&(e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(6,23,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(8,25,n.isLoading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("formGroup",n.mobileAppSettingsForm),e.\u0275\u0275advance(6),e.\u0275\u0275property("value",!0),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(18,27,"admin.mobile-app.default")),e.\u0275\u0275advance(2),e.\u0275\u0275property("value",!1),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(21,29,"admin.mobile-app.custom")),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(26,31,"admin.mobile-app.android")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.mobileAppSettingsForm.get("useDefaultApp").value&&n.mobileAppSettingsForm.get("androidConfig.enabled").value),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n.mobileAppSettingsForm.get("useDefaultApp").value&&n.mobileAppSettingsForm.get("androidConfig.enabled").value),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n.mobileAppSettingsForm.get("useDefaultApp").value&&n.mobileAppSettingsForm.get("androidConfig.enabled").value),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(34,33,"admin.mobile-app.ios")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.mobileAppSettingsForm.get("useDefaultApp").value&&n.mobileAppSettingsForm.get("iosConfig.enabled").value),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n.mobileAppSettingsForm.get("useDefaultApp").value&&n.mobileAppSettingsForm.get("iosConfig.enabled").value),e.\u0275\u0275advance(6),e.\u0275\u0275property("value",!0),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(44,35,"admin.mobile-app.enabled")),e.\u0275\u0275advance(2),e.\u0275\u0275property("value",!1),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(47,37,"admin.mobile-app.disabled")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").value),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").value),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").value),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(53,39,n.isLoading$)||n.mobileAppSettingsForm.invalid||!n.mobileAppSettingsForm.dirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(55,41,"action.save")," "))},dependencies:[p.NgForOf,p.NgIf,x.MatButton,E.MatIcon,D.MatCard,D.MatCardContent,D.MatCardHeader,D.MatCardTitle,K.MatProgressBar,L.MatInput,v.MatFormField,v.MatSuffix,ce.MatSelect,z.MatOption,_e.MatTooltip,pe.MatSlideToggle,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.FormGroupDirective,s.FormControlName,s.FormGroupName,u.TranslateDirective,sn.ToggleOption,ea.ToggleSelectComponent,sm.p,p.AsyncPipe,p.KeyValuePipe,u.TranslatePipe],styles:['@charset "UTF-8";.tb-qrcode-preview[_ngcontent-%COMP%]{background-color:#0000000a;box-shadow:none}.tb-qrcode-preview[_ngcontent-%COMP%]   .tb-form-panel-title[_ngcontent-%COMP%]{color:#00000061}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']})}}var fn=d(95435);const Im=()=>({standalone:!0});function wm(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.client-title-required")," "))}function Em(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.client-title-max-length")," "))}function Mm(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",17),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit;e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",i," ")}}function Nm(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",17),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.platformTypeTranslations.get(i))," ")}}function Am(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.client-id-required")," "))}function Fm(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.client-id-max-length")," "))}function Dm(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.client-secret-required")," "))}function Pm(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.client-secret-max-length")," "))}function km(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.access-token-uri-required")," "))}function Lm(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.uri-pattern-error")," "))}function Om(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.authorization-uri-required")," "))}function Rm(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.uri-pattern-error")," "))}function Vm(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.uri-pattern-error")," "))}function Bm(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.uri-pattern-error")," "))}function Gm(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",17),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"uppercase"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit;e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,i)," ")}}function jm(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.login-button-label-required")," "))}function Um(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",6)(1,"mat-form-field",10)(2,"mat-label",3),e.\u0275\u0275text(3,"admin.oauth2.login-button-label"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"input",35),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275template(6,jm,3,3,"mat-error",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"mat-form-field",2)(8,"mat-label",3),e.\u0275\u0275text(9,"admin.oauth2.login-button-icon"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(10,"input",36),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(5,2,"admin.oauth2.login-button-label-placeholder")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.entityForm.get("loginButtonLabel").hasError("required"))}}function qm(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"section",23)(1,"div",6)(2,"mat-form-field",2)(3,"mat-label",3),e.\u0275\u0275text(4,"admin.oauth2.access-token-uri"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"input",24),e.\u0275\u0275template(6,km,3,3,"mat-error",5)(7,Lm,3,3,"mat-error",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"mat-form-field",2)(9,"mat-label",3),e.\u0275\u0275text(10,"admin.oauth2.authorization-uri"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(11,"input",25),e.\u0275\u0275template(12,Om,3,3,"mat-error",5)(13,Rm,3,3,"mat-error",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(14,"div",6)(15,"mat-form-field",2)(16,"mat-label",3),e.\u0275\u0275text(17,"admin.oauth2.jwk-set-uri"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(18,"input",26),e.\u0275\u0275template(19,Vm,3,3,"mat-error",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"mat-form-field",2)(21,"mat-label",3),e.\u0275\u0275text(22,"admin.oauth2.user-info-uri"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(23,"input",27),e.\u0275\u0275template(24,Bm,3,3,"mat-error",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(25,"div",1)(26,"mat-form-field",2)(27,"mat-label",3),e.\u0275\u0275text(28,"admin.oauth2.client-authentication-method"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(29,"mat-select",28),e.\u0275\u0275template(30,Gm,3,4,"mat-option",9),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(31,Um,11,4,"div",29),e.\u0275\u0275elementStart(32,"section",30)(33,"div",31)(34,"mat-slide-toggle",32),e.\u0275\u0275text(35),e.\u0275\u0275pipe(36,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(37,"div",31)(38,"mat-slide-toggle",33),e.\u0275\u0275text(39),e.\u0275\u0275pipe(40,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(41,"tb-string-items-list",34),e.\u0275\u0275pipe(42,"translate"),e.\u0275\u0275pipe(43,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",i.entityForm.get("accessTokenUri").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.entityForm.get("accessTokenUri").hasError("pattern")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.entityForm.get("authorizationUri").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.entityForm.get("authorizationUri").hasError("pattern")),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",i.entityForm.get("jwkSetUri").hasError("pattern")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.entityForm.get("userInfoUri").hasError("pattern")),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",i.clientAuthenticationMethods),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.isCustomProvider()),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(36,12,"admin.oauth2.allow-user-creation")," "),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(40,14,"admin.oauth2.activate-user")," "),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(42,16,"admin.oauth2.scope")),e.\u0275\u0275propertyInterpolate("requiredText",e.\u0275\u0275pipeBind1(43,18,"admin.oauth2.scope-required"))}}function Wm(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.user-name-attribute-name-required")," "))}function $m(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",17),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit;e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",i," ")}}function zm(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.email-attribute-key-required")," "))}function Hm(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.email-attribute-key-max-length")," "))}function Km(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",1)(1,"mat-form-field",2)(2,"mat-label",3),e.\u0275\u0275text(3,"admin.oauth2.email-attribute-key"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"input",52),e.\u0275\u0275template(5,zm,3,3,"mat-error",5)(6,Hm,3,3,"mat-error",5),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.entityForm.get("mapperConfig.basic.emailAttributeKey").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.entityForm.get("mapperConfig.basic.emailAttributeKey").hasError("maxlength"))}}function Ym(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.first-name-attribute-key-max-length")," "))}function Qm(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.last-name-attribute-key-max-length")," "))}function Jm(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",17),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit;e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",i," ")}}function Zm(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.tenant-name-pattern-required")," "))}function Xm(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.tenant-name-pattern-max-length")," "))}function eu(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.customer-name-pattern-max-length")," "))}function tu(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.default-dashboard-name-max-length")," "))}function nu(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"section",43),e.\u0275\u0275template(1,Km,7,2,"div",44),e.\u0275\u0275elementStart(2,"div",6)(3,"mat-form-field",2)(4,"mat-label",3),e.\u0275\u0275text(5,"admin.oauth2.first-name-attribute-key"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(6,"input",45),e.\u0275\u0275template(7,Ym,3,3,"mat-error",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"mat-form-field",2)(9,"mat-label",3),e.\u0275\u0275text(10,"admin.oauth2.last-name-attribute-key"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(11,"input",46),e.\u0275\u0275template(12,Qm,3,3,"mat-error",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(13,"div",6)(14,"mat-form-field",2)(15,"mat-label",3),e.\u0275\u0275text(16,"admin.oauth2.tenant-name-strategy"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"mat-select",47),e.\u0275\u0275template(18,Jm,2,2,"mat-option",9),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(19,"mat-form-field",2)(20,"mat-label",3),e.\u0275\u0275text(21,"admin.oauth2.tenant-name-pattern"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(22,"input",48),e.\u0275\u0275template(23,Zm,3,3,"mat-error",5)(24,Xm,3,3,"mat-error",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(25,"div",1)(26,"mat-form-field",2)(27,"mat-label",3),e.\u0275\u0275text(28,"admin.oauth2.customer-name-pattern"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(29,"input",49),e.\u0275\u0275template(30,eu,3,3,"mat-error",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(31,"div",6)(32,"mat-form-field",2)(33,"mat-label",3),e.\u0275\u0275text(34,"admin.oauth2.default-dashboard-name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(35,"input",50),e.\u0275\u0275template(36,tu,3,3,"mat-error",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(37,"mat-slide-toggle",51),e.\u0275\u0275text(38),e.\u0275\u0275pipe(39,"translate"),e.\u0275\u0275elementEnd()()()),2&a){const i=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.entityForm.get("mapperConfig.type").value!==i.mapperType.GITHUB),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",i.entityForm.get("mapperConfig.basic.firstNameAttributeKey").hasError("maxlength")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.entityForm.get("mapperConfig.basic.lastNameAttributeKey").hasError("maxlength")),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",i.tenantNameStrategies),e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden","CUSTOM"!==i.entityForm.get("mapperConfig.basic.tenantNameStrategy").value),e.\u0275\u0275advance(3),e.\u0275\u0275property("required","CUSTOM"===i.entityForm.get("mapperConfig.basic.tenantNameStrategy").value),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.entityForm.get("mapperConfig.basic.tenantNamePattern").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.entityForm.get("mapperConfig.basic.tenantNamePattern").hasError("maxlength")),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",i.entityForm.get("mapperConfig.basic.customerNamePattern").hasError("maxlength")),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",i.entityForm.get("mapperConfig.basic.defaultDashboardName").hasError("maxlength")),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(39,12,"admin.oauth2.always-fullscreen")," ")}}function iu(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.url-required")," "))}function au(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.url-pattern")," "))}function ou(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.url-max-length")," "))}function ru(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.username-max-length")," "))}function su(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.password-max-length")," "))}function lu(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"section",53)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),e.\u0275\u0275text(4,"admin.oauth2.url"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"input",54),e.\u0275\u0275template(6,iu,3,3,"mat-error",5)(7,au,3,3,"mat-error",5)(8,ou,3,3,"mat-error",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(9,"div",6)(10,"mat-form-field",2)(11,"mat-label",3),e.\u0275\u0275text(12,"common.username"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(13,"input",55),e.\u0275\u0275template(14,ru,3,3,"mat-error",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"mat-form-field",2)(16,"mat-label",3),e.\u0275\u0275text(17,"common.password"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(18,"input",56),e.\u0275\u0275template(19,su,3,3,"mat-error",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(20,"mat-slide-toggle",57),e.\u0275\u0275text(21),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",i.entityForm.get("mapperConfig.custom.url").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.entityForm.get("mapperConfig.custom.url").hasError("pattern")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.entityForm.get("mapperConfig.custom.url").hasError("maxlength")),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",i.entityForm.get("mapperConfig.custom.username").hasError("maxlength")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.entityForm.get("mapperConfig.custom.password").hasError("maxlength")),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(22,6,"admin.oauth2.send-token")," ")}}function du(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"section",37)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),e.\u0275\u0275text(4,"admin.oauth2.user-name-attribute-name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"input",38),e.\u0275\u0275template(6,Wm,3,3,"mat-error",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(7,"section",39)(8,"div",1)(9,"mat-form-field",2)(10,"mat-label",3),e.\u0275\u0275text(11,"admin.oauth2.type"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"mat-select",40),e.\u0275\u0275template(13,$m,2,2,"mat-option",9),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(14,nu,40,14,"section",41)(15,lu,23,8,"section",42),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",i.entityForm.get("userNameAttributeName").hasError("required")),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngForOf",i.mapperTypes),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.entityForm.get("mapperConfig.type").value!==i.mapperType.CUSTOM&&i.entityForm.get("mapperConfig.basic")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.entityForm.get("mapperConfig.type").value===i.mapperType.CUSTOM&&i.entityForm.get("mapperConfig.custom"))}}function cu(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"section",18)(1,"div",19),e.\u0275\u0275element(2,"span"),e.\u0275\u0275elementStart(3,"tb-toggle-select",20),e.\u0275\u0275twoWayListener("ngModelChange",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275twoWayBindingSet(r.generalSettingsMode,o)||(r.generalSettingsMode=o),e.\u0275\u0275resetView(o)}),e.\u0275\u0275elementStart(4,"tb-toggle-option",17),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"tb-toggle-option",17),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(10,qm,44,20,"section",21)(11,du,16,4,"section",22),e.\u0275\u0275elementEnd()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275twoWayProperty("ngModel",i.generalSettingsMode),e.\u0275\u0275property("ngModelOptions",e.\u0275\u0275pureFunction0(12,Im)),e.\u0275\u0275advance(),e.\u0275\u0275property("value",!0),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(6,8,"admin.oauth2.general")),e.\u0275\u0275advance(2),e.\u0275\u0275property("value",!1),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,10,"admin.oauth2.mapper")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.generalSettingsMode),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!i.generalSettingsMode)}}class Vt extends xe.l{constructor(t,i,n,o,r,l,c){super(t,c,o,r,l),this.store=t,this.translate=i,this.oauth2Service=n,this.entityValue=o,this.entitiesTableConfigValue=r,this.cd=l,this.fb=c,this.createNewDialog=!1,this.templateProvider=["Custom"],this.templates=new Map,this.defaultProvider={additionalInfo:{providerName:"Custom"},clientAuthenticationMethod:J.Pg.POST,userNameAttributeName:"email",mapperConfig:{allowUserCreation:!0,activateUser:!1,type:J.Qf.BASIC,basic:{emailAttributeKey:"email",tenantNameStrategy:J.Vj.DOMAIN,alwaysFullScreen:!1}}},this.URL_REGEXP=/^[A-Za-z][A-Za-z\d.+-]*:\/*(?:\w+(?::\w+)?@)?[^\s/]+(?::\d+)?(?:\/[\w#!:.,?+=&%@\-/]*)?$/,this.subscriptions=[],this.separatorKeysCodes=[ct.ENTER,ct.COMMA],this.clientAuthenticationMethods=Object.keys(J.Pg),this.mapperType=J.Qf,this.mapperTypes=Object.keys(J.Qf),this.tenantNameStrategies=Object.keys(J.Vj),this.platformTypes=Object.values(J.Yw),this.platformTypeTranslations=J.e3,this.generalSettingsMode=!0,this.advancedExpanded=!1,this.oauth2Service.getOAuth2Template().subscribe(m=>{this.initTemplates(m)})}ngOnDestroy(){super.ngOnDestroy(),this.subscriptions.forEach(t=>{t.unsubscribe()})}buildForm(t){return this.fb.group({title:[t?.title?t.title:"",[s.Validators.required,s.Validators.maxLength(100)]],additionalInfo:this.fb.group({providerName:[t?.additionalInfo?.providerName?t?.additionalInfo?.providerName:"",s.Validators.required]}),platforms:[t?.platforms?t.platforms:[]],clientId:[t?.clientId?t.clientId:"",[s.Validators.required,s.Validators.maxLength(255)]],clientSecret:[t?.clientSecret?t.clientSecret:"",[s.Validators.required,s.Validators.maxLength(2048)]],accessTokenUri:[t?.accessTokenUri?t.accessTokenUri:"",[s.Validators.required,s.Validators.pattern(this.URL_REGEXP)]],authorizationUri:[t?.authorizationUri?t.authorizationUri:"",[s.Validators.required,s.Validators.pattern(this.URL_REGEXP)]],jwkSetUri:[t?.jwkSetUri?t.jwkSetUri:"",s.Validators.pattern(this.URL_REGEXP)],userInfoUri:[t?.userInfoUri?t.userInfoUri:"",[s.Validators.pattern(this.URL_REGEXP)]],clientAuthenticationMethod:[t?.clientAuthenticationMethod?t.clientAuthenticationMethod:J.Pg.POST,s.Validators.required],loginButtonLabel:[t?.loginButtonLabel?t.loginButtonLabel:null,s.Validators.required],loginButtonIcon:[t?.loginButtonIcon?t.loginButtonIcon:null],userNameAttributeName:[t?.userNameAttributeName?t.userNameAttributeName:"email",s.Validators.required],scope:[t?.scope?t.scope:[],s.Validators.required],mapperConfig:this.fb.group({allowUserCreation:[!(0,_.f1)(t?.mapperConfig?.allowUserCreation)||t.mapperConfig.allowUserCreation],activateUser:[!!(0,_.f1)(t?.mapperConfig?.activateUser)&&t.mapperConfig.activateUser],type:[t?.mapperConfig?.type?t.mapperConfig.type:J.Qf.BASIC,s.Validators.required]})})}updateForm(t){this.entityForm.patchValue({title:t.title,additionalInfo:{providerName:t.additionalInfo.providerName},platforms:t.platforms,clientId:t.clientId,clientSecret:t.clientSecret,accessTokenUri:t.accessTokenUri,scope:t.scope,authorizationUri:t.authorizationUri,jwkSetUri:t.jwkSetUri,userInfoUri:t.userInfoUri,clientAuthenticationMethod:t.clientAuthenticationMethod,loginButtonLabel:t.loginButtonLabel,loginButtonIcon:t.loginButtonIcon,userNameAttributeName:t.userNameAttributeName,mapperConfig:{allowUserCreation:t.mapperConfig.allowUserCreation,activateUser:t.mapperConfig.activateUser,type:t.mapperConfig.type}},{emitEvent:!1}),this.changeMapperConfigType(this.entityForm,this.entityValue.mapperConfig.type,this.entityValue.mapperConfig)}getProviderName(){return this.entityForm.get("additionalInfo.providerName").value}isCustomProvider(){return"Custom"===this.getProviderName()}initTemplates(t){t.map(o=>{delete o.additionalInfo,this.templates.set(o.name,o)}),this.templateProvider.push(...Array.from(this.templates.keys())),this.templateProvider.sort();let i=null;(0,_.f1)(this.entityValue?.additionalInfo)&&(i=this.entityValue.additionalInfo,-1===this.templateProvider.indexOf(i.providerName)&&(i.providerName="Custom"));let n="Custom";this.templateProvider.indexOf("Google")&&(n="Google"),this.entityForm.get("additionalInfo.providerName").setValue(i?.providerName?i?.providerName:n),this.changeMapperConfigType(this.entityForm,J.Qf.BASIC),this.setProviderDefaultValue(n,this.entityForm),this.subscriptions.push(this.entityForm.get("mapperConfig.type").valueChanges.subscribe(o=>{this.changeMapperConfigType(this.entityForm,o)})),this.subscriptions.push(this.entityForm.get("additionalInfo.providerName").valueChanges.subscribe(o=>{this.entityForm.get("scope").setValue([]),this.setProviderDefaultValue(o,this.entityForm)}))}changeMapperConfigType(t,i,n){const o=t.get("mapperConfig");i===J.Qf.CUSTOM?(o.removeControl("basic"),o.addControl("custom",this.formCustomGroup(n?.custom))):(o.removeControl("custom"),o.get("basic")?n?.basic&&(o.get("basic").patchValue(n.basic,{emitEvent:!1}),o.get("basic.tenantNameStrategy").updateValueAndValidity({onlySelf:!0})):o.addControl("basic",this.formBasicGroup(n?.basic)),i===J.Qf.GITHUB?(o.get("basic.emailAttributeKey").disable(),o.get("basic.emailAttributeKey").patchValue(null,{emitEvent:!1})):(this.createNewDialog||this.isEdit||this.isAdd)&&o.get("basic.emailAttributeKey").enable())}formCustomGroup(t){const i=this.fb.group({url:[t?.url?t.url:null,[s.Validators.required,s.Validators.pattern(this.URL_REGEXP),s.Validators.maxLength(255)]],username:[t?.username?t.username:null,s.Validators.maxLength(255)],password:[t?.password?t.password:null,s.Validators.maxLength(255)],sendToken:[!!(0,_.f1)(t?.sendToken)&&t.sendToken]});return!this.createNewDialog&&!(this.isEdit||this.isAdd)&&i.disable(),i}formBasicGroup(t){let i;i=t?.tenantNamePattern?t.tenantNamePattern:{value:null,disabled:!0};const n=this.fb.group({emailAttributeKey:[t?.emailAttributeKey?t.emailAttributeKey:"email",[s.Validators.required,s.Validators.maxLength(31)]],firstNameAttributeKey:[t?.firstNameAttributeKey?t.firstNameAttributeKey:"",s.Validators.maxLength(31)],lastNameAttributeKey:[t?.lastNameAttributeKey?t.lastNameAttributeKey:"",s.Validators.maxLength(31)],tenantNameStrategy:[t?.tenantNameStrategy?t.tenantNameStrategy:J.Vj.DOMAIN],tenantNamePattern:[i,[s.Validators.required,s.Validators.maxLength(255)]],customerNamePattern:[t?.customerNamePattern?t.customerNamePattern:null,s.Validators.maxLength(255)],defaultDashboardName:[t?.defaultDashboardName?t.defaultDashboardName:null,s.Validators.maxLength(255)],alwaysFullScreen:[!!(0,_.f1)(t?.alwaysFullScreen)&&t.alwaysFullScreen]});return!this.createNewDialog&&!(this.isEdit||this.isAdd)&&n.disable(),this.subscriptions.push(n.get("tenantNameStrategy").valueChanges.subscribe(o=>{"CUSTOM"===o&&(this.createNewDialog||this.isEdit||this.isAdd)?n.get("tenantNamePattern").enable():n.get("tenantNamePattern").disable()})),n}setProviderDefaultValue(t,i){if("Custom"===t){const n=i.get("title").value;i.reset(this.defaultProvider,{emitEvent:!1}),i.patchValue({title:n},{emitEvent:!1}),this.advancedExpanded=!0}else{const n=this.templates.get(t);n.clientId="",n.clientSecret="",i.patchValue(n)}}static{this.\u0275fac=function(i){return new(i||Vt)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(fn.P),e.\u0275\u0275directiveInject("entity",8),e.\u0275\u0275directiveInject("entitiesTableConfig",8),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Vt,selectors:[["tb-client"]],inputs:{createNewDialog:"createNewDialog"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:39,vars:15,consts:[[1,"tb-form-panel","no-gap","no-border",3,"formGroup"],[1,"tb-form-row","tb-standard-fields","no-border","no-padding"],[1,"flex"],["translate",""],["matInput","","formControlName","title"],[4,"ngIf"],[1,"tb-form-row","tb-standard-fields","no-border","no-padding","column-xs"],["formGroupName","additionalInfo",1,"tb-flex"],["formControlName","providerName"],[3,"value",4,"ngFor","ngForOf"],["floatLabel","always",1,"flex"],["formControlName","platforms","multiple","",3,"placeholder"],["matInput","","formControlName","clientId"],["matInput","","formControlName","clientSecret"],[1,"configuration-panel","mat-elevation-z0",3,"expanded"],["translate","",1,"flex","items-center","justify-start"],["matExpansionPanelContent",""],[3,"value"],[1,"tb-form-panel","no-border","no-padding"],[1,"tb-form-row","column-xs","no-border","no-padding","space-between"],["appearance","fill",3,"ngModelChange","ngModel","ngModelOptions"],["class","tb-form-panel no-gap no-border no-padding","style","padding-bottom: 16px",4,"ngIf"],["class","tb-form-panel no-border no-padding no-gap",4,"ngIf"],[1,"tb-form-panel","no-gap","no-border","no-padding",2,"padding-bottom","16px"],["matInput","","formControlName","accessTokenUri"],["matInput","","formControlName","authorizationUri","required",""],["matInput","","formControlName","jwkSetUri"],["matInput","","formControlName","userInfoUri"],["formControlName","clientAuthenticationMethod"],["class","tb-form-row tb-standard-fields no-border no-padding column-xs",4,"ngIf"],["formGroupName","mapperConfig",2,"margin-bottom","22px"],[1,"tb-form-row","no-border","no-padding"],["formControlName","allowUserCreation",1,"mat-slide"],["formControlName","activateUser",1,"mat-slide"],["formControlName","scope","required","",3,"label","requiredText"],["matInput","","formControlName","loginButtonLabel",3,"placeholder"],["matInput","","formControlName","loginButtonIcon"],[1,"tb-form-panel","no-border","no-padding","no-gap"],["matInput","","formControlName","userNameAttributeName"],["formGroupName","mapperConfig",1,"tb-form-panel","no-border","no-padding","no-gap"],["formControlName","type"],["class","tb-form-panel no-border no-padding no-gap","formGroupName","basic",4,"ngIf"],["class","tb-form-panel no-border no-padding no-gap","formGroupName","custom",4,"ngIf"],["formGroupName","basic",1,"tb-form-panel","no-border","no-padding","no-gap"],["class","tb-form-row tb-standard-fields no-border no-padding",4,"ngIf"],["matInput","","formControlName","firstNameAttributeKey"],["matInput","","formControlName","lastNameAttributeKey"],["formControlName","tenantNameStrategy"],["matInput","","formControlName","tenantNamePattern",3,"required"],["matInput","","formControlName","customerNamePattern"],["matInput","","formControlName","defaultDashboardName"],["formControlName","alwaysFullScreen",1,"tb-flex","mat-slide",2,"margin-bottom","16px"],["matInput","","formControlName","emailAttributeKey"],["formGroupName","custom",1,"tb-form-panel","no-border","no-padding","no-gap"],["matInput","","formControlName","url"],["matInput","","formControlName","username","autocomplete","new-username"],["matInput","","formControlName","password","autocomplete","new-password"],["formControlName","sendToken",1,"tb-flex","mat-slide",2,"margin-bottom","16px"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"section",0)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),e.\u0275\u0275text(4,"admin.oauth2.title"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"input",4),e.\u0275\u0275template(6,wm,3,3,"mat-error",5)(7,Em,3,3,"mat-error",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(8,"div",6)(9,"div",7)(10,"mat-form-field",2)(11,"mat-label",3),e.\u0275\u0275text(12,"admin.oauth2.provider"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"mat-select",8),e.\u0275\u0275template(14,Mm,2,2,"mat-option",9),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(15,"mat-form-field",10)(16,"mat-label",3),e.\u0275\u0275text(17,"admin.oauth2.allowed-platforms"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"mat-select",11),e.\u0275\u0275pipe(19,"translate"),e.\u0275\u0275template(20,Nm,3,4,"mat-option",9),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(21,"div",6)(22,"mat-form-field",2)(23,"mat-label",3),e.\u0275\u0275text(24,"admin.oauth2.client-id"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(25,"input",12),e.\u0275\u0275template(26,Am,3,3,"mat-error",5)(27,Fm,3,3,"mat-error",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(28,"mat-form-field",2)(29,"mat-label",3),e.\u0275\u0275text(30,"admin.oauth2.client-secret"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(31,"input",13),e.\u0275\u0275template(32,Dm,3,3,"mat-error",5)(33,Pm,3,3,"mat-error",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(34,"mat-expansion-panel",14)(35,"mat-expansion-panel-header")(36,"mat-panel-title",15),e.\u0275\u0275text(37," admin.oauth2.advanced-settings "),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(38,cu,12,13,"ng-template",16),e.\u0275\u0275elementEnd()()),2&i&&(e.\u0275\u0275classProp("no-padding",n.isAdd),e.\u0275\u0275property("formGroup",n.entityForm),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.entityForm.get("title").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("title").hasError("maxlength")),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngForOf",n.templateProvider),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(19,13,"admin.oauth2.all-platforms")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",n.platformTypes),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.entityForm.get("clientId").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("clientId").hasError("maxlength")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",n.entityForm.get("clientSecret").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("clientSecret").hasError("maxlength")),e.\u0275\u0275advance(),e.\u0275\u0275property("expanded",n.advancedExpanded))},dependencies:[p.NgForOf,p.NgIf,ba.StringItemsListComponent,L.MatInput,v.MatFormField,v.MatLabel,v.MatError,ce.MatSelect,z.MatOption,pe.MatSlideToggle,U.MatExpansionPanel,U.MatExpansionPanelHeader,U.MatExpansionPanelTitle,U.MatExpansionPanelContent,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.NgModel,s.FormGroupDirective,s.FormControlName,s.FormGroupName,u.TranslateDirective,sn.ToggleOption,ea.ToggleSelectComponent,p.UpperCasePipe,u.TranslatePipe],styles:['@charset "UTF-8";  .mat-expansion-panel .mat-expansion-panel-header{height:48px;padding:0 12px}  .mat-expansion-panel .mat-expansion-panel-header.mat-expanded{height:48px}  .mat-expansion-panel .mat-expansion-panel-body{padding:0 12px}  .mat-expansion-panel.configuration-panel{border:1px solid rgba(0,0,0,.2)}']})}}(0,Ge.__decorate)([(0,_a.coerceBoolean)(),(0,Ge.__metadata)("design:type",Object)],Vt.prototype,"createNewDialog",void 0);class wa extends Ne.M{constructor(t){super(t),this.store=t}static{this.\u0275fac=function(i){return new(i||wa)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:wa,selectors:[["tb-client-table-header"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:0,consts:[["tb-help","oauth2Settings",2,"margin-left","-20px"]],template:function(i,n){1&i&&e.\u0275\u0275element(0,"div",0)},dependencies:[be.HelpComponent],encapsulation:2})}}class Bt{constructor(t,i,n){this.translate=t,this.datePipe=i,this.oauth2Service=n,this.config=new y.M7,this.config.tableTitle=this.translate.instant("admin.oauth2.clients"),this.config.selectionEnabled=!1,this.config.entityType=f.ck.OAUTH2_CLIENT,this.config.rowPointer=!0,this.config.entityTranslations=f.Mi.get(f.ck.OAUTH2_CLIENT),this.config.entityResources={helpLinkId:null,helpLinkIdForEntity:o=>(0,J.z9)(o.additionalInfo.providerName)},this.config.entityComponent=Vt,this.config.headerComponent=wa,this.config.addDialogStyle={width:"850px",maxHeight:"100vh"},this.config.defaultSortOrder={property:"createdTime",direction:Pe.O.DESC},this.config.columns.push(new y.Qr("createdTime","common.created-time",this.datePipe,"170px"),new y.KK("title","admin.oauth2.title","350px"),new y.KK("platforms","admin.oauth2.allowed-platforms","100%",o=>o.platforms&&o.platforms.length?o.platforms.map(r=>this.translate.instant(J.e3.get(r))).join(", "):this.translate.instant("admin.oauth2.all-platforms"),()=>({}),!1)),this.config.deleteEntityTitle=o=>this.translate.instant("admin.oauth2.delete-client-title",{clientName:o.title}),this.config.deleteEntityContent=()=>this.translate.instant("admin.oauth2.delete-client-text"),this.config.entitiesFetchFunction=o=>this.oauth2Service.findTenantOAuth2ClientInfos(o),this.config.loadEntity=o=>this.oauth2Service.getOAuth2ClientById(o.id),this.config.saveEntity=o=>this.oauth2Service.saveOAuth2Client(o),this.config.deleteEntity=o=>this.oauth2Service.deleteOauth2Client(o.id)}resolve(){return this.config}static{this.\u0275fac=function(i){return new(i||Bt)(e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(p.DatePipe),e.\u0275\u0275inject(fn.P))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Bt,factory:Bt.\u0275fac})}}var vr=d(15673),Ue=d(72261);class Ea{constructor(t){this.http=t}saveDomain(t,i,n){return this.http.post(`/api/domain?oauth2ClientIds=${i.join(",")}`,t,(0,Ue.eT)(n))}updateOauth2Clients(t,i,n){return this.http.put(`/api/domain/${t}/oauth2Clients`,i,(0,Ue.eT)(n))}getTenantDomainInfos(t,i){return this.http.get(`/api/domain/infos${t.toQuery()}`,(0,Ue.eT)(i))}getDomainInfoById(t,i){return this.http.get(`/api/domain/info/${t}`,(0,Ue.eT)(i))}deleteDomain(t,i){return this.http.delete(`/api/domain/${t}`,(0,Ue.eT)(i))}static{this.\u0275fac=function(i){return new(i||Ea)(e.\u0275\u0275inject(ha.HttpClient))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Ea,factory:Ea.\u0275fac,providedIn:"root"})}}const pu=["clientComponent"];function mu(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",14)}function uu(a,t){1&a&&e.\u0275\u0275element(0,"div",15)}class Gt extends se.m{constructor(t,i,n,o,r){super(t,i,n),this.store=t,this.router=i,this.dialogRef=n,this.oauth2Service=o,this.errorStateMatcher=r,this.submitted=!1}ngAfterViewInit(){setTimeout(()=>{this.clientComponent.entityForm.markAsDirty()},0)}isErrorState(t,i){const n=this.errorStateMatcher.isErrorState(t,i),o=!!(t&&t.invalid&&this.submitted);return n||o}cancel(){this.dialogRef.close(null)}save(){this.submitted=!0,this.clientComponent.entityForm.valid&&this.oauth2Service.saveOAuth2Client(this.clientComponent.entityFormValue()).subscribe(t=>{this.dialogRef.close(t)})}helpLinkId(){return(0,J.z9)(this.clientComponent.entityForm.get("additionalInfo.providerName")?.value)}static{this.\u0275fac=function(i){return new(i||Gt)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(S.MatDialogRef),e.\u0275\u0275directiveInject(fn.P),e.\u0275\u0275directiveInject(z.ErrorStateMatcher,4))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Gt,selectors:[["tb-client-dialog"]],viewQuery:function(i,n){if(1&i&&e.\u0275\u0275viewQuery(pu,7),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.clientComponent=o.first)}},features:[e.\u0275\u0275ProvidersFeature([{provide:z.ErrorStateMatcher,useExisting:Gt}]),e.\u0275\u0275InheritDefinitionFeature],decls:26,vars:22,consts:[["clientComponent",""],[2,"width","850px","max-height","100vh",3,"ngSubmit"],["color","primary"],[1,"flex-1"],[3,"tb-help"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","",2,"padding","0"],["createNewDialog",""],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"form",1),e.\u0275\u0275listener("ngSubmit",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.save())}),e.\u0275\u0275elementStart(1,"mat-toolbar",2)(2,"h2"),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"span",3)(6,"div",4),e.\u0275\u0275elementStart(7,"button",5),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.cancel())}),e.\u0275\u0275elementStart(8,"mat-icon",6),e.\u0275\u0275text(9,"close"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(10,mu,1,0,"mat-progress-bar",7),e.\u0275\u0275pipe(11,"async"),e.\u0275\u0275template(12,uu,1,0,"div",8),e.\u0275\u0275pipe(13,"async"),e.\u0275\u0275elementStart(14,"div",9),e.\u0275\u0275element(15,"tb-client",10,0),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"div",11)(18,"button",12),e.\u0275\u0275pipe(19,"async"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.cancel())}),e.\u0275\u0275text(20),e.\u0275\u0275pipe(21,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(22,"button",13),e.\u0275\u0275pipe(23,"async"),e.\u0275\u0275text(24),e.\u0275\u0275pipe(25,"translate"),e.\u0275\u0275elementEnd()()()}if(2&i){const o=e.\u0275\u0275reference(16);e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,8,"admin.oauth2.add-client")),e.\u0275\u0275advance(3),e.\u0275\u0275property("tb-help",n.helpLinkId()),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(11,10,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(13,12,n.isLoading$)),e.\u0275\u0275advance(6),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(19,14,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(21,16,"action.cancel")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(23,18,n.isLoading$)||(null==o.entityForm?null:o.entityForm.invalid)||!(null!=o.entityForm&&o.entityForm.dirty)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(25,20,"action.add")," ")}},dependencies:[p.NgIf,be.HelpComponent,x.MatButton,x.MatIconButton,E.MatIcon,K.MatProgressBar,ae.MatToolbar,S.MatDialogActions,S.MatDialogContent,s.\u0275NgNoValidate,s.NgControlStatusGroup,s.NgForm,Vt,p.AsyncPipe,u.TranslatePipe],encapsulation:2})}}var Yo=d(44216);function gu(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.domain-name-required")," "))}function fu(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.domain-name-max-length")," "))}function hu(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.error-verification-url")," "))}class Ma extends xe.l{constructor(t,i,n,o,r,l,c,m,h){super(t,c,o,r,l),this.store=t,this.translate=i,this.oauth2Service=n,this.entityValue=o,this.entitiesTableConfigValue=r,this.cd=l,this.fb=c,this.window=m,this.dialog=h,this.loginProcessingUrl="",this.entityType=f.ck,this.entityForm.get("name").setValue(this.window.location.hostname),this.entityForm.markAsDirty(),this.oauth2Service.getLoginProcessingUrl().subscribe(T=>{this.loginProcessingUrl=T})}buildForm(t){return this.fb.group({name:[t?.name?t.name:"",[s.Validators.required,s.Validators.maxLength(255),s.Validators.pattern("^(?:\\w+(?::\\w+)?@)?[^\\s/]+(?::\\d+)?$")]],oauth2Enabled:!(0,_.f1)(t?.oauth2Enabled)||t.oauth2Enabled,oauth2ClientInfos:t?.oauth2ClientInfos?t.oauth2ClientInfos.map(i=>i.id.id):[],propagateToEdge:!!(0,_.f1)(t?.propagateToEdge)&&t.propagateToEdge})}updateForm(t){this.entityForm.patchValue({name:t.name,oauth2Enabled:t.oauth2Enabled,oauth2ClientInfos:t.oauth2ClientInfos?.map(i=>i.id?i.id.id:i),propagateToEdge:t.propagateToEdge})}redirectURI(){const t=this.entityForm.get("name").value;return""!==t?`${t}${this.loginProcessingUrl}`:""}createClient(t){t&&(t.stopPropagation(),t.preventDefault()),this.dialog.open(Gt,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{}}).afterClosed().subscribe(i=>{if(i){const n=this.entityForm.get("oauth2ClientInfos").value?[...this.entityForm.get("oauth2ClientInfos").value]:[];n.push(i.id.id),this.entityForm.get("oauth2ClientInfos").patchValue(n),this.entityForm.get("oauth2ClientInfos").markAsDirty()}})}static{this.\u0275fac=function(i){return new(i||Ma)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(fn.P),e.\u0275\u0275directiveInject("entity"),e.\u0275\u0275directiveInject("entitiesTableConfig"),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(mr.jf),e.\u0275\u0275directiveInject(S.MatDialog))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Ma,selectors:[["tb-domain"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:31,vars:28,consts:[[1,"tb-form-panel","no-gap","no-border",3,"formGroup"],[1,"tb-form-row","tb-standard-fields","no-border","no-padding"],[1,"flex"],["translate",""],["matInput","","formControlName","name"],[4,"ngIf"],["matInput","","readonly","",3,"value"],["matSuffix","","miniButton","false","color","primary","tooltipPosition","above","icon","content_copy",3,"copyText","tooltipText"],[1,"tb-form-row","no-border","no-padding",2,"margin-bottom","22px"],["formControlName","oauth2Enabled",1,"mat-slide"],["formControlName","oauth2ClientInfos",3,"entityType","labelText","placeholderText"],["mat-button","","color","primary","matSuffix","",3,"click","disabled"],[2,"white-space","nowrap"],[1,"tb-form-row","no-border","no-padding"],["formControlName","propagateToEdge",1,"mat-slide"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"section",0)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),e.\u0275\u0275text(4,"admin.oauth2.domain-name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"input",4),e.\u0275\u0275template(6,gu,3,3,"mat-error",5)(7,fu,3,3,"mat-error",5)(8,hu,3,3,"mat-error",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(9,"div",1)(10,"mat-form-field",2)(11,"mat-label",3),e.\u0275\u0275text(12,"admin.oauth2.redirect-url-template"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(13,"input",6)(14,"tb-copy-button",7),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(16,"div",8)(17,"mat-slide-toggle",9),e.\u0275\u0275text(18),e.\u0275\u0275pipe(19,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(20,"tb-entity-list",10),e.\u0275\u0275pipe(21,"translate"),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275elementStart(23,"button",11),e.\u0275\u0275listener("click",function(r){return n.createClient(r)}),e.\u0275\u0275elementStart(24,"span",12),e.\u0275\u0275text(25),e.\u0275\u0275pipe(26,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(27,"div",13)(28,"mat-slide-toggle",14),e.\u0275\u0275text(29),e.\u0275\u0275pipe(30,"translate"),e.\u0275\u0275elementEnd()()()),2&i&&(e.\u0275\u0275classProp("no-padding",n.isAdd),e.\u0275\u0275property("formGroup",n.entityForm),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.entityForm.get("name").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("name").hasError("maxlength")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("name").hasError("pattern")),e.\u0275\u0275advance(5),e.\u0275\u0275property("value",n.redirectURI()),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("tooltipText",e.\u0275\u0275pipeBind1(15,16,"admin.oauth2.copy-redirect-uri")),e.\u0275\u0275property("copyText",n.redirectURI()),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(19,18,"admin.oauth2.enable")," "),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("labelText",e.\u0275\u0275pipeBind1(21,20,"admin.oauth2.clients")),e.\u0275\u0275propertyInterpolate("placeholderText",e.\u0275\u0275pipeBind1(22,22,"admin.oauth2.add-client")),e.\u0275\u0275property("entityType",n.entityType.OAUTH2_CLIENT),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",!n.isEdit),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(26,24,"admin.oauth2.create-new")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(30,26,"admin.oauth2.edge")," "))},dependencies:[p.NgIf,Yo.EntityListComponent,x.MatButton,L.MatInput,v.MatFormField,v.MatLabel,v.MatError,v.MatSuffix,pe.MatSlideToggle,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,ur.CopyButtonComponent,u.TranslatePipe],encapsulation:2})}}class Na extends Ne.M{constructor(t){super(t),this.store=t}static{this.\u0275fac=function(i){return new(i||Na)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Na,selectors:[["tb-domain-table-header"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:0,consts:[["tb-help","oauth2Settings",2,"margin-left","-20px"]],template:function(i,n){1&i&&e.\u0275\u0275element(0,"div",0)},dependencies:[be.HelpComponent],encapsulation:2})}}class hn{constructor(t,i,n,o){this.translate=t,this.datePipe=i,this.utilsService=n,this.domainService=o,this.config=new y.M7,this.config.tableTitle=this.translate.instant("admin.oauth2.domains"),this.config.selectionEnabled=!1,this.config.entityType=f.ck.DOMAIN,this.config.rowPointer=!0,this.config.entityTranslations=f.Mi.get(f.ck.DOMAIN),this.config.entityResources=f.BT.get(f.ck.DOMAIN),this.config.entityComponent=Ma,this.config.headerComponent=Na,this.config.addDialogStyle={width:"850px",maxHeight:"100vh"},this.config.defaultSortOrder={property:"createdTime",direction:Pe.O.DESC},this.config.columns.push(new y.Qr("createdTime","common.created-time",this.datePipe,"170px"),new y.KK("name","admin.oauth2.domain-name","170px"),new y.us("oauth2ClientInfos","admin.oauth2.clients","40%"),new y.aN("oauth2Enabled","admin.oauth2.enable",{name:"",nameFunction:r=>this.translate.instant(r.oauth2Enabled?"admin.oauth2.disable":"admin.oauth2.enable"),icon:"mdi:toggle-switch",iconFunction:r=>r.oauth2Enabled?"mdi:toggle-switch":"mdi:toggle-switch-off-outline",isEnabled:()=>!0,onAction:(r,l)=>this.toggleEnableOAuth(r,l)}),new y.aN("propagateToEdge","admin.oauth2.edge",{name:"",nameFunction:r=>this.translate.instant(r.propagateToEdge?"admin.oauth2.edge-disable":"admin.oauth2.edge-enable"),icon:"mdi:toggle-switch",iconFunction:r=>r.propagateToEdge?"mdi:toggle-switch":"mdi:toggle-switch-off-outline",isEnabled:()=>!0,onAction:(r,l)=>this.togglePropagateToEdge(r,l)})),this.config.deleteEntityTitle=r=>this.translate.instant("admin.oauth2.delete-domain-title",{domainName:r.name}),this.config.deleteEntityContent=()=>this.translate.instant("admin.oauth2.delete-domain-text"),this.config.entitiesFetchFunction=r=>this.domainService.getTenantDomainInfos(r),this.config.loadEntity=r=>this.domainService.getDomainInfoById(r.id),this.config.saveEntity=(r,l)=>{const c=r.oauth2ClientInfos||[];let m;return m=r.id&&!(0,_.n4)(r.oauth2ClientInfos?.sort(),l.oauth2ClientInfos?.map(h=>h.id?h.id.id:h).sort())?this.domainService.updateOauth2Clients(r.id.id,c):(0,H.of)(null),delete r.oauth2ClientInfos,m.pipe((0,Z.Z)(()=>this.domainService.saveDomain(r,r.id?[]:c)),(0,ie.T)(h=>(h.oauth2ClientInfos=c,h)))},this.config.deleteEntity=r=>this.domainService.deleteDomain(r.id)}resolve(t){return this.config}toggleEnableOAuth(t,i){t&&t.stopPropagation();const n={...i,oauth2Enabled:!i.oauth2Enabled};this.domainService.saveDomain(n,i.oauth2ClientInfos.map(o=>o.id.id),{ignoreLoading:!0}).subscribe(o=>{i.oauth2Enabled=o.oauth2Enabled,this.config.getTable().detectChanges()})}togglePropagateToEdge(t,i){t&&t.stopPropagation();const n={...i,propagateToEdge:!i.propagateToEdge};this.domainService.saveDomain(n,i.oauth2ClientInfos.map(o=>o.id.id),{ignoreLoading:!0}).subscribe(o=>{i.propagateToEdge=o.propagateToEdge,this.config.getTable().detectChanges()})}static{this.\u0275fac=function(i){return new(i||hn)(e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(p.DatePipe),e.\u0275\u0275inject(vr.T),e.\u0275\u0275inject(Ea))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:hn,factory:hn.\u0275fac})}}class Aa{constructor(t){this.http=t}saveMobileApp(t,i,n){return this.http.post(`/api/mobileApp?oauth2ClientIds=${i.join(",")}`,t,(0,Ue.eT)(n))}updateOauth2Clients(t,i,n){return this.http.put(`/api/mobileApp/${t}/oauth2Clients`,i,(0,Ue.eT)(n))}getTenantMobileAppInfos(t,i){return this.http.get(`/api/mobileApp/infos${t.toQuery()}`,(0,Ue.eT)(i))}getMobileAppInfoById(t,i){return this.http.get(`/api/mobileApp/info/${t}`,(0,Ue.eT)(i))}deleteMobileApp(t,i){return this.http.delete(`/api/mobileApp/${t}`,(0,Ue.eT)(i))}static{this.\u0275fac=function(i){return new(i||Aa)(e.\u0275\u0275inject(ha.HttpClient))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Aa,factory:Aa.\u0275fac,providedIn:"root"})}}function bu(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.mobile-package-unique")," "))}function yu(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.mobile-package-max-length")," "))}function vu(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.mobile-package-spaces")," "))}function Cu(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.mobile-app-secret-required")," "))}function xu(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.mobile-app-secret-min-length")," "))}function _u(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"admin.oauth2.mobile-app-secret-base64")," "))}class Fa extends xe.l{constructor(t,i,n,o,r,l,c){super(t,l,n,o,r),this.store=t,this.translate=i,this.entityValue=n,this.entitiesTableConfigValue=o,this.cd=r,this.fb=l,this.dialog=c,this.entityType=f.ck}buildForm(t){return this.fb.group({pkgName:[t?.pkgName?t.pkgName:"",[s.Validators.required,s.Validators.maxLength(255),s.Validators.pattern(/^\S+$/)]],appSecret:[t?.appSecret?t.appSecret:btoa((0,_.N8)(64)),[s.Validators.required,this.base64Format]],oauth2Enabled:!(0,_.f1)(t?.oauth2Enabled)||t.oauth2Enabled,oauth2ClientInfos:t?.oauth2ClientInfos?t.oauth2ClientInfos.map(i=>i.id.id):[]})}updateForm(t){this.entityForm.patchValue({pkgName:t.pkgName,appSecret:t.appSecret,oauth2Enabled:t.oauth2Enabled,oauth2ClientInfos:t.oauth2ClientInfos?.map(i=>i.id?i.id.id:i)})}createClient(t){t&&(t.stopPropagation(),t.preventDefault()),this.dialog.open(Gt,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{}}).afterClosed().subscribe(i=>{if(i){const n=this.entityForm.get("oauth2ClientInfos").value?[...this.entityForm.get("oauth2ClientInfos").value]:[];n.push(i.id.id),this.entityForm.get("oauth2ClientInfos").patchValue(n),this.entityForm.get("oauth2ClientInfos").markAsDirty()}})}base64Format(t){if(""===t.value)return null;try{return atob(t.value).length<64?{minLength:!0}:null}catch{return{base64:!0}}}static{this.\u0275fac=function(i){return new(i||Fa)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject("entity"),e.\u0275\u0275directiveInject("entitiesTableConfig"),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(S.MatDialog))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Fa,selectors:[["tb-mobile-app"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:35,vars:30,consts:[[1,"tb-form-panel","no-border",3,"formGroup"],[1,"tb-form-row","tb-standard-fields","no-border","no-padding"],["floatLabel","always","subscriptSizing","dynamic",1,"flex"],["translate",""],["matInput","","formControlName","pkgName","required","",3,"placeholder"],[4,"ngIf"],["matInput","","formControlName","appSecret","required",""],["matSuffix","","miniButton","false","color","primary","tooltipPosition","above","icon","content_copy",3,"copyText","tooltipText"],[1,"tb-form-row","no-border","no-padding"],["formControlName","oauth2Enabled",1,"mat-slide"],["formControlName","oauth2ClientInfos",3,"entityType","labelText","placeholderText"],["mat-button","","color","primary","matSuffix","",3,"click","disabled"],[2,"white-space","nowrap"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"section",0)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),e.\u0275\u0275text(4,"admin.oauth2.mobile-package"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"input",4),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementStart(7,"mat-hint",3),e.\u0275\u0275text(8,"admin.oauth2.mobile-package-hint"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(9,bu,3,3,"mat-error",5)(10,yu,3,3,"mat-error",5)(11,vu,3,3,"mat-error",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(12,"div",1)(13,"mat-form-field",2)(14,"mat-label",3),e.\u0275\u0275text(15,"admin.oauth2.mobile-app-secret"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(16,"input",6)(17,"tb-copy-button",7),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementStart(19,"mat-hint",3),e.\u0275\u0275text(20,"admin.oauth2.mobile-app-secret-hint"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(21,Cu,3,3,"mat-error",5)(22,xu,3,3,"mat-error",5)(23,_u,3,3,"mat-error",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(24,"div",8)(25,"mat-slide-toggle",9),e.\u0275\u0275text(26),e.\u0275\u0275pipe(27,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(28,"tb-entity-list",10),e.\u0275\u0275pipe(29,"translate"),e.\u0275\u0275pipe(30,"translate"),e.\u0275\u0275elementStart(31,"button",11),e.\u0275\u0275listener("click",function(r){return n.createClient(r)}),e.\u0275\u0275elementStart(32,"span",12),e.\u0275\u0275text(33),e.\u0275\u0275pipe(34,"translate"),e.\u0275\u0275elementEnd()()()()),2&i&&(e.\u0275\u0275classProp("no-padding",n.isAdd),e.\u0275\u0275property("formGroup",n.entityForm),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(6,18,"admin.oauth2.mobile-package-placeholder")),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",n.entityForm.hasError("unique")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("pkgName").hasError("maxlength")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("pkgName").hasError("pattern")),e.\u0275\u0275advance(6),e.\u0275\u0275propertyInterpolate("tooltipText",e.\u0275\u0275pipeBind1(18,20,"admin.oauth2.copy-mobile-app-secret")),e.\u0275\u0275property("copyText",n.entityForm.get("appSecret").value),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",n.entityForm.get("appSecret").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("appSecret").hasError("base64")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("appSecret").hasError("minLength")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(27,22,"admin.oauth2.enable")," "),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("labelText",e.\u0275\u0275pipeBind1(29,24,"admin.oauth2.clients")),e.\u0275\u0275propertyInterpolate("placeholderText",e.\u0275\u0275pipeBind1(30,26,"admin.oauth2.add-client")),e.\u0275\u0275property("entityType",n.entityType.OAUTH2_CLIENT),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",!n.isEdit),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(34,28,"admin.oauth2.create-new")))},dependencies:[p.NgIf,Yo.EntityListComponent,x.MatButton,L.MatInput,v.MatFormField,v.MatLabel,v.MatHint,v.MatError,v.MatSuffix,pe.MatSlideToggle,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,ur.CopyButtonComponent,u.TranslatePipe],encapsulation:2})}}class Da extends Ne.M{constructor(t){super(t),this.store=t}static{this.\u0275fac=function(i){return new(i||Da)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Da,selectors:[["tb-mobile-app-table-header"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:0,consts:[["tb-help","oauth2Settings",2,"margin-left","-20px"]],template:function(i,n){1&i&&e.\u0275\u0275element(0,"div",0)},dependencies:[be.HelpComponent],encapsulation:2})}}class bn{constructor(t,i,n){this.translate=t,this.datePipe=i,this.mobileAppService=n,this.config=new y.M7,this.config.tableTitle=this.translate.instant("admin.oauth2.mobile-apps"),this.config.selectionEnabled=!1,this.config.entityType=f.ck.MOBILE_APP,this.config.rowPointer=!0,this.config.entityTranslations=f.Mi.get(f.ck.MOBILE_APP),this.config.entityResources=f.BT.get(f.ck.MOBILE_APP),this.config.entityComponent=Fa,this.config.headerComponent=Da,this.config.addDialogStyle={width:"850px",maxHeight:"100vh"},this.config.defaultSortOrder={property:"createdTime",direction:Pe.O.DESC},this.config.columns.push(new y.Qr("createdTime","common.created-time",this.datePipe,"170px"),new y.KK("pkgName","admin.oauth2.mobile-package","170px"),new y.KK("appSecret","admin.oauth2.mobile-app-secret","350px",o=>o.appSecret?this.appSecretText(o):"",()=>({}),!1,()=>({}),()=>{},!1,{name:this.translate.instant("admin.oauth2.copy-mobile-app-secret"),icon:"content_copy",style:{padding:"4px","font-size":"16px",color:"rgba(0,0,0,.87)"},isEnabled:o=>!!o.appSecret,onAction:(o,r)=>r.appSecret,type:y.Uk.COPY_BUTTON}),new y.us("oauth2ClientInfos","admin.oauth2.clients","20%"),new y.aN("oauth2Enabled","admin.oauth2.enable",{name:"",nameFunction:o=>this.translate.instant(o.oauth2Enabled?"admin.oauth2.disable":"admin.oauth2.enable"),icon:"mdi:toggle-switch",iconFunction:o=>o.oauth2Enabled?"mdi:toggle-switch":"mdi:toggle-switch-off-outline",isEnabled:()=>!0,onAction:(o,r)=>this.toggleEnableOAuth(o,r)})),this.config.deleteEntityTitle=o=>this.translate.instant("admin.oauth2.delete-mobile-app-title",{applicationName:o.pkgName}),this.config.deleteEntityContent=()=>this.translate.instant("admin.oauth2.delete-mobile-app-text"),this.config.entitiesFetchFunction=o=>this.mobileAppService.getTenantMobileAppInfos(o),this.config.loadEntity=o=>this.mobileAppService.getMobileAppInfoById(o.id),this.config.saveEntity=(o,r)=>{const l=o.oauth2ClientInfos||[];let c;return c=o.id&&!(0,_.n4)(o.oauth2ClientInfos?.sort(),r.oauth2ClientInfos?.map(m=>m.id?m.id.id:m).sort())?this.mobileAppService.updateOauth2Clients(o.id.id,l):(0,H.of)(null),delete o.oauth2ClientInfos,c.pipe((0,Z.Z)(()=>this.mobileAppService.saveMobileApp(o,o.id?[]:l)),(0,ie.T)(m=>(m.oauth2ClientInfos=l,m)))},this.config.deleteEntity=o=>this.mobileAppService.deleteMobileApp(o.id)}resolve(t){return this.config}toggleEnableOAuth(t,i){t&&t.stopPropagation();const n={...i,oauth2Enabled:!i.oauth2Enabled};this.mobileAppService.saveMobileApp(n,i.oauth2ClientInfos.map(o=>o.id.id),{ignoreLoading:!0}).subscribe(o=>{i.oauth2Enabled=o.oauth2Enabled,this.config.getTable().detectChanges()})}appSecretText(t){let i=t.appSecret;return i.length>35&&(i=`${i.slice(0,35)}\u2026`),i}static{this.\u0275fac=function(i){return new(i||bn)(e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(p.DatePipe),e.\u0275\u0275inject(Aa))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:bn,factory:bn.\u0275fac})}}class Pa{constructor(t){this.oauth2Service=t}resolve(){return this.oauth2Service.getLoginProcessingUrl()}static{this.\u0275fac=function(i){return new(i||Pa)(e.\u0275\u0275inject(fn.P))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Pa,factory:Pa.\u0275fac})}}const es=[{path:"oauth2",component:va.V,data:{auth:[g.s.SYS_ADMIN],breadcrumb:{label:"admin.oauth2.oauth2",icon:"mdi:shield-account"}},children:[{path:"",children:[],data:{auth:[g.s.SYS_ADMIN],redirectTo:"/security-settings/oauth2/domains"}},{path:"domains",component:G.EntitiesTableComponent,data:{auth:[g.s.SYS_ADMIN],title:"admin.oauth2.domains",breadcrumb:{menuId:F.D8.domains}},resolve:{entitiesTableConfig:hn}},{path:"mobile-applications",component:G.EntitiesTableComponent,data:{auth:[g.s.SYS_ADMIN],title:"admin.oauth2.mobile-apps",breadcrumb:{menuId:F.D8.mobile_apps}},resolve:{entitiesTableConfig:bn}},{path:"clients",data:{title:"admin.oauth2.clients",breadcrumb:{menuId:F.D8.clients}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.SYS_ADMIN],title:"admin.oauth2.clients"},resolve:{entitiesTableConfig:Bt}},{path:"details",children:[{path:":entityId",component:X.i,data:{breadcrumb:{labelFunction:ee,icon:"public"},auth:[g.s.SYS_ADMIN],title:"admin.oauth2.clients",hideTabs:!0,backNavigationCommands:["../.."]},resolve:{entitiesTableConfig:Bt}}]}]}]}];class yn{static{this.\u0275fac=function(i){return new(i||yn)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:yn})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[Pa,Bt,hn,bn],imports:[b.RouterModule.forChild(es),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(yn,{imports:[b.RouterModule],exports:[b.RouterModule]});var A=d(21062),Qo=d(21178),Cr=d(19724),w=d(19440),ts=d(42415);const Su=["tagField"],ka='@charset "UTF-8";.tb-scada-symbol-tooltip-panel{display:flex;flex-direction:row;align-items:center;gap:8px}.tb-scada-symbol-tooltip-panel.column{flex-direction:column}.tb-scada-symbol-tooltip-panel.flex-start{align-items:start}.tb-scada-symbol-tooltip-panel .tb-confirm-text{font-size:14px;line-height:16px;text-align:center;font-weight:400}.tb-scada-symbol-tooltip-panel .mdc-button{line-height:20px;font-size:12px}.tb-scada-symbol-tooltip-panel .mdc-button.mat-mdc-button-base,.tb-scada-symbol-tooltip-panel .mdc-button.mat-mdc-button-base .mat-mdc-button-touch-target{height:20px}.tb-scada-symbol-tooltip-panel .mat-mdc-form-field.tb-inline-field{font-size:12px;line-height:12px}.tb-scada-symbol-tooltip-panel .mat-mdc-form-field.tb-inline-field .mat-mdc-text-field-wrapper{padding:0 8px}.tb-scada-symbol-tooltip-panel .mat-mdc-form-field.tb-inline-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-form-field-infix{padding-top:4px;padding-bottom:4px;min-height:20px}.tb-scada-symbol-tooltip-panel .mat-mdc-form-field.tb-inline-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-form-field-infix .mat-mdc-input-element{font-size:12px;line-height:12px;height:12px}\n',Tu=["tagSettingsButton"],Iu=["removeTagButton"];function wu(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",5),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.onUpdateTag())}),e.\u0275\u0275elementStart(2,"mat-icon"),e.\u0275\u0275text(3,"edit"),e.\u0275\u0275elementEnd()()}2&a&&e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(1,1,"scada.tag.update-tag"))}function Eu(a,t){1&a&&(e.\u0275\u0275elementStart(0,"button",6,0),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementStart(3,"mat-icon"),e.\u0275\u0275text(4,"settings"),e.\u0275\u0275elementEnd()()),2&a&&e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(2,1,"scada.tag.tag-settings"))}function Mu(a,t){1&a&&(e.\u0275\u0275elementStart(0,"button",6,1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementStart(3,"mat-icon"),e.\u0275\u0275text(4,"delete"),e.\u0275\u0275elementEnd()()),2&a&&e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(2,1,"scada.tag.remove-tag"))}const Nu=["yesButton"];function Au(a,t){1&a&&(e.\u0275\u0275elementStart(0,"div",3),e.\u0275\u0275text(1,"scada.state-render-function"),e.\u0275\u0275elementEnd())}function Fu(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",4),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.editStateRenderFunction())}),e.\u0275\u0275elementStart(1,"mat-icon"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"span"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(null!=i.symbolElement&&i.symbolElement.readonly?"visibility":"edit"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(5,2,null!=i.symbolElement&&i.symbolElement.readonly?"action.view":"action.edit"))}}function Du(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",4),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.editStateRenderFunction())}),e.\u0275\u0275elementStart(1,"mat-icon"),e.\u0275\u0275text(2,"add"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"span",3),e.\u0275\u0275text(4,"action.add"),e.\u0275\u0275elementEnd()()}}function Pu(a,t){1&a&&(e.\u0275\u0275elementStart(0,"div",3),e.\u0275\u0275text(1,"scada.tag.on-click-action"),e.\u0275\u0275elementEnd())}function ku(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",4),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.editClickAction())}),e.\u0275\u0275elementStart(1,"mat-icon"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"span"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(null!=i.symbolElement&&i.symbolElement.readonly?"visibility":"edit"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(5,2,null!=i.symbolElement&&i.symbolElement.readonly?"action.view":"action.edit"))}}function Lu(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",4),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.editClickAction())}),e.\u0275\u0275elementStart(1,"mat-icon"),e.\u0275\u0275text(2,"add"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"span",3),e.\u0275\u0275text(4,"action.add"),e.\u0275\u0275elementEnd()()}}class gt{constructor(t){this.element=t,this.viewInited=new e.EventEmitter}ngAfterViewInit(){this.viewInited.emit()}static{this.\u0275fac=function(i){return new(i||gt)(e.\u0275\u0275directiveInject(e.ElementRef))}}static{this.\u0275dir=e.\u0275\u0275defineDirective({type:gt,inputs:{symbolElement:"symbolElement"},outputs:{viewInited:"viewInited"}})}}class La extends gt{constructor(t){super(t),this.element=t,this.addTag=new e.EventEmitter}onAddTag(){this.addTag.emit()}static{this.\u0275fac=function(i){return new(i||La)(e.\u0275\u0275directiveInject(e.ElementRef))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:La,selectors:[["ng-component"]],outputs:{addTag:"addTag"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:9,vars:4,consts:[[1,"tb-scada-symbol-tooltip-panel"],["mat-stroked-button","","color","primary",3,"click"],["translate",""]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"span"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"button",1),e.\u0275\u0275listener("click",function(){return n.onAddTag()}),e.\u0275\u0275elementStart(5,"mat-icon"),e.\u0275\u0275text(6,"add"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"span",2),e.\u0275\u0275text(8,"scada.tag.add-tag"),e.\u0275\u0275elementEnd()()()),2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2("",null==n.symbolElement||null==n.symbolElement.element?null:n.symbolElement.element.type,"",null!=n.symbolElement&&n.symbolElement.invisible?" ("+e.\u0275\u0275pipeBind1(3,2,"scada.hidden")+")":"",""))},dependencies:[x.MatButton,E.MatIcon,u.TranslateDirective,u.TranslatePipe],styles:[ka],encapsulation:2})}}class Oa extends gt{constructor(t){super(t),this.element=t,this.apply=new e.EventEmitter,this.cancel=new e.EventEmitter,this.closed=!1}ngAfterViewInit(){super.ngAfterViewInit(),setTimeout(()=>{this.tagField.nativeElement.focus()})}ngOnDestroy(){this.blurTimeout&&(clearTimeout(this.blurTimeout),this.blurTimeout=null)}tagEnter(t){t.keyCode===ct.ENTER&&(t.preventDefault(),this.tag&&(this.closed=!0,this.apply.emit(this.tag)))}onApply(){this.closed=!0,this.tag?this.apply.emit(this.tag):this.cancel.emit()}onCancel(){this.closed=!0,this.cancel.emit()}onBlur(){this.blurTimeout=setTimeout(()=>{this.closed||(this.closed=!0,this.cancel.emit())},300)}static{this.\u0275fac=function(i){return new(i||Oa)(e.\u0275\u0275directiveInject(e.ElementRef))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Oa,selectors:[["ng-component"]],viewQuery:function(i,n){if(1&i&&e.\u0275\u0275viewQuery(Su,5),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.tagField=o.first)}},inputs:{isAdd:"isAdd",tag:"tag"},outputs:{apply:"apply",cancel:"cancel"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:16,vars:14,consts:[["tagField",""],[1,"tb-scada-symbol-tooltip-panel"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field"],["matInput","",3,"ngModelChange","keydown","blur","ngModel","placeholder"],["type","button","mat-icon-button","","matTooltipPosition","above",1,"tb-mat-20",3,"click","matTooltip","disabled"],["type","button","mat-icon-button","","matTooltipPosition","above",1,"tb-mat-20",3,"click","matTooltip"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",1)(1,"span"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"mat-form-field",2)(5,"input",3,0),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275twoWayListener("ngModelChange",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275twoWayBindingSet(n.tag,l)||(n.tag=l),e.\u0275\u0275resetView(l)}),e.\u0275\u0275listener("keydown",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.tagEnter(l))})("blur",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.onBlur())}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(8,"button",4),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.onApply())}),e.\u0275\u0275elementStart(10,"mat-icon"),e.\u0275\u0275text(11,"done"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(12,"button",5),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.onCancel())}),e.\u0275\u0275elementStart(14,"mat-icon"),e.\u0275\u0275text(15,"close"),e.\u0275\u0275elementEnd()()()}2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(3,6,n.isAdd?"scada.tag.enter-tag":"scada.tag.update-tag"),":"),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(7,8,"widget-config.set")),e.\u0275\u0275twoWayProperty("ngModel",n.tag),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(9,10,"action.apply")),e.\u0275\u0275property("disabled",!n.tag),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(13,12,"action.cancel")))},dependencies:[x.MatIconButton,E.MatIcon,L.MatInput,v.MatFormField,_e.MatTooltip,s.DefaultValueAccessor,s.NgControlStatus,s.NgModel,u.TranslatePipe],styles:[ka],encapsulation:2})}}class Ra extends gt{constructor(t,i){super(t),this.element=t,this.container=i,this.updateTag=new e.EventEmitter,this.removeTag=new e.EventEmitter,this.displayTagSettings=!0}ngOnInit(){this.symbolElement?.readonly&&(this.displayTagSettings=this.symbolElement?.hasStateRenderFunction()||this.symbolElement?.hasClickAction())}ngAfterViewInit(){super.ngAfterViewInit(),setTimeout(()=>{if(this.displayTagSettings){const t=ts(this.tagSettingsButton.nativeElement);t.tooltipster({parent:this.symbolElement.tooltipContainer,zIndex:200,arrow:!0,theme:["scada-symbol","tb-active"],interactive:!0,trigger:"click",trackOrigin:!0,trackerInterval:100,side:"top",content:""});const i=t.tooltipster("instance"),n=Ga(this.symbolElement,this.container,Ba,i);i.on("ready",()=>{n.instance.updateFunctionsState()})}if(!this.symbolElement.readonly){const t=ts(this.removeTagButton.nativeElement);t.tooltipster({parent:this.symbolElement.tooltipContainer,zIndex:200,arrow:!0,theme:["scada-symbol","tb-active"],interactive:!0,trigger:"click",trackOrigin:!0,trackerInterval:100,side:"top",content:""});const i=t.tooltipster("instance"),n=Ga(this.symbolElement,this.container,Va,i);n.instance.removeTag.subscribe(()=>{i.destroy(),this.removeTag.emit()}),n.instance.cancel.subscribe(()=>{i.close()}),i.on("ready",()=>{n.instance.yesButton.focus()})}})}onUpdateTag(){this.updateTag.emit()}static{this.\u0275fac=function(i){return new(i||Ra)(e.\u0275\u0275directiveInject(e.ElementRef),e.\u0275\u0275directiveInject(e.ViewContainerRef))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Ra,selectors:[["ng-component"]],viewQuery:function(i,n){if(1&i&&(e.\u0275\u0275viewQuery(Tu,5,e.ElementRef),e.\u0275\u0275viewQuery(Iu,5,e.ElementRef)),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.tagSettingsButton=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.removeTagButton=o.first)}},outputs:{updateTag:"updateTag",removeTag:"removeTag"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:10,vars:8,consts:[["tagSettingsButton",""],["removeTagButton",""],[1,"tb-scada-symbol-tooltip-panel"],["type","button","mat-icon-button","","class","tb-mat-20","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["type","button","mat-icon-button","","class","tb-mat-20","matTooltipPosition","above",3,"matTooltip",4,"ngIf"],["type","button","mat-icon-button","","matTooltipPosition","above",1,"tb-mat-20",3,"click","matTooltip"],["type","button","mat-icon-button","","matTooltipPosition","above",1,"tb-mat-20",3,"matTooltip"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",2)(1,"span"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"span")(5,"b"),e.\u0275\u0275text(6),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(7,wu,4,3,"button",3)(8,Eu,5,3,"button",4)(9,Mu,5,3,"button",4),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2("",null==n.symbolElement||null==n.symbolElement.element?null:n.symbolElement.element.type,"",null!=n.symbolElement&&n.symbolElement.invisible?" ("+e.\u0275\u0275pipeBind1(3,6,"scada.hidden")+")":"",":"),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(null==n.symbolElement?null:n.symbolElement.tag),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!(null!=n.symbolElement&&n.symbolElement.readonly)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.displayTagSettings),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!(null!=n.symbolElement&&n.symbolElement.readonly)))},dependencies:[p.NgIf,x.MatIconButton,E.MatIcon,_e.MatTooltip,u.TranslatePipe],styles:[ka],encapsulation:2})}}class Va extends gt{constructor(t,i){super(t),this.element=t,this.translate=i,this.cancel=new e.EventEmitter,this.removeTag=new e.EventEmitter}ngOnInit(){this.deleteText=this.translate.instant("scada.tag.delete-tag-text",{tag:this.symbolElement?.tag,elementType:this.symbolElement?.element?.type})}onCancel(){this.cancel.emit()}onRemoveTag(){this.removeTag.emit()}static{this.\u0275fac=function(i){return new(i||Va)(e.\u0275\u0275directiveInject(e.ElementRef),e.\u0275\u0275directiveInject(u.TranslateService))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Va,selectors:[["ng-component"]],viewQuery:function(i,n){if(1&i&&e.\u0275\u0275viewQuery(Nu,5),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.yesButton=o.first)}},outputs:{cancel:"cancel",removeTag:"removeTag"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:14,vars:1,consts:[["yesButton",""],[1,"tooltipster-content","tb-scada-symbol-tooltip-panel","column"],[1,"tb-confirm-text",3,"innerHTML"],[1,"tb-scada-symbol-tooltip-panel"],["mat-stroked-button","","color","primary",3,"click"],["translate",""]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",1),e.\u0275\u0275element(1,"div",2),e.\u0275\u0275elementStart(2,"div",3)(3,"button",4),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.onCancel())}),e.\u0275\u0275elementStart(4,"mat-icon"),e.\u0275\u0275text(5,"close"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"span",5),e.\u0275\u0275text(7,"action.no"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(8,"button",4,0),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.onRemoveTag())}),e.\u0275\u0275elementStart(10,"mat-icon"),e.\u0275\u0275text(11,"done"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"span",5),e.\u0275\u0275text(13,"action.yes"),e.\u0275\u0275elementEnd()()()()}2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275property("innerHTML",n.deleteText,e.\u0275\u0275sanitizeHtml))},dependencies:[x.MatButton,E.MatIcon,u.TranslateDirective],styles:[ka],encapsulation:2})}}class Ba extends gt{constructor(t){super(t),this.element=t,this.hasStateRenderFunction=!1,this.hasClickAction=!1}ngOnInit(){this.updateFunctionsState()}updateFunctionsState(){this.hasStateRenderFunction=this.symbolElement.hasStateRenderFunction(),this.hasClickAction=this.symbolElement.hasClickAction()}editStateRenderFunction(){this.symbolElement.editStateRenderFunction()}editClickAction(){this.symbolElement.editClickAction()}static{this.\u0275fac=function(i){return new(i||Ba)(e.\u0275\u0275directiveInject(e.ElementRef))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Ba,selectors:[["ng-component"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:7,vars:6,consts:[[1,"tooltipster-content","tb-scada-symbol-tooltip-panel","column","flex-start"],["translate","",4,"ngIf"],["mat-stroked-button","","color","primary",3,"click",4,"ngIf"],["translate",""],["mat-stroked-button","","color","primary",3,"click"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,Au,2,0,"div",1)(2,Fu,6,4,"button",2)(3,Du,5,0,"button",2)(4,Pu,2,0,"div",1)(5,ku,6,4,"button",2)(6,Lu,5,0,"button",2),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!(null!=n.symbolElement&&n.symbolElement.readonly)||n.hasStateRenderFunction),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.hasStateRenderFunction),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!(n.hasStateRenderFunction||null!=n.symbolElement&&n.symbolElement.readonly)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!(null!=n.symbolElement&&n.symbolElement.readonly)||n.hasClickAction),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.hasClickAction),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!(n.hasClickAction||null!=n.symbolElement&&n.symbolElement.readonly)))},dependencies:[p.NgIf,x.MatButton,E.MatIcon,u.TranslateDirective,u.TranslatePipe],styles:[ka],encapsulation:2})}}class vn{static{this.\u0275fac=function(i){return new(i||vn)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:vn})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(vn,{declarations:[La,Oa,Ra,Va,Ba],imports:[p.CommonModule,w.G]});const ns=(a,t)=>{a.stopEdit(),a.tooltip.off("close");const i=Ga(a,t,La);i.instance.addTag.subscribe(()=>{i.destroy(),as(a,t,!0)})},is=(a,t)=>{a.stopEdit(),a.unhighlight();const i=Ga(a,t,Ra);i.instance.updateTag.subscribe(()=>{i.destroy(),as(a,t,!1)}),i.instance.removeTag.subscribe(()=>{i.destroy(),a.clearTag()}),a.tooltip.open()},as=(a,t,i)=>{a.startEdit(()=>{i?(a.unhighlight(),a.tooltip.close()):(n.destroy(),is(a,t))});const n=Ga(a,t,Oa);n.instance.isAdd=i,i||(n.instance.tag=a.tag),n.instance.apply.subscribe(o=>{n.destroy(),i&&a.tooltip.off("close"),a.setTag(o)}),n.instance.cancel.subscribe(()=>{a.stopEdit(!0)}),i&&(a.tooltip.option("delay",[0,1e7]),a.tooltip.on("close",()=>{n.destroy(),a.tooltip.option("delay",[0,300]),ns(a,t)}))},Ga=(a,t,i,n)=>{n||(n=a.tooltip);const o=t.createComponent(i);o.instance.symbolElement=a,o.instance.viewInited.subscribe(()=>{n.status().open&&n.reposition()}),n.on("destroyed",()=>{o.destroy()});const r=o.instance.element.nativeElement,l=r.firstChild;return r.removeChild(l),r.style.display="none",n.content(l),o};var le=d(74972),ft=d(42415);class Ou{constructor(t,i,n,o,r,l){this.rootElement=t,this.tooltipsContainer=i,this.viewContainerRef=n,this.zone=o,this.callbacks=r,this.readonly=l,this.elements=[],this.performSetup=!1,this.showHidden=!1,this.scale=1,this.tags=[],this.zoomFactor=.34,this.shapeResize$=new ResizeObserver(()=>{this.resize()})}setReadOnly(t){this.readonly=t}setContent(t){this.shapeResize$.unobserve(this.rootElement),this.svgShape&&(this.destroyElements(),this.svgShape.remove()),this.scale=1,this.showHidden=!1;const i=(0,A.SX)(t);this.svgRootNodePart=i.svgRootNode,this.svgShape=(0,Qo.SVG)().svg(i.innerSvg),this.svgShape.node.style.overflow="visible",this.svgShape.node.style["user-select"]="none";const n=(0,Qo.SVG)(`${i.svgRootNode}\n${i.innerSvg}\n</svg>`);"svg"===n.type?(this.box=n.viewbox(),n.fill()&&this.svgShape.fill(n.fill())):this.box=this.svgShape.bbox(),n.remove(),this.svgShape.size(this.box.width,this.box.height),this.svgShape.viewbox(`0 0 ${this.box.width} ${this.box.height}`),this.svgShape.style().attr("tb:inner",!0).rule(".tb-element",{cursor:"pointer",transition:"0.2s filter ease-in-out"}),this.svgShape.addTo(this.rootElement),this.updateHoverFilterStyle(),this.performSetup=!0,this.shapeResize$.observe(this.rootElement)}getContent(){if(this.svgShape){this.elements.forEach(i=>i.restoreOrigVisibility());const t=this.svgShape.svg(i=>{if(i.node.hasAttribute("tb:inner"))return!1;i.node.classList.remove("tb-element","tooltipstered"),i.node.classList.length||i.node.removeAttribute("class"),i.attr("svgjs:data",null)},!1);return this.showHiddenElements(this.showHidden),`${this.svgRootNodePart}\n${t}\n</svg>`}return null}cancelEdit(){this.elements.filter(t=>t.isEditing()).forEach(t=>t.stopEdit(!0))}zoomIn(){const t=Math.min(Math.pow(1+this.zoomFactor,1.2)*this.svgShape.zoom(),4);this.zoomAnimate(t)}zoomOut(){const t=Math.max(Math.pow(1+this.zoomFactor,-1.2)*this.svgShape.zoom(),.75);this.zoomAnimate(t)}showHiddenElements(t){this.showHidden=t,this.elements.forEach(i=>t?i.showInvisible():i.hideInvisible())}zoomAnimate(t,i=200){t!==this.svgShape.zoom()&&(this.hideTooltips(),this.svgShape.animate(i).ease("<>").zoom(t).during(()=>{const o=this.restrictToMargins(this.svgShape.viewbox());this.svgShape.viewbox(o)}).after(()=>{this.postZoom(this.callbacks.onZoom)}))}zoomInDisabled(){return Number(this.svgShape.zoom().toFixed(5))>=4}zoomOutDisabled(){return Number(this.svgShape.zoom().toFixed(5))<=.75}doSetup(){this.setupZoomPan(),window.SVG=Qo,(0,Se.p)([(0,Cr.H)(d.e(89).then(d.t.bind(d,10089,23))),(0,Cr.H)(Promise.all([d.e(89),d.e(414)]).then(d.t.bind(d,80414,23)))]).subscribe(()=>{this.zone.run(()=>{this.setupElements()})})}setupZoomPan(){this.svgShape.panZoom({zoomMin:.75,zoomMax:4,zoomFactor:this.zoomFactor}),this.svgShape.on("zoom",t=>{const{detail:{level:i,focus:n}}=t;this.svgShape.zoom(i,n),this.postZoom(this.callbacks.onZoom,t)}),this.svgShape.on("panning",t=>{const i=t.detail.box;this.svgShape.viewbox(this.restrictToMargins(i)),t.preventDefault()}),this.svgShape.on("panStart",t=>{this.hideTooltips(),this.svgShape.node.style.cursor="grab"}),this.svgShape.on("panEnd",t=>{this.restoreTooltips(),this.svgShape.node.style.cursor="default"}),this.svgShape.zoom(.75)}postZoom(t,i){const n=this.restrictToMargins(this.svgShape.viewbox());this.svgShape.viewbox(n),setTimeout(()=>{this.updateTooltipPositions()}),i?.preventDefault(),t&&t()}restrictToMargins(t){const i=Math.max(t.width-this.box.width,0),n=Math.max(t.height-this.box.height,0);return t.x<-i?t.x=-i:t.x+t.width>this.box.width+i&&(t.x=this.box.width+i-t.width),t.y<-n?t.y=-n:t.y+t.height>this.box.height+n&&(t.y=this.box.height+n-t.height),t}setupElements(){this.svgShape.children().forEach(n=>{this.addElement(n)});const t=[];for(const n of this.elements)for(const o of this.elements)if(n!==o&&n.overlappingCenters(o)){let r;for(const l of t)if(l.includes(o)||l.includes(n)){r=l;break}r?r.includes(n)?r.includes(o)||r.push(o):r.push(n):(r=[n,o],t.push(r))}for(const n of t){const o=n.map(h=>h.box.cy),r=o.reduce((h,T)=>h+T,0)/o.length,l=n.find(h=>h.isText()),c=l&&n.length%2==0?n.length+1:n.length;l&&(l.setInnerTooltipOffset(0,r),n.splice(n.indexOf(l),1));let m=-Cn*c/2+Cn/2;for(const h of n)l&&0===m&&(m+=Cn),h.setInnerTooltipOffset(m,r),m+=Cn}for(const n of this.elements)n.init();this.updateTags();const i=this.elements.some(n=>n.invisible);this.callbacks.hasHiddenElements&&this.callbacks.hasHiddenElements(i)}addElement(t,i=!1){if(Ru(t)){const n=i||!t.visible(),o=new Bu(this,t,n);this.elements.push(o),t.children().forEach(r=>{"tspan"===r.type&&"text"===t.type||this.addElement(r,n)},!0)}}destroy(){this.shapeResize$&&this.shapeResize$.disconnect(),this.destroyElements()}destroyElements(){this.elements.forEach(t=>{t.destroy()}),this.elements.length=0}resize(){if(this.svgShape){const t=this.rootElement.getBoundingClientRect().width,i=this.rootElement.getBoundingClientRect().height;if(t&&i){let r;r=this.box.width/this.box.height>t/i?t/this.box.width:i/this.box.height,this.scale!==r&&(this.scale=r,this.svgShape.node.style.transform=`scale(${this.scale})`,this.updateHoverFilterStyle(),this.updateTooltipPositions()),this.performSetup&&(this.performSetup=!1,this.doSetup())}}}updateHoverFilterStyle(){this.hoverFilterStyle&&this.hoverFilterStyle.remove();const t=(2.8/this.scale).toFixed(2),i=(1.2/this.scale).toFixed(2);this.hoverFilterStyle=this.svgShape.style().attr("tb:inner",!0).rule(".hovered",{filter:`drop-shadow(0px 0px ${t}px white) drop-shadow(0px 0px ${t}px white)\n             drop-shadow(0px 0px ${t}px white) drop-shadow(0px 0px ${t}px white)\n             drop-shadow(0px 0px ${i}px black)`})}updateTooltipPositions(){for(const t of this.elements)t.updateTooltipPosition()}hideTooltips(){for(const t of this.elements)t.hideTooltip()}restoreTooltips(){for(const t of this.elements)t.restoreTooltip()}updateTags(){this.tags=this.elements.filter(t=>t.hasTag()).map(t=>t.tag).filter((t,i,n)=>n.indexOf(t)===i).sort(),this.callbacks.tagsUpdated(this.tags)}getTags(){return this.tags}tagHasStateRenderFunction(t){return this.callbacks.tagHasStateRenderFunction(t)}tagHasClickAction(t){return this.callbacks.tagHasClickAction(t)}editTagStateRenderFunction(t){this.callbacks.editTagStateRenderFunction(t)}editTagClickAction(t){this.callbacks.editTagClickAction(t)}setDirty(t){this.callbacks.onSymbolEditObjectDirty(t)}}const Ru=a=>{try{if(a.bbox){let t=a.bbox();return!t.width&&!t.height&&!a.visible()&&(a.show(),t=a.bbox(),a.hide()),!!t.width||!!t.height}return!1}catch{return!1}},Cn=44;class Bu{get readonly(){return this.editObject.readonly}constructor(t,i,n=!1){this.editObject=t,this.element=i,this.invisible=n,this.editing=!1,this.innerTooltipOffset=0,this.highlighted=!1,this.origVisibility=!0,this.tag=i.attr("tb:tag"),this.origVisibility=i.visible(),this.invisible&&i.show(),this.box=i.rbox(this.editObject.svgShape)}init(){this.isGroup()?(this.highlightRect=this.editObject.svgShape.rect(this.box.width+4,this.box.height+4).x(this.box.x-2).y(this.box.y-2).attr({"tb:inner":!0,fill:"none",rx:this.unscaled(6),stroke:"rgba(0, 0, 0, 0.38)","stroke-dasharray":"1","stroke-width":this.unscaled(2),opacity:0}),this.highlightRectTimeline=new Qo.Timeline,this.highlightRect.timeline(this.highlightRectTimeline),this.highlightRect.hide()):this.element.addClass("tb-element"),this.element.on("mouseenter",t=>{this.highlight()}),this.element.on("mouseleave",t=>{this.unhighlight()}),this.invisible||this.setupTooltips(),this.hideInvisible()}setupTooltips(){this.hasTag()?this.createTagTooltip():this.readonly||this.createAddTagTooltip()}showInvisible(){this.invisible&&(this.element.show(),this.tooltip||this.setupTooltips())}hideInvisible(){this.invisible&&(this.element.hide(),this.tooltip&&(this.tooltip.destroy(),this.tooltip=null))}restoreOrigVisibility(){this.origVisibility?this.element.show():this.element.hide()}overlappingCenters(t){return!this.isGroup()&&!t.isGroup()&&(Math.abs(this.box.cx-t.box.cx)*this.editObject.scale<100&&Math.abs(this.box.cy-t.box.cy)*this.editObject.scale<Cn)}highlight(){this.highlighted||(this.highlighted=!0,this.isGroup()?(this.highlightRectTimeline.finish(),this.highlightRect.attr({rx:this.unscaled(6),"stroke-width":this.unscaled(2)}),this.highlightRect.show(),this.highlightRect.animate(300).attr({opacity:1})):this.element.addClass("hovered"),this.hasTag()&&(this.tooltip.reposition(),ft(this.tooltip.elementTooltip()).addClass("tb-active")))}unhighlight(){this.highlighted&&(this.highlighted=!1,this.isGroup()?(this.highlightRectTimeline.finish(),this.highlightRect.animate(300).attr({opacity:0}).after(()=>{this.highlightRect.hide()})):this.element.removeClass("hovered"),this.hasTag()&&!this.editing&&ft(this.tooltip.elementTooltip()).removeClass("tb-active"))}clearTag(){this.tooltip.destroy(),this.tag=null,this.element.attr("tb:tag",null),this.unhighlight(),this.createAddTagTooltip(),this.editObject.setDirty(!0),this.editObject.updateTags()}setTag(t){this.tooltip.destroy(),this.tag=t,this.element.attr("tb:tag",t),this.createTagTooltip(),this.editObject.setDirty(!0),this.editObject.updateTags()}hasStateRenderFunction(){return!!this.hasTag()&&this.editObject.tagHasStateRenderFunction(this.tag)}hasClickAction(){return!!this.hasTag()&&this.editObject.tagHasClickAction(this.tag)}editStateRenderFunction(){this.hasTag()&&this.editObject.editTagStateRenderFunction(this.tag)}editClickAction(){this.hasTag()&&this.editObject.editTagClickAction(this.tag)}startEdit(t){this.editing||(this.editObject.cancelEdit(),this.editing=!0,this.onCancelEdit=t)}stopEdit(t=!1){this.editing&&(this.editing=!1,t&&this.onCancelEdit&&this.onCancelEdit(),this.onCancelEdit=null,this.hasTag()&&!this.highlighted&&ft(this.tooltip.elementTooltip()).removeClass("tb-active"))}isEditing(){return this.editing}updateTooltipPosition(){if(this.tooltip&&!this.tooltip.status().destroyed){this.tooltip.reposition();const t=this.tooltip.elementTooltip();t&&(t.style.visibility=null)}}hideTooltip(){if(this.tooltip&&!this.tooltip.status().destroyed){const t=this.tooltip.elementTooltip();t&&(t.style.visibility="hidden")}}restoreTooltip(){this.updateTooltipPosition()}setInnerTooltipOffset(t,i){this.innerTooltipOffset=t+(i-this.box.cy)*this.editObject.scale}destroy(){this.tooltip&&this.tooltip.destroy()}get tooltipContainer(){return ft(this.editObject.tooltipsContainer)}unscaled(t){return t/(this.editObject.scale*this.editObject.svgShape.zoom())}scaled(t){return t*(this.editObject.scale*this.editObject.svgShape.zoom())}createTagTooltip(){const t=ft(this.element.node);t.tooltipster({parent:this.tooltipContainer,zIndex:100,arrow:this.isGroup(),distance:this.isGroup()?this.scaled(2)+2:6,theme:["scada-symbol"],delay:0,animationDuration:0,interactive:!0,trigger:"custom",side:"top",trackOrigin:!1,content:"",functionPosition:(i,n,o)=>this.innerTagTooltipPosition(i,n,o),functionReady:(i,n)=>{const o=ft(n.tooltip);o.on("mouseenter",()=>{this.highlight()}),o.on("mouseleave",()=>{this.unhighlight()})}}),this.tooltip=t.tooltipster("instance"),this.setupTagPanel()}setupTagPanel(){is(this,this.editObject.viewContainerRef)}createAddTagTooltip(){const t=ft(this.element.node);t.tooltipster({parent:this.tooltipContainer,zIndex:100,arrow:!0,theme:["scada-symbol","tb-active"],delay:[0,300],interactive:!0,trigger:"hover",side:["top","left","bottom","right"],trackOrigin:!1,content:"",functionBefore:(i,n)=>{const o=n.event;let r;this.tooltipMouseX=o.clientX,this.tooltipMouseY=o.clientY,r=this.isGroup()?"top":this.calculateTooltipSide(n.origin.getBoundingClientRect(),o.clientX,o.clientY),i.option("side",r)},functionPosition:(i,n,o)=>this.innerAddTagTooltipPosition(i,n,o),functionReady:(i,n)=>{const o=ft(n.tooltip);o.on("mouseenter",()=>{this.highlight()}),o.on("mouseleave",()=>{this.unhighlight()})}}),this.tooltip=t.tooltipster("instance"),this.setupAddTagPanel()}setupAddTagPanel(){ns(this,this.editObject.viewContainerRef)}innerTagTooltipPosition(t,i,n){const o=i.origin.getBoundingClientRect();return this.isGroup()?(n.distance=this.scaled(2)+2,n.coord.top=o.top-n.size.height-(this.scaled(2)+2)):(n.coord.top=o.top+(o.height-n.size.height)/2+this.innerTooltipOffset*this.editObject.svgShape.zoom(),n.coord.left=o.left+(o.width-n.size.width)/2),n}innerAddTagTooltipPosition(t,i,n){const r=this.tooltipContainer[0].getBoundingClientRect();switch(n.side){case"right":n.coord.top=this.tooltipMouseY-n.size.height/2,n.coord.left=this.tooltipMouseX+10,n.target=this.tooltipMouseY;break;case"top":n.coord.top=this.tooltipMouseY-n.size.height-10,n.coord.left=this.tooltipMouseX-n.size.width/2,n.target=this.tooltipMouseX,this.isGroup()&&(n.coord.top-=Cn);break;case"left":n.coord.top=this.tooltipMouseY-n.size.height/2,n.coord.left=this.tooltipMouseX-n.size.width-10,n.target=this.tooltipMouseY;break;case"bottom":n.coord.top=this.tooltipMouseY+10,n.coord.left=this.tooltipMouseX-n.size.width/2,n.target=this.tooltipMouseX}const l=r.right-(n.coord.left+n.size.width);l<0&&(n.coord.left+=l);const c=r.left-n.coord.left;return c>0&&(n.coord.left+=c),n}calculateTooltipSide(t,i,n){let o;const r=t.left+t.width/2,l=t.top+t.height/2;return o=t.width>t.height?Math.abs(r-i)>t.width/4?i<r?"left":"right":n<l?"top":"bottom":Math.abs(l-n)>t.height/4?n<l?"top":"bottom":i<r?"left":"right",o}hasTag(){return!!this.tag}isGroup(){return"g"===this.element.type}isText(){return"text"===this.element.type}}const ht=/[a-zA-Z$_\u00a1-\uffff][a-zA-Z\d$_\u00a1-\uffff]*/,Je={token:"punctuation.operator",regex:/[.](?![.])/},Ze={regex:"",token:"empty",next:"no_regex"},_r={token:"tb.scada-symbol-ctx",regex:/\bctx\b/,next:"scadaSymbolCtxApi"},os={token:"tb.scada-symbol-element",regex:/\belement\b/,next:"scadaSymbolElementApi"},Sr={scadaSymbolCtxApi:[Je,{token:"tb.scada-symbol-ctx-properties",regex:/properties/,next:"scadaSymbolCtxPropertiesApi"},{token:"tb.scada-symbol-ctx-tags",regex:/tags/,next:"scadaSymbolCtxTagsApi"},{token:"tb.scada-symbol-ctx-values",regex:/values/,next:"scadaSymbolCtxValuesApi"},{token:"tb.scada-symbol-ctx-api",regex:/api/,next:"scadaSymbolCtxApiMethodApi"},{token:"tb.scada-symbol-ctx-svg",regex:/svg/,next:"scadaSymbolCtxSVGMethodApi"},Ze],scadaSymbolCtxPropertiesApi:[Je,{token:"tb.scada-symbol-ctx-property",regex:ht,next:"no_regex"},Ze],scadaSymbolCtxTagsApi:[Je,{token:"tb.scada-symbol-ctx-tag",regex:ht,next:"no_regex"},Ze],scadaSymbolCtxValuesApi:[Je,{token:"tb.scada-symbol-ctx-value",regex:ht,next:"no_regex"},Ze],scadaSymbolCtxApiMethodApi:[Je,{token:"tb.scada-symbol-ctx-api-method",regex:ht,next:"no_regex"},Ze],scadaSymbolCtxSVGMethodApi:[Je,{token:"tb.scada-symbol-ctx-svg-method",regex:ht,next:"no_regex"},Ze]},Uu={scadaSymbolSVGApi:[Je,{token:"tb.scada-symbol-svg-properties",regex:ht,next:"no_regex"},Ze]},rs={scadaSymbolElementApi:[Je,{token:"tb.scada-symbol-element-properties",regex:ht,next:"no_regex"},Ze]},qu={scadaSymbolEventApi:[Je,{token:"tb.scada-symbol-event-properties",regex:ht,next:"no_regex"},Ze]},Wu={start:[_r,{token:"tb.scada-symbol-svg",regex:/\bsvg\b/,next:"scadaSymbolSVGApi"}],...Sr,...Uu},$u={no_regex:[_r,os],...Sr,...rs},zu={start:[_r,os,{token:"tb.scada-symbol-event",regex:/\bevent\b/,next:"scadaSymbolEventApi"}],...Sr,...rs,...qu},ss=a=>({ctx:a,element:{meta:"argument",type:"Element",description:'SVG element.<br>See <a href="https://svgjs.dev/docs/3.2/manipulating/" target="_blank">Manipulating</a> section to manipulate the element.<br>See <a href="https://svgjs.dev/docs/3.2/animating/" target="_blank">Animating</a> section to animate the element.'}}),Qu=(a,t)=>{let i=t.transform(a.name,a.name);return a.subLabel&&(i+=` <small>${t.transform(a.subLabel,a.subLabel)}</small>`),{meta:"property",description:i,type:Zu(a.type)}},Ju=(a,t)=>({meta:"property",description:t.transform(a.name,a.name),type:Xu(a.valueType)}),Zu=a=>{switch(a){case A._K.text:return"string";case A._K.number:return"number";case A._K.switch:return"boolean";case A._K.color:return"color string";case A._K.color_settings:return"ColorProcessor";case A._K.font:return"Font";case A._K.units:return"units string";case A._K.icon:return"icon string"}},Xu=a=>{switch(a){case le.eV.STRING:return"string";case le.eV.INTEGER:case le.eV.DOUBLE:return"number";case le.eV.BOOLEAN:return"boolean";case le.eV.JSON:return"object"}};var eg=d(93938),tg=d(11568);const ng=["scadaSymbolShape"],ig=["tooltipsContainer"],ag=["tooltipsContainerComponent"];function og(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",13)(1,"button",14),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.toggleShowHidden())}),e.\u0275\u0275elementStart(3,"mat-icon"),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd()()()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275classProp("!hidden","svg"!==i.editorMode),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(2,4,i.showHiddenElements?"scada.hide-hidden-elements":"scada.show-hidden-elements")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(i.showHiddenElements?"visibility_off":"visibility")}}class Ua{get editorMode(){return this.editorModeValue}set editorMode(t){this.updateEditorMode(t)}constructor(t,i){this.cd=t,this.zone=i,this.updateScadaSymbol=new e.EventEmitter,this.downloadScadaSymbol=new e.EventEmitter,this.zoomInDisabled=!1,this.zoomOutDisabled=!1,this.showHiddenElements=!1,this.showHiddenElementsChange=new e.EventEmitter,this.displayShowHidden=!1,this.svgContentFormControl=new s.FormControl,this.editorModeValue="svg"}ngOnInit(){this.readonly?this.svgContentFormControl.disable({emitEvent:!1}):this.svgContentFormControl.enable({emitEvent:!1}),this.svgContentFormControl.valueChanges.subscribe(t=>{this.svgContent!==t&&(this.svgContent=t,this.editObjectCallbacks.onSymbolEditObjectDirty(!0)),this.editObjectCallbacks.onSymbolEditObjectValid(this.svgContentFormControl.valid)})}ngAfterViewInit(){this.editObjectCallbacks.onZoom=()=>{this.updateZoomButtonsState()},this.editObjectCallbacks.hasHiddenElements=t=>{this.displayShowHidden=t,t&&this.scadaSymbolEditObject.showHiddenElements(this.showHiddenElements),this.cd.markForCheck()},this.scadaSymbolEditObject=new Ou(this.scadaSymbolShape.nativeElement,this.tooltipsContainer.nativeElement,this.tooltipsContainerComponent.viewContainerRef,this.zone,this.editObjectCallbacks,this.readonly),this.data&&this.updateContent(this.data.scadaSymbolContent)}ngOnChanges(t){for(const i of Object.keys(t)){const n=t[i];!n.firstChange&&n.currentValue!==n.previousValue&&("data"===i?setTimeout(()=>{this.updateContent(this.data.scadaSymbolContent)}):"readonly"===i&&(this.scadaSymbolEditObject.setReadOnly(this.readonly),this.readonly?this.svgContentFormControl.disable({emitEvent:!1}):this.svgContentFormControl.enable({emitEvent:!1})))}}ngOnDestroy(){this.scadaSymbolEditObject.destroy()}getContent(){return"svg"===this.editorMode?this.scadaSymbolEditObject?.getContent():this.svgContent}getTags(){return"svg"===this.editorMode?this.scadaSymbolEditObject?.getTags():(0,A.BD)(this.svgContent)}zoomIn(){this.scadaSymbolEditObject.zoomIn()}zoomOut(){this.scadaSymbolEditObject.zoomOut()}toggleShowHidden(){this.showHiddenElements=!this.showHiddenElements,this.showHiddenElementsChange.emit(this.showHiddenElements),this.scadaSymbolEditObject.showHiddenElements(this.showHiddenElements)}updateEditorMode(t){this.editorModeValue=t,"xml"===t?(this.svgContent=this.scadaSymbolEditObject.getContent(),this.svgContentFormControl.setValue(this.svgContent,{emitEvent:!1})):this.updateEditObjectContent(this.svgContent)}updateContent(t){this.svgContent=(0,A.Er)(t),"xml"===this.editorMode?this.svgContentFormControl.setValue(this.svgContent,{emitEvent:!1}):this.updateEditObjectContent(this.svgContent)}updateEditObjectContent(t){this.scadaSymbolEditObject&&(this.displayShowHidden=!1,this.scadaSymbolEditObject.setContent(t),setTimeout(()=>{this.updateZoomButtonsState()}))}updateZoomButtonsState(){this.zoomInDisabled=this.scadaSymbolEditObject.zoomInDisabled(),this.zoomOutDisabled=this.scadaSymbolEditObject.zoomOutDisabled(),this.cd.markForCheck()}static{this.\u0275fac=function(i){return new(i||Ua)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(e.NgZone))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Ua,selectors:[["tb-scada-symbol-editor"]],viewQuery:function(i,n){if(1&i&&(e.\u0275\u0275viewQuery(ng,5),e.\u0275\u0275viewQuery(ig,5),e.\u0275\u0275viewQuery(ag,7)),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.scadaSymbolShape=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.tooltipsContainer=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.tooltipsContainerComponent=o.first)}},inputs:{data:"data",editObjectCallbacks:"editObjectCallbacks",readonly:"readonly",showHiddenElements:"showHiddenElements"},outputs:{updateScadaSymbol:"updateScadaSymbol",downloadScadaSymbol:"downloadScadaSymbol",showHiddenElementsChange:"showHiddenElementsChange"},features:[e.\u0275\u0275NgOnChangesFeature],decls:38,vars:32,consts:[["scadaSymbolShape",""],["tooltipsContainer",""],["tooltipsContainerComponent",""],[1,"tb-scada-symbol-editor-shape"],[1,"tb-scada-symbol-editor-tooltips"],[1,"tb-scada-symbol-editor-svg-xml"],["fillHeight","","noLabel","",3,"formControl"],[1,"tb-scada-symbol-editor-buttons"],[1,"tb-scada-symbol-editor-view-buttons"],[1,"tb-scada-symbol-editor-zoom-buttons","tb-primary-fill"],["mat-icon-button","","matTooltipPosition","above",3,"click","disabled","matTooltip"],["class","tb-primary-fill",3,"!hidden",4,"ngIf"],[1,"tb-scada-symbol-editor-right-buttons"],[1,"tb-primary-fill"],["mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"],["appearance","fill","fillHeight","","extraPadding","","primaryBackground","",3,"ngModelChange","disabled","ngModel"],["value","svg"],["value","xml"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275element(0,"div",3,0),e.\u0275\u0275elementStart(2,"div",4,1),e.\u0275\u0275element(4,"tb-anchor",null,2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",5),e.\u0275\u0275element(7,"tb-svg-xml",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"div",7)(9,"div",8)(10,"div",9)(11,"button",10),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.zoomIn())}),e.\u0275\u0275elementStart(13,"mat-icon"),e.\u0275\u0275text(14,"add"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(15,"button",10),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.zoomOut())}),e.\u0275\u0275elementStart(17,"mat-icon"),e.\u0275\u0275text(18,"remove"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(19,og,5,6,"div",11),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"div",12)(21,"div",13)(22,"button",14),e.\u0275\u0275pipe(23,"translate"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.updateScadaSymbol.emit())}),e.\u0275\u0275elementStart(24,"mat-icon"),e.\u0275\u0275text(25,"file_upload"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(26,"div",13)(27,"button",14),e.\u0275\u0275pipe(28,"translate"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.downloadScadaSymbol.emit())}),e.\u0275\u0275elementStart(29,"mat-icon"),e.\u0275\u0275text(30,"download"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(31,"tb-toggle-select",15),e.\u0275\u0275twoWayListener("ngModelChange",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275twoWayBindingSet(n.editorMode,l)||(n.editorMode=l),e.\u0275\u0275resetView(l)}),e.\u0275\u0275elementStart(32,"tb-toggle-option",16),e.\u0275\u0275text(33),e.\u0275\u0275pipe(34,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(35,"tb-toggle-option",17),e.\u0275\u0275text(36),e.\u0275\u0275pipe(37,"translate"),e.\u0275\u0275elementEnd()()()()}2&i&&(e.\u0275\u0275classProp("!hidden","svg"!==n.editorMode),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden","svg"!==n.editorMode),e.\u0275\u0275advance(4),e.\u0275\u0275classProp("!hidden","xml"!==n.editorMode),e.\u0275\u0275advance(),e.\u0275\u0275property("formControl",n.svgContentFormControl),e.\u0275\u0275advance(3),e.\u0275\u0275classProp("!hidden","svg"!==n.editorMode),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(12,20,"scada.zoom-in")),e.\u0275\u0275property("disabled",n.zoomInDisabled),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(16,22,"scada.zoom-out")),e.\u0275\u0275property("disabled",n.zoomOutDisabled),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",n.displayShowHidden),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(23,24,"scada.update-symbol")),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(28,26,"scada.download-symbol")),e.\u0275\u0275advance(4),e.\u0275\u0275property("disabled",!n.readonly&&!n.svgContentFormControl.valid),e.\u0275\u0275twoWayProperty("ngModel",n.editorMode),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(34,28,"scada.mode-svg")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(37,30,"scada.mode-xml")))},dependencies:[p.NgIf,eg.TbAnchorComponent,tg.t,x.MatIconButton,E.MatIcon,_e.MatTooltip,s.NgControlStatus,s.NgModel,s.FormControlDirective,sn.ToggleOption,ea.ToggleSelectComponent,u.TranslatePipe],styles:['@charset "UTF-8";.tb-scada-symbol-editor-shape{width:100%;height:100%;display:flex;align-items:center;justify-content:center}.tb-scada-symbol-editor-tooltips{position:absolute;inset:0;pointer-events:none}.tb-scada-symbol-editor-svg-xml{width:100%;height:100%;padding-top:88px}.tb-scada-symbol-editor-buttons{pointer-events:none;position:absolute;left:20px;top:20px;right:20px;display:flex;justify-content:space-between;align-items:flex-start}.tb-scada-symbol-editor-buttons .tb-primary-fill{background:#fff;border-radius:50%}.tb-scada-symbol-editor-buttons .tb-primary-fill:before{opacity:.1}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-view-buttons{display:flex;flex-direction:column;gap:8px;z-index:101}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-zoom-buttons{display:flex;flex-direction:column;z-index:101;background:#fff;border-radius:24px}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-zoom-buttons.tb-primary-fill{border-radius:24px}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-zoom-buttons.tb-primary-fill:before{opacity:.1}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-right-buttons{display:flex;flex-direction:row;gap:8px;z-index:101}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-right-buttons tb-toggle-select{pointer-events:auto}.tooltipster-sidetip.scada-symbol{position:fixed}.tooltipster-sidetip.scada-symbol .tooltipster-box{-webkit-user-select:none;user-select:none;background:#0000008a;border:1px solid rgba(0,0,0,0);border-radius:8px;display:flex;align-items:center}.tooltipster-sidetip.scada-symbol .tooltipster-box .tooltipster-content{padding:4px 8px;font-size:12px;line-height:12px;font-weight:500;color:#fff}.tooltipster-sidetip.scada-symbol.tb-active .tooltipster-box{background:#fff;border:1px solid rgba(0,0,0,.38);box-shadow:0 0 10px 6px #0003}.tooltipster-sidetip.scada-symbol.tb-active .tooltipster-box .tooltipster-content{color:#000000c2}.tooltipster-sidetip.scada-symbol.tb-active .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-width:12px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-top .tooltipster-arrow{bottom:-1px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-top .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-top-color:#00000061}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-top .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-top-color:#fff;left:-2px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-bottom .tooltipster-arrow{top:-1px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-bottom .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-bottom-color:#00000061}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-bottom .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-bottom-color:#fff;left:-2px;top:-1px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-left .tooltipster-arrow{right:-1px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-left .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-left-color:#00000061}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-left .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-left-color:#fff;top:-2px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-right .tooltipster-arrow{left:-1px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-right .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-right-color:#00000061}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-right .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-right-color:#fff;top:-2px;left:-1px}.tooltipster-sidetip.scada-symbol.tooltipster-left .tooltipster-box,.tooltipster-sidetip.scada-symbol.tooltipster-right .tooltipster-box{min-height:36px}.tooltipster-sidetip.scada-symbol.tooltipster-top .tooltipster-arrow{bottom:-2px}.tooltipster-sidetip.scada-symbol.tooltipster-top .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-top-color:#0000008a}.tooltipster-sidetip.scada-symbol.tooltipster-top .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-top-color:transparent}.tooltipster-sidetip.scada-symbol.tooltipster-bottom .tooltipster-arrow{top:-2px}.tooltipster-sidetip.scada-symbol.tooltipster-bottom .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-bottom-color:#0000008a}.tooltipster-sidetip.scada-symbol.tooltipster-bottom .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-bottom-color:transparent}.tooltipster-sidetip.scada-symbol.tooltipster-left .tooltipster-arrow{right:-2px}.tooltipster-sidetip.scada-symbol.tooltipster-left .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-left-color:#0000008a}.tooltipster-sidetip.scada-symbol.tooltipster-left .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-left-color:transparent}.tooltipster-sidetip.scada-symbol.tooltipster-right .tooltipster-arrow{left:-2px}.tooltipster-sidetip.scada-symbol.tooltipster-right .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-right-color:#0000008a}.tooltipster-sidetip.scada-symbol.tooltipster-right .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-right-color:transparent}\n'],encapsulation:2})}}var ls=d(15421),rg=d(39116),sg=d(78911),lg=d(28345),Zo=d(42319),ds=(d(90039),d(93014));const dg=["tagFunctionComponent"];function cg(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",9),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.applyTagFunction())}),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("disabled",i.tagFunctionFormGroup.invalid||!i.tagFunctionFormGroup.dirty),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,"action.apply")," ")}}class qa{constructor(t,i){this.fb=t,this.widgetService=i,this.tagFunctionApplied=new e.EventEmitter,this.functionScopeVariables=this.widgetService.getWidgetScopeVariables()}ngOnInit(){this.tagFunctionFormGroup=this.fb.group({tagFunction:[this.tagFunction,[]]}),this.disabled&&this.tagFunctionFormGroup.disable({emitEvent:!1}),"renderFunction"===this.tagFunctionType?(this.panelTitle="scada.state-render-function",this.tagFunctionArgs=["ctx","element"],this.highlightRules=$u,this.tagFunctionHelpId="scada/tag_state_render_fn"):"clickAction"===this.tagFunctionType&&(this.panelTitle="scada.tag.on-click-action",this.tagFunctionArgs=["ctx","element","event"],this.highlightRules=zu,this.tagFunctionHelpId="scada/tag_click_action_fn")}ngAfterViewInit(){this.tagFunctionComponent.focus()}cancel(){this.popover?.hide()}applyTagFunction(){const t=this.tagFunctionFormGroup.get("tagFunction").value;this.tagFunctionApplied.emit(t)}static{this.\u0275fac=function(i){return new(i||qa)(e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(Ae.C))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:qa,selectors:[["tb-scada-symbol-metadata-tag-function-panel"]],viewQuery:function(i,n){if(1&i&&e.\u0275\u0275viewQuery(dg,5),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.tagFunctionComponent=o.first)}},inputs:{tagFunction:"tagFunction",tagFunctionType:"tagFunctionType",tag:"tag",completer:"completer",disabled:"disabled",popover:"popover"},outputs:{tagFunctionApplied:"tagFunctionApplied"},decls:17,vars:13,consts:[["tagFunctionComponent",""],[1,"tb-scada-symbol-metadata-tag-function-panel",3,"formGroup"],[1,"tb-scada-symbol-metadata-tag-function-title-container"],[1,"tb-scada-symbol-metadata-tag-function-title"],[1,"tb-scada-symbol-metadata-tag-function-panel-content"],["minHeight","300px","formControlName","tagFunction",3,"highlightRules","editorCompleter","functionArgs","helpId"],[1,"tb-scada-symbol-metadata-tag-function-panel-buttons"],["mat-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",1)(1,"div",2)(2,"mat-chip-set")(3,"mat-chip")(4,"span"),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(6,"div",3),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(9,"div",4),e.\u0275\u0275element(10,"tb-js-func",5,0),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"div",6)(13,"button",7),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.cancel())}),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(16,cg,3,4,"button",8),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275property("formGroup",n.tagFunctionFormGroup),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate1(" ",n.tag," "),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,9,n.panelTitle)),e.\u0275\u0275advance(3),e.\u0275\u0275property("highlightRules",n.highlightRules)("editorCompleter",n.completer)("functionArgs",n.tagFunctionArgs)("helpId",n.tagFunctionHelpId),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(15,11,n.disabled?"action.close":"action.cancel")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.disabled))},dependencies:[p.NgIf,ds.JsFuncComponent,x.MatButton,Ie.MatChip,Ie.MatChipSet,s.NgControlStatus,s.NgControlStatusGroup,s.FormGroupDirective,s.FormControlName,u.TranslatePipe],styles:['@charset "UTF-8";.tb-scada-symbol-metadata-tag-function-panel{width:800px;display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 959px){.tb-scada-symbol-metadata-tag-function-panel{width:90vw}}.tb-scada-symbol-metadata-tag-function-panel .tb-scada-symbol-metadata-tag-function-panel-content{display:flex;flex-direction:column;gap:16px;overflow:auto;margin:-10px;padding:10px}.tb-scada-symbol-metadata-tag-function-panel .tb-scada-symbol-metadata-tag-function-title-container{display:flex;flex-direction:row;gap:16px;align-items:center}.tb-scada-symbol-metadata-tag-function-panel .tb-scada-symbol-metadata-tag-function-title{font-size:16px;font-weight:500;line-height:24px;letter-spacing:.25px;color:#000000de}.tb-scada-symbol-metadata-tag-function-panel .tb-scada-symbol-metadata-tag-function-panel-buttons{height:40px;display:flex;flex-direction:row;gap:16px;justify-content:flex-end;align-items:flex-end}\n'],encapsulation:2})}}const pg=["editStateRenderFunctionButton"],mg=["editClickActionButton"];function ug(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",8,0),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.editTagStateRenderFunction())}),e.\u0275\u0275elementStart(2,"mat-icon"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"span"),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(i.disabled?"visibility":i.tagFormGroup.get("stateRenderFunction").value?"edit":"add"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(6,2,i.disabled?"action.view":i.tagFormGroup.get("stateRenderFunction").value?"action.edit":"action.add"))}}function gg(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",8,1),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.editClickAction())}),e.\u0275\u0275elementStart(2,"mat-icon"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"span"),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(i.disabled?"visibility":i.tagFormGroup.get("clickAction").value?"edit":"add"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(6,2,i.disabled?"action.view":i.tagFormGroup.get("clickAction").value?"action.edit":"action.add"))}}class bt{constructor(t,i,n,o){this.fb=t,this.popoverService=i,this.renderer=n,this.viewContainerRef=o,this.propagateChange=r=>{}}ngOnInit(){this.tagFormGroup=this.fb.group({tag:[null,[]],stateRenderFunction:[null,[]],clickAction:[null,[]]})}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}setDisabledState(t){this.disabled=t,t?this.tagFormGroup.disable({emitEvent:!1}):this.tagFormGroup.enable({emitEvent:!1})}writeValue(t){this.modelValue=t;const i=t?.actions?.click?.actionFunction;this.tagFormGroup.patchValue({tag:t?.tag,stateRenderFunction:t?.stateRenderFunction,clickAction:i},{emitEvent:!1})}validate(t){return this.tagFormGroup.valid?null:{tag:{valid:!1}}}editTagStateRenderFunction(){this.openTagFunction("renderFunction",this.editStateRenderFunctionButton)}editClickAction(){this.openTagFunction("clickAction",this.editClickActionButton)}openTagFunction(t,i){const n=i._elementRef.nativeElement;if(n.scrollIntoView(),this.popoverService.hasPopover(n))this.popoverService.hidePopover(n);else{let o,r;"renderFunction"===t?(o=this.tagFormGroup.get("stateRenderFunction"),r=this.elementStateRenderFunctionCompleter):"clickAction"===t&&(o=this.tagFormGroup.get("clickAction"),r=this.clickActionFunctionCompleter);const l={tagFunction:o.value,tagFunctionType:t,tag:this.tagFormGroup.get("tag").value,completer:r,disabled:this.disabled},c=this.popoverService.displayPopover(n,this.renderer,this.viewContainerRef,qa,["leftOnly","leftTopOnly","leftBottomOnly"],!0,null,l,{},{},{},!0);c.tbComponentRef.instance.popover=c,c.tbComponentRef.instance.tagFunctionApplied.subscribe(m=>{c.hide(),o.patchValue(m,{emitEvent:!1}),this.updateModel()})}}updateModel(){const t=this.tagFormGroup.value;this.modelValue={tag:t.tag,stateRenderFunction:t.stateRenderFunction},t.clickAction?this.modelValue.actions={click:{actionFunction:t.clickAction}}:this.modelValue.actions=null,this.propagateChange(this.modelValue)}static{this.\u0275fac=function(i){return new(i||bt)(e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(Zo.TbPopoverService),e.\u0275\u0275directiveInject(e.Renderer2),e.\u0275\u0275directiveInject(e.ViewContainerRef))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:bt,selectors:[["tb-scada-symbol-metadata-tag"]],viewQuery:function(i,n){if(1&i&&(e.\u0275\u0275viewQuery(pg,5),e.\u0275\u0275viewQuery(mg,5)),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.editStateRenderFunctionButton=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.editClickActionButton=o.first)}},inputs:{disabled:"disabled",elementStateRenderFunctionCompleter:"elementStateRenderFunctionCompleter",clickActionFunctionCompleter:"clickActionFunctionCompleter"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>bt),multi:!0},{provide:s.NG_VALIDATORS,useExisting:(0,e.forwardRef)(()=>bt),multi:!0}])],decls:10,vars:4,consts:[["editStateRenderFunctionButton",""],["editClickActionButton",""],[1,"tb-form-table-row","tb-scada-symbol-metadata-tag-row",3,"formGroup"],[1,"tb-tag-field"],[1,"tb-scada-symbol-metadata-tag-label"],[1,"tb-state-render-function-field"],["mat-button","","color","primary",3,"click",4,"ngIf"],[1,"tb-on-click-action-field"],["mat-button","","color","primary",3,"click"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"mat-chip-set")(3,"mat-chip")(4,"span",4),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(6,"div",5),e.\u0275\u0275template(7,ug,7,4,"button",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"div",7),e.\u0275\u0275template(9,gg,7,4,"button",6),e.\u0275\u0275elementEnd()()),2&i&&(e.\u0275\u0275property("formGroup",n.tagFormGroup),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate1(" ",n.tagFormGroup.get("tag").value," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.disabled||n.tagFormGroup.get("stateRenderFunction").value),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.disabled||n.tagFormGroup.get("clickAction").value))},dependencies:[p.NgIf,x.MatButton,E.MatIcon,Ie.MatChip,Ie.MatChipSet,s.NgControlStatusGroup,s.FormGroupDirective,u.TranslatePipe],styles:['@charset "UTF-8";.tb-scada-symbol-metadata-tag-row .tb-tag-field{flex:1 1 70%}.tb-scada-symbol-metadata-tag-row .tb-state-render-function-field,.tb-scada-symbol-metadata-tag-row .tb-on-click-action-field{flex:1 1 15%}.tb-scada-symbol-metadata-tag-row .tb-state-render-function-field,.tb-scada-symbol-metadata-tag-row .tb-on-click-action-field{display:flex;justify-content:flex-end}.tb-scada-symbol-metadata-tag-row .tb-state-render-function-field .mdc-button .mat-mdc-button-touch-target,.tb-scada-symbol-metadata-tag-row .tb-on-click-action-field .mdc-button .mat-mdc-button-touch-target{height:36px}\n'],encapsulation:2})}}function fg(a,t){1&a&&e.\u0275\u0275element(0,"mat-divider")}function hg(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275element(1,"tb-scada-symbol-metadata-tag",10),e.\u0275\u0275template(2,fg,1,0,"mat-divider",11),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=t.last,o=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("elementStateRenderFunctionCompleter",o.elementStateRenderFunctionCompleter)("clickActionFunctionCompleter",o.clickActionFunctionCompleter)("formControl",i),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n)}}function bg(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",8),e.\u0275\u0275template(1,hg,3,4,"div",9),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",i.tagsFormArray().controls)("ngForTrackBy",i.trackByTag)}}function yg(a,t){1&a&&(e.\u0275\u0275elementStart(0,"span",12),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"scada.tag.no-tags")))}const cs=a=>!a.stateRenderFunction&&!a.actions?.click?.actionFunction;class Ut{constructor(t){this.fb=t,this.styleDisplay="flex",this.styleOverflow="hidden",this.propagateChange=i=>{}}ngOnInit(){this.tagsFormGroup=this.fb.group({tags:this.fb.array([])});const t=this.setupTags();this.tagsFormGroup.setControl("tags",this.prepareTagsFormArray(t.tags),{emitEvent:!1}),this.tagsFormGroup.valueChanges.subscribe(()=>{let i=this.tagsFormGroup.get("tags").value;i&&(i=i.filter(n=>!cs(n))),this.modelValue=i,this.propagateChange(this.modelValue)})}ngOnChanges(t){for(const i of Object.keys(t)){const n=t[i];if(!n.firstChange&&n.currentValue!==n.previousValue&&["tags"].includes(i)){const o=this.setupTags(this.modelValue),r=this.prepareTagsFormArray(o.tags);o.emitEvent?setTimeout(()=>{this.tagsFormGroup.setControl("tags",r,{emitEvent:!0}),this.setDisabledState(this.disabled)}):(this.tagsFormGroup.setControl("tags",r,{emitEvent:!1}),this.setDisabledState(this.disabled))}}}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}setDisabledState(t){this.disabled=t,t?this.tagsFormGroup.disable({emitEvent:!1}):this.tagsFormGroup.enable({emitEvent:!1})}writeValue(t){this.modelValue=t||[];const i=this.setupTags(this.modelValue);this.tagsFormGroup.setControl("tags",this.prepareTagsFormArray(i.tags),{emitEvent:!1}),this.setDisabledState(this.disabled)}validate(t){return this.tagsFormGroup.valid?null:{tags:{valid:!1}}}tagsFormArray(){return this.tagsFormGroup.get("tags")}trackByTag(t,i){return i}editTagStateRenderFunction(t){setTimeout(()=>{const n=this.tagsFormGroup.get("tags").value.findIndex(r=>r.tag===t);this.metadataTags.get(n)?.editTagStateRenderFunction()})}editTagClickAction(t){setTimeout(()=>{const n=this.tagsFormGroup.get("tags").value.findIndex(r=>r.tag===t);this.metadataTags.get(n)?.editClickAction()})}setupTags(t){t=(t||[]).filter(o=>!cs(o));const i=(this.tags||[]).sort().map(o=>({tag:o,stateRenderFunction:null,actions:null}));for(const o of t){const r=i.find(l=>l.tag===o.tag);r&&(r.stateRenderFunction=o.stateRenderFunction,o.actions?.click?.actionFunction&&(r.actions={click:{actionFunction:o.actions.click.actionFunction}}))}const n=!!t.find(o=>!i.find(r=>r.tag===o.tag));return{tags:i,emitEvent:n}}prepareTagsFormArray(t){const i=[];return t&&t.forEach(n=>{i.push(this.fb.control(n,[]))}),this.fb.array(i)}static{this.\u0275fac=function(i){return new(i||Ut)(e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Ut,selectors:[["tb-scada-symbol-metadata-tags"]],viewQuery:function(i,n){if(1&i&&e.\u0275\u0275viewQuery(bt,5),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.metadataTags=o)}},hostVars:4,hostBindings:function(i,n){2&i&&e.\u0275\u0275styleProp("display",n.styleDisplay)("overflow",n.styleOverflow)},inputs:{disabled:"disabled",tags:"tags",elementStateRenderFunctionCompleter:"elementStateRenderFunctionCompleter",clickActionFunctionCompleter:"clickActionFunctionCompleter"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>Ut),multi:!0},{provide:s.NG_VALIDATORS,useExisting:(0,e.forwardRef)(()=>Ut),multi:!0}]),e.\u0275\u0275NgOnChangesFeature],decls:12,vars:2,consts:[["noTags",""],[1,"tb-form-panel","tb-scada-symbol-metadata-tags"],[1,"tb-form-table"],[1,"tb-form-table-header"],["translate","",1,"tb-form-table-header-cell","tb-tag-header"],["translate","",1,"tb-form-table-header-cell","tb-state-render-function-header"],["translate","",1,"tb-form-table-header-cell","tb-on-click-action-header"],["class","tb-form-table-body",4,"ngIf","ngIfElse"],[1,"tb-form-table-body"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex-1",3,"elementStateRenderFunctionCompleter","clickActionFunctionCompleter","formControl"],[4,"ngIf"],[1,"tb-prompt","flex","items-center","justify-center"]],template:function(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),e.\u0275\u0275text(4,"scada.tag.tag"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",5),e.\u0275\u0275text(6,"scada.state-render-function"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div",6),e.\u0275\u0275text(8,"scada.tag.on-click-action"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(9,bg,2,2,"div",7),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(10,yg,3,3,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)),2&i){const o=e.\u0275\u0275reference(11);e.\u0275\u0275advance(9),e.\u0275\u0275property("ngIf",n.tagsFormArray().controls.length)("ngIfElse",o)}},dependencies:[p.NgForOf,p.NgIf,Ye.MatDivider,s.NgControlStatus,s.FormControlDirective,u.TranslateDirective,bt,u.TranslatePipe],styles:['@charset "UTF-8";.tb-scada-symbol-metadata-tags{flex:1;margin:12px}.tb-scada-symbol-metadata-tags .tb-form-table-header-cell.tb-tag-header{flex:1 1 70%}.tb-scada-symbol-metadata-tags .tb-form-table-header-cell.tb-state-render-function-header,.tb-scada-symbol-metadata-tags .tb-form-table-header-cell.tb-on-click-action-header{flex:1 1 15%}.tb-scada-symbol-metadata-tags .tb-form-table-header-cell.tb-state-render-function-header,.tb-scada-symbol-metadata-tags .tb-form-table-header-cell.tb-on-click-action-header{display:flex;justify-content:flex-end}.tb-scada-symbol-metadata-tags .tb-form-table{overflow:hidden}.tb-scada-symbol-metadata-tags .tb-form-table-body{overflow:auto}.tb-scada-symbol-metadata-tags .tb-form-table-body tb-scada-symbol-metadata-tag{overflow:hidden}.tb-scada-symbol-metadata-tags .tb-form-table-body .mat-divider{margin-top:8px}\n'],encapsulation:2})}}var Tr=d(38789),vg=d(57786),Ir=d(44774),Cg=d(97035),xg=d(26847),_g=d(92387);const Sg=(a,t)=>[a,t];function Tg(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",17),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.scadaSymbolBehaviorTypeTranslations.get(i))," ")}}function Ig(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-select-trigger")(1,"div",20),e.\u0275\u0275element(2,"mat-icon",21),e.\u0275\u0275elementStart(3,"span"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("svgIcon",i.valueTypesMap.get(i.behaviorFormGroup.get("valueType").value).icon),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(5,2,i.valueTypesMap.get(i.behaviorFormGroup.get("valueType").value).name))}}function wg(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",17),e.\u0275\u0275element(1,"mat-icon",22),e.\u0275\u0275elementStart(2,"span"),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("svgIcon",n.valueTypesMap.get(i).icon),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,3,n.valueTypesMap.get(i).name))}}function Eg(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",3)(1,"div",4),e.\u0275\u0275text(2,"scada.behavior.value-type"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"mat-form-field",18)(4,"mat-select",19),e.\u0275\u0275template(5,Ig,6,4,"mat-select-trigger",13)(6,wg,5,5,"mat-option",11),e.\u0275\u0275elementEnd()()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.behaviorFormGroup.get("valueType").value),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",i.valueTypes)}}function Mg(a,t){1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",3)(2,"div",4),e.\u0275\u0275text(3,"scada.behavior.true-label"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"mat-form-field",5),e.\u0275\u0275element(5,"input",24),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(7,"div",3)(8,"div",4),e.\u0275\u0275text(9,"scada.behavior.false-label"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"mat-form-field",5),e.\u0275\u0275element(11,"input",25),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(13,"div",3)(14,"div",4),e.\u0275\u0275text(15,"scada.behavior.state-label"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"mat-form-field",5),e.\u0275\u0275element(17,"input",26),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()),2&a&&(e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(6,3,"widget-config.set")),e.\u0275\u0275advance(6),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(12,5,"widget-config.set")),e.\u0275\u0275advance(6),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(18,7,"widget-config.set")))}function Ng(a,t){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Mg,19,9,"ng-container",13),e.\u0275\u0275elementStart(2,"div",3)(3,"div",4),e.\u0275\u0275text(4,"scada.behavior.default-settings"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"tb-get-value-action-settings",23),e.\u0275\u0275pipe(6,"customTranslate"),e.\u0275\u0275pipe(7,"customTranslate"),e.\u0275\u0275pipe(8,"customTranslate"),e.\u0275\u0275pipe(9,"customTranslate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.behaviorFormGroup.get("valueType").value===i.ValueType.BOOLEAN),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("panelTitle",e.\u0275\u0275pipeBind1(6,8,i.behaviorFormGroup.get("name").value)),e.\u0275\u0275property("valueType",i.behaviorFormGroup.get("valueType").value)("trueLabel",e.\u0275\u0275pipeBind1(7,10,i.behaviorFormGroup.get("trueLabel").value))("falseLabel",e.\u0275\u0275pipeBind1(8,12,i.behaviorFormGroup.get("falseLabel").value))("stateLabel",e.\u0275\u0275pipeBind1(9,14,i.behaviorFormGroup.get("stateLabel").value))("aliasController",i.aliasController)("widgetType",i.widgetType.rpc)}}function Ag(a,t){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",3)(2,"div",4),e.\u0275\u0275text(3,"scada.behavior.default-settings"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"tb-set-value-action-settings",27),e.\u0275\u0275pipe(5,"customTranslate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("panelTitle",e.\u0275\u0275pipeBind1(5,4,i.behaviorFormGroup.get("name").value)),e.\u0275\u0275property("valueType",i.behaviorFormGroup.get("valueType").value)("aliasController",i.aliasController)("widgetType",i.widgetType.rpc)}}function Fg(a,t){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",3)(2,"div",4),e.\u0275\u0275text(3,"scada.behavior.default-settings"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"tb-widget-action-settings",28),e.\u0275\u0275pipe(5,"customTranslate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("panelTitle",e.\u0275\u0275pipeBind1(5,3,i.behaviorFormGroup.get("name").value)),e.\u0275\u0275property("callbacks",i.callbacks)("widgetType",i.widgetType.rpc)}}function Dg(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",29),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.applyBehaviorSettings())}),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("disabled",i.behaviorFormGroup.invalid||!i.behaviorFormGroup.dirty),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,i.isAdd?"action.add":"action.apply")," ")}}class Wa{constructor(t,i){this.fb=t,this.widgetService=i,this.widgetType=he.t_,this.ScadaSymbolBehaviorType=A.LU,this.ValueType=le.eV,this.ValueToDataType=Ir.V9,this.scadaSymbolBehaviorTypes=A.gF,this.scadaSymbolBehaviorTypeTranslations=A.dr,this.valueTypes=Object.keys(le.eV),this.valueTypesMap=le.JT,this.isAdd=!1,this.behaviorSettingsApplied=new e.EventEmitter,this.functionScopeVariables=this.widgetService.getWidgetScopeVariables()}ngOnInit(){this.panelTitle=this.isAdd?"scada.behavior.add-behavior":"scada.behavior.behavior-settings",this.behaviorFormGroup=this.fb.group({id:[this.behavior.id,[s.Validators.required]],name:[this.behavior.name,[s.Validators.required]],hint:[this.behavior.hint,[]],group:[this.behavior.group,[]],type:[this.behavior.type,[s.Validators.required]],valueType:[this.behavior.valueType,[s.Validators.required]],trueLabel:[this.behavior.trueLabel,[]],falseLabel:[this.behavior.falseLabel,[]],stateLabel:[this.behavior.stateLabel,[]],defaultGetValueSettings:[this.behavior.defaultGetValueSettings,[s.Validators.required]],defaultSetValueSettings:[this.behavior.defaultSetValueSettings,[s.Validators.required]],defaultWidgetActionSettings:[this.behavior.defaultWidgetActionSettings,[s.Validators.required]]}),this.disabled?this.behaviorFormGroup.disable({emitEvent:!1}):((0,vg.h)(this.behaviorFormGroup.get("type").valueChanges,this.behaviorFormGroup.get("valueType").valueChanges).subscribe(()=>{this.updateValidators()}),this.updateValidators())}cancel(){this.popover?.hide()}applyBehaviorSettings(){const t=this.behaviorFormGroup.getRawValue();this.behaviorSettingsApplied.emit(t)}updateValidators(){const t=this.behaviorFormGroup.get("type").value,i=this.behaviorFormGroup.get("valueType").value;let n=this.behaviorFormGroup.get("defaultGetValueSettings").value,o=this.behaviorFormGroup.get("defaultSetValueSettings").value,r=this.behaviorFormGroup.get("defaultWidgetActionSettings").value;switch(this.behaviorFormGroup.disable({emitEvent:!1}),this.behaviorFormGroup.get("id").enable({emitEvent:!1}),this.behaviorFormGroup.get("name").enable({emitEvent:!1}),this.behaviorFormGroup.get("type").enable({emitEvent:!1}),this.behaviorFormGroup.get("hint").enable({emitEvent:!1}),this.behaviorFormGroup.get("group").enable({emitEvent:!1}),t){case A.LU.value:this.behaviorFormGroup.get("valueType").enable({emitEvent:!1}),this.behaviorFormGroup.get("defaultGetValueSettings").enable({emitEvent:!1}),i===le.eV.BOOLEAN&&(this.behaviorFormGroup.get("trueLabel").enable({emitEvent:!1}),this.behaviorFormGroup.get("falseLabel").enable({emitEvent:!1}),this.behaviorFormGroup.get("stateLabel").enable({emitEvent:!1})),n||(n=(0,_.D9)({},(0,A.U6)(i)),this.behaviorFormGroup.get("defaultGetValueSettings").patchValue(n,{emitEvent:!0})),o&&this.behaviorFormGroup.get("defaultSetValueSettings").patchValue(null,{emitEvent:!0}),r&&this.behaviorFormGroup.get("defaultWidgetActionSettings").patchValue(null,{emitEvent:!0});break;case A.LU.action:this.behaviorFormGroup.get("valueType").enable({emitEvent:!1}),this.behaviorFormGroup.get("defaultSetValueSettings").enable({emitEvent:!1}),o||(o=(0,_.D9)({},(0,A.sI)(i)),this.behaviorFormGroup.get("defaultSetValueSettings").patchValue(o,{emitEvent:!0})),n&&this.behaviorFormGroup.get("defaultGetValueSettings").patchValue(null,{emitEvent:!0}),r&&this.behaviorFormGroup.get("defaultWidgetActionSettings").patchValue(null,{emitEvent:!0});break;case A.LU.widgetAction:this.behaviorFormGroup.get("defaultWidgetActionSettings").enable({emitEvent:!1}),r||(r=(0,_.D9)({},A.vt),this.behaviorFormGroup.get("defaultWidgetActionSettings").patchValue(r,{emitEvent:!0})),n&&this.behaviorFormGroup.get("defaultGetValueSettings").patchValue(null,{emitEvent:!0}),o&&this.behaviorFormGroup.get("defaultSetValueSettings").patchValue(null,{emitEvent:!0})}}static{this.\u0275fac=function(i){return new(i||Wa)(e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(Ae.C))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Wa,selectors:[["tb-scada-symbol-behavior-panel"]],inputs:{isAdd:"isAdd",behavior:"behavior",aliasController:"aliasController",callbacks:"callbacks",disabled:"disabled",popover:"popover"},outputs:{behaviorSettingsApplied:"behaviorSettingsApplied"},decls:44,vars:28,consts:[[1,"tb-scada-symbol-behavior-settings-panel",3,"formGroup"],[1,"tb-scada-symbol-behavior-settings-title"],[1,"tb-scada-symbol-behavior-settings-panel-content"],[1,"tb-form-row"],["translate","",1,"fixed-title-width"],["appearance","outline","subscriptSizing","dynamic",1,"flex"],["required","","matInput","","formControlName","id",3,"placeholder"],["required","","matInput","","formControlName","name",3,"placeholder"],["matInput","","formControlName","hint",3,"placeholder"],["matInput","","formControlName","group",3,"placeholder"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],["class","tb-form-row",4,"ngIf"],[4,"ngIf"],[1,"tb-scada-symbol-behavior-settings-panel-buttons"],["mat-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",3,"disabled","click",4,"ngIf"],[3,"value"],["appearance","outline","subscriptSizing","dynamic",1,"tb-value-type","flex"],["formControlName","valueType"],[1,"tb-value-type-row"],[1,"tb-mat-18",3,"svgIcon"],[1,"tb-mat-20",3,"svgIcon"],["formControlName","defaultGetValueSettings",1,"flex-1",3,"panelTitle","valueType","trueLabel","falseLabel","stateLabel","aliasController","widgetType"],["matInput","","formControlName","trueLabel",3,"placeholder"],["matInput","","formControlName","falseLabel",3,"placeholder"],["matInput","","formControlName","stateLabel",3,"placeholder"],["formControlName","defaultSetValueSettings",1,"flex-1",3,"panelTitle","valueType","aliasController","widgetType"],["formControlName","defaultWidgetActionSettings",1,"flex-1",3,"panelTitle","callbacks","widgetType"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",2)(5,"div",3)(6,"div",4),e.\u0275\u0275text(7,"scada.behavior.id"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"mat-form-field",5),e.\u0275\u0275element(9,"input",6),e.\u0275\u0275pipe(10,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(11,"div",3)(12,"div",4),e.\u0275\u0275text(13,"scada.behavior.name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"mat-form-field",5),e.\u0275\u0275element(15,"input",7),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(17,"div",3)(18,"div",4),e.\u0275\u0275text(19,"scada.behavior.hint"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"mat-form-field",5),e.\u0275\u0275element(21,"input",8),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(23,"div",3)(24,"div",4),e.\u0275\u0275text(25,"scada.behavior.group-title"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(26,"mat-form-field",5),e.\u0275\u0275element(27,"input",9),e.\u0275\u0275pipe(28,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(29,"div",3)(30,"div",4),e.\u0275\u0275text(31,"scada.behavior.type"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(32,"mat-form-field",5)(33,"mat-select",10),e.\u0275\u0275template(34,Tg,3,4,"mat-option",11),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(35,Eg,7,2,"div",12)(36,Ng,10,16,"ng-container",13)(37,Ag,6,6,"ng-container",13)(38,Fg,6,5,"ng-container",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(39,"div",14)(40,"button",15),e.\u0275\u0275listener("click",function(){return n.cancel()}),e.\u0275\u0275text(41),e.\u0275\u0275pipe(42,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(43,Dg,3,4,"button",16),e.\u0275\u0275elementEnd()()),2&i&&(e.\u0275\u0275property("formGroup",n.behaviorFormGroup),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,13,n.panelTitle)),e.\u0275\u0275advance(7),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(10,15,"widget-config.set")),e.\u0275\u0275advance(6),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(16,17,"widget-config.set")),e.\u0275\u0275advance(6),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(22,19,"widget-config.set")),e.\u0275\u0275advance(6),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(28,21,"widget-config.set")),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngForOf",n.scadaSymbolBehaviorTypes),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",e.\u0275\u0275pureFunction2(25,Sg,n.ScadaSymbolBehaviorType.value,n.ScadaSymbolBehaviorType.action).includes(n.behaviorFormGroup.get("type").value)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.behaviorFormGroup.get("type").value===n.ScadaSymbolBehaviorType.value),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.behaviorFormGroup.get("type").value===n.ScadaSymbolBehaviorType.action),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.behaviorFormGroup.get("type").value===n.ScadaSymbolBehaviorType.widgetAction),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(42,23,n.disabled?"action.close":"action.cancel")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.disabled))},dependencies:[p.NgForOf,p.NgIf,x.MatButton,E.MatIcon,L.MatInput,v.MatFormField,ce.MatSelect,ce.MatSelectTrigger,z.MatOption,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,Cg.I,xg.c,_g.f,Tr.m,u.TranslatePipe],styles:['@charset "UTF-8";.tb-scada-symbol-behavior-settings-panel{width:540px;display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 959px){.tb-scada-symbol-behavior-settings-panel{width:90vw}}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-panel-content{display:flex;flex-direction:column;gap:16px;overflow:auto;margin:-10px;padding:10px}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-panel-content .mat-mdc-form-field.tb-value-type .mat-mdc-form-field-infix{max-height:40px}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-panel-content .mat-mdc-form-field.tb-value-type mat-select-trigger .tb-value-type-row{display:flex;flex-direction:row;align-items:center;justify-content:flex-start;gap:10px}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-panel-content .mat-mdc-form-field.tb-value-type mat-select-trigger .tb-value-type-row .mat-icon{color:#00000061;vertical-align:bottom}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-title{font-size:16px;font-weight:500;line-height:24px;letter-spacing:.25px;color:#000000de}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-panel-buttons{height:40px;display:flex;flex-direction:row;gap:16px;justify-content:flex-end;align-items:flex-end}\n'],encapsulation:2})}}const Pg=["idInput"],kg=["editButton"];function Lg(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",13),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.scadaSymbolBehaviorTypeTranslations.get(i))," ")}}function Og(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",11),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.behaviorRemoved.emit())}),e.\u0275\u0275elementStart(2,"mat-icon"),e.\u0275\u0275text(3,"delete"),e.\u0275\u0275elementEnd()()}2&a&&e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(1,1,"scada.behavior.remove-behavior"))}const Xo=a=>{if(!a.id||!a.name||!a.type)return!1;switch(a.type){case A.LU.value:if(!a.valueType||!a.defaultGetValueSettings)return!1;break;case A.LU.action:if(!a.defaultSetValueSettings||a.defaultSetValueSettings.valueToData?.type===Ir.V9.CONSTANT&&(0,_.z)(a.defaultSetValueSettings.valueToData?.constantValue)||a.defaultSetValueSettings.valueToData?.type===Ir.V9.FUNCTION&&(0,_.z)(a.defaultSetValueSettings.valueToData?.valueToDataFunction))return!1;case A.LU.widgetAction:}return!0};class yt{constructor(t,i,n,o,r,l){this.fb=t,this.cd=i,this.popoverService=n,this.renderer=o,this.viewContainerRef=r,this.behaviorsComponent=l,this.scadaSymbolBehaviorTypes=A.gF,this.scadaSymbolBehaviorTypeTranslations=A.dr,this.behaviorRemoved=new e.EventEmitter,this.propagateChange=c=>{}}ngOnInit(){this.behaviorRowFormGroup=this.fb.group({id:[null,[this.behaviorIdValidator()]],name:[null,[s.Validators.required]],type:[null,[s.Validators.required]]}),this.behaviorRowFormGroup.valueChanges.subscribe(()=>this.updateModel()),this.behaviorRowFormGroup.get("type").valueChanges.subscribe(t=>{this.onTypeChanged(t)})}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}setDisabledState(t){this.disabled=t,t?this.behaviorRowFormGroup.disable({emitEvent:!1}):this.behaviorRowFormGroup.enable({emitEvent:!1})}writeValue(t){this.modelValue=t,this.behaviorRowFormGroup.patchValue({id:t?.id,name:t?.name,type:t?.type},{emitEvent:!1}),this.cd.markForCheck()}editBehavior(t,i,n=!1,o=()=>{}){t&&t.stopPropagation();const r=i._elementRef.nativeElement;if(this.popoverService.hasPopover(r))this.popoverService.hidePopover(r);else{const l={isAdd:n,disabled:this.disabled,aliasController:this.aliasController,callbacks:this.callbacks,behavior:(0,_.Go)(this.modelValue)},c=this.popoverService.displayPopover(r,this.renderer,this.viewContainerRef,Wa,["leftOnly","leftTopOnly","leftBottomOnly"],!0,null,l,{},{},{},!0);c.tbComponentRef.instance.popover=c,c.tbComponentRef.instance.behaviorSettingsApplied.subscribe(m=>{c.hide(),this.behaviorRowFormGroup.patchValue({id:m.id,name:m.name,type:m.type},{emitEvent:!1}),this.modelValue=m,this.propagateChange(this.modelValue)}),c.tbDestroy.subscribe(()=>{Xo(this.modelValue)||o()})}}focus(){this.idInput.nativeElement.scrollIntoView(),this.idInput.nativeElement.focus()}onAdd(t){this.idInput.nativeElement.scrollIntoView(),this.editBehavior(null,this.editButton,!0,t)}validate(t){const i=this.behaviorRowFormGroup.get("id");if(i.hasError("behaviorIdNotUnique")&&i.updateValueAndValidity({onlySelf:!1,emitEvent:!1}),i.hasError("behaviorIdNotUnique"))return this.behaviorRowFormGroup.get("id").markAsTouched(),{behaviorIdNotUnique:!0};const n={...this.modelValue,...this.behaviorRowFormGroup.value};return Xo(n)?null:{behavior:!0}}behaviorIdValidator(){return t=>t.value?this.behaviorsComponent.behaviorIdUnique(t.value,this.index)?null:{behaviorIdNotUnique:!0}:{required:!0}}onTypeChanged(t){const i=(0,_.Go)(this.modelValue);this.modelValue={...this.modelValue,type:t},this.modelValue=(0,A.CP)(this.modelValue),Xo(this.modelValue)||this.editBehavior(null,this.editButton,!1,()=>{this.modelValue=i,this.behaviorRowFormGroup.patchValue({type:i.type},{emitEvent:!0})})}updateModel(){const t=this.behaviorRowFormGroup.value;this.modelValue={...this.modelValue,...t},this.propagateChange(this.modelValue)}static{this.\u0275fac=function(i){return new(i||yt)(e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(Zo.TbPopoverService),e.\u0275\u0275directiveInject(e.Renderer2),e.\u0275\u0275directiveInject(e.ViewContainerRef),e.\u0275\u0275directiveInject(Xe))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:yt,selectors:[["tb-scada-symbol-metadata-behavior-row"]],viewQuery:function(i,n){if(1&i&&(e.\u0275\u0275viewQuery(Pg,5),e.\u0275\u0275viewQuery(kg,5)),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.idInput=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.editButton=o.first)}},inputs:{disabled:"disabled",index:"index",aliasController:"aliasController",callbacks:"callbacks"},outputs:{behaviorRemoved:"behaviorRemoved"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>yt),multi:!0},{provide:s.NG_VALIDATORS,useExisting:(0,e.forwardRef)(()=>yt),multi:!0}])],decls:18,vars:12,consts:[["idInput",""],["editButton",""],[1,"tb-form-table-row","tb-scada-symbol-metadata-behavior-row",3,"formGroup"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field","tb-id-field"],["required","","matInput","","formControlName","id",3,"placeholder"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field","tb-name-field"],["required","","matInput","","formControlName","name",3,"placeholder"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field","tb-type-field","fixed-height"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],[1,"tb-form-table-row-cell-buttons"],["type","button","mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"],["type","button","mat-icon-button","","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],[3,"value"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",2)(1,"mat-form-field",3),e.\u0275\u0275element(2,"input",4,0),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"mat-form-field",5),e.\u0275\u0275element(6,"input",6),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"mat-form-field",7)(9,"mat-select",8),e.\u0275\u0275template(10,Lg,3,4,"mat-option",9),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(11,"div",10)(12,"button",11,1),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275listener("click",function(l){e.\u0275\u0275restoreView(o);const c=e.\u0275\u0275reference(13);return e.\u0275\u0275resetView(n.editBehavior(l,c))}),e.\u0275\u0275elementStart(15,"mat-icon"),e.\u0275\u0275text(16,"settings"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(17,Og,4,3,"button",12),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275property("formGroup",n.behaviorRowFormGroup),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(4,6,"widget-config.set")),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(7,8,"widget-config.set")),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",n.scadaSymbolBehaviorTypes),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(14,10,"scada.behavior.behavior-settings")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",!n.disabled))},dependencies:[p.NgForOf,p.NgIf,x.MatIconButton,E.MatIcon,L.MatInput,v.MatFormField,ce.MatSelect,z.MatOption,_e.MatTooltip,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,u.TranslatePipe],styles:['@charset "UTF-8";.tb-scada-symbol-metadata-behavior-row .tb-id-field,.tb-scada-symbol-metadata-behavior-row .tb-name-field{flex:1 1 40%}.tb-scada-symbol-metadata-behavior-row .tb-type-field{flex:1 1 20%}\n'],encapsulation:2})}}function Rg(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"button",17),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275elementStart(2,"mat-icon"),e.\u0275\u0275text(3,"drag_indicator"),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(3);e.\u0275\u0275classProp("tb-hidden",!i.dragEnabled),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(1,3,"action.drag"))}}function Vg(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",13)(1,"tb-scada-symbol-metadata-behavior-row",14),e.\u0275\u0275listener("behaviorRemoved",function(){const o=e.\u0275\u0275restoreView(i).index,r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(r.removeBehavior(o))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(2,"div",15),e.\u0275\u0275template(3,Rg,4,5,"button",16),e.\u0275\u0275elementEnd()()}if(2&a){const i=t.$implicit,n=t.index,o=e.\u0275\u0275nextContext(2);e.\u0275\u0275classProp("tb-draggable-form-table-row",!o.disabled),e.\u0275\u0275property("cdkDragDisabled",!o.dragEnabled),e.\u0275\u0275advance(),e.\u0275\u0275property("index",n)("formControl",i)("aliasController",o.aliasController)("callbacks",o.callbacks),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!o.disabled)}}function Bg(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",11),e.\u0275\u0275listener("cdkDropListDropped",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.behaviorDrop(o))}),e.\u0275\u0275template(1,Vg,4,8,"div",12),e.\u0275\u0275elementEnd()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("cdkDropListDisabled",!i.dragEnabled),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",i.behaviorsFormArray().controls)("ngForTrackBy",i.trackByBehavior)}}function Gg(a,t){if(1&a&&e.\u0275\u0275element(0,"tb-error",18),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("error",i.errorText)}}function jg(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"button",19),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.addBehavior())}),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()}2&a&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"scada.behavior.add-behavior")," "))}function Ug(a,t){1&a&&(e.\u0275\u0275elementStart(0,"span",20),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"scada.behavior.no-behaviors")))}class Xe{get dragEnabled(){return!this.disabled&&this.behaviorsFormArray().controls.length>1}constructor(t,i){this.fb=t,this.translate=i,this.styleDisplay="flex",this.styleOverflow="hidden",this.errorText="",this.propagateChange=n=>{}}ngOnInit(){this.behaviorsFormGroup=this.fb.group({behaviors:this.fb.array([])}),this.behaviorsFormGroup.valueChanges.subscribe(()=>{let t=this.behaviorsFormGroup.get("behaviors").value;t&&(t=t.filter(i=>Xo(i))),this.propagateChange(t)})}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}setDisabledState(t){this.disabled=t,t?this.behaviorsFormGroup.disable({emitEvent:!1}):this.behaviorsFormGroup.enable({emitEvent:!1})}writeValue(t){const i=t||[];this.behaviorsFormGroup.setControl("behaviors",this.prepareBehaviorsFormArray(i),{emitEvent:!1})}validate(t){this.errorText="";const n=this.behaviorsFormGroup.get("behaviors").controls.filter(r=>r.hasError("behaviorIdNotUnique"));for(const r of n)r.updateValueAndValidity({onlySelf:!1,emitEvent:!1}),r.hasError("behaviorIdNotUnique")&&(this.errorText=this.translate.instant("scada.behavior.not-unique-behavior-ids-error"));return this.behaviorsFormGroup.valid?null:{behaviors:{valid:!1}}}behaviorIdUnique(t,i){const n=this.behaviorsFormGroup.get("behaviors");for(let o=0;o<n.controls.length;o++)if(o!==i){if(t===n.controls[o].value.id)return!1}return!0}behaviorDrop(t){const i=this.behaviorsFormGroup.get("behaviors"),n=i.at(t.previousIndex);i.removeAt(t.previousIndex),i.insert(t.currentIndex,n)}behaviorsFormArray(){return this.behaviorsFormGroup.get("behaviors")}trackByBehavior(t,i){return i}removeBehavior(t,i=!0){this.behaviorsFormGroup.get("behaviors").removeAt(t,{emitEvent:i})}addBehavior(){const t={id:"",name:"",type:A.LU.value,valueType:le.eV.BOOLEAN,defaultGetValueSettings:(0,_.D9)({},(0,A.U6)(le.eV.BOOLEAN))},i=this.behaviorsFormGroup.get("behaviors"),n=this.fb.control(t,[]);i.push(n),setTimeout(()=>{this.behaviorRows.get(this.behaviorRows.length-1).onAdd(()=>{this.removeBehavior(i.length-1)})})}prepareBehaviorsFormArray(t){const i=[];return t&&t.forEach(n=>{i.push(this.fb.control(n,[]))}),this.fb.array(i)}static{this.\u0275fac=function(i){return new(i||Xe)(e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(u.TranslateService))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Xe,selectors:[["tb-scada-symbol-metadata-behaviors"]],viewQuery:function(i,n){if(1&i&&e.\u0275\u0275viewQuery(yt,5),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.behaviorRows=o)}},hostVars:4,hostBindings:function(i,n){2&i&&e.\u0275\u0275styleProp("display",n.styleDisplay)("overflow",n.styleOverflow)},inputs:{aliasController:"aliasController",callbacks:"callbacks",disabled:"disabled"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>Xe),multi:!0},{provide:s.NG_VALIDATORS,useExisting:(0,e.forwardRef)(()=>Xe),multi:!0}])],decls:15,vars:8,consts:[["noBehaviors",""],[1,"tb-form-panel","tb-scada-symbol-behaviors"],[1,"tb-form-table"],[1,"tb-form-table-header"],["translate","",1,"tb-form-table-header-cell","tb-id-header"],["translate","",1,"tb-form-table-header-cell","tb-name-header"],["translate","",1,"tb-form-table-header-cell","tb-type-header"],[1,"tb-form-table-header-cell","tb-actions-header"],["class","tb-form-table-body tb-drop-list","cdkDropList","","cdkDropListOrientation","vertical",3,"cdkDropListDisabled","cdkDropListDropped",4,"ngIf","ngIfElse"],["noMargin","","style","padding-left: 12px;",3,"error",4,"ngIf"],[4,"ngIf"],["cdkDropList","","cdkDropListOrientation","vertical",1,"tb-form-table-body","tb-drop-list",3,"cdkDropListDropped","cdkDropListDisabled"],["cdkDrag","",3,"cdkDragDisabled","tb-draggable-form-table-row",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",3,"cdkDragDisabled"],[1,"flex-1",3,"behaviorRemoved","index","formControl","aliasController","callbacks"],[1,"tb-form-table-row-cell-buttons"],["mat-icon-button","","type","button","cdkDragHandle","","matTooltipPosition","above",3,"tb-hidden","matTooltip",4,"ngIf"],["mat-icon-button","","type","button","cdkDragHandle","","matTooltipPosition","above",3,"matTooltip"],["noMargin","",2,"padding-left","12px",3,"error"],["type","button","mat-stroked-button","","color","primary",3,"click"],[1,"tb-prompt","flex","items-center","justify-center"]],template:function(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),e.\u0275\u0275text(4,"scada.behavior.id"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",5),e.\u0275\u0275text(6,"scada.behavior.name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div",6),e.\u0275\u0275text(8,"scada.behavior.type"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"div",7),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(10,Bg,2,3,"div",8)(11,Gg,1,1,"tb-error",9),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(12,jg,4,3,"div",10),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(13,Ug,3,3,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)),2&i){const o=e.\u0275\u0275reference(14);e.\u0275\u0275advance(2),e.\u0275\u0275classProp("no-padding-right",!n.disabled),e.\u0275\u0275advance(7),e.\u0275\u0275classProp("disabled",n.disabled),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.behaviorsFormArray().controls.length)("ngIfElse",o),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.errorText),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n.disabled)}},styles:['@charset "UTF-8";.tb-scada-symbol-behaviors{flex:1;margin:12px}.tb-scada-symbol-behaviors .tb-form-table-header-cell.tb-id-header,.tb-scada-symbol-behaviors .tb-form-table-header-cell.tb-name-header{flex:1 1 40%}.tb-scada-symbol-behaviors .tb-form-table-header-cell.tb-type-header{flex:1 1 20%}.tb-scada-symbol-behaviors .tb-form-table-header-cell.tb-actions-header{width:120px;min-width:120px}.tb-scada-symbol-behaviors .tb-form-table-header-cell.tb-actions-header.disabled{width:40px;min-width:40px}.tb-scada-symbol-behaviors .tb-form-table{overflow:hidden}.tb-scada-symbol-behaviors .tb-form-table-body{overflow:auto}.tb-scada-symbol-behaviors .tb-form-table-body tb-scada-symbol-metadata-behavior-row{overflow:hidden}\n'],encapsulation:2})}}var ps=d(96771),qg=d(77674),Wg=d(62720),$g=d(31302),zg=d(25629),Hg=d(43116),Kg=d(95620);const Yg=(a,t)=>[a,t];function Qg(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",28),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.scadaSymbolPropertyTypeTranslations.get(i))," ")}}function Jg(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-form-field",5),e.\u0275\u0275element(1,"input",29),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(2,1,"widget-config.set")))}function Zg(a,t){1&a&&e.\u0275\u0275element(0,"tb-color-input",30)}function Xg(a,t){if(1&a&&e.\u0275\u0275element(0,"tb-color-settings",31),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("settingsKey",i.propertyFormGroup.get("id").value)}}function ef(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-form-field",32),e.\u0275\u0275element(1,"input",33),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(2,4,"widget-config.set")),e.\u0275\u0275property("min",i.propertyFormGroup.get("min").value)("max",i.propertyFormGroup.get("max").value)("step",i.propertyFormGroup.get("step").value)}}function tf(a,t){1&a&&e.\u0275\u0275element(0,"tb-font-settings",34)}function nf(a,t){1&a&&e.\u0275\u0275element(0,"tb-unit-input",35)}function af(a,t){if(1&a&&e.\u0275\u0275element(0,"tb-value-input",36),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("valueType",i.ValueType.BOOLEAN)}}function of(a,t){1&a&&e.\u0275\u0275element(0,"tb-material-icon-select",37)}function rf(a,t){1&a&&(e.\u0275\u0275elementStart(0,"div",10)(1,"div",38),e.\u0275\u0275text(2,"scada.property.number-settings"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",39)(4,"div",40),e.\u0275\u0275text(5,"scada.property.min"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"mat-form-field",41),e.\u0275\u0275element(7,"input",42),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"mat-divider",43),e.\u0275\u0275elementStart(10,"div",40),e.\u0275\u0275text(11,"scada.property.max"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"mat-form-field",41),e.\u0275\u0275element(13,"input",44),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(15,"mat-divider",43),e.\u0275\u0275elementStart(16,"div",40),e.\u0275\u0275text(17,"scada.property.step"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"mat-form-field",41),e.\u0275\u0275element(19,"input",45),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275elementEnd()()()),2&a&&(e.\u0275\u0275advance(7),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(8,3,"widget-config.set")),e.\u0275\u0275advance(6),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(14,5,"widget-config.set")),e.\u0275\u0275advance(6),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(20,7,"widget-config.set")))}function sf(a,t){1&a&&(e.\u0275\u0275elementStart(0,"div",10)(1,"div",4),e.\u0275\u0275text(2,"scada.property.input-field-suffix"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"mat-form-field",5),e.\u0275\u0275element(4,"input",51),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()),2&a&&(e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(5,1,"widget-config.set")))}function lf(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",28),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit;e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",i," ")}}function df(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",28),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit;e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",i," ")}}function cf(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",28),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit;e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",i," ")}}function pf(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",3)(1,"div",4),e.\u0275\u0275text(2,"scada.property.property-field-classes"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"mat-form-field",5)(4,"mat-select",52),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275template(6,cf,2,2,"mat-option",9),e.\u0275\u0275elementEnd()()()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(5,2,"widget-config.set")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",i.scadaSymbolPropertyFieldClasses)}}function mf(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",10)(1,"div",4),e.\u0275\u0275text(2,"scada.property.sub-label"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"mat-form-field",5),e.\u0275\u0275element(4,"input",46),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",10)(7,"mat-slide-toggle",47),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(10,sf,6,3,"div",19),e.\u0275\u0275elementStart(11,"div",10)(12,"div",4),e.\u0275\u0275text(13,"scada.property.disable-on-property"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"mat-form-field",5)(15,"mat-select",48),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275element(17,"mat-option",28),e.\u0275\u0275template(18,lf,2,2,"mat-option",9),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(19,"div",3)(20,"div",4),e.\u0275\u0275text(21,"scada.property.property-row-classes"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(22,"mat-form-field",5)(23,"mat-select",49),e.\u0275\u0275pipe(24,"translate"),e.\u0275\u0275template(25,df,2,2,"mat-option",9),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(26,pf,7,4,"div",50)),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(5,9,"widget-config.set")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(9,11,"scada.property.vertical-divider-after")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pureFunction2(17,Yg,i.ScadaSymbolPropertyType.number,i.ScadaSymbolPropertyType.text).includes(i.propertyFormGroup.get("type").value)),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(16,13,"widget-config.set")),e.\u0275\u0275advance(2),e.\u0275\u0275property("value",null),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",i.booleanPropertyIds),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(24,15,"widget-config.set")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",i.scadaSymbolPropertyRowClasses),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.propertyFormGroup.get("type").value!==i.ScadaSymbolPropertyType.switch)}}function uf(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",53),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.applyPropertySettings())}),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("disabled",i.propertyFormGroup.invalid||!i.propertyFormGroup.dirty),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,i.isAdd?"action.add":"action.apply")," ")}}class $a{constructor(t){this.fb=t,this.ValueType=le.eV,this.ScadaSymbolPropertyType=A._K,this.scadaSymbolPropertyTypes=A.jz,this.scadaSymbolPropertyTypeTranslations=A.eu,this.scadaSymbolPropertyRowClasses=A.Hn,this.scadaSymbolPropertyFieldClasses=A.K,this.isAdd=!1,this.propertySettingsApplied=new e.EventEmitter}ngOnInit(){this.panelTitle=this.isAdd?"scada.property.add-property":"scada.property.property-settings",this.propertyType=this.property.type,this.propertyFormGroup=this.fb.group({id:[this.property.id,[s.Validators.required]],name:[this.property.name,[s.Validators.required]],type:[this.property.type,[s.Validators.required]],default:[this.property.default,[]],required:[this.property.required,[]],subLabel:[this.property.subLabel,[]],divider:[this.property.divider,[]],fieldSuffix:[this.property.fieldSuffix,[]],disableOnProperty:[this.property.disableOnProperty,[]],rowClass:[(this.property.rowClass||"").split(" "),[]],fieldClass:[(this.property.fieldClass||"").split(" "),[]],min:[this.property.min,[]],max:[this.property.max,[]],step:[this.property.step,[s.Validators.min(0)]]}),this.disabled?this.propertyFormGroup.disable({emitEvent:!1}):(this.propertyFormGroup.get("type").valueChanges.subscribe(()=>{this.updateValidators()}),this.updateValidators())}cancel(){this.popover?.hide()}applyPropertySettings(){const t=this.propertyFormGroup.getRawValue();t.rowClass=(t.rowClass||[]).join(" "),t.fieldClass=(t.fieldClass||[]).join(" "),this.propertySettingsApplied.emit(t)}updateValidators(){const t=this.propertyFormGroup.get("type").value;if(t===A._K.number?(this.propertyFormGroup.get("min").enable({emitEvent:!1}),this.propertyFormGroup.get("max").enable({emitEvent:!1}),this.propertyFormGroup.get("step").enable({emitEvent:!1})):(this.propertyFormGroup.get("min").disable({emitEvent:!1}),this.propertyFormGroup.get("max").disable({emitEvent:!1}),this.propertyFormGroup.get("step").disable({emitEvent:!1})),this.propertyType!==t){const i=ms(t);this.propertyFormGroup.get("default").patchValue(i,{emitEvent:!1}),this.propertyType=t}}static{this.\u0275fac=function(i){return new(i||$a)(e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:$a,selectors:[["tb-scada-symbol-property-panel"]],inputs:{isAdd:"isAdd",property:"property",booleanPropertyIds:"booleanPropertyIds",disabled:"disabled",popover:"popover"},outputs:{propertySettingsApplied:"propertySettingsApplied"},decls:51,vars:30,consts:[[1,"tb-scada-symbol-property-settings-panel",3,"formGroup"],[1,"tb-scada-symbol-property-settings-title"],[1,"tb-scada-symbol-property-settings-panel-content"],[1,"tb-form-row"],["translate","",1,"fixed-title-width"],["appearance","outline","subscriptSizing","dynamic",1,"flex"],["required","","matInput","","formControlName","id",3,"placeholder"],["required","","matInput","","formControlName","name",3,"placeholder"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],[1,"tb-form-row","space-between"],["class","flex","appearance","outline","subscriptSizing","dynamic",4,"ngIf"],["asBoxInput","","colorClearButton","","formControlName","default",4,"ngIf"],["formControlName","default",3,"settingsKey",4,"ngIf"],["appearance","outline","class","number","subscriptSizing","dynamic",4,"ngIf"],["formControlName","default","clearButton","","disabledLineHeight","",4,"ngIf"],["formControlName","default",4,"ngIf"],["formControlName","default",3,"valueType",4,"ngIf"],["asBoxInput","","formControlName","default",4,"ngIf"],["class","tb-form-row space-between",4,"ngIf"],["formControlName","required",1,"mat-slide","fixed-title-width"],[1,"tb-form-panel","stroked"],[1,"tb-settings"],[1,"flex","flex-row","flex-wrap"],["matExpansionPanelContent",""],[1,"tb-scada-symbol-property-settings-panel-buttons"],["mat-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",3,"disabled","click",4,"ngIf"],[3,"value"],["matInput","","formControlName","default",3,"placeholder"],["asBoxInput","","colorClearButton","","formControlName","default"],["formControlName","default",3,"settingsKey"],["appearance","outline","subscriptSizing","dynamic",1,"number"],["matInput","","formControlName","default","type","number",3,"min","max","step","placeholder"],["formControlName","default","clearButton","","disabledLineHeight",""],["formControlName","default"],["formControlName","default",3,"valueType"],["asBoxInput","","formControlName","default"],["translate",""],[1,"flex","flex-1","flex-row","items-center","justify-end","gap-2"],["translate","",1,"tb-small-label"],["appearance","outline","subscriptSizing","dynamic",1,"number","flex"],["matInput","","formControlName","min","type","number",3,"placeholder"],["vertical",""],["matInput","","formControlName","max","type","number",3,"placeholder"],["matInput","","formControlName","step","min","0","type","number",3,"placeholder"],["matInput","","formControlName","subLabel",3,"placeholder"],["formControlName","divider",1,"mat-slide","fixed-title-width"],["formControlName","disableOnProperty",3,"placeholder"],["formControlName","rowClass","multiple","",3,"placeholder"],["class","tb-form-row",4,"ngIf"],["matInput","","formControlName","fieldSuffix",3,"placeholder"],["formControlName","fieldClass","multiple","",3,"placeholder"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",2)(5,"div",3)(6,"div",4),e.\u0275\u0275text(7,"scada.property.id"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"mat-form-field",5),e.\u0275\u0275element(9,"input",6),e.\u0275\u0275pipe(10,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(11,"div",3)(12,"div",4),e.\u0275\u0275text(13,"scada.property.name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"mat-form-field",5),e.\u0275\u0275element(15,"input",7),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(17,"div",3)(18,"div",4),e.\u0275\u0275text(19,"scada.property.type"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"mat-form-field",5)(21,"mat-select",8),e.\u0275\u0275template(22,Qg,3,4,"mat-option",9),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(23,"div",10)(24,"div",4),e.\u0275\u0275text(25,"scada.property.default-value"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(26,Jg,3,3,"mat-form-field",11)(27,Zg,1,0,"tb-color-input",12)(28,Xg,1,1,"tb-color-settings",13)(29,ef,3,6,"mat-form-field",14)(30,tf,1,0,"tb-font-settings",15)(31,nf,1,0,"tb-unit-input",16)(32,af,1,1,"tb-value-input",17)(33,of,1,0,"tb-material-icon-select",18),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(34,rf,21,9,"div",19),e.\u0275\u0275elementStart(35,"div",10)(36,"mat-slide-toggle",20),e.\u0275\u0275text(37),e.\u0275\u0275pipe(38,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(39,"div",21)(40,"mat-expansion-panel",22)(41,"mat-expansion-panel-header",23)(42,"mat-panel-title"),e.\u0275\u0275text(43),e.\u0275\u0275pipe(44,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(45,mf,27,20,"ng-template",24),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(46,"div",25)(47,"button",26),e.\u0275\u0275listener("click",function(){return n.cancel()}),e.\u0275\u0275text(48),e.\u0275\u0275pipe(49,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(50,uf,3,4,"button",27),e.\u0275\u0275elementEnd()()),2&i&&(e.\u0275\u0275property("formGroup",n.propertyFormGroup),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,18,n.panelTitle)),e.\u0275\u0275advance(7),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(10,20,"widget-config.set")),e.\u0275\u0275advance(6),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(16,22,"widget-config.set")),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngForOf",n.scadaSymbolPropertyTypes),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",n.propertyFormGroup.get("type").value===n.ScadaSymbolPropertyType.text),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.propertyFormGroup.get("type").value===n.ScadaSymbolPropertyType.color),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.propertyFormGroup.get("type").value===n.ScadaSymbolPropertyType.color_settings),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.propertyFormGroup.get("type").value===n.ScadaSymbolPropertyType.number),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.propertyFormGroup.get("type").value===n.ScadaSymbolPropertyType.font),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.propertyFormGroup.get("type").value===n.ScadaSymbolPropertyType.units),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.propertyFormGroup.get("type").value===n.ScadaSymbolPropertyType.switch),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.propertyFormGroup.get("type").value===n.ScadaSymbolPropertyType.icon),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.propertyFormGroup.get("type").value===n.ScadaSymbolPropertyType.number),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(38,24,"scada.property.value-required")," "),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(44,26,"scada.property.advanced-ui-settings")," "),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(49,28,n.disabled?"action.close":"action.cancel")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.disabled))},dependencies:[p.NgForOf,p.NgIf,qg.ValueInputComponent,x.MatButton,L.MatInput,v.MatFormField,ce.MatSelect,z.MatOption,Ye.MatDivider,pe.MatSlideToggle,U.MatExpansionPanel,U.MatExpansionPanelHeader,U.MatExpansionPanelTitle,U.MatExpansionPanelContent,s.DefaultValueAccessor,s.NumberValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.MinValidator,s.MaxValidator,s.FormGroupDirective,s.FormControlName,Wg.ColorInputComponent,$g.MaterialIconSelectComponent,u.TranslateDirective,zg.UnitInputComponent,Hg.FontSettingsComponent,Kg.ColorSettingsComponent,u.TranslatePipe],styles:['@charset "UTF-8";.tb-scada-symbol-property-settings-panel{width:540px;display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 959px){.tb-scada-symbol-property-settings-panel{width:90vw}}.tb-scada-symbol-property-settings-panel .tb-scada-symbol-property-settings-panel-content{display:flex;flex-direction:column;gap:16px;overflow:auto;margin:-10px;padding:10px}.tb-scada-symbol-property-settings-panel .tb-scada-symbol-property-settings-title{font-size:16px;font-weight:500;line-height:24px;letter-spacing:.25px;color:#000000de}.tb-scada-symbol-property-settings-panel .tb-scada-symbol-property-settings-panel-buttons{height:40px;display:flex;flex-direction:row;gap:16px;justify-content:flex-end;align-items:flex-end}\n'],encapsulation:2})}}const gf=["idInput"],ff=["editButton"];function hf(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",13),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.scadaSymbolPropertyTypeTranslations.get(i))," ")}}function bf(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",11),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.propertyRemoved.emit())}),e.\u0275\u0275elementStart(2,"mat-icon"),e.\u0275\u0275text(3,"delete"),e.\u0275\u0275elementEnd()()}2&a&&e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(1,1,"scada.property.remove-property"))}const wr=a=>!(!a.id||!a.name||!a.type),ms=a=>{switch(a){case A._K.text:return"";case A._K.number:return 0;case A._K.switch:return!1;case A._K.color:return"#000";case A._K.color_settings:return(0,ps.sj)("#000");case A._K.font:return{size:12,sizeUnit:"px",family:"Roboto",weight:"normal",style:"normal",lineHeight:"1"};case A._K.units:return"";case A._K.icon:return"star"}};class vt{constructor(t,i,n,o,r,l){this.fb=t,this.cd=i,this.popoverService=n,this.renderer=o,this.viewContainerRef=r,this.propertiesComponent=l,this.scadaSymbolPropertyTypes=A.jz,this.scadaSymbolPropertyTypeTranslations=A.eu,this.propertyRemoved=new e.EventEmitter,this.propagateChange=c=>{}}ngOnInit(){this.propertyRowFormGroup=this.fb.group({id:[null,[this.propertyIdValidator()]],name:[null,[s.Validators.required]],type:[null,[s.Validators.required]]}),this.propertyRowFormGroup.valueChanges.subscribe(()=>this.updateModel()),this.propertyRowFormGroup.get("type").valueChanges.subscribe(t=>{this.onTypeChanged(t)})}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}setDisabledState(t){this.disabled=t,t?this.propertyRowFormGroup.disable({emitEvent:!1}):this.propertyRowFormGroup.enable({emitEvent:!1})}writeValue(t){this.modelValue=t,this.propertyRowFormGroup.patchValue({id:t?.id,name:t?.name,type:t?.type},{emitEvent:!1}),this.cd.markForCheck()}editProperty(t,i,n=!1,o=()=>{}){t&&t.stopPropagation();const r=i._elementRef.nativeElement;if(this.popoverService.hasPopover(r))this.popoverService.hidePopover(r);else{const l={isAdd:n,disabled:this.disabled,booleanPropertyIds:this.booleanPropertyIds,property:(0,_.Go)(this.modelValue)},c=this.popoverService.displayPopover(r,this.renderer,this.viewContainerRef,$a,["leftOnly","leftTopOnly","leftBottomOnly"],!0,null,l,{},{},{},!0);c.tbComponentRef.instance.popover=c,c.tbComponentRef.instance.propertySettingsApplied.subscribe(m=>{c.hide(),this.propertyRowFormGroup.patchValue({id:m.id,name:m.name,type:m.type},{emitEvent:!1}),this.modelValue=m,this.propagateChange(this.modelValue)}),c.tbDestroy.subscribe(()=>{wr(this.modelValue)||o()})}}focus(){this.idInput.nativeElement.scrollIntoView(),this.idInput.nativeElement.focus()}onAdd(t){this.idInput.nativeElement.scrollIntoView(),this.editProperty(null,this.editButton,!0,t)}validate(t){const i=this.propertyRowFormGroup.get("id");if(i.hasError("propertyIdNotUnique")&&i.updateValueAndValidity({onlySelf:!1,emitEvent:!1}),i.hasError("propertyIdNotUnique"))return this.propertyRowFormGroup.get("id").markAsTouched(),{propertyIdNotUnique:!0};const n={...this.modelValue,...this.propertyRowFormGroup.value};return wr(n)?null:{property:!0}}propertyIdValidator(){return t=>t.value?this.propertiesComponent.propertyIdUnique(t.value,this.index)?null:{propertyIdNotUnique:!0}:{required:!0}}onTypeChanged(t){this.modelValue={...this.modelValue,type:t},this.modelValue.default=ms(t)}updateModel(){const t=this.propertyRowFormGroup.value;this.modelValue={...this.modelValue,...t},this.propagateChange(this.modelValue)}static{this.\u0275fac=function(i){return new(i||vt)(e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(Zo.TbPopoverService),e.\u0275\u0275directiveInject(e.Renderer2),e.\u0275\u0275directiveInject(e.ViewContainerRef),e.\u0275\u0275directiveInject(et))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:vt,selectors:[["tb-scada-symbol-metadata-property-row"]],viewQuery:function(i,n){if(1&i&&(e.\u0275\u0275viewQuery(gf,5),e.\u0275\u0275viewQuery(ff,5)),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.idInput=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.editButton=o.first)}},inputs:{disabled:"disabled",index:"index",booleanPropertyIds:"booleanPropertyIds"},outputs:{propertyRemoved:"propertyRemoved"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>vt),multi:!0},{provide:s.NG_VALIDATORS,useExisting:(0,e.forwardRef)(()=>vt),multi:!0}])],decls:18,vars:12,consts:[["idInput",""],["editButton",""],[1,"tb-form-table-row","tb-scada-symbol-metadata-property-row",3,"formGroup"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field","tb-id-field"],["required","","matInput","","formControlName","id",3,"placeholder"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field","tb-name-field"],["required","","matInput","","formControlName","name",3,"placeholder"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field","tb-type-field","fixed-height"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],[1,"tb-form-table-row-cell-buttons"],["type","button","mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"],["type","button","mat-icon-button","","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],[3,"value"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",2)(1,"mat-form-field",3),e.\u0275\u0275element(2,"input",4,0),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"mat-form-field",5),e.\u0275\u0275element(6,"input",6),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"mat-form-field",7)(9,"mat-select",8),e.\u0275\u0275template(10,hf,3,4,"mat-option",9),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(11,"div",10)(12,"button",11,1),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275listener("click",function(l){e.\u0275\u0275restoreView(o);const c=e.\u0275\u0275reference(13);return e.\u0275\u0275resetView(n.editProperty(l,c))}),e.\u0275\u0275elementStart(15,"mat-icon"),e.\u0275\u0275text(16,"settings"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(17,bf,4,3,"button",12),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275property("formGroup",n.propertyRowFormGroup),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(4,6,"widget-config.set")),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(7,8,"widget-config.set")),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",n.scadaSymbolPropertyTypes),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(14,10,"scada.property.property-settings")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",!n.disabled))},dependencies:[p.NgForOf,p.NgIf,x.MatIconButton,E.MatIcon,L.MatInput,v.MatFormField,ce.MatSelect,z.MatOption,_e.MatTooltip,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,u.TranslatePipe],styles:['@charset "UTF-8";.tb-scada-symbol-metadata-property-row .tb-id-field,.tb-scada-symbol-metadata-property-row .tb-name-field{flex:1 1 40%}.tb-scada-symbol-metadata-property-row .tb-type-field{flex:1 1 20%}\n'],encapsulation:2})}}function yf(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"button",17),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275elementStart(2,"mat-icon"),e.\u0275\u0275text(3,"drag_indicator"),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(3);e.\u0275\u0275classProp("tb-hidden",!i.dragEnabled),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(1,3,"action.drag"))}}function vf(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",13)(1,"tb-scada-symbol-metadata-property-row",14),e.\u0275\u0275listener("propertyRemoved",function(){const o=e.\u0275\u0275restoreView(i).index,r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(r.removeProperty(o))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(2,"div",15),e.\u0275\u0275template(3,yf,4,5,"button",16),e.\u0275\u0275elementEnd()()}if(2&a){const i=t.$implicit,n=t.index,o=e.\u0275\u0275nextContext(2);e.\u0275\u0275classProp("tb-draggable-form-table-row",!o.disabled),e.\u0275\u0275property("cdkDragDisabled",!o.dragEnabled),e.\u0275\u0275advance(),e.\u0275\u0275property("index",n)("booleanPropertyIds",o.booleanPropertyIds)("formControl",i),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!o.disabled)}}function Cf(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",11),e.\u0275\u0275listener("cdkDropListDropped",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.propertyDrop(o))}),e.\u0275\u0275template(1,vf,4,7,"div",12),e.\u0275\u0275elementEnd()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("cdkDropListDisabled",!i.dragEnabled),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",i.propertiesFormArray().controls)("ngForTrackBy",i.trackByProperty)}}function xf(a,t){if(1&a&&e.\u0275\u0275element(0,"tb-error",18),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("error",i.errorText)}}function _f(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"button",19),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.addProperty())}),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()}2&a&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"scada.property.add-property")," "))}function Sf(a,t){1&a&&(e.\u0275\u0275elementStart(0,"span",20),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"scada.property.no-properties")))}class et{get dragEnabled(){return!this.disabled&&this.propertiesFormArray().controls.length>1}constructor(t,i){this.fb=t,this.translate=i,this.styleDisplay="flex",this.styleOverflow="hidden",this.booleanPropertyIds=[],this.errorText="",this.propagateChange=n=>{}}ngOnInit(){this.propertiesFormGroup=this.fb.group({properties:this.fb.array([])}),this.propertiesFormGroup.valueChanges.subscribe(()=>{let t=this.propertiesFormGroup.get("properties").value;t&&(t=t.filter(i=>wr(i))),this.booleanPropertyIds=t.filter(i=>i.type===A._K.switch).map(i=>i.id),t.forEach((i,n)=>{i.disableOnProperty&&!this.booleanPropertyIds.includes(i.disableOnProperty)&&(i.disableOnProperty=null,this.propertiesFormArray().controls[n].patchValue(i,{emitEvent:!1}))}),this.propagateChange(t)})}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}setDisabledState(t){this.disabled=t,t?this.propertiesFormGroup.disable({emitEvent:!1}):this.propertiesFormGroup.enable({emitEvent:!1})}writeValue(t){const i=t||[];this.propertiesFormGroup.setControl("properties",this.preparePropertiesFormArray(i),{emitEvent:!1}),this.booleanPropertyIds=i.filter(n=>n.type===A._K.switch).map(n=>n.id)}validate(t){this.errorText="";const n=this.propertiesFormGroup.get("properties").controls.filter(r=>r.hasError("propertyIdNotUnique"));for(const r of n)r.updateValueAndValidity({onlySelf:!1,emitEvent:!1}),r.hasError("propertyIdNotUnique")&&(this.errorText=this.translate.instant("scada.property.not-unique-property-ids-error"));return this.propertiesFormGroup.valid?null:{properties:{valid:!1}}}propertyIdUnique(t,i){const n=this.propertiesFormGroup.get("properties");for(let o=0;o<n.controls.length;o++)if(o!==i){if(t===n.controls[o].value.id)return!1}return!0}propertyDrop(t){const i=this.propertiesFormGroup.get("properties"),n=i.at(t.previousIndex);i.removeAt(t.previousIndex),i.insert(t.currentIndex,n)}propertiesFormArray(){return this.propertiesFormGroup.get("properties")}trackByProperty(t,i){return i}removeProperty(t,i=!0){this.propertiesFormGroup.get("properties").removeAt(t,{emitEvent:i})}addProperty(){const t={id:"",name:"",type:A._K.text,default:""},i=this.propertiesFormGroup.get("properties"),n=this.fb.control(t,[]);i.push(n),setTimeout(()=>{this.propertyRows.get(this.propertyRows.length-1).onAdd(()=>{this.removeProperty(i.length-1)})})}preparePropertiesFormArray(t){const i=[];return t&&t.forEach(n=>{i.push(this.fb.control(n,[]))}),this.fb.array(i)}static{this.\u0275fac=function(i){return new(i||et)(e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(u.TranslateService))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:et,selectors:[["tb-scada-symbol-metadata-properties"]],viewQuery:function(i,n){if(1&i&&e.\u0275\u0275viewQuery(vt,5),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.propertyRows=o)}},hostVars:4,hostBindings:function(i,n){2&i&&e.\u0275\u0275styleProp("display",n.styleDisplay)("overflow",n.styleOverflow)},inputs:{disabled:"disabled"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>et),multi:!0},{provide:s.NG_VALIDATORS,useExisting:(0,e.forwardRef)(()=>et),multi:!0}])],decls:15,vars:8,consts:[["noProperties",""],[1,"tb-form-panel","tb-scada-symbol-properties"],[1,"tb-form-table"],[1,"tb-form-table-header"],["translate","",1,"tb-form-table-header-cell","tb-id-header"],["translate","",1,"tb-form-table-header-cell","tb-name-header"],["translate","",1,"tb-form-table-header-cell","tb-type-header"],[1,"tb-form-table-header-cell","tb-actions-header"],["class","tb-form-table-body tb-drop-list","cdkDropList","","cdkDropListOrientation","vertical",3,"cdkDropListDisabled","cdkDropListDropped",4,"ngIf","ngIfElse"],["noMargin","","style","padding-left: 12px;",3,"error",4,"ngIf"],[4,"ngIf"],["cdkDropList","","cdkDropListOrientation","vertical",1,"tb-form-table-body","tb-drop-list",3,"cdkDropListDropped","cdkDropListDisabled"],["cdkDrag","",3,"cdkDragDisabled","tb-draggable-form-table-row",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",3,"cdkDragDisabled"],[1,"flex-1",3,"propertyRemoved","index","booleanPropertyIds","formControl"],[1,"tb-form-table-row-cell-buttons"],["mat-icon-button","","type","button","cdkDragHandle","","matTooltipPosition","above",3,"tb-hidden","matTooltip",4,"ngIf"],["mat-icon-button","","type","button","cdkDragHandle","","matTooltipPosition","above",3,"matTooltip"],["noMargin","",2,"padding-left","12px",3,"error"],["type","button","mat-stroked-button","","color","primary",3,"click"],[1,"tb-prompt","flex","items-center","justify-center"]],template:function(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),e.\u0275\u0275text(4,"scada.property.id"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",5),e.\u0275\u0275text(6,"scada.property.name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div",6),e.\u0275\u0275text(8,"scada.property.type"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"div",7),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(10,Cf,2,3,"div",8)(11,xf,1,1,"tb-error",9),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(12,_f,4,3,"div",10),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(13,Sf,3,3,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)),2&i){const o=e.\u0275\u0275reference(14);e.\u0275\u0275advance(2),e.\u0275\u0275classProp("no-padding-right",!n.disabled),e.\u0275\u0275advance(7),e.\u0275\u0275classProp("disabled",n.disabled),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.propertiesFormArray().controls.length)("ngIfElse",o),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.errorText),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n.disabled)}},styles:['@charset "UTF-8";.tb-scada-symbol-properties{flex:1;margin:12px}.tb-scada-symbol-properties .tb-form-table-header-cell.tb-id-header,.tb-scada-symbol-properties .tb-form-table-header-cell.tb-name-header{flex:1 1 40%}.tb-scada-symbol-properties .tb-form-table-header-cell.tb-type-header{flex:1 1 20%}.tb-scada-symbol-properties .tb-form-table-header-cell.tb-actions-header{width:120px;min-width:120px}.tb-scada-symbol-properties .tb-form-table-header-cell.tb-actions-header.disabled{width:40px;min-width:40px}.tb-scada-symbol-properties .tb-form-table{overflow:hidden}.tb-scada-symbol-properties .tb-form-table-body{overflow:auto}.tb-scada-symbol-properties .tb-form-table-body tb-scada-symbol-metadata-property-row{overflow:hidden}\n'],encapsulation:2})}}const Tf=["symbolMetadataTags"],If=[[["",8,"tb-scada-symbol-metadata-header-prefix"]],[["",8,"tb-scada-symbol-metadata-header-suffix"]]],wf=[".tb-scada-symbol-metadata-header-prefix",".tb-scada-symbol-metadata-header-suffix"],Ef=()=>["ctx","svg"];function Mf(a,t){if(1&a&&e.\u0275\u0275element(0,"tb-js-func",28),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("editorCompleter",i.generalStateRenderFunctionCompleter)("highlightRules",i.highlightRules)("functionArgs",e.\u0275\u0275pureFunction0(3,Ef))}}class Ct extends de.H{constructor(t,i,n,o){super(t),this.store=t,this.fb=i,this.translate=n,this.customTranslate=o,this.propagateChange=null,this.headerOptions=[{name:this.translate.instant("scada.general"),value:"general"},{name:this.translate.instant("scada.tags"),value:"tags"},{name:this.translate.instant("scada.behavior.behavior"),value:"behavior"},{name:this.translate.instant("scada.properties"),value:"properties"}],this.selectedOption="general",this.highlightRules=Wu}ngOnInit(){this.metadataFormGroup=this.fb.group({title:[null,[s.Validators.required]],description:[null],searchTags:[null],widgetSizeX:[null,[s.Validators.min(1),s.Validators.max(24),s.Validators.required]],widgetSizeY:[null,[s.Validators.min(1),s.Validators.max(24),s.Validators.required]],stateRenderFunction:[null],tags:[null],behavior:[null],properties:[null]}),this.updateFunctionCompleters((0,A.fs)()),this.metadataFormGroup.valueChanges.subscribe(()=>{this.updateModel()})}ngOnChanges(t){for(const i of Object.keys(t)){const n=t[i];!n.firstChange&&n.currentValue!==n.previousValue&&["tags"].includes(i)&&this.updateFunctionCompleters(this.modelValue)}}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}setDisabledState(t){this.disabled=t,t?this.metadataFormGroup.disable({emitEvent:!1}):this.metadataFormGroup.enable({emitEvent:!1})}writeValue(t){this.modelValue=t,this.metadataFormGroup.patchValue({title:t?.title,description:t?.description,searchTags:t?.searchTags,widgetSizeX:t?.widgetSizeX||3,widgetSizeY:t?.widgetSizeY||3,stateRenderFunction:t?.stateRenderFunction,tags:t?.tags,behavior:t?.behavior,properties:t?.properties},{emitEvent:!1}),this.updateFunctionCompleters(t)}editTagStateRenderFunction(t){this.selectedOption="tags",this.symbolMetadataTags.editTagStateRenderFunction(t)}editTagClickAction(t){this.selectedOption="tags",this.symbolMetadataTags.editTagClickAction(t)}validate(t){return this.metadataFormGroup.valid?null:{metadata:{valid:!1}}}updateModel(){const t=this.metadataFormGroup.getRawValue();this.modelValue=t,this.propagateChange(this.modelValue),this.updateFunctionCompleters(t)}updateFunctionCompleters(t){const i=((a,t,i)=>{const o=`<a href="${le.Hu.linksMap.scadaSymbolDevAnimation}" target="_blank">ScadaSymbolAnimation</a>`,r={meta:"object",type:"object",description:"An object holding all defined SCADA symbol properties.",children:{}};for(const h of a.properties)r.children[h.id]=Qu(h,i);const l={meta:"object",type:"object",description:'An object holding all values obtained using behaviors of type <b>"Value"</b>',children:{}},c=a.behavior.filter(h=>h.type===A.LU.value);for(const h of c)l.children[h.id]=Ju(h,i);const m={meta:"object",type:"object",description:"An object holding all tagged SVG elements grouped by tags (object keys).",children:{}};if(t?.length)for(const h of t)m.children[h]={meta:"property",description:"An array of SVG elements.",type:"Array<Element>"};return{meta:"argument",type:"ScadaSymbolContext",description:"Context of the SCADA symbol.",children:{api:{meta:"object",type:"ScadaSymbolApi",description:"SCADA symbol API",children:{cssAnimate:{meta:"function",description:"Finishes any previous CSS animation and starts new CSS animation for SVG element.",args:[{name:"element",description:"SVG element",type:"Element"},{name:"duration",description:"Animation duration in milliseconds",type:"number"}],return:{description:`Instance of ${o} class with API to setup and control the animation.`,type:o}},cssAnimation:{meta:"function",description:"Get the current CSS animation applied for the SVG element.",args:[{name:"element",description:"SVG element",type:"Element"}],return:{description:`Instance of ${o} class with API to setup and control the animation.`,type:o}},resetCssAnimation:{meta:"function",description:"Stops CSS animation if any and restore SVG element initial state, removes CSS animation instance.",args:[{name:"element",description:"SVG element",type:"Element"}]},finishCssAnimation:{meta:"function",description:"Finishes CSS animation if any, SVG element state updated according to the end animation values, removes CSS animation instance.",args:[{name:"element",description:"SVG element",type:"Element"}]},generateElementId:{meta:"function",description:"Generates new unique element id.",args:[],return:{type:"string",description:"Newly generated element id."}},formatValue:{meta:"function",description:"Formats numeric value according to specified decimals and units",args:[{name:"value",description:"Numeric value to be formatted",type:"any"},{name:"dec",description:"Number of decimal digits",type:"number",optional:!0},{name:"units",description:"Units to append to the formatted value",type:"string",optional:!0},{name:"showZeroDecimals",description:"Whether to keep zero decimal digits",type:"boolean",optional:!0}],return:{type:"string",description:"Formatted value"}},text:{meta:"function",description:'Set text to element(s). Only applicable for elements of type <a href="https://svgjs.dev/docs/3.2/shape-elements/#svg-text" target="_blank">SVG.Text</a> or <a href="https://svgjs.dev/docs/3.2/shape-elements/#svg-tspan" target="_blank">SVG.Tspan</a>.',args:[{name:"element",description:"SVG element or an array of SVG elements",type:"Element | Array&lt;Element&gt;"},{name:"text",description:"Text to be set",type:"string"}]},font:{meta:"function",description:'Set element(s) text font and color. Only applicable for elements of type <a href="https://svgjs.dev/docs/3.2/shape-elements/#svg-text" target="_blank">SVG.Text</a> or <a href="https://svgjs.dev/docs/3.2/shape-elements/#svg-tspan" target="_blank">SVG.Tspan</a>.',args:[{name:"element",description:"SVG element or an array of SVG elements",type:"Element | Array&lt;Element&gt;"},{name:"font",description:"Font settings object used to apply text element font",type:"Font"},{name:"color",description:"Color string used to apply text color of the element",type:"string"}]},icon:{meta:"function",description:'Draws icon inside element(s). Only applicable for elements of type <a href="https://svgjs.dev/docs/3.2/container-elements/#svg-g" target="_blank">SVG.G</a>.',args:[{name:"element",description:"SVG element or an array of SVG elements",type:"Element | Array&lt;Element&gt;"},{name:"icon",description:"Icon to draw",type:"string"},{name:"size",description:"Optional icon size in pixels. Default 12 pixels.",type:"number",optional:!0},{name:"color",description:"Optional icon color. Default #0000008A.",type:"string",optional:!0},{name:"center",description:"Whether to center icon inside group element. Default true.",type:"boolean",optional:!0}]},disable:{meta:"function",description:"Disables element(s). Disabled element doesn't accept any user interaction. For ex. if disabled element has click action, no click action will be performed on user click.",args:[{name:"element",description:"SVG element or an array of SVG elements",type:"Element | Array&lt;Element&gt;"}]},enable:{meta:"function",description:"Enables disabled element(s). Enabled element accepts user interaction. For ex. if element has click action, click action will be performed on user click.",args:[{name:"element",description:"SVG element or an array of SVG elements",type:"Element | Array&lt;Element&gt;"}]},callAction:{meta:"function",description:'Invokes action specified by behavior of type <b>"Action"</b> found by <b>behaviorId</b>.',args:[{name:"event",description:"DOM event",type:"Event"},{name:"behaviorId",description:'Id of the <b>"Action"</b> behavior',type:"string"},{name:"value",description:"Optional value passed to behavior",type:"any",optional:!0},{name:"observer",description:"Optional observer callback",type:"Partial&lt;Observer&lt;void&gt;&gt;",optional:!0}]},setValue:{meta:"function",description:"Updates value by <b>valueId</b>. See <code>ctx.values</code> for reference. Value update triggers all render functions.",args:[{name:"valueId",description:"Id of the value to be updated",type:"string"},{name:"value",description:"New value to be set",type:"any"}]}}},properties:r,values:l,tags:m,svg:{meta:"argument",type:'<a href="https://svgjs.dev/docs/3.2/container-elements/#svg-svg" target="_blank">SVG.Svg</a>',description:'A root svg node. Instance of <a href="https://svgjs.dev/docs/3.2/container-elements/#svg-svg" target="_blank">SVG.Svg</a>.'}}}})(t,this.tags,this.customTranslate),n={ctx:i,svg:{meta:"argument",type:'<a href="https://svgjs.dev/docs/3.2/container-elements/#svg-svg" target="_blank">SVG.Svg</a>',description:'A root svg node. Instance of <a href="https://svgjs.dev/docs/3.2/container-elements/#svg-svg" target="_blank">SVG.Svg</a>.'}};this.generalStateRenderFunctionCompleter?this.generalStateRenderFunctionCompleter.updateCompletions(n):this.generalStateRenderFunctionCompleter=new Wo.P(n);const o=ss(i);this.elementStateRenderFunctionCompleter?this.elementStateRenderFunctionCompleter.updateCompletions(o):this.elementStateRenderFunctionCompleter=new Wo.P(o);const r=(a=>{const t=ss(a);return t.event={meta:"argument",type:"Event",description:"DOM event."},t})(i);this.clickActionFunctionCompleter?this.clickActionFunctionCompleter.updateCompletions(r):this.clickActionFunctionCompleter=new Wo.P(r)}static{this.\u0275fac=function(i){return new(i||Ct)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(Tr.m))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Ct,selectors:[["tb-scada-symbol-metadata"]],viewQuery:function(i,n){if(1&i&&e.\u0275\u0275viewQuery(Tf,5),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.symbolMetadataTags=o.first)}},inputs:{aliasController:"aliasController",callbacks:"callbacks",disabled:"disabled",tags:"tags"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>Ct),multi:!0},{provide:s.NG_VALIDATORS,useExisting:(0,e.forwardRef)(()=>Ct),multi:!0}]),e.\u0275\u0275InheritDefinitionFeature,e.\u0275\u0275NgOnChangesFeature],ngContentSelectors:wf,decls:55,vars:40,consts:[["symbolMetadataTags",""],[1,"tb-scada-symbol-metadata","tb-absolute-fill"],[1,"tb-scada-symbol-metadata-header"],["appearance","fill",3,"ngModelChange","options","ngModel"],[1,"tb-scada-symbol-metadata-header-components"],[1,"tb-scada-symbol-metadata-content",3,"formGroup"],[1,"mat-content"],[1,"tb-form-panel"],[1,"tb-form-row"],["translate","",1,"fixed-title-width"],["appearance","outline","subscriptSizing","dynamic",1,"flex-1"],["matInput","","required","","formControlName","title",3,"placeholder"],["matInput","","formControlName","description","rows","2"],[1,"flex","flex-1","flex-row","items-center","justify-start"],["formControlName","searchTags","appearance","outline","subscriptSizing","dynamic",1,"flex-1",2,"display","flex"],[1,"flex","flex-1","flex-row","items-center","justify-end","gap-2"],[1,"tb-small-label"],["appearance","outline","subscriptSizing","dynamic",1,"number","flex"],["matInput","","formControlName","widgetSizeX","required","","type","number",3,"min","max","step","placeholder"],["matInput","","formControlName","widgetSizeY","required","","type","number",3,"min","max","step","placeholder"],[1,"tb-form-panel","stroked"],["expanded","",1,"tb-settings"],[1,"flex","flex-row","flex-wrap"],["matExpansionPanelContent",""],[1,"mat-content","overflow-hidden"],["formControlName","tags",3,"tags","clickActionFunctionCompleter","elementStateRenderFunctionCompleter"],["formControlName","behavior",3,"aliasController","callbacks"],["formControlName","properties"],["formControlName","stateRenderFunction","minHeight","300px","helpId","scada/symbol_state_render_fn",3,"editorCompleter","highlightRules","functionArgs"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275projectionDef(If),e.\u0275\u0275elementStart(0,"div",1)(1,"div",2)(2,"tb-toggle-select",3),e.\u0275\u0275twoWayListener("ngModelChange",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275twoWayBindingSet(n.selectedOption,l)||(n.selectedOption=l),e.\u0275\u0275resetView(l)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",4),e.\u0275\u0275projection(4),e.\u0275\u0275projection(5,1),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",5)(7,"div",6)(8,"div",7)(9,"div",8)(10,"div",9),e.\u0275\u0275text(11,"scada.title"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"mat-form-field",10),e.\u0275\u0275element(13,"input",11),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(15,"div",8)(16,"div",9),e.\u0275\u0275text(17,"scada.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"mat-form-field",10),e.\u0275\u0275element(19,"textarea",12),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(20,"div",8)(21,"div",9),e.\u0275\u0275text(22,"scada.search-tags"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(23,"div",13),e.\u0275\u0275element(24,"tb-string-items-list",14),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(25,"div",8)(26,"div",9),e.\u0275\u0275text(27,"scada.widget-size"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(28,"div",15)(29,"div",16),e.\u0275\u0275text(30),e.\u0275\u0275pipe(31,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(32,"mat-form-field",17),e.\u0275\u0275element(33,"input",18),e.\u0275\u0275pipe(34,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(35,"div",16),e.\u0275\u0275text(36),e.\u0275\u0275pipe(37,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(38,"mat-form-field",17),e.\u0275\u0275element(39,"input",19),e.\u0275\u0275pipe(40,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(41,"div",20)(42,"mat-expansion-panel",21)(43,"mat-expansion-panel-header",22)(44,"mat-panel-title"),e.\u0275\u0275text(45),e.\u0275\u0275pipe(46,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(47,Mf,1,4,"ng-template",23),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(48,"div",24),e.\u0275\u0275element(49,"tb-scada-symbol-metadata-tags",25,0),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(51,"div",24),e.\u0275\u0275element(52,"tb-scada-symbol-metadata-behaviors",26),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(53,"div",24),e.\u0275\u0275element(54,"tb-scada-symbol-metadata-properties",27),e.\u0275\u0275elementEnd()()()}2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275property("options",n.headerOptions),e.\u0275\u0275twoWayProperty("ngModel",n.selectedOption),e.\u0275\u0275advance(4),e.\u0275\u0275property("formGroup",n.metadataFormGroup),e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden","general"!==n.selectedOption),e.\u0275\u0275advance(6),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(14,28,"widget-config.set")),e.\u0275\u0275advance(17),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(31,30,"scada.cols")),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(34,32,"widget-config.set")),e.\u0275\u0275property("min",1)("max",24)("step",1),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(37,34,"scada.rows")),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(40,36,"widget-config.set")),e.\u0275\u0275property("min",1)("max",24)("step",1),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(46,38,"scada.state-render-function")," "),e.\u0275\u0275advance(3),e.\u0275\u0275classProp("!hidden","tags"!==n.selectedOption),e.\u0275\u0275advance(),e.\u0275\u0275property("tags",n.tags)("clickActionFunctionCompleter",n.clickActionFunctionCompleter)("elementStateRenderFunctionCompleter",n.elementStateRenderFunctionCompleter),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden","behavior"!==n.selectedOption),e.\u0275\u0275advance(),e.\u0275\u0275property("aliasController",n.aliasController)("callbacks",n.callbacks),e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden","properties"!==n.selectedOption))},dependencies:[ba.StringItemsListComponent,ds.JsFuncComponent,L.MatInput,v.MatFormField,U.MatExpansionPanel,U.MatExpansionPanelHeader,U.MatExpansionPanelTitle,U.MatExpansionPanelContent,s.DefaultValueAccessor,s.NumberValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.MinValidator,s.MaxValidator,s.NgModel,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,ea.ToggleSelectComponent,Ut,Xe,et,u.TranslatePipe],styles:['@charset "UTF-8";.tb-scada-symbol-metadata{display:flex;flex-direction:column;gap:8px}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-header{padding:24px 24px 0;display:flex;gap:12px;flex-direction:column-reverse;align-items:flex-start}@media screen and (min-width: 960px){.tb-scada-symbol-metadata .tb-scada-symbol-metadata-header{gap:0;flex-direction:row;align-items:center;justify-content:space-between}}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-header .tb-scada-symbol-metadata-header-components{width:100%;flex:1;display:flex;flex-direction:row;align-items:center;justify-content:space-between}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content{display:flex;flex:1;overflow:auto}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content>.mat-content{padding-top:8px}@media screen and (max-width: 599px){.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content>.mat-content{padding-left:8px;padding-right:8px}}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content>div{padding:16px}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content .mat-content{display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 599px){.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content .mat-content{gap:8px}}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content .mat-content.overflow-hidden{overflow:hidden}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content .tb-form-panel .mat-expansion-panel.tb-settings>.mat-expansion-panel-header{font-weight:400}.tb-js-func .ace_tb.ace_scada-symbol-ctx{color:#c52f00}.tb-js-func .ace_tb.ace_scada-symbol-ctx-properties,.tb-js-func .ace_tb.ace_scada-symbol-ctx-property{color:#185f2a}.tb-js-func .ace_tb.ace_scada-symbol-ctx-values,.tb-js-func .ace_tb.ace_scada-symbol-ctx-value{color:#2caa00}.tb-js-func .ace_tb.ace_scada-symbol-ctx-tags,.tb-js-func .ace_tb.ace_scada-symbol-ctx-tag{color:#df8600}.tb-js-func .ace_tb.ace_scada-symbol-ctx-api,.tb-js-func .ace_tb.ace_scada-symbol-ctx-api-method{color:#7214d0}.tb-js-func .ace_tb.ace_scada-symbol-ctx-svg,.tb-js-func .ace_tb.ace_scada-symbol-ctx-svg-method{color:#c24c1a}.tb-js-func .ace_tb.ace_scada-symbol-ctx-property,.tb-js-func .ace_tb.ace_scada-symbol-ctx-value,.tb-js-func .ace_tb.ace_scada-symbol-ctx-tag,.tb-js-func .ace_tb.ace_scada-symbol-ctx-api-method{font-weight:700}.tb-js-func .ace_tb.ace_scada-symbol-svg,.tb-js-func .ace_tb.ace_scada-symbol-element,.tb-js-func .ace_tb.ace_scada-symbol-event{color:#c52f00}.tb-js-func .ace_tb.ace_scada-symbol-svg-properties,.tb-js-func .ace_tb.ace_scada-symbol-element-properties,.tb-js-func .ace_tb.ace_scada-symbol-event-properties{color:#7214d0;font-weight:700}\n'],encapsulation:2})}}var Nf=d(94272),Af=d(73378),xn=d(90882),Ff=d(23688),us=d(60563),Df=d(57469),Pf=d(79667);const kf=["symbolEditor"],Lf=["symbolMetadata"];function Of(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",22)(1,"div",23)(2,"button",24),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.exitPreviewMode())}),e.\u0275\u0275elementStart(3,"mat-icon"),e.\u0275\u0275text(4,"chevron_left"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(7,"span",25),e.\u0275\u0275elementStart(8,"button",26),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.onRevertPreviewSettings())}),e.\u0275\u0275elementStart(9,"mat-icon"),e.\u0275\u0275text(10,"close"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"button",27),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.onApplyPreviewSettings())}),e.\u0275\u0275elementStart(14,"mat-icon"),e.\u0275\u0275text(15,"done"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(18,"div",28)(19,"div",29)(20,"div",30)(21,"div",31),e.\u0275\u0275text(22,"scada.symbol.symbol"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(23,"tb-scada-symbol-input",32),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(24,"tb-scada-symbol-object-settings",33),e.\u0275\u0275elementEnd()()()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(6,12,"action.back")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",!i.scadaPreviewFormGroup.dirty),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(12,14,"action.decline")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!i.scadaPreviewFormGroup.valid||!i.scadaPreviewFormGroup.dirty),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(17,16,"action.apply")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",i.scadaPreviewFormGroup),e.\u0275\u0275advance(5),e.\u0275\u0275property("scadaSymbolContent",i.symbolData.scadaSymbolContent)("scadaSymbolMetadata",i.previewMetadata),e.\u0275\u0275advance(),e.\u0275\u0275property("scadaSymbolMetadata",i.previewMetadata)("aliasController",i.aliasController)("widgetType",i.widgetType.rpc)("callbacks",i.widgetActionCallbacks)}}function Rf(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",34)(1,"button",26),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.onRevertScadaSymbolConfig())}),e.\u0275\u0275elementStart(2,"mat-icon"),e.\u0275\u0275text(3,"close"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"button",27),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.onApplyScadaSymbolConfig())}),e.\u0275\u0275elementStart(7,"mat-icon"),e.\u0275\u0275text(8,"done"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(9),e.\u0275\u0275pipe(10,"translate"),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",!(i.scadaSymbolFormGroup.dirty||i.symbolEditorDirty)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,4,"action.decline")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!i.scadaSymbolFormGroup.valid||!i.symbolEditorValid||!(i.scadaSymbolFormGroup.dirty||i.symbolEditorDirty)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(10,6,"action.apply")," ")}}function Vf(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tb-scada-symbol-editor",35,1),e.\u0275\u0275twoWayListener("showHiddenElementsChange",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275twoWayBindingSet(r.showHiddenElements,o)||(r.showHiddenElements=o),e.\u0275\u0275resetView(o)}),e.\u0275\u0275listener("updateScadaSymbol",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.updateScadaSymbol())})("downloadScadaSymbol",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.downloadScadaSymbol())}),e.\u0275\u0275elementEnd()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("readonly",i.readonly),e.\u0275\u0275twoWayProperty("showHiddenElements",i.showHiddenElements),e.\u0275\u0275property("data",i.symbolEditorData)("editObjectCallbacks",i.editObjectCallbacks)}}function Bf(a,t){if(1&a&&e.\u0275\u0275element(0,"tb-dashboard",36),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("aliasController",i.aliasController)("widgets",i.previewWidgets)("autofillHeight",!1)("gridType",i.previewWidget.sizeX>=i.previewWidget.sizeY?i.GridType.ScrollVertical:i.GridType.ScrollHorizontal)("columns",i.previewWidget.sizeX)("centerVertical",i.previewWidget.sizeX>=i.previewWidget.sizeY)("centerHorizontal",i.previewWidget.sizeX<i.previewWidget.sizeY)("margin",0)("isEdit",!1)("isMobileDisabled",!0)("isEditActionEnabled",!1)("isRemoveActionEnabled",!1)}}class za extends de.H{get isDirty(){return(this.scadaSymbolFormGroup.dirty||this.symbolEditorDirty)&&!this.forcePristine}set isDirty(t){this.forcePristine=!t}constructor(t,i,n,o,r,l,c,m,h,T){super(t),this.store=t,this.route=i,this.fb=n,this.cd=o,this.entityService=r,this.utils=l,this.translate=c,this.imageService=m,this.widgetService=h,this.dialog=T,this.widgetType=he.t_,this.GridType=Af.jJ,this.width="100%",this.height="100%",this.previewMode=!1,this.destroy$=new fe.B,this.updateBreadcrumbs=new e.EventEmitter,this.widgetActionCallbacks={fetchDashboardStates:()=>[],fetchCellClickColumns:()=>[]},this.previewWidgets=[],this.editObjectCallbacks=this,this.symbolEditorDirty=!1,this.symbolEditorValid=!0,this.forcePristine=!1,this.authUser=(0,q.rx)(this.store),this.showHiddenElements=!1}ngOnInit(){this.scadaSymbolFormGroup=this.fb.group({metadata:[null]}),this.scadaPreviewFormGroup=this.fb.group({scadaSymbolObjectSettings:[null]});const i={getStateParams:()=>({})};this.aliasController=new rg.P(this.utils,this.entityService,this.translate,()=>i,{},{}),this.route.data.pipe((0,j.Q)(this.destroy$)).subscribe(()=>{this.reset(),this.init(this.route.snapshot.data.symbolData)})}ngAfterViewInit(){}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}onApplyScadaSymbolConfig(){if(this.scadaSymbolFormGroup.valid){if("xml"===this.symbolEditor.editorMode){const l=this.symbolEditor.getTags();this.editObjectCallbacks.tagsUpdated(l)}const t=this.scadaSymbolFormGroup.get("metadata").value,i=this.prepareScadaSymbolContent(t),n=(0,_.mg)(i,this.symbolData.imageResource.fileName,this.symbolData.imageResource.descriptor.mediaType),o=(0,me.AQ)(this.symbolData.imageResource);let r=this.imageService.updateImage(o,this.symbolData.imageResource.resourceKey,n);t.title!==this.symbolData.imageResource.title&&(r=r.pipe((0,Ho.n)(l=>(l.title=t.title,this.imageService.updateImageInfo(l))))),r.pipe((0,Ho.n)(l=>this.imageService.getImageString(`${me.a5}/${o}/${encodeURIComponent(l.resourceKey)}`).pipe((0,ie.T)(c=>({imageResource:l,scadaSymbolContent:c}))))).subscribe(l=>{this.init(l),this.updateBreadcrumbs.emit()})}}onRevertScadaSymbolConfig(){this.init(this.origSymbolData)}enterPreviewMode(){this.previewMetadata=this.scadaSymbolFormGroup.get("metadata").value,this.symbolData.scadaSymbolContent=this.prepareScadaSymbolContent(this.previewMetadata),this.previewScadaSymbolObjectSettings={behavior:{},properties:{}},this.scadaPreviewFormGroup.patchValue({scadaSymbolObjectSettings:this.previewScadaSymbolObjectSettings},{emitEvent:!1}),this.scadaPreviewFormGroup.markAsPristine();const t={...lg.X,simulated:!0,scadaSymbolUrl:null,scadaSymbolContent:this.symbolData.scadaSymbolContent,scadaSymbolObjectSettings:this.previewScadaSymbolObjectSettings,padding:"0",background:(0,ps.GU)("rgba(0,0,0,0)")};this.previewWidget={typeFullFqn:"system.scada_symbol",type:he.t_.rpc,sizeX:this.previewMetadata.widgetSizeX||3,sizeY:this.previewMetadata.widgetSizeY||3,row:0,col:0,config:{settings:t,showTitle:!1,dropShadow:!1,padding:"0",margin:"0",backgroundColor:"rgba(0,0,0,0)"}},this.previewWidgets=[this.previewWidget],this.previewMode=!0}exitPreviewMode(){this.symbolEditorData={scadaSymbolContent:this.symbolData.scadaSymbolContent},this.previewMode=!1}onRevertPreviewSettings(){this.scadaPreviewFormGroup.patchValue({scadaSymbolObjectSettings:this.previewScadaSymbolObjectSettings},{emitEvent:!1}),this.scadaPreviewFormGroup.markAsPristine()}onApplyPreviewSettings(){this.scadaPreviewFormGroup.markAsPristine(),this.previewScadaSymbolObjectSettings=this.scadaPreviewFormGroup.get("scadaSymbolObjectSettings").value,this.updatePreviewWidgetSettings()}tagsUpdated(t){this.tags=t}tagHasStateRenderFunction(t){const i=this.scadaSymbolFormGroup.get("metadata").value;return!!i.tags&&!!i.tags.find(o=>o.tag===t)?.stateRenderFunction}tagHasClickAction(t){const i=this.scadaSymbolFormGroup.get("metadata").value;return!!i.tags&&!!i.tags.find(o=>o.tag===t)?.actions?.click?.actionFunction}editTagStateRenderFunction(t){this.symbolMetadata.editTagStateRenderFunction(t)}editTagClickAction(t){this.symbolMetadata.editTagClickAction(t)}onSymbolEditObjectDirty(t){this.symbolEditorDirty=t}onSymbolEditObjectValid(t){this.symbolEditorValid=t}updateScadaSymbol(){this.dialog.open(Nf.W,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{imageSubType:this.symbolData.imageResource.resourceSubType,image:this.symbolData.imageResource}}).afterClosed().subscribe(t=>{t?.scadaSymbolContent&&(this.symbolData.scadaSymbolContent=t.scadaSymbolContent,this.symbolEditorData={scadaSymbolContent:this.symbolData.scadaSymbolContent},this.symbolEditorDirty=!0,this.symbolEditorValid=!0)})}downloadScadaSymbol(){let t;t=this.scadaSymbolFormGroup.valid?this.scadaSymbolFormGroup.get("metadata").value:(0,A.Ip)(this.origSymbolData.scadaSymbolContent);const i=document.createElement("a"),n=this.prepareScadaSymbolContent(t),o=new Blob([n],{type:this.symbolData.imageResource.descriptor.mediaType}),r=URL.createObjectURL(o);i.setAttribute("href",r),i.setAttribute("download",this.symbolData.imageResource.fileName);const l=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});i.dispatchEvent(l)}createWidget(){const t=this.scadaSymbolFormGroup.get("metadata").value;this.dialog.open(dn,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{title:t.title,dialogTitle:"scada.create-widget-from-symbol",saveAsActionTitle:"action.create"}}).afterClosed().subscribe(i=>{i&&this.widgetService.getWidgetType("system.scada_symbol").subscribe(n=>{const o=me.iB+this.symbolData.imageResource.link,r={image:o,description:t.description,tags:t.searchTags,...n};r.fqn=void 0,r.id=void 0,r.name=i.widgetName;const l=r.descriptor;l.sizeX=t.widgetSizeX,l.sizeY=t.widgetSizeY,l.controllerScript=l.controllerScript.replace(/previewWidth: '\d*px'/gm,`previewWidth: '${100*t.widgetSizeX}px'`),l.controllerScript=l.controllerScript.replace(/previewHeight: '\d*px'/gm,`previewHeight: '${100*t.widgetSizeY+20}px'`);const c=JSON.parse(l.defaultConfig);c.title=i.widgetName,c.settings=c.settings||{},c.settings.scadaSymbolUrl=o,l.defaultConfig=JSON.stringify(c),this.widgetService.saveWidgetType(r).subscribe(m=>{i.widgetBundleId&&this.widgetService.addWidgetFqnToWidgetBundle(i.widgetBundleId,m.fqn).subscribe()})})})}updatePreviewWidgetSettings(){this.previewWidget=(0,_.Go)(this.previewWidget),this.previewWidget.config.settings.scadaSymbolObjectSettings=this.previewScadaSymbolObjectSettings,this.previewWidgets=[this.previewWidget]}prepareScadaSymbolContent(t){const i=this.symbolEditor.getContent();return(0,A.jZ)(i,t)}reset(){this.symbolMetadata&&(this.symbolMetadata.selectedOption="general"),this.previewMode=!1}init(t){this.authUser.authority===g.s.TENANT_ADMIN?this.readonly=t.imageResource.tenantId.id===R.k:this.readonly=this.authUser.authority!==g.s.SYS_ADMIN,this.origSymbolData=t,this.symbolData=(0,_.Go)(t),this.symbolEditorData={scadaSymbolContent:this.symbolData.scadaSymbolContent};const i=(0,A.Ip)(this.symbolData.scadaSymbolContent);this.scadaSymbolFormGroup.patchValue({metadata:i},{emitEvent:!1}),this.readonly?this.scadaSymbolFormGroup.disable({emitEvent:!1}):this.scadaSymbolFormGroup.enable({emitEvent:!1}),this.scadaSymbolFormGroup.markAsPristine(),this.symbolEditorDirty=!1,this.symbolEditorValid=!0,this.cd.markForCheck()}static{this.\u0275fac=function(i){return new(i||za)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.ActivatedRoute),e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(sg.T),e.\u0275\u0275directiveInject(vr.T),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(ls.f),e.\u0275\u0275directiveInject(Ae.C),e.\u0275\u0275directiveInject(S.MatDialog))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:za,selectors:[["tb-scada-symbol"]],viewQuery:function(i,n){if(1&i&&(e.\u0275\u0275viewQuery(kf,5),e.\u0275\u0275viewQuery(Lf,5)),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.symbolEditor=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.symbolMetadata=o.first)}},hostVars:4,hostBindings:function(i,n){2&i&&e.\u0275\u0275styleProp("width",n.width)("height",n.height)},features:[e.\u0275\u0275InheritDefinitionFeature],decls:31,vars:27,consts:[["symbolMetadata",""],["symbolEditor",""],[1,"tb-scada-symbol-editor","mat-content","flex","flex-col"],[1,"tb-scada-symbol-editor-container","flex","flex-1","flex-col"],[1,"tb-scada-symbol-editor-layout","flex","flex-1","flex-row"],[1,"size-full"],["disableClose","true","mode","side","opened","","position","end",1,"tb-scada-symbol-editor-details-drawer","mat-elevation-z4"],["headerHeightPx","64",1,"flex-1",3,"isReadOnly","showCloseDetails","headerTitle"],[1,"details-buttons","flex","flex-row","items-center","justify-start","gap-4"],["tb-help","scadaSymbolDev"],["mat-stroked-button","",3,"click","disabled"],["class","tb-scada-symbol-editor-preview-content tb-absolute-fill",4,"ngIf"],[3,"formGroup"],["formControlName","metadata",3,"tags","aliasController","callbacks"],[1,"tb-scada-symbol-metadata-header-prefix"],["mat-button","","color","primary",1,"gt-sm:!hidden",3,"click","disabled"],[1,"tb-scada-symbol-metadata-header-suffix","flex","flex-row","items-center","justify-end","gap-3","lt-md:flex-1"],["mat-button","","color","primary",1,"lt-md:!hidden",3,"click","disabled"],["class","flex flex-row items-center justify-start gap-3",4,"ngIf"],[1,"tb-scada-symbol-editor-content"],[3,"readonly","showHiddenElements","data","editObjectCallbacks","showHiddenElementsChange","updateScadaSymbol","downloadScadaSymbol",4,"ngIf"],["class","tb-absolute-fill","displayGrid","always","setGridSize","",3,"aliasController","widgets","autofillHeight","gridType","columns","centerVertical","centerHorizontal","margin","isEdit","isMobileDisabled","isEditActionEnabled","isRemoveActionEnabled",4,"ngIf"],[1,"tb-scada-symbol-editor-preview-content","tb-absolute-fill"],[1,"tb-scada-symbol-editor-preview-header"],["mat-button","",3,"click"],[2,"flex","1"],["mat-stroked-button","","color","primary",3,"click","disabled"],["mat-flat-button","","color","primary",3,"click","disabled"],[1,"tb-scada-symbol-editor-preview-settings",3,"formGroup"],[1,"mat-content"],[1,"tb-form-panel"],["translate","",1,"tb-form-panel-title"],[3,"scadaSymbolContent","scadaSymbolMetadata"],["formControlName","scadaSymbolObjectSettings",3,"scadaSymbolMetadata","aliasController","widgetType","callbacks"],[1,"flex","flex-row","items-center","justify-start","gap-3"],[3,"showHiddenElementsChange","updateScadaSymbol","downloadScadaSymbol","readonly","showHiddenElements","data","editObjectCallbacks"],["displayGrid","always","setGridSize","",1,"tb-absolute-fill",3,"aliasController","widgets","autofillHeight","gridType","columns","centerVertical","centerHorizontal","margin","isEdit","isMobileDisabled","isEditActionEnabled","isRemoveActionEnabled"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",2)(1,"section",3)(2,"div",4)(3,"mat-drawer-container",5)(4,"mat-drawer",6)(5,"tb-details-panel",7)(6,"div",8),e.\u0275\u0275element(7,"div",9),e.\u0275\u0275elementStart(8,"button",10),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.createWidget())}),e.\u0275\u0275text(9),e.\u0275\u0275pipe(10,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(11,Of,25,18,"div",11),e.\u0275\u0275elementStart(12,"div",12)(13,"tb-scada-symbol-metadata",13,0)(15,"div",14)(16,"button",15),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.enterPreviewMode())}),e.\u0275\u0275elementStart(17,"mat-icon"),e.\u0275\u0275text(18,"visibility"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(19),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(21,"div",16)(22,"button",17),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.enterPreviewMode())}),e.\u0275\u0275elementStart(23,"mat-icon"),e.\u0275\u0275text(24,"visibility"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(25),e.\u0275\u0275pipe(26,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(27,Rf,11,8,"div",18),e.\u0275\u0275elementEnd()()()()(),e.\u0275\u0275elementStart(28,"mat-drawer-content",19),e.\u0275\u0275template(29,Vf,2,4,"tb-scada-symbol-editor",20)(30,Bf,1,12,"tb-dashboard",21),e.\u0275\u0275elementEnd()()()()()}2&i&&(e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("headerTitle",null==n.symbolData||null==n.symbolData.imageResource?null:n.symbolData.imageResource.title),e.\u0275\u0275property("isReadOnly",!0)("showCloseDetails",!1),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",n.scadaSymbolFormGroup.invalid),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(10,21,"scada.create-widget")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.previewMode),e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",n.previewMode),e.\u0275\u0275property("formGroup",n.scadaSymbolFormGroup),e.\u0275\u0275advance(),e.\u0275\u0275property("tags",n.tags)("aliasController",n.aliasController)("callbacks",n.widgetActionCallbacks),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",n.scadaSymbolFormGroup.invalid||!n.symbolEditorValid),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(20,23,"scada.preview")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",n.scadaSymbolFormGroup.invalid||!n.symbolEditorValid),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(26,25,"scada.preview")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.readonly),e.\u0275\u0275advance(),e.\u0275\u0275classProp("preview",n.previewMode),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n.previewMode),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.previewMode))},dependencies:[p.NgIf,be.HelpComponent,x.MatButton,E.MatIcon,xn.MatDrawer,xn.MatDrawerContainer,xn.MatDrawerContent,s.NgControlStatus,s.NgControlStatusGroup,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,Ff.M,us.DetailsPanelComponent,Df.DashboardComponent,Ct,Pf.K,Ua,u.TranslatePipe],styles:['@charset "UTF-8";.tb-scada-symbol-editor{width:100%;height:100%}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer{width:50%}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content{display:flex;flex-direction:column;gap:8px}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-header{padding:24px 24px 0;display:flex;gap:12px;flex-direction:row;align-items:center;justify-content:space-between}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings{flex:1;overflow:auto}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings>.mat-content{padding-top:8px}@media screen and (max-width: 599px){.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings>.mat-content{padding-left:8px;padding-right:8px}}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings>div{padding:16px}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings .mat-content{display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 599px){.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings .mat-content{gap:8px}}.tb-scada-symbol-editor .tb-scada-symbol-editor-content{flex:1;min-width:0;min-height:0;width:50%;max-width:50%;background:#fff}.tb-scada-symbol-editor .tb-scada-symbol-editor-content.preview #gridster-parent #gridster-background{background-color:#eee}\n'],encapsulation:2})}}const Uf=[{path:"resources",data:{auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN],breadcrumb:{menuId:F.D8.resources}},children:[{path:"",children:[],data:{auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN],redirectTo:"/resources/widgets-library"}},...nm,{path:"images",data:{breadcrumb:{menuId:F.D8.images}},children:[{path:"",component:Zr.l,data:{auth:[g.s.TENANT_ADMIN,g.s.SYS_ADMIN],title:"image.gallery",imageSubType:me.BI.IMAGE}}]},{path:"scada-symbols",data:{breadcrumb:{menuId:F.D8.scada_symbols}},children:[{path:"",component:Zr.l,data:{auth:[g.s.TENANT_ADMIN,g.s.SYS_ADMIN],title:"scada.symbols",imageSubType:me.BI.SCADA_SYMBOL}},{path:":type/:key",component:za,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:(a,t,i)=>i.symbolData?.imageResource?.title,icon:"view_in_ar"},auth:[g.s.TENANT_ADMIN,g.s.SYS_ADMIN],title:"scada.symbol.symbol"},resolve:{symbolData:(a,t,i=(0,e.inject)(b.Router),n=(0,e.inject)(ls.f))=>{const o=a.params.type,r=decodeURIComponent(a.params.key);return(0,Se.p)({imageResource:n.getImageInfo(o,r),scadaSymbolContent:n.getImageString(`${me.a5}/${o}/${encodeURIComponent(r)}`)}).pipe((0,cn.W)(()=>(i.navigate(["/resources/scada-symbols"]),(0,H.of)(null))))}}}]},{path:"resources-library",data:{breadcrumb:{menuId:F.D8.resources_library}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN,g.s.SYS_ADMIN],title:"resource.resources-library"},resolve:{entitiesTableConfig:Ft}},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"mdi:rhombus-split"},auth:[g.s.TENANT_ADMIN,g.s.SYS_ADMIN],title:"resource.resources-library"},resolve:{entitiesTableConfig:Ft}}]}]},{path:"settings",component:va.V,data:{auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN],showMainLoadingBar:!1,breadcrumb:{menuId:F.D8.settings}},children:[{path:"",children:[],data:{auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN],redirectTo:{SYS_ADMIN:"/settings/general",TENANT_ADMIN:"/settings/home"}}},{path:"general",component:ta,canDeactivate:[P.L],data:{auth:[g.s.SYS_ADMIN],title:"admin.general-settings",breadcrumb:{menuId:F.D8.general}}},{path:"outgoing-mail",component:Xi,canDeactivate:[P.L],data:{auth:[g.s.SYS_ADMIN],title:"admin.outgoing-mail-settings",breadcrumb:{menuId:F.D8.mail_server}}},{path:"notifications",component:aa,canDeactivate:[P.L],data:{auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN],title:"admin.notifications-settings",breadcrumb:{menuId:F.D8.notification_settings}}},{path:"queues",data:{breadcrumb:{menuId:F.D8.queues}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.SYS_ADMIN],title:"admin.queues"},resolve:{entitiesTableConfig:Pt}},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"swap_calls"},auth:[g.s.SYS_ADMIN],title:"admin.queues"},resolve:{entitiesTableConfig:Pt}}]},{path:"home",component:ra,canDeactivate:[P.L],data:{auth:[g.s.TENANT_ADMIN],title:"admin.home-settings",breadcrumb:{menuId:F.D8.home_settings}}},{path:"repository",component:ma,canDeactivate:[P.L],data:{auth:[g.s.TENANT_ADMIN],title:"admin.repository-settings",breadcrumb:{menuId:F.D8.repository_settings}}},{path:"auto-commit",component:ua,canDeactivate:[P.L],data:{auth:[g.s.TENANT_ADMIN],title:"admin.auto-commit-settings",breadcrumb:{menuId:F.D8.auto_commit_settings}}},{path:"mobile-app",component:Ia,canDeactivate:[P.L],data:{auth:[g.s.SYS_ADMIN],title:"admin.mobile-app.mobile-app",breadcrumb:{menuId:F.D8.mobile_app_settings}}},{path:"security-settings",redirectTo:"/security-settings/general"},{path:"oauth2",redirectTo:"/security-settings/oauth2"},{path:"resources-library",pathMatch:"full",redirectTo:"/resources/resources-library"},{path:"resources-library/:entityId",redirectTo:"/resources/resources-library/:entityId"},{path:"2fa",redirectTo:"/security-settings/2fa"},{path:"sms-provider",redirectTo:"/settings/notifications"}]},{path:"security-settings",data:{auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN],breadcrumb:{menuId:F.D8.security_settings}},children:[{path:"",children:[],data:{auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN],redirectTo:{SYS_ADMIN:"/security-settings/general",TENANT_ADMIN:"/security-settings/auditLogs"}}},{path:"general",component:na,canDeactivate:[P.L],data:{auth:[g.s.SYS_ADMIN],title:"admin.general",breadcrumb:{menuId:F.D8.security_settings_general}}},{path:"2fa",component:ga,canDeactivate:[P.L],data:{auth:[g.s.SYS_ADMIN],title:"admin.2fa.2fa",breadcrumb:{menuId:F.D8.two_fa}}},...es,...am]}];class _n{static{this.\u0275fac=function(i){return new(i||_n)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:_n})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[Ft,Pt],imports:[b.RouterModule.forChild(Uf),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(_n,{imports:[b.RouterModule],exports:[b.RouterModule]});var k=d(25612),gs=d(60392);class Sn{static{this.\u0275fac=function(i){return new(i||Sn)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Sn})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[yn,p.CommonModule,w.G,k.I]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Sn,{declarations:[Vt,Gt,wa,Ma,Na,Fa,Da],imports:[yn,p.CommonModule,w.G,k.I]});class Tn{static{this.\u0275fac=function(i){return new(i||Tn)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Tn})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,k.I,_n,gs.WidgetComponentsModule,Sn]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Tn,{declarations:[ta,Xi,aa,ia,na,ra,la,da,pa,ma,ua,ga,Ia],imports:[p.CommonModule,w.G,k.I,_n,gs.WidgetComponentsModule,Sn]});var qf=d(94375),fs=d(99327),hs=d(16195),Er=d(49764);function Wf(a,t){if(1&a&&e.\u0275\u0275element(0,"tb-dashboard-page",2),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("embedded",!0)("dashboard",i.homeDashboard)("hideToolbar",i.homeDashboard.hideDashboardToolbar)}}function $f(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-grid-tile")(1,"a",10)(2,"tb-icon",11),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"span"),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"customTranslate"),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275elementEnd()()()),2&a){const i=t.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("routerLink",i.path),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(i.icon),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(i.customTranslate?e.\u0275\u0275pipeBind1(6,3,i.name):e.\u0275\u0275pipeBind1(7,5,i.name))}}function zf(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-grid-tile",5)(1,"mat-card",6)(2,"mat-card-title")(3,"span",7),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"mat-card-content")(6,"mat-grid-list",8),e.\u0275\u0275template(7,$f,8,7,"mat-grid-tile",9),e.\u0275\u0275elementEnd()()()()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("colspan",n.sectionColspan(i)),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(i.name),e.\u0275\u0275advance(2),e.\u0275\u0275property("cols",i.places.length),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",i.places)}}function Hf(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-grid-list",3),e.\u0275\u0275template(1,zf,8,4,"mat-grid-tile",4),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("cols",i.cols),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(2,2,i.homeSections$))}}class Ha{constructor(t,i,n,o){this.menuService=t,this.breakpointObserver=i,this.cd=n,this.route=o,this.homeSections$=this.menuService.homeSections(),this.cols=2,this.homeDashboard=this.route.snapshot.data.homeDashboard}ngOnInit(){this.homeDashboard||(this.updateColumnCount(),this.breakpointObserver.observe([le.zV.lg,le.zV["gt-lg"]]).subscribe(t=>this.updateColumnCount()))}updateColumnCount(){this.cols=2,this.breakpointObserver.isMatched(le.zV.lg)&&(this.cols=3),this.breakpointObserver.isMatched(le.zV["gt-lg"])&&(this.cols=4),this.cd.detectChanges()}sectionColspan(t){if(this.breakpointObserver.isMatched(le.zV["gt-sm"])){let i=this.cols;return t&&t.places&&t.places.length<=i&&(i=t.places.length),i}return 2}static{this.\u0275fac=function(i){return new(i||Ha)(e.\u0275\u0275directiveInject(qf.$),e.\u0275\u0275directiveInject(fs.BreakpointObserver),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(b.ActivatedRoute))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Ha,selectors:[["tb-home-links"]],decls:3,vars:2,consts:[["homeLinks",""],[3,"embedded","dashboard","hideToolbar",4,"ngIf","ngIfElse"],[3,"embedded","dashboard","hideToolbar"],["rowHeight","280px",1,"tb-home-links",3,"cols"],[3,"colspan",4,"ngFor","ngForOf"],[3,"colspan"],["appearance","outlined",2,"width","100%"],["translate","",1,"mat-headline-5"],["rowHeight","170px",3,"cols"],[4,"ngFor","ngForOf"],["mat-raised-button","","color","primary",1,"tb-card-button",3,"routerLink"],["matButtonIcon","",1,"tb-mat-96"]],template:function(i,n){if(1&i&&e.\u0275\u0275template(0,Wf,1,3,"tb-dashboard-page",1)(1,Hf,3,4,"ng-template",null,0,e.\u0275\u0275templateRefExtractor),2&i){const o=e.\u0275\u0275reference(2);e.\u0275\u0275property("ngIf",n.homeDashboard)("ngIfElse",o)}},dependencies:[p.NgForOf,p.NgIf,x.MatAnchor,D.MatCard,D.MatCardContent,D.MatCardTitle,hs.MatGridList,hs.MatGridTile,b.RouterLink,u.TranslateDirective,zo.TbIconComponent,Er.DashboardPageComponent,p.AsyncPipe,Tr.m,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]     .tb-home-links .mat-headline-5{font-size:20px}@media screen and (min-width: 1600px){[_nghost-%COMP%]     .tb-home-links .mat-headline-5{font-size:24px}}[_nghost-%COMP%]     .tb-home-links .mat-mdc-card{padding:0;margin:8px}[_nghost-%COMP%]     .tb-home-links .mat-mdc-card .mat-mdc-card-title{margin:0;padding:24px 16px 16px}[_nghost-%COMP%]     .tb-home-links .mat-mdc-card .mat-mdc-card-title+.mat-mdc-card-content{padding-top:0}[_nghost-%COMP%]     .tb-home-links .mat-mdc-card .mat-mdc-card-content{padding:16px}[_nghost-%COMP%]     .tb-home-links .tb-card-button{width:100%;height:100%;max-width:240px;display:flex;flex-direction:column;align-items:center}[_nghost-%COMP%]     .tb-home-links .tb-card-button:hover{border-bottom:none}[_nghost-%COMP%]     .tb-home-links .tb-card-button:focus{border-bottom:none}[_nghost-%COMP%]     .tb-home-links .tb-card-button .mat-icon{margin:auto}[_nghost-%COMP%]     .tb-home-links .tb-card-button span.mdc-button__label{height:18px;min-height:36px;max-height:36px;padding:0 0 20px;margin:auto;font-size:18px;font-weight:400;line-height:18px;white-space:normal;text-align:center}[_nghost-%COMP%]     .tb-home-links .tb-card-button.mat-mdc-raised-button.mat-primary .mat-ripple-element{opacity:.3;background-color:#ffffff4d}'],changeDetection:0})}}var Kf=d(93064),Mr=d(59729);const Nr=(a,t,i)=>{let n;switch(i){case g.s.SYS_ADMIN:n=a.pipe((0,C.select)(q.T9),(0,ie.T)(o=>({mobileQrEnabled:o})));break;case g.s.TENANT_ADMIN:n=a.pipe((0,C.select)(q.QF));break;case g.s.CUSTOMER_USER:n=a.pipe((0,C.select)(q.Ik),(0,ie.T)(o=>({persistDeviceStateToTelemetry:o})))}return n.pipe((0,Z.Z)(o=>t.pipe((0,ie.T)(r=>{if(o.persistDeviceStateToTelemetry)for(const l of Object.keys(r.configuration.filters))["Active Devices","Inactive Devices"].includes(r.configuration.filters[l].filter)&&(r.configuration.filters[l].keyFilters[0].key.type=Kf.vH.TIME_SERIES);if((0,_.f1)(o.mobileQrEnabled))for(const l of Object.keys(r.configuration.widgets))if("Select show mobile QR code"===r.configuration.widgets[l].config.title){r.configuration.widgets[l].config.settings.markdownTextFunction=r.configuration.widgets[l].config.settings.markdownTextFunction.replace(/\${mobileQrEnabled:([^}]+)}/,`\${mobileQrEnabled:${String(o.mobileQrEnabled)}}`);break}return r.hideDashboardToolbar=!0,r}))))},eh=[{path:"home",component:Ha,data:{auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"home.home",breadcrumb:{menuId:F.D8.home}},resolve:{homeDashboard:(a,t,i=(0,e.inject)(Br.I),n=(0,e.inject)(Mr.pQ),o=(0,e.inject)(C.Store))=>i.getHomeDashboard().pipe((0,Z.Z)(r=>r?(0,H.of)(r):((a,t)=>{const i=(0,q.rx)(a).authority;switch(i){case g.s.SYS_ADMIN:return Nr(a,t.loadJsonResource("/assets/dashboard/sys_admin_home_page.json"),i);case g.s.TENANT_ADMIN:return Nr(a,t.loadJsonResource("/assets/dashboard/tenant_admin_home_page.json"),i);case g.s.CUSTOMER_USER:return Nr(a,t.loadJsonResource("/assets/dashboard/customer_user_home_page.json"),i);default:return(0,H.of)(null)}})(o,n)))}}];class In{static{this.\u0275fac=function(i){return new(i||In)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:In})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[b.RouterModule.forChild(eh),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(In,{imports:[b.RouterModule],exports:[b.RouterModule]});class wn{static{this.\u0275fac=function(i){return new(i||wn)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:wn})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,k.I,In]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(wn,{declarations:[Ha],imports:[p.CommonModule,w.G,k.I,In]});var Ka=d(39063),th=d(45312),nh=d(4642);function ih(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",25)}function ah(a,t){1&a&&e.\u0275\u0275element(0,"div",26)}function oh(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"user.email-required")," "))}function rh(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"user.invalid-email-format")," "))}function sh(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",27),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit;e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",i?e.\u0275\u0275pipeBind1(2,2,"language.locales."+i):""," ")}}function lh(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"section",28),e.\u0275\u0275element(1,"tb-dashboard-autocomplete",29),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementStart(3,"mat-checkbox",30),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,6,"dashboard.home-dashboard")),e.\u0275\u0275property("dashboardsScope",(null==i.user?null:i.user.authority)===i.authorities.TENANT_ADMIN?"tenant":"customer")("tenantId",null==i.user||null==i.user.tenantId?null:i.user.tenantId.id)("customerId",null==i.user||null==i.user.customerId?null:i.user.customerId.id)("selectFirstDashboard",!1),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,8,"dashboard.home-dashboard-hide-toolbar")," ")}}class Ya extends de.H{constructor(t,i,n,o,r,l){super(t),this.store=t,this.route=i,this.userService=n,this.authService=o,this.translate=r,this.fb=l,this.authorities=g.s,this.languageList=th.c.supportedLangs,this.authUser=(0,q.rx)(this.store)}ngOnInit(){this.buildProfileForm(),this.userLoaded(this.route.snapshot.data.user)}buildProfileForm(){this.profile=this.fb.group({email:["",[s.Validators.required,s.Validators.email]],firstName:[""],lastName:[""],phone:[""],language:[""],homeDashboardId:[null],homeDashboardHideToolbar:[!0]})}save(){this.user={...this.user,...this.profile.value},this.user.additionalInfo||(this.user.additionalInfo={}),this.user.additionalInfo.lang=this.profile.get("language").value,this.user.additionalInfo.homeDashboardId=this.profile.get("homeDashboardId").value,this.user.additionalInfo.homeDashboardHideToolbar=this.profile.get("homeDashboardHideToolbar").value,this.userService.saveUser(this.user).subscribe(t=>{this.userLoaded(t),this.store.dispatch(new Ko.xh({userDetails:{additionalInfo:{...t.additionalInfo},authority:t.authority,createdTime:t.createdTime,tenantId:t.tenantId,customerId:t.customerId,email:t.email,phone:t.phone,firstName:t.firstName,id:t.id,lastName:t.lastName}})),this.store.dispatch(new nh.U({userLang:t.additionalInfo.lang})),this.authService.refreshJwtToken(!1)})}userLoaded(t){this.user=t,this.profile.reset(t);let i,n,o=!0;t.additionalInfo&&(t.additionalInfo.lang&&(i=t.additionalInfo.lang),n=t.additionalInfo.homeDashboardId,(0,_.f1)(t.additionalInfo.homeDashboardHideToolbar)&&(o=t.additionalInfo.homeDashboardHideToolbar)),i||(i=this.translate.currentLang),this.profile.get("language").setValue(i),this.profile.get("homeDashboardId").setValue(n),this.profile.get("homeDashboardHideToolbar").setValue(o)}confirmForm(){return this.profile}isSysAdmin(){return this.authUser.authority===g.s.SYS_ADMIN}static{this.\u0275fac=function(i){return new(i||Ya)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.ActivatedRoute),e.\u0275\u0275directiveInject(Ka.D),e.\u0275\u0275directiveInject(on.u),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Ya,selectors:[["tb-profile"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:50,vars:30,consts:[["appearance","outlined",1,"profile-card"],[1,"flex","flex-1","flex-row","items-start","justify-between","xs:flex-col","xs:justify-start","xs:gap-2"],[1,"flex","flex-1","flex-col"],["translate","",1,"mat-headline-5"],[1,"profile-email",2,"opacity","0.7"],[1,"flex","flex-col"],["translate","",1,"mat-mdc-subheader"],[1,"profile-last-login-ts",2,"opacity","0.7"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[2,"padding-top","16px"],[3,"ngSubmit","formGroup"],[3,"disabled"],[1,"mat-block"],["translate",""],["matInput","","type","email","formControlName","email","required",""],[4,"ngIf"],["matInput","","formControlName","firstName"],["matInput","","formControlName","lastName"],["formControlName","phone",3,"required","label","enableFlagsSelect"],["formControlName","language"],[3,"value",4,"ngFor","ngForOf"],["class","tb-home-dashboard flex flex-1 flex-col gt-sm:flex-row",4,"ngIf"],[1,"flex","flex-row","items-start","justify-end"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[3,"value"],[1,"tb-home-dashboard","flex","flex-1","flex-col","gt-sm:flex-row"],["formControlName","homeDashboardId",1,"flex-1",3,"label","dashboardsScope","tenantId","customerId","selectFirstDashboard"],["formControlName","homeDashboardHideToolbar",1,"flex-1"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div")(1,"mat-card",0)(2,"mat-card-header")(3,"div",1)(4,"div",2)(5,"span",3),e.\u0275\u0275text(6,"profile.profile"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"span",4),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(9,"div",5)(10,"span",6),e.\u0275\u0275text(11,"profile.last-login-time"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"span",7),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"date"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275template(15,ih,1,0,"mat-progress-bar",8),e.\u0275\u0275pipe(16,"async"),e.\u0275\u0275template(17,ah,1,0,"div",9),e.\u0275\u0275pipe(18,"async"),e.\u0275\u0275elementStart(19,"mat-card-content",10)(20,"form",11),e.\u0275\u0275listener("ngSubmit",function(){return n.save()}),e.\u0275\u0275elementStart(21,"fieldset",12),e.\u0275\u0275pipe(22,"async"),e.\u0275\u0275elementStart(23,"mat-form-field",13)(24,"mat-label",14),e.\u0275\u0275text(25,"user.email"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(26,"input",15),e.\u0275\u0275template(27,oh,3,3,"mat-error",16)(28,rh,3,3,"mat-error",16),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(29,"mat-form-field",13)(30,"mat-label",14),e.\u0275\u0275text(31,"user.first-name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(32,"input",17),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(33,"mat-form-field",13)(34,"mat-label",14),e.\u0275\u0275text(35,"user.last-name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(36,"input",18),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(37,"tb-phone-input",19),e.\u0275\u0275pipe(38,"translate"),e.\u0275\u0275elementStart(39,"mat-form-field",13)(40,"mat-label",14),e.\u0275\u0275text(41,"language.language"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(42,"mat-select",20),e.\u0275\u0275template(43,sh,3,4,"mat-option",21),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(44,lh,6,10,"section",22),e.\u0275\u0275elementStart(45,"div",23)(46,"button",24),e.\u0275\u0275pipe(47,"async"),e.\u0275\u0275text(48),e.\u0275\u0275pipe(49,"translate"),e.\u0275\u0275elementEnd()()()()()()()),2&i&&(e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate(n.profile?n.profile.get("email").value:""),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(14,15,null==n.user||null==n.user.additionalInfo?null:n.user.additionalInfo.lastLoginTs,"yyyy-MM-dd HH:mm:ss")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(16,18,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(18,20,n.isLoading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("formGroup",n.profile),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(22,22,n.isLoading$)),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.profile.get("email").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.profile.get("email").hasError("email")),e.\u0275\u0275advance(9),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(38,24,"contact.phone")),e.\u0275\u0275property("required",!1)("enableFlagsSelect",!0),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",n.languageList),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n.isSysAdmin()),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(47,26,n.isLoading$)||n.profile.invalid||!n.profile.dirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(49,28,"action.save")," "))},dependencies:[p.NgForOf,p.NgIf,oa.DashboardAutocompleteComponent,x.MatButton,Te.MatCheckbox,D.MatCard,D.MatCardContent,D.MatCardHeader,K.MatProgressBar,L.MatInput,v.MatFormField,v.MatLabel,v.MatError,ce.MatSelect,z.MatOption,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,jo.U,p.AsyncPipe,p.DatePipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{margin:8px}@media screen and (min-width: 960px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{width:60%}}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .mat-headline-5[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .profile-email[_ngcontent-%COMP%]{font-size:16px;font-weight:400}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .mat-mdc-subheader[_ngcontent-%COMP%]{line-height:24px;color:#0000008a;font-size:14px;font-weight:400}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .profile-last-login-ts[_ngcontent-%COMP%]{font-size:16px;font-weight:400}@media screen and (min-width: 960px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .tb-home-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-right:12px}}@media screen and (max-width: 959px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .tb-home-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-bottom:12px}}@media screen and (min-width: 960px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .tb-home-dashboard[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:16px}}']})}}class En{constructor(t,i){this.store=t,this.userService=i}resolve(){const t=(0,q.rx)(this.store).userId;return this.userService.getUser(t)}static{this.\u0275fac=function(i){return new(i||En)(e.\u0275\u0275inject(C.Store),e.\u0275\u0275inject(Ka.D))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:En,factory:En.\u0275fac})}}const dh=[{path:"profile",component:Ya,canDeactivate:[P.L],data:{auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"profile.profile",breadcrumb:{label:"profile.profile",icon:"account_circle"}},resolve:{user:En}}],ch=[{path:"profile",redirectTo:"account/profile"}];class Mn{static{this.\u0275fac=function(i){return new(i||Mn)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Mn})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[En],imports:[b.RouterModule.forChild(ch),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Mn,{imports:[b.RouterModule],exports:[b.RouterModule]});class Nn{static{this.\u0275fac=function(i){return new(i||Nn)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Nn})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,Mn]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Nn,{declarations:[Ya],imports:[p.CommonModule,w.G,Mn]});var te=d(76233);const ph=["stepper"],mh=["canvas"];function uh(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",28)}function gh(a,t){1&a&&e.\u0275\u0275element(0,"div",29)}function fh(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-icon"),e.\u0275\u0275text(1,"done"),e.\u0275\u0275elementEnd())}function hh(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"security.2fa.dialog.totp-step-label"))}function bh(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"security.2fa.dialog.verification-step-label"))}function yh(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"security.2fa.dialog.verification-code-invalid")," "))}function vh(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"security.2fa.dialog.activation-step-label"))}class Qa extends se.m{constructor(t,i,n,o,r){super(t,i,o),this.store=t,this.router=i,this.twoFaService=n,this.dialogRef=o,this.fb=r,this.twoFaService.generateTwoFaAccountConfig(W.LB.TOTP).subscribe(l=>{this.authAccountConfig=l,this.totpAuthURL=this.authAccountConfig.authUrl,this.authAccountConfig.useByDefault=!0,d.e(8314).then(d.t.bind(d,68314,19)).then(c=>{c.toCanvas(this.canvasRef.nativeElement,this.totpAuthURL),this.canvasRef.nativeElement.style.width="auto",this.canvasRef.nativeElement.style.height="auto"})}),this.totpConfigForm=this.fb.group({verificationCode:["",[s.Validators.required,s.Validators.minLength(6),s.Validators.maxLength(6),s.Validators.pattern(/^\d*$/)]]})}onSaveConfig(){this.totpConfigForm.valid?this.twoFaService.verifyAndSaveTwoFaAccountConfig(this.authAccountConfig,this.totpConfigForm.get("verificationCode").value).subscribe(t=>{this.config=t,this.stepper.next()}):Object.keys(this.totpConfigForm.controls).forEach(t=>{this.totpConfigForm.get(t).markAsTouched({onlySelf:!0})})}closeDialog(){return this.dialogRef.close(this.config)}static{this.\u0275fac=function(i){return new(i||Qa)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(kt.Z),e.\u0275\u0275directiveInject(S.MatDialogRef),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Qa,selectors:[["tb-totp-auth-dialog"]],viewQuery:function(i,n){if(1&i&&(e.\u0275\u0275viewQuery(ph,5),e.\u0275\u0275viewQuery(mh,5)),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.stepper=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.canvasRef=o.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:55,vars:26,consts:[["stepper",""],["canvas",""],["color","primary",1,"flex","flex-row"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","",2,"padding","0"],["linear",""],["matStepperIcon","edit"],["matStepLabel",""],["translate","",1,"mat-body-2"],[1,"flex","flex-row","items-center","justify-end"],["mat-raised-button","","type","button","color","primary","matStepperNext",""],[3,"stepControl"],[1,"flex","flex-col","items-center","justify-start",3,"ngSubmit","formGroup"],["translate","",1,"mat-body","qr-code-description"],["translate","",1,"mat-body","qr-code-description",2,"margin-top","30px"],[1,"mat-block","code-container","flex-1"],["matInput","","formControlName","verificationCode","maxlength","6","type","text","required","","inputmode","numeric","pattern","[0-9]*","autocomplete","off",3,"placeholder"],[4,"ngIf"],["mat-raised-button","","type","button","color","primary",3,"click","disabled"],["matStepLabel","","matStepperIcon","done"],["translate","",1,"result-title"],["translate","",1,"mat-body","result-description"],["mat-raised-button","","type","button","color","primary",3,"click"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-toolbar",2)(1,"h2",3),e.\u0275\u0275text(2,"security.2fa.dialog.enable-totp-title"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"span",4),e.\u0275\u0275elementStart(4,"button",5),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.closeDialog())}),e.\u0275\u0275elementStart(5,"mat-icon",6),e.\u0275\u0275text(6,"close"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(7,uh,1,0,"mat-progress-bar",7),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275template(9,gh,1,0,"div",8),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275elementStart(11,"div",9)(12,"mat-stepper",10,0),e.\u0275\u0275template(14,fh,2,0,"ng-template",11),e.\u0275\u0275elementStart(15,"mat-step"),e.\u0275\u0275template(16,hh,2,3,"ng-template",12),e.\u0275\u0275elementStart(17,"div")(18,"p",13),e.\u0275\u0275text(19,"security.2fa.dialog.totp-step-description-open"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"p",13),e.\u0275\u0275text(21,"security.2fa.dialog.totp-step-description-install"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(22,"div",14)(23,"button",15),e.\u0275\u0275text(24),e.\u0275\u0275pipe(25,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(26,"mat-step",16),e.\u0275\u0275template(27,bh,2,3,"ng-template",12),e.\u0275\u0275elementStart(28,"form",17),e.\u0275\u0275listener("ngSubmit",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.onSaveConfig())}),e.\u0275\u0275elementStart(29,"p",18),e.\u0275\u0275text(30,"security.2fa.dialog.scan-qr-code"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(31,"canvas",4,1),e.\u0275\u0275elementStart(33,"p",19),e.\u0275\u0275text(34,"security.2fa.dialog.enter-verification-code"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(35,"mat-form-field",20),e.\u0275\u0275element(36,"input",21),e.\u0275\u0275pipe(37,"translate"),e.\u0275\u0275template(38,yh,3,3,"mat-error",22),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(39,"div",14)(40,"button",23),e.\u0275\u0275pipe(41,"async"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.onSaveConfig())}),e.\u0275\u0275text(42),e.\u0275\u0275pipe(43,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(44,"mat-step"),e.\u0275\u0275template(45,vh,2,3,"ng-template",24),e.\u0275\u0275elementStart(46,"div")(47,"h3",25),e.\u0275\u0275text(48,"security.2fa.dialog.success"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(49,"p",26),e.\u0275\u0275text(50,"security.2fa.dialog.activation-step-description-totp"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(51,"div",14)(52,"button",27),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.closeDialog())}),e.\u0275\u0275text(53),e.\u0275\u0275pipe(54,"translate"),e.\u0275\u0275elementEnd()()()()()()}2&i&&(e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(8,12,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(10,14,n.isLoading$)),e.\u0275\u0275advance(15),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(25,16,"security.2fa.dialog.next")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("stepControl",n.totpConfigForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.totpConfigForm),e.\u0275\u0275advance(3),e.\u0275\u0275styleProp("display",n.totpAuthURL?"block":"none"),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(37,18,"security.2fa.dialog.verification-code")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.totpConfigForm.get("verificationCode").invalid),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(41,20,n.isLoading$)||n.totpConfigForm.invalid),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(43,22,"security.2fa.dialog.next")," "),e.\u0275\u0275advance(11),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(54,24,"action.done")," "))},dependencies:[p.NgIf,pt.ToastDirective,x.MatButton,x.MatIconButton,E.MatIcon,K.MatProgressBar,L.MatInput,v.MatFormField,v.MatError,ae.MatToolbar,S.MatDialogContent,te.MatStep,te.MatStepLabel,te.MatStepper,te.MatStepperNext,te.MatStepperIcon,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.MaxLengthValidator,s.PatternValidator,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%] > h2[_ngcontent-%COMP%]{font-weight:400;letter-spacing:.25px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]{margin-bottom:0;letter-spacing:.25px}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]:not(:first-of-type){margin:0 0 8px}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]{margin:0;color:#0000008a}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]{max-width:290px}[_nghost-%COMP%]   .code-container[_ngcontent-%COMP%]{max-width:170px}@media screen and (max-width: 599px){[_nghost-%COMP%]   .code-container.full-width-xs[_ngcontent-%COMP%]{max-width:100%;width:100%}}[_nghost-%COMP%]   .result-title[_ngcontent-%COMP%]{font:500 18px/24px Roboto,Helvetica Neue,sans-serif;letter-spacing:.1px;margin:8px 0;text-align:center}[_nghost-%COMP%]   .result-description[_ngcontent-%COMP%]{text-align:center;margin:0 0 16px;letter-spacing:.25px;max-width:500px}[_nghost-%COMP%]   .step-description[_ngcontent-%COMP%]{max-width:450px}[_nghost-%COMP%]   .step-description.input[_ngcontent-%COMP%]{margin:12px 0 0}[_nghost-%COMP%]   .qr-code-description[_ngcontent-%COMP%]{text-align:center;max-width:180px;letter-spacing:.25px;color:#000000de;margin-bottom:0}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]{max-width:500px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{max-width:500px;margin:40px 0 8px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{letter-spacing:.25px;padding:0 24px;margin-bottom:16px;font-family:Roboto Mono,Helvetica Neue,monospace}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code.even[_ngcontent-%COMP%]{text-align:right}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{margin-bottom:40px}[_nghost-%COMP%]     .mat-horizontal-stepper-header{pointer-events:none!important}']})}}const Ch=["stepper"],xh=a=>({address:a});function _h(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",30)}function Sh(a,t){1&a&&e.\u0275\u0275element(0,"div",31)}function Th(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-icon"),e.\u0275\u0275text(1,"done"),e.\u0275\u0275elementEnd())}function Ih(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"security.2fa.dialog.sms-step-label"))}function wh(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"security.2fa.dialog.verification-step-label"))}function Eh(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"security.2fa.dialog.verification-code-invalid")," "))}function Mh(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"security.2fa.dialog.activation-step-label"))}class Ja extends se.m{constructor(t,i,n,o,r){super(t,i,o),this.store=t,this.router=i,this.twoFaService=n,this.dialogRef=o,this.fb=r,this.phoneNumberPattern=Re.MT,this.smsConfigForm=this.fb.group({phone:["",[s.Validators.required,s.Validators.pattern(Re.MT)]]}),this.smsVerificationForm=this.fb.group({verificationCode:["",[s.Validators.required,s.Validators.minLength(6),s.Validators.maxLength(6),s.Validators.pattern(/^\d*$/)]]})}nextStep(){switch(this.stepper.selectedIndex){case 0:this.smsConfigForm.valid?(this.authAccountConfig={providerType:W.LB.SMS,useByDefault:!0,phoneNumber:this.smsConfigForm.get("phone").value},this.twoFaService.submitTwoFaAccountConfig(this.authAccountConfig).subscribe(()=>{this.stepper.next()})):this.showFormErrors(this.smsConfigForm);break;case 1:this.smsVerificationForm.valid?this.twoFaService.verifyAndSaveTwoFaAccountConfig(this.authAccountConfig,this.smsVerificationForm.get("verificationCode").value).subscribe(t=>{this.config=t,this.stepper.next()}):this.showFormErrors(this.smsVerificationForm)}}closeDialog(){return this.dialogRef.close(this.config)}showFormErrors(t){Object.keys(t.controls).forEach(i=>{t.get(i).markAsTouched({onlySelf:!0})})}static{this.\u0275fac=function(i){return new(i||Ja)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(kt.Z),e.\u0275\u0275directiveInject(S.MatDialogRef),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Ja,selectors:[["tb-sms-auth-dialog"]],viewQuery:function(i,n){if(1&i&&e.\u0275\u0275viewQuery(Ch,5),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.stepper=o.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:58,vars:45,consts:[["stepper",""],["color","primary",1,"flex","flex-row"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","",2,"padding","0"],["linear",""],["matStepperIcon","edit"],[3,"stepControl"],["matStepLabel",""],[3,"ngSubmit","formGroup"],["translate","",1,"mat-body","step-description","input"],[1,"flex","flex-row","items-center","justify-between","gap-3.75"],["formControlName","phone",1,"flex-1",3,"floatLabel","placeholder"],["mat-raised-button","","type","submit","color","primary",3,"disabled"],[1,"mat-body","step-description","input"],[1,"flex","flex-row","items-center","justify-between","xs:flex-col","xs:items-end","xs:justify-start"],[1,"mat-block","code-container","full-width-xs","flex-1"],["matInput","","formControlName","verificationCode","maxlength","6","type","text","required","","inputmode","numeric","pattern","[0-9]*","autocomplete","off",3,"placeholder"],[4,"ngIf"],[1,"flex","gap-2"],["mat-button","","matStepperPrevious","",3,"disabled"],["matStepLabel","","matStepperIcon","done"],["translate","",1,"result-title"],["translate","",1,"mat-body","result-description"],[1,"flex","flex-row","items-center","justify-end"],["mat-raised-button","","type","button","color","primary",3,"click"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-toolbar",1)(1,"h2",2),e.\u0275\u0275text(2,"security.2fa.dialog.enable-sms-title"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"span",3),e.\u0275\u0275elementStart(4,"button",4),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.closeDialog())}),e.\u0275\u0275elementStart(5,"mat-icon",5),e.\u0275\u0275text(6,"close"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(7,_h,1,0,"mat-progress-bar",6),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275template(9,Sh,1,0,"div",7),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275elementStart(11,"div",8)(12,"mat-stepper",9,0),e.\u0275\u0275template(14,Th,2,0,"ng-template",10),e.\u0275\u0275elementStart(15,"mat-step",11),e.\u0275\u0275template(16,Ih,2,3,"ng-template",12),e.\u0275\u0275elementStart(17,"form",13),e.\u0275\u0275listener("ngSubmit",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.nextStep())}),e.\u0275\u0275elementStart(18,"p",14),e.\u0275\u0275text(19,"security.2fa.dialog.sms-step-description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"div",15),e.\u0275\u0275element(21,"tb-phone-input",16),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275elementStart(23,"button",17),e.\u0275\u0275pipe(24,"async"),e.\u0275\u0275text(25),e.\u0275\u0275pipe(26,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(27,"mat-step",11),e.\u0275\u0275template(28,wh,2,3,"ng-template",12),e.\u0275\u0275elementStart(29,"form",13),e.\u0275\u0275listener("ngSubmit",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.nextStep())}),e.\u0275\u0275elementStart(30,"p",18),e.\u0275\u0275text(31),e.\u0275\u0275pipe(32,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(33,"div",19)(34,"mat-form-field",20),e.\u0275\u0275element(35,"input",21),e.\u0275\u0275pipe(36,"translate"),e.\u0275\u0275template(37,Eh,3,3,"mat-error",22),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(38,"div",23)(39,"button",24),e.\u0275\u0275pipe(40,"async"),e.\u0275\u0275text(41),e.\u0275\u0275pipe(42,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(43,"button",17),e.\u0275\u0275pipe(44,"async"),e.\u0275\u0275text(45),e.\u0275\u0275pipe(46,"translate"),e.\u0275\u0275elementEnd()()()()(),e.\u0275\u0275elementStart(47,"mat-step"),e.\u0275\u0275template(48,Mh,2,3,"ng-template",25),e.\u0275\u0275elementStart(49,"div")(50,"h3",26),e.\u0275\u0275text(51,"security.2fa.dialog.success"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(52,"p",27),e.\u0275\u0275text(53,"security.2fa.dialog.activation-step-description-sms"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(54,"div",28)(55,"button",29),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.closeDialog())}),e.\u0275\u0275text(56),e.\u0275\u0275pipe(57,"translate"),e.\u0275\u0275elementEnd()()()()()()}2&i&&(e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(8,18,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(10,20,n.isLoading$)),e.\u0275\u0275advance(6),e.\u0275\u0275property("stepControl",n.smsConfigForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.smsConfigForm),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(22,22,"security.2fa.dialog.sms-step-label")),e.\u0275\u0275property("floatLabel","never"),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(24,24,n.isLoading$)||n.smsConfigForm.invalid),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(26,26,"security.2fa.dialog.send-code")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("stepControl",n.smsVerificationForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.smsVerificationForm),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(32,28,"security.2fa.dialog.verification-step-description",e.\u0275\u0275pureFunction1(43,xh,n.smsConfigForm.get("phone").value))," "),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(36,31,"security.2fa.dialog.verification-code")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.smsVerificationForm.get("verificationCode").invalid),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(40,33,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(42,35,"action.back")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(44,37,n.isLoading$)||n.smsVerificationForm.invalid),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(46,39,"action.activate")," "),e.\u0275\u0275advance(11),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(57,41,"action.done")," "))},dependencies:[p.NgIf,pt.ToastDirective,x.MatButton,x.MatIconButton,E.MatIcon,K.MatProgressBar,L.MatInput,v.MatFormField,v.MatError,ae.MatToolbar,S.MatDialogContent,te.MatStep,te.MatStepLabel,te.MatStepper,te.MatStepperPrevious,te.MatStepperIcon,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.MaxLengthValidator,s.PatternValidator,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,jo.U,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%] > h2[_ngcontent-%COMP%]{font-weight:400;letter-spacing:.25px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]{margin-bottom:0;letter-spacing:.25px}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]:not(:first-of-type){margin:0 0 8px}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]{margin:0;color:#0000008a}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]{max-width:290px}[_nghost-%COMP%]   .code-container[_ngcontent-%COMP%]{max-width:170px}@media screen and (max-width: 599px){[_nghost-%COMP%]   .code-container.full-width-xs[_ngcontent-%COMP%]{max-width:100%;width:100%}}[_nghost-%COMP%]   .result-title[_ngcontent-%COMP%]{font:500 18px/24px Roboto,Helvetica Neue,sans-serif;letter-spacing:.1px;margin:8px 0;text-align:center}[_nghost-%COMP%]   .result-description[_ngcontent-%COMP%]{text-align:center;margin:0 0 16px;letter-spacing:.25px;max-width:500px}[_nghost-%COMP%]   .step-description[_ngcontent-%COMP%]{max-width:450px}[_nghost-%COMP%]   .step-description.input[_ngcontent-%COMP%]{margin:12px 0 0}[_nghost-%COMP%]   .qr-code-description[_ngcontent-%COMP%]{text-align:center;max-width:180px;letter-spacing:.25px;color:#000000de;margin-bottom:0}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]{max-width:500px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{max-width:500px;margin:40px 0 8px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{letter-spacing:.25px;padding:0 24px;margin-bottom:16px;font-family:Roboto Mono,Helvetica Neue,monospace}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code.even[_ngcontent-%COMP%]{text-align:right}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{margin-bottom:40px}[_nghost-%COMP%]     .mat-horizontal-stepper-header{pointer-events:none!important}']})}}const Nh=["stepper"],Ah=a=>({address:a});function Fh(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",31)}function Dh(a,t){1&a&&e.\u0275\u0275element(0,"div",32)}function Ph(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-icon"),e.\u0275\u0275text(1,"done"),e.\u0275\u0275elementEnd())}function kh(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"security.2fa.dialog.email-step-label"))}function Lh(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"user.email-required")," "))}function Oh(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"user.invalid-email-format")," "))}function Rh(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"security.2fa.dialog.verification-step-label"))}function Vh(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"security.2fa.dialog.verification-code-invalid")," "))}function Bh(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"security.2fa.dialog.activation-step-label"))}class Za extends se.m{constructor(t,i,n,o,r,l){super(t,i,r),this.store=t,this.router=i,this.twoFaService=n,this.data=o,this.dialogRef=r,this.fb=l,this.emailConfigForm=this.fb.group({email:[this.data.email,[s.Validators.required,s.Validators.email]]}),this.emailVerificationForm=this.fb.group({verificationCode:["",[s.Validators.required,s.Validators.minLength(6),s.Validators.maxLength(6),s.Validators.pattern(/^\d*$/)]]})}nextStep(){switch(this.stepper.selectedIndex){case 0:this.emailConfigForm.valid?(this.authAccountConfig={providerType:W.LB.EMAIL,useByDefault:!0,email:this.emailConfigForm.get("email").value},this.twoFaService.submitTwoFaAccountConfig(this.authAccountConfig).subscribe(()=>{this.stepper.next()})):this.showFormErrors(this.emailConfigForm);break;case 1:this.emailVerificationForm.valid?this.twoFaService.verifyAndSaveTwoFaAccountConfig(this.authAccountConfig,this.emailVerificationForm.get("verificationCode").value).subscribe(t=>{this.config=t,this.stepper.next()}):this.showFormErrors(this.emailVerificationForm)}}closeDialog(){return this.dialogRef.close(this.config)}showFormErrors(t){Object.keys(t.controls).forEach(i=>{t.get(i).markAsTouched({onlySelf:!0})})}static{this.\u0275fac=function(i){return new(i||Za)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(kt.Z),e.\u0275\u0275directiveInject(S.MAT_DIALOG_DATA),e.\u0275\u0275directiveInject(S.MatDialogRef),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Za,selectors:[["tb-email-auth-dialog"]],viewQuery:function(i,n){if(1&i&&e.\u0275\u0275viewQuery(Nh,5),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.stepper=o.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:61,vars:47,consts:[["stepper",""],["color","primary",1,"flex","flex-row"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","",2,"padding","0"],[3,"linear"],["matStepperIcon","edit"],[3,"stepControl"],["matStepLabel",""],[3,"ngSubmit","formGroup"],["translate","",1,"mat-body","step-description","input"],[1,"flex","flex-row","items-center","justify-between","gap-2"],[1,"mat-block","input-container","flex-1"],["matInput","","formControlName","email","type","email","required","",3,"placeholder"],[4,"ngIf"],["mat-raised-button","","type","submit","color","primary",3,"disabled"],[1,"mat-body","step-description","input"],[1,"flex","flex-row","items-center","justify-between","xs:flex-col","xs:items-end","xs:justify-start"],[1,"mat-block","code-container","full-width-xs","flex-1"],["matInput","","formControlName","verificationCode","maxlength","6","type","text","required","","inputmode","numeric","pattern","[0-9]*","autocomplete","off",3,"placeholder"],[1,"flex","gap-2"],["mat-button","","matStepperPrevious","",3,"disabled"],["matStepLabel","","matStepperIcon","done"],["translate","",1,"result-title"],["translate","",1,"mat-body","result-description"],[1,"flex","flex-row","items-center","justify-end"],["mat-raised-button","","type","button","color","primary",3,"click"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-toolbar",1)(1,"h2",2),e.\u0275\u0275text(2,"security.2fa.dialog.enable-email-title"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"span",3),e.\u0275\u0275elementStart(4,"button",4),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.closeDialog())}),e.\u0275\u0275elementStart(5,"mat-icon",5),e.\u0275\u0275text(6,"close"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(7,Fh,1,0,"mat-progress-bar",6),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275template(9,Dh,1,0,"div",7),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275elementStart(11,"div",8)(12,"mat-stepper",9,0),e.\u0275\u0275template(14,Ph,2,0,"ng-template",10),e.\u0275\u0275elementStart(15,"mat-step",11),e.\u0275\u0275template(16,kh,2,3,"ng-template",12),e.\u0275\u0275elementStart(17,"form",13),e.\u0275\u0275listener("ngSubmit",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.nextStep())}),e.\u0275\u0275elementStart(18,"p",14),e.\u0275\u0275text(19,"security.2fa.dialog.email-step-description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"div",15)(21,"mat-form-field",16),e.\u0275\u0275element(22,"input",17),e.\u0275\u0275pipe(23,"translate"),e.\u0275\u0275template(24,Lh,3,3,"mat-error",18)(25,Oh,3,3,"mat-error",18),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(26,"button",19),e.\u0275\u0275pipe(27,"async"),e.\u0275\u0275text(28),e.\u0275\u0275pipe(29,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(30,"mat-step",11),e.\u0275\u0275template(31,Rh,2,3,"ng-template",12),e.\u0275\u0275elementStart(32,"form",13),e.\u0275\u0275listener("ngSubmit",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.nextStep())}),e.\u0275\u0275elementStart(33,"p",20),e.\u0275\u0275text(34),e.\u0275\u0275pipe(35,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(36,"div",21)(37,"mat-form-field",22),e.\u0275\u0275element(38,"input",23),e.\u0275\u0275pipe(39,"translate"),e.\u0275\u0275template(40,Vh,3,3,"mat-error",18),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(41,"div",24)(42,"button",25),e.\u0275\u0275pipe(43,"async"),e.\u0275\u0275text(44),e.\u0275\u0275pipe(45,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(46,"button",19),e.\u0275\u0275pipe(47,"async"),e.\u0275\u0275text(48),e.\u0275\u0275pipe(49,"translate"),e.\u0275\u0275elementEnd()()()()(),e.\u0275\u0275elementStart(50,"mat-step"),e.\u0275\u0275template(51,Bh,2,3,"ng-template",26),e.\u0275\u0275elementStart(52,"div")(53,"h3",27),e.\u0275\u0275text(54,"security.2fa.dialog.success"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(55,"p",28),e.\u0275\u0275text(56,"security.2fa.dialog.activation-step-description-email"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(57,"div",29)(58,"button",30),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.closeDialog())}),e.\u0275\u0275text(59),e.\u0275\u0275pipe(60,"translate"),e.\u0275\u0275elementEnd()()()()()()}2&i&&(e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(8,20,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(10,22,n.isLoading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("linear",!0),e.\u0275\u0275advance(3),e.\u0275\u0275property("stepControl",n.emailConfigForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.emailConfigForm),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(23,24,"security.2fa.dialog.email-step-label")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.emailConfigForm.get("email").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.emailConfigForm.get("email").hasError("email")),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(27,26,n.isLoading$)||n.emailConfigForm.invalid),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(29,28,"security.2fa.dialog.send-code")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("stepControl",n.emailVerificationForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.emailVerificationForm),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(35,30,"security.2fa.dialog.verification-step-description",e.\u0275\u0275pureFunction1(45,Ah,n.emailConfigForm.get("email").value))," "),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(39,33,"security.2fa.dialog.verification-code")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.emailVerificationForm.get("verificationCode").invalid),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(43,35,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(45,37,"action.back")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(47,39,n.isLoading$)||n.emailVerificationForm.invalid),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(49,41,"action.activate")," "),e.\u0275\u0275advance(11),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(60,43,"action.done")," "))},dependencies:[p.NgIf,pt.ToastDirective,x.MatButton,x.MatIconButton,E.MatIcon,K.MatProgressBar,L.MatInput,v.MatFormField,v.MatError,ae.MatToolbar,S.MatDialogContent,te.MatStep,te.MatStepLabel,te.MatStepper,te.MatStepperPrevious,te.MatStepperIcon,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.MaxLengthValidator,s.PatternValidator,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%] > h2[_ngcontent-%COMP%]{font-weight:400;letter-spacing:.25px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]{margin-bottom:0;letter-spacing:.25px}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]:not(:first-of-type){margin:0 0 8px}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]{margin:0;color:#0000008a}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]{max-width:290px}[_nghost-%COMP%]   .code-container[_ngcontent-%COMP%]{max-width:170px}@media screen and (max-width: 599px){[_nghost-%COMP%]   .code-container.full-width-xs[_ngcontent-%COMP%]{max-width:100%;width:100%}}[_nghost-%COMP%]   .result-title[_ngcontent-%COMP%]{font:500 18px/24px Roboto,Helvetica Neue,sans-serif;letter-spacing:.1px;margin:8px 0;text-align:center}[_nghost-%COMP%]   .result-description[_ngcontent-%COMP%]{text-align:center;margin:0 0 16px;letter-spacing:.25px;max-width:500px}[_nghost-%COMP%]   .step-description[_ngcontent-%COMP%]{max-width:450px}[_nghost-%COMP%]   .step-description.input[_ngcontent-%COMP%]{margin:12px 0 0}[_nghost-%COMP%]   .qr-code-description[_ngcontent-%COMP%]{text-align:center;max-width:180px;letter-spacing:.25px;color:#000000de;margin-bottom:0}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]{max-width:500px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{max-width:500px;margin:40px 0 8px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{letter-spacing:.25px;padding:0 24px;margin-bottom:16px;font-family:Roboto Mono,Helvetica Neue,monospace}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code.even[_ngcontent-%COMP%]{text-align:right}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{margin-bottom:40px}[_nghost-%COMP%]     .mat-horizontal-stepper-header{pointer-events:none!important}']})}}const Gh='<html lang="en">\r\n<head>\r\n    <meta name="viewport" content="width=device-width" />\r\n    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />\r\n    <title>Backup code</title>\r\n\r\n    <style>\r\n        .code-block {\r\n            display: flex;\r\n            flex-wrap: wrap;\r\n            margin-bottom: 16px;\r\n        }\r\n        .code-row {\r\n            margin: 0 6px 8px;\r\n            display: flex;\r\n            min-width: 130px;\r\n        }\r\n        .code {\r\n            font: 400 16px / 20px Roboto Mono, "Helvetica Neue", monospace;\r\n            margin-left: 6px;\r\n        }\r\n        input[type="checkbox"] {\r\n            -webkit-appearance: none;\r\n            appearance: none;\r\n            background-color: #fff;\r\n            margin: 0;\r\n            font: inherit;\r\n            color: currentColor;\r\n            width: 1em;\r\n            height: 1em;\r\n            border: 0.1em solid currentColor;\r\n            border-radius: 0.15em;\r\n            transform: translateY(0em);\r\n        }\r\n    </style>\r\n</head>\r\n\r\n<body style="margin: 0">\r\n    <div style="margin: 8px; max-width: 286px">\r\n        <div style="border: #d0d7de solid 1px; border-radius:4px">\r\n            <h3 style="padding: 16px 24px; margin: 0; font: 500 20px / 24px Roboto, \'Helvetica Neue\', sans-serif; text-align: center">\r\n                Backup codes\r\n            </h3>\r\n            <div class="code-block">\r\n                ${codesBlock}\r\n            </div>\r\n        </div>\r\n    </div>\r\n</body>\r\n</html>\r\n';function jh(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",15)}function Uh(a,t){1&a&&e.\u0275\u0275element(0,"div",16)}function qh(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",17),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=t.even;e.\u0275\u0275classProp("even",n),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",i," ")}}class Xa extends se.m{constructor(t,i,n,o,r,l){super(t,i,r),this.store=t,this.router=i,this.twoFaService=n,this.importExportService=o,this.dialogRef=r,this.fb=l,this.twoFaService.generateTwoFaAccountConfig(W.LB.BACKUP_CODE).pipe((0,ne.M)(c=>this.backupCode=c),(0,Z.Z)(c=>this.twoFaService.verifyAndSaveTwoFaAccountConfig(c,null,{ignoreLoading:!0}))).subscribe(c=>{this.config=c})}closeDialog(){this.dialogRef.close(this.config)}downloadFile(){this.importExportService.exportText(this.backupCode.codes,"backup-codes")}printCode(){const t=(0,_.Go)(this.backupCode.codes).map(o=>`<div class="code-row"><input type="checkbox"><span class="code">${o}</span></div>`).join(""),i=Gh.replace("${codesBlock}",t),n=window.open("","Print backup code");n.document.open(),n.document.write(i),setTimeout(()=>{n.print(),n.document.close(),setTimeout(()=>{n.close()},10)},0)}static{this.\u0275fac=function(i){return new(i||Xa)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(kt.Z),e.\u0275\u0275directiveInject(ut.ImportExportService),e.\u0275\u0275directiveInject(S.MatDialogRef),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Xa,selectors:[["tb-backup-code-auth-dialog"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:29,vars:16,consts:[["color","primary",1,"flex","flex-row"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","",1,"backup-code"],["translate","",1,"mat-body-2","description"],[1,"container","flex","flex-row","flex-wrap"],["class","code max-w-50% flex-full",3,"even",4,"ngFor","ngForOf"],[1,"action-buttons","flex","flex-row","items-center","justify-start","gap-4"],["type","button","mat-stroked-button","","color","primary",3,"click"],["type","button","mat-raised-button","","color","primary",3,"click"],[1,"flex","flex-row","items-start","justify-end"],["color","warn","mode","indeterminate"],[2,"height","4px"],[1,"code","max-w-50%","flex-full"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"mat-toolbar",0)(1,"h2",1),e.\u0275\u0275text(2,"security.2fa.dialog.get-backup-code-title"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"span",2),e.\u0275\u0275elementStart(4,"button",3),e.\u0275\u0275listener("click",function(){return n.closeDialog()}),e.\u0275\u0275elementStart(5,"mat-icon",4),e.\u0275\u0275text(6,"close"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(7,jh,1,0,"mat-progress-bar",5),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275template(9,Uh,1,0,"div",6),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275elementStart(11,"div",7)(12,"p",8),e.\u0275\u0275text(13,"security.2fa.dialog.backup-code-description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"div",9),e.\u0275\u0275template(15,qh,2,3,"div",10),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"div",11)(17,"button",12),e.\u0275\u0275listener("click",function(){return n.downloadFile()}),e.\u0275\u0275text(18),e.\u0275\u0275pipe(19,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"button",13),e.\u0275\u0275listener("click",function(){return n.printCode()}),e.\u0275\u0275text(21),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(23,"p",8),e.\u0275\u0275text(24,"security.2fa.dialog.backup-code-warn"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(25,"div",14)(26,"button",13),e.\u0275\u0275listener("click",function(){return n.closeDialog()}),e.\u0275\u0275text(27),e.\u0275\u0275pipe(28,"translate"),e.\u0275\u0275elementEnd()()()),2&i&&(e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(8,6,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(10,8,n.isLoading$)),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",null==n.backupCode?null:n.backupCode.codes),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(19,10,"security.2fa.dialog.download-txt")," "),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(22,12,"action.print")," "),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(28,14,"action.done")," "))},dependencies:[p.NgForOf,p.NgIf,pt.ToastDirective,x.MatButton,x.MatIconButton,E.MatIcon,K.MatProgressBar,ae.MatToolbar,S.MatDialogContent,u.TranslateDirective,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%] > h2[_ngcontent-%COMP%]{font-weight:400;letter-spacing:.25px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]{margin-bottom:0;letter-spacing:.25px}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]:not(:first-of-type){margin:0 0 8px}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]{margin:0;color:#0000008a}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]{max-width:290px}[_nghost-%COMP%]   .code-container[_ngcontent-%COMP%]{max-width:170px}@media screen and (max-width: 599px){[_nghost-%COMP%]   .code-container.full-width-xs[_ngcontent-%COMP%]{max-width:100%;width:100%}}[_nghost-%COMP%]   .result-title[_ngcontent-%COMP%]{font:500 18px/24px Roboto,Helvetica Neue,sans-serif;letter-spacing:.1px;margin:8px 0;text-align:center}[_nghost-%COMP%]   .result-description[_ngcontent-%COMP%]{text-align:center;margin:0 0 16px;letter-spacing:.25px;max-width:500px}[_nghost-%COMP%]   .step-description[_ngcontent-%COMP%]{max-width:450px}[_nghost-%COMP%]   .step-description.input[_ngcontent-%COMP%]{margin:12px 0 0}[_nghost-%COMP%]   .qr-code-description[_ngcontent-%COMP%]{text-align:center;max-width:180px;letter-spacing:.25px;color:#000000de;margin-bottom:0}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]{max-width:500px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{max-width:500px;margin:40px 0 8px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{letter-spacing:.25px;padding:0 24px;margin-bottom:16px;font-family:Roboto Mono,Helvetica Neue,monospace}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code.even[_ngcontent-%COMP%]{text-align:right}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{margin-bottom:40px}[_nghost-%COMP%]     .mat-horizontal-stepper-header{pointer-events:none!important}']})}}const Wh=new Map([[W.LB.TOTP,Qa],[W.LB.SMS,Ja],[W.LB.EMAIL,Za],[W.LB.BACKUP_CODE,Xa]]),An=a=>({count:a});function $h(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"security.password-requirement.incorrect-password-try-again")," "))}function zh(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"security.password-requirement.password-not-meet-requirements")," "))}function Hh(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",i.changePassword.get("newPassword").getError("alreadyUsed")," ")}}function Kh(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"security.password-requirement.password-should-difference")," "))}function Yh(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"security.password-requirement.password-should-not-contain-spaces")," "))}function Qh(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function Jh(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"security.password-requirement.new-passwords-not-match")," "))}function Zh(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function Xh(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"p",37)(1,"tb-icon",38),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",i.changePassword.get("newPassword").hasError("notUpperCase")?"mdi:circle-small":"mdi:check"," "),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(4,2,"security.password-requirement.uppercase-letter",e.\u0275\u0275pureFunction1(5,An,i.passwordPolicy.minimumUppercaseLetters))," ")}}function eb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"p",37)(1,"tb-icon",38),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",i.changePassword.get("newPassword").hasError("notLowerCase")?"mdi:circle-small":"mdi:check"," "),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(4,2,"security.password-requirement.lowercase-letter",e.\u0275\u0275pureFunction1(5,An,i.passwordPolicy.minimumLowercaseLetters))," ")}}function tb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"p",37)(1,"tb-icon",38),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",i.changePassword.get("newPassword").hasError("notNumeric")?"mdi:circle-small":"mdi:check"," "),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(4,2,"security.password-requirement.digit",e.\u0275\u0275pureFunction1(5,An,i.passwordPolicy.minimumDigits))," ")}}function nb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"p",37)(1,"tb-icon",38),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",i.changePassword.get("newPassword").hasError("notSpecial")?"mdi:circle-small":"mdi:check"," "),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(4,2,"security.password-requirement.special-character",e.\u0275\u0275pureFunction1(5,An,i.passwordPolicy.minimumSpecialCharacters))," ")}}function ib(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"p",37)(1,"tb-icon",38),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",i.changePassword.get("newPassword").hasError("minLength")?"mdi:circle-small":"mdi:check"," "),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(4,2,"security.password-requirement.character",e.\u0275\u0275pureFunction1(5,An,i.passwordPolicy.minimumLength))," ")}}function ab(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",34)(1,"h4",35),e.\u0275\u0275text(2,"security.password-requirement.at-most"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"p",37),e.\u0275\u0275element(4,"mat-icon",39),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(4),e.\u0275\u0275property("svgIcon",i.changePassword.get("newPassword").hasError("maxLength")?"mdi:circle-small":"mdi:check"),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(6,2,"security.password-requirement.character",e.\u0275\u0275pureFunction1(5,An,i.passwordPolicy.maximumLength))," ")}}function ob(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",34)(1,"h3",15),e.\u0275\u0275text(2,"security.password-requirement.password-requirements"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"h4",35),e.\u0275\u0275text(4,"security.password-requirement.at-least"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,Xh,5,7,"p",36)(6,eb,5,7,"p",36)(7,tb,5,7,"p",36)(8,nb,5,7,"p",36)(9,ib,5,7,"p",36)(10,ab,7,7,"div",33),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.passwordPolicy.minimumUppercaseLetters>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.passwordPolicy.minimumLowercaseLetters>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.passwordPolicy.minimumDigits>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.passwordPolicy.minimumSpecialCharacters>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.passwordPolicy.minimumLength>0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.passwordPolicy.maximumLength>0)}}function rb(a,t){if(1&a&&e.\u0275\u0275template(0,ob,11,6,"div",33),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngIf",i.passwordPolicy)}}function sb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",54),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,n.providersData.get(i).description)," ")}}function lb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",54),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(2,1,n.providersData.get(i).activatedHint,n.providerDataInfo(i))," ")}}function db(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-checkbox",55),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275listener("change",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext().$implicit,l=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(l.changeDefaultProvider(o,r))}),e.\u0275\u0275elementStart(2,"span",56),e.\u0275\u0275text(3,"security.2fa.main-2fa-method"),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i)("checked",n.useByDefault===i)("disabled",e.\u0275\u0275pipeBind1(1,3,n.isLoading$))}}function cb(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",57),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(o.generateNewBackupCode())}),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()}2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"security.2fa.get-new-code")," "))}function pb(a,t){1&a&&e.\u0275\u0275element(0,"mat-divider")}function mb(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",47)(2,"h4",48),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",49),e.\u0275\u0275template(6,sb,3,3,"div",50)(7,lb,3,4,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(9,"mat-slide-toggle",51),e.\u0275\u0275listener("mousedown",function(o){const r=e.\u0275\u0275restoreView(i).$implicit,l=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(l.confirm2FAChange(o,r))}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(10,db,4,5,"mat-checkbox",52)(11,cb,3,3,"button",53),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(12,pb,1,0,"mat-divider",20),e.\u0275\u0275elementContainerEnd()}if(2&a){const i=t.$implicit,n=t.last,o=e.\u0275\u0275reference(8),r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,7,r.providersData.get(i).name)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!r.twoFactorAuth.get(i).value)("ngIfElse",o),e.\u0275\u0275advance(3),e.\u0275\u0275property("formControlName",i),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",r.twoFactorAuth.get(i).value&&i!==r.twoFactorAuthProviderType.BACKUP_CODE&&!r.activeSingleProvider),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",r.twoFactorAuth.get(i).value&&i===r.twoFactorAuthProviderType.BACKUP_CODE),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n)}}function ub(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-card",40)(1,"mat-card-title",41)(2,"span",6),e.\u0275\u0275text(3,"admin.2fa.2fa"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"mat-card-subtitle",42)(5,"div",43),e.\u0275\u0275text(6,"security.2fa.2fa-description"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(7,"h3",44),e.\u0275\u0275text(8,"security.2fa.authenticate-with"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"form",45),e.\u0275\u0275template(10,mb,13,9,"ng-container",46),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(9),e.\u0275\u0275property("formGroup",i.twoFactorAuth),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",i.allowTwoFactorProviders)("ngForTrackBy",i.trackByProvider)}}class eo extends de.H{get jwtToken(){return`Bearer ${localStorage.getItem("jwt_token")}`}get jwtTokenExpiration(){return localStorage.getItem("jwt_token_expiration")}get expirationJwtData(){const t=this.datePipe.transform(this.jwtTokenExpiration,"yyyy-MM-dd HH:mm:ss");return this.translate.instant("profile.valid-till",{expirationData:t})}constructor(t,i,n,o,r,l,c,m,h,T){super(t),this.store=t,this.route=i,this.translate=n,this.twoFaService=o,this.dialog=r,this.dialogService=l,this.fb=c,this.datePipe=m,this.authService=h,this.clipboardService=T,this.destroy$=new fe.B,this.allowTwoFactorProviders=[],this.providersData=W.yD,this.twoFactorAuthProviderType=W.LB,this.useByDefault=null,this.activeSingleProvider=!0}ngOnInit(){this.buildTwoFactorForm(),this.user=this.route.snapshot.data.user,this.twoFactorLoad(this.route.snapshot.data.providers),this.buildChangePasswordForm(),this.loadPasswordPolicy()}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}buildTwoFactorForm(){this.twoFactorAuth=this.fb.group({TOTP:[!1],SMS:[!1],EMAIL:[!1],BACKUP_CODE:[{value:!1,disabled:!0}]}),this.twoFactorAuth.valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(t=>{const i=Object.keys(t).filter(n=>t[n]&&n!==W.LB.BACKUP_CODE);this.activeSingleProvider=i.length<2,i.length?this.twoFactorAuth.get("BACKUP_CODE").enable({emitEvent:!1}):this.twoFactorAuth.get("BACKUP_CODE").disable({emitEvent:!1})})}twoFactorLoad(t){t.length&&(this.twoFaService.getAccountTwoFaSettings().subscribe(i=>this.processTwoFactorAuthConfig(i)),Object.values(W.LB).forEach(i=>{t.includes(i)&&this.allowTwoFactorProviders.push(i)}))}processTwoFactorAuthConfig(t){this.accountConfig=t?.configs||{},Object.values(W.LB).forEach(i=>{this.accountConfig[i]?(this.twoFactorAuth.get(i).setValue(!0),this.accountConfig[i].useByDefault&&(this.useByDefault=i)):this.twoFactorAuth.get(i).setValue(!1)})}buildChangePasswordForm(){this.changePassword=this.fb.group({currentPassword:[""],newPassword:["",s.Validators.required],newPassword2:["",this.samePasswordValidation(!1,"newPassword")]})}loadPasswordPolicy(){this.authService.getUserPasswordPolicy().subscribe(t=>{this.passwordPolicy=t,this.changePassword.get("newPassword").setValidators([this.passwordStrengthValidator(),this.samePasswordValidation(!0,"currentPassword"),s.Validators.required]),this.changePassword.get("newPassword").updateValueAndValidity({emitEvent:!1})})}passwordStrengthValidator(){return t=>{const i=t.value,n={};return this.passwordPolicy.minimumUppercaseLetters>0&&!new RegExp(`(?:.*?[A-Z]){${this.passwordPolicy.minimumUppercaseLetters}}`).test(i)&&(n.notUpperCase=!0),this.passwordPolicy.minimumLowercaseLetters>0&&!new RegExp(`(?:.*?[a-z]){${this.passwordPolicy.minimumLowercaseLetters}}`).test(i)&&(n.notLowerCase=!0),this.passwordPolicy.minimumDigits>0&&!new RegExp(`(?:.*?\\d){${this.passwordPolicy.minimumDigits}}`).test(i)&&(n.notNumeric=!0),this.passwordPolicy.minimumSpecialCharacters>0&&!new RegExp(`(?:.*?[\\W_]){${this.passwordPolicy.minimumSpecialCharacters}}`).test(i)&&(n.notSpecial=!0),!this.passwordPolicy.allowWhitespaces&&/\s/.test(i)&&(n.hasWhitespaces=!0),this.passwordPolicy.minimumLength>0&&i.length<this.passwordPolicy.minimumLength&&(n.minLength=!0),(!i.length||this.passwordPolicy.maximumLength>0&&i.length>this.passwordPolicy.maximumLength)&&(n.maxLength=!0),(0,_.n4)(n,{})?null:n}}samePasswordValidation(t,i){return n=>{const o=n.value,r=n.parent?.value[i];return t?o===r?{samePassword:!0}:null:o!==r?{differencePassword:!0}:null}}trackByProvider(t,i){return i}copyToken(){+this.jwtTokenExpiration<Date.now()?this.store.dispatch(new $.xo({message:this.translate.instant("profile.tokenCopiedWarnMessage"),type:"warn",duration:1500,verticalPosition:"bottom",horizontalPosition:"right"})):(this.clipboardService.copyFromContent(this.jwtToken),this.store.dispatch(new $.xo({message:this.translate.instant("profile.tokenCopiedSuccessMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"})))}confirm2FAChange(t,i){if(t.stopPropagation(),t.preventDefault(),!this.twoFactorAuth.get(i).disabled)if(this.twoFactorAuth.get(i).value){const n=this.translate.instant(`security.2fa.provider.${i.toLowerCase()}`);this.dialogService.confirm(this.translate.instant("security.2fa.disable-2fa-provider-title",{name:n}),this.translate.instant("security.2fa.disable-2fa-provider-text",{name:n})).subscribe(o=>{o&&(this.twoFactorAuth.disable({emitEvent:!1}),this.twoFaService.deleteTwoFaAccountConfig(i).pipe((0,ne.M)(()=>this.twoFactorAuth.enable({emitEvent:!1}))).subscribe(r=>this.processTwoFactorAuthConfig(r)))})}else this.createdNewAuthConfig(i)}createdNewAuthConfig(t){const i=t===W.LB.EMAIL?{email:this.user.email}:{};this.dialog.open(Wh.get(t),{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:i}).afterClosed().subscribe(n=>{(0,_.f1)(n)&&this.processTwoFactorAuthConfig(n)})}changeDefaultProvider(t,i){this.useByDefault!==i?(this.twoFactorAuth.disable({emitEvent:!1}),this.twoFaService.updateTwoFaAccountConfig(i,!0).pipe((0,ne.M)(()=>this.twoFactorAuth.enable({emitEvent:!1}))).subscribe(n=>this.processTwoFactorAuthConfig(n))):t.source.checked=!0}generateNewBackupCode(){const t=this.accountConfig[W.LB.BACKUP_CODE].codesLeft;let i;i=t?this.dialogService.confirm("Get new set of backup codes?",`If you get new backup codes, ${t} remaining codes you have left will be unusable.`,"","Get new codes"):(0,H.of)(!0),i.subscribe(n=>{n&&(this.twoFactorAuth.disable({emitEvent:!1}),this.twoFaService.deleteTwoFaAccountConfig(W.LB.BACKUP_CODE).pipe((0,ne.M)(()=>this.twoFactorAuth.enable({emitEvent:!1}))).subscribe(()=>this.createdNewAuthConfig(W.LB.BACKUP_CODE)))})}providerDataInfo(t){const i={info:null},n=this.accountConfig[t];if((0,_.f1)(n))switch(t){case W.LB.EMAIL:i.info=n.email;break;case W.LB.SMS:i.info=n.phoneNumber;break;case W.LB.BACKUP_CODE:i.info=n.codesLeft}return i}onChangePassword(t){this.changePassword.valid?this.authService.changePassword(this.changePassword.get("currentPassword").value,this.changePassword.get("newPassword").value,{ignoreErrors:!0}).subscribe(()=>{this.discardChanges(t)},i=>{400===i.status&&"Current password doesn't match!"===i.error.message?this.changePassword.get("currentPassword").setErrors({differencePassword:!0}):400===i.status&&i.error.message.startsWith("Password must")?this.loadPasswordPolicy():400===i.status&&i.error.message.startsWith("Password was already used")?this.changePassword.get("newPassword").setErrors({alreadyUsed:i.error.message}):this.store.dispatch(new $.xo({message:i.error.message,type:"error",target:"changePassword"}))}):this.changePassword.markAllAsTouched()}discardChanges(t,i){i&&i.stopPropagation(),t.resetForm({currentPassword:"",newPassword:"",newPassword2:""})}static{this.\u0275fac=function(i){return new(i||eo)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.ActivatedRoute),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(kt.Z),e.\u0275\u0275directiveInject(S.MatDialog),e.\u0275\u0275directiveInject(Ce.o),e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(p.DatePipe),e.\u0275\u0275directiveInject(on.u),e.\u0275\u0275directiveInject(we.WW))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:eo,selectors:[["tb-security"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:63,vars:41,consts:[["changePasswordForm","ngForm"],["passwordRequirements",""],["providerInfo",""],[1,"profile-container","flex","flex-col","gap-2"],["appearance","outlined",1,"profile-card","flex","flex-col"],[2,"margin-bottom","8px"],["translate","",1,"mat-headline-5","card-title"],[1,"flex","flex-row","items-center","justify-between"],[1,"token-text"],[1,"date"],["mat-raised-button","","color","primary","type","button",3,"click"],["tb-toast","","toastTarget","changePassword",1,"change-password"],[3,"ngSubmit","formGroup"],[1,"flex","flex-row","gap-6.25","xs:flex-col","xs:gap-0"],[1,"min-w-72.5","max-w-72.5","flex-1","basis-72.5","xs:min-w-0","xs:max-w-full","xs:basis-full","sm:min-w-62.5","sm:max-w-62.5","sm:basis-62.5"],["translate","",1,"card-title"],["appearance","fill","color","primary",1,"mat-block","same-color"],["translate",""],["matInput","","type","password","name","current-password","formControlName","currentPassword","autocomplete","current-password"],["matSuffix",""],[4,"ngIf"],["hideRequiredMarker","","appearance","fill","color","primary","subscriptSizing","dynamic",1,"mat-block","same-color"],["matInput","","type","password","name","new-password","formControlName","newPassword","autocomplete","new-password","required",""],[1,"flex","flex-1","items-center","justify-start","gt-xs:!hidden"],[4,"ngTemplateOutlet"],["hideRequiredMarker","","appearance","fill","color","primary",1,"mat-block","same-color"],["matInput","","type","password","name","new-password","formControlName","newPassword2","autocomplete","new-password","required",""],[3,"vertical"],[1,"flex","flex-1","items-start","justify-start","xs:!hidden"],[1,"flex","flex-row","gap-2",2,"margin-top","18px"],["mat-button","","color","primary","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["appearance","outlined","class","profile-card",4,"ngIf"],["class","password-requirements",4,"ngIf"],[1,"password-requirements"],["translate","",1,"mat-h4"],["class","mat-body",4,"ngIf"],[1,"mat-body"],[1,"tb-mat-20"],[1,"tb-mat-20",3,"svgIcon"],["appearance","outlined",1,"profile-card"],[2,"margin-bottom","20px"],[2,"margin-bottom","40px"],["translate","",1,"mat-body-2","description"],["translate","",1,"mat-h3","auth-title"],[3,"formGroup"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"provider"],[1,"provider-title"],[1,"flex","flex-row","items-start","justify-between"],["class","mat-body-2 description",4,"ngIf","ngIfElse"],[3,"mousedown","formControlName"],[3,"value","checked","disabled","change",4,"ngIf"],["type","button","mat-stroked-button","","color","primary",3,"click",4,"ngIf"],[1,"mat-body-2","description"],[3,"change","value","checked","disabled"],["translate","",1,"checkbox-label"],["type","button","mat-stroked-button","","color","primary",3,"click"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",3)(1,"mat-card",4)(2,"mat-card-title",5)(3,"span",6),e.\u0275\u0275text(4,"profile.jwt-token"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",7)(6,"div",8),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementStart(9,"span",9),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"date"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(12,"button",10),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.copyToken())}),e.\u0275\u0275elementStart(13,"span"),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(16,"mat-card",4)(17,"div",11)(18,"form",12,0),e.\u0275\u0275listener("ngSubmit",function(){e.\u0275\u0275restoreView(o);const l=e.\u0275\u0275reference(19);return e.\u0275\u0275resetView(n.onChangePassword(l))}),e.\u0275\u0275elementStart(20,"div",13)(21,"div",14)(22,"h3",15),e.\u0275\u0275text(23,"profile.change-password"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(24,"mat-form-field",16)(25,"mat-label",17),e.\u0275\u0275text(26,"profile.current-password"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(27,"input",18)(28,"tb-toggle-password",19),e.\u0275\u0275template(29,$h,3,3,"mat-error",20),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(30,"mat-form-field",21)(31,"mat-label",17),e.\u0275\u0275text(32,"login.new-password"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(33,"input",22)(34,"tb-toggle-password",19)(35,"mat-hint"),e.\u0275\u0275template(36,zh,3,3,"mat-error",20)(37,Hh,2,1,"mat-error",20)(38,Kh,3,3,"mat-error",20)(39,Yh,3,3,"mat-error",20),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(40,"div",23),e.\u0275\u0275template(41,Qh,1,0,"ng-container",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(42,"mat-form-field",25)(43,"mat-label",17),e.\u0275\u0275text(44,"login.new-password-again"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(45,"input",26)(46,"tb-toggle-password",19),e.\u0275\u0275template(47,Jh,3,3,"mat-error",20),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(48,"mat-divider",27),e.\u0275\u0275elementStart(49,"div",28),e.\u0275\u0275template(50,Zh,1,0,"ng-container",24),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(51,rb,1,1,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(53,"div",29)(54,"button",30),e.\u0275\u0275pipe(55,"async"),e.\u0275\u0275listener("click",function(l){e.\u0275\u0275restoreView(o);const c=e.\u0275\u0275reference(19);return e.\u0275\u0275resetView(n.discardChanges(c,l))}),e.\u0275\u0275text(56),e.\u0275\u0275pipe(57,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(58,"button",31),e.\u0275\u0275pipe(59,"async"),e.\u0275\u0275text(60),e.\u0275\u0275pipe(61,"translate"),e.\u0275\u0275elementEnd()()()()(),e.\u0275\u0275template(62,ub,11,3,"mat-card",32),e.\u0275\u0275elementEnd()}if(2&i){const o=e.\u0275\u0275reference(52);e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(8,26,"profile.token-valid-till")," "),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(11,28,n.jwtTokenExpiration,"yyyy-MM-dd HH:mm:ss")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,31,"profile.copy-jwt-token")),e.\u0275\u0275advance(4),e.\u0275\u0275property("formGroup",n.changePassword),e.\u0275\u0275advance(10),e.\u0275\u0275classProp("!hidden",!n.changePassword.get("currentPassword").dirty&&!n.changePassword.get("currentPassword").touched),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.changePassword.get("currentPassword").hasError("differencePassword")),e.\u0275\u0275advance(5),e.\u0275\u0275classProp("!hidden",!n.changePassword.get("newPassword").dirty&&!n.changePassword.get("newPassword").touched),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.changePassword.get("newPassword").errors&&!n.changePassword.get("newPassword").hasError("alreadyUsed")&&!n.changePassword.get("newPassword").hasError("hasWhitespaces")&&!n.changePassword.get("newPassword").hasError("samePassword")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.changePassword.get("newPassword").hasError("alreadyUsed")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.changePassword.get("newPassword").hasError("samePassword")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.changePassword.get("newPassword").hasError("hasWhitespaces")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngTemplateOutlet",o),e.\u0275\u0275advance(5),e.\u0275\u0275classProp("!hidden",!n.changePassword.get("newPassword2").dirty&&!n.changePassword.get("newPassword2").touched),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.changePassword.get("newPassword2").hasError("differencePassword")),e.\u0275\u0275advance(),e.\u0275\u0275property("vertical",!0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngTemplateOutlet",o),e.\u0275\u0275advance(3),e.\u0275\u0275classProp("!hidden",!n.changePassword.dirty&&!n.changePassword.touched),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(55,33,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(57,35,"action.discard-changes")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(59,37,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(61,39,"profile.change-password")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.allowTwoFactorProviders.length)}},dependencies:[p.NgForOf,p.NgIf,p.NgTemplateOutlet,pt.ToastDirective,x.MatButton,Te.MatCheckbox,E.MatIcon,D.MatCard,D.MatCardSubtitle,D.MatCardTitle,L.MatInput,v.MatFormField,v.MatLabel,v.MatHint,v.MatError,v.MatSuffix,Ye.MatDivider,pe.MatSlideToggle,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,Rr.TogglePasswordComponent,zo.TbIconComponent,p.AsyncPipe,p.DatePipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]   .profile-container[_ngcontent-%COMP%]{padding:8px}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{padding:24px}@media screen and (min-width: 960px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{width:55%}}@media screen and (min-width: 1920px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{width:45%}}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{font:500 18px/24px Roboto,Helvetica Neue,sans-serif;letter-spacing:.15px;margin-top:0}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .mat-h4[_ngcontent-%COMP%]{font-weight:500;font-size:14px;letter-spacing:.25px;margin:0 0 4px}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .change-password[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .change-password[_ngcontent-%COMP%]   .mat-divider.mat-divider-vertical[_ngcontent-%COMP%]{margin-bottom:25px}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .change-password[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{margin-bottom:4px}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .change-password[_ngcontent-%COMP%]   .password-requirements[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{margin:0 0 8px;letter-spacing:.25px;color:#000000de}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .change-password[_ngcontent-%COMP%]   .mat-icon[data-mat-icon-name=check][_ngcontent-%COMP%]{color:#24a148}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .auth-title[_ngcontent-%COMP%]{font-weight:500;margin:0}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .token-text[_ngcontent-%COMP%]{font:400 14px/16px Roboto,Helvetica Neue,sans-serif;letter-spacing:.25px;padding:8px 0}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .token-text[_ngcontent-%COMP%] > .date[_ngcontent-%COMP%]{opacity:.7}[_nghost-%COMP%]   .description[_ngcontent-%COMP%]{color:#0000008a;letter-spacing:.25px;margin-right:8px}[_nghost-%COMP%]   .mat-divider-horizontal[_ngcontent-%COMP%]{left:16px;right:16px;width:auto}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]{padding:24px 0}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]   .provider-title[_ngcontent-%COMP%]{font:400 14px/16px Roboto,Helvetica Neue,sans-serif;letter-spacing:.25px;margin:0 0 8px}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{max-width:85%}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]   .checkbox-label[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.25px;opacity:.87}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:8px}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]   .mat-mdc-outlined-button[_ngcontent-%COMP%]{margin-top:8px}']})}}class Fn{constructor(t,i){this.store=t,this.userService=i}resolve(){const t=(0,q.rx)(this.store).userId;return this.userService.getUser(t)}static{this.\u0275fac=function(i){return new(i||Fn)(e.\u0275\u0275inject(C.Store),e.\u0275\u0275inject(Ka.D))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Fn,factory:Fn.\u0275fac})}}class Dn{constructor(t){this.twoFactorAuthService=t}resolve(){return this.twoFactorAuthService.getAvailableTwoFaProviders()}static{this.\u0275fac=function(i){return new(i||Dn)(e.\u0275\u0275inject(kt.Z))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Dn,factory:Dn.\u0275fac})}}const gb=[{path:"security",component:eo,canDeactivate:[P.L],data:{auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"security.security",breadcrumb:{label:"security.security",icon:"lock"}},resolve:{user:Fn,providers:Dn}}],fb=[{path:"security",redirectTo:"/account/security"}];class Pn{static{this.\u0275fac=function(i){return new(i||Pn)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Pn})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[Fn,Dn],imports:[b.RouterModule.forChild(fb),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Pn,{imports:[b.RouterModule],exports:[b.RouterModule]});class kn{static{this.\u0275fac=function(i){return new(i||kn)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:kn})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,Pn]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(kn,{declarations:[eo,Qa,Ja,Za,Xa],imports:[p.CommonModule,w.G,Pn]});var bs=d(42903);class er extends xe.l{constructor(t,i,n,o,r,l){super(t,i,n,o,r),this.store=t,this.fb=i,this.entityValue=n,this.entitiesTableConfigValue=o,this.cd=r,this.countryData=l}buildForm(t){const i=this.buildEntityForm(t);return i.addControl("country",this.fb.control(t?t.country:"",[s.Validators.maxLength(255)])),i.addControl("city",this.fb.control(t?t.city:"",[s.Validators.maxLength(255)])),i.addControl("state",this.fb.control(t?t.state:"",[s.Validators.maxLength(255)])),i.addControl("zip",this.fb.control(t?t.zip:"",this.zipValidators(t?t.country:""))),i.addControl("address",this.fb.control(t?t.address:"",[])),i.addControl("address2",this.fb.control(t?t.address2:"",[])),i.addControl("phone",this.fb.control(t?t.phone:"",[s.Validators.maxLength(255)])),i.addControl("email",this.fb.control(t?t.email:"",[s.Validators.email])),i}updateForm(t){this.updateEntityForm(t),this.entityForm.patchValue({country:t.country}),this.entityForm.patchValue({city:t.city}),this.entityForm.patchValue({state:t.state}),this.entityForm.get("zip").setValidators(this.zipValidators(t.country)),this.entityForm.patchValue({zip:t.zip}),this.entityForm.patchValue({address:t.address}),this.entityForm.patchValue({address2:t.address2}),this.entityForm.patchValue({phone:t.phone}),this.entityForm.patchValue({email:t.email})}ngAfterViewInit(){this.entityForm.get("country").valueChanges.subscribe(t=>{this.entityForm.get("zip").setValidators(this.zipValidators(t)),this.entityForm.get("zip").updateValueAndValidity({onlySelf:!0}),this.entityForm.get("zip").markAsTouched({onlySelf:!0})})}zipValidators(t){const i=[];if(t){const n=this.countryData.allCountries.find(o=>o.name===t)?.postCodePattern;n&&i.push(s.Validators.pattern(n))}return i}static{this.\u0275fac=function(i){e.\u0275\u0275invalidFactory()}}static{this.\u0275dir=e.\u0275\u0275defineDirective({type:er,features:[e.\u0275\u0275InheritDefinitionFeature]})}}var ys=d(70110),hb=d(34103);function bb(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"tenant.title-required")," "))}function yb(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"tenant.title-max-length")," "))}function vb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"section",17)(1,"section",18),e.\u0275\u0275element(2,"tb-dashboard-autocomplete",19),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementStart(4,"mat-checkbox",20),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(3,5,"dashboard.home-dashboard")),e.\u0275\u0275property("dashboardsScope","tenant")("tenantId",null==i.entity?null:i.entity.id.id)("selectFirstDashboard",!1),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(6,7,"dashboard.home-dashboard-hide-toolbar")," ")}}class to extends er{constructor(t,i,n,o,r,l,c){super(t,r,n,o,l,c),this.store=t,this.translate=i,this.entityValue=n,this.entitiesTableConfigValue=o,this.fb=r,this.cd=l,this.countryData=c}hideDelete(){return!!this.entitiesTableConfig&&!this.entitiesTableConfig.deleteEnabled(this.entity)}buildEntityForm(t){return this.fb.group({title:[t?t.title:"",[s.Validators.required,s.Validators.maxLength(255)]],tenantProfileId:[t?t.tenantProfileId:null,[s.Validators.required]],additionalInfo:this.fb.group({description:[t&&t.additionalInfo?t.additionalInfo.description:""],homeDashboardId:[t&&t.additionalInfo?t.additionalInfo.homeDashboardId:null],homeDashboardHideToolbar:[!(t&&t.additionalInfo&&(0,_.f1)(t.additionalInfo.homeDashboardHideToolbar))||t.additionalInfo.homeDashboardHideToolbar]})})}updateEntityForm(t){this.entityForm.patchValue({title:t.title}),this.entityForm.patchValue({tenantProfileId:t.tenantProfileId}),this.entityForm.patchValue({additionalInfo:{description:t.additionalInfo?t.additionalInfo.description:""}}),this.entityForm.patchValue({additionalInfo:{homeDashboardId:t.additionalInfo?t.additionalInfo.homeDashboardId:null}}),this.entityForm.patchValue({additionalInfo:{homeDashboardHideToolbar:!t.additionalInfo||!(0,_.f1)(t.additionalInfo.homeDashboardHideToolbar)||t.additionalInfo.homeDashboardHideToolbar}})}updateFormState(){this.entityForm&&(this.isEditValue?this.entityForm.enable({emitEvent:!1}):this.entityForm.disable({emitEvent:!1}))}onTenantIdCopied(t){this.store.dispatch(new $.xo({message:this.translate.instant("tenant.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onTenantProfileUpdated(){this.entitiesTableConfig.updateData(!1)}static{this.\u0275fac=function(i){return new(i||to)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject("entity"),e.\u0275\u0275directiveInject("entitiesTableConfig"),e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(bs.P))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:to,selectors:[["tb-tenant"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:36,vars:38,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["required","","formControlName","tenantProfileId",3,"tenantProfileUpdated","selectDefaultProfile","showDetailsPageLink"],["formGroupName","additionalInfo",1,"flex","flex-col"],["matInput","","formControlName","description","rows","2"],["class","tb-default-dashboard flex flex-1 flex-col",4,"ngIf"],[3,"parentForm","isEdit"],[1,"tb-default-dashboard","flex","flex-1","flex-col"],[1,"flex","flex-1","flex-col","gt-sm:flex-row"],["formControlName","homeDashboardId",1,"flex-1",3,"label","dashboardsScope","tenantId","selectFirstDashboard"],["formControlName","homeDashboardHideToolbar",1,"flex-1"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"button",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"open")}),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",1),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"manageTenantAdmins")}),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"button",1),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"delete")}),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"div",2)(14,"button",3),e.\u0275\u0275listener("cbOnSuccess",function(r){return n.onTenantIdCopied(r)}),e.\u0275\u0275element(15,"mat-icon",4),e.\u0275\u0275elementStart(16,"span",5),e.\u0275\u0275text(17,"tenant.copyId"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(18,"div",6)(19,"form",7)(20,"fieldset",8),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275elementStart(22,"mat-form-field",9)(23,"mat-label",5),e.\u0275\u0275text(24,"tenant.title"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(25,"input",10),e.\u0275\u0275template(26,bb,3,3,"mat-error",11)(27,yb,3,3,"mat-error",11),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(28,"tb-tenant-profile-autocomplete",12),e.\u0275\u0275listener("tenantProfileUpdated",function(){return n.onTenantProfileUpdated()}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(29,"div",13)(30,"mat-form-field",9)(31,"mat-label",5),e.\u0275\u0275text(32,"tenant.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(33,"textarea",14),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(34,vb,7,9,"section",15),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(35,"tb-contact",16),e.\u0275\u0275elementEnd()()()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",n.isEdit||n.isDetailsPage),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(2,24,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,26,"common.open-details-page")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(6,28,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(8,30,"tenant.manage-tenant-admins")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.hideDelete()||n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(10,32,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(12,34,"tenant.delete")," "),e.\u0275\u0275advance(3),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("cbContent",null==n.entity||null==n.entity.id?null:n.entity.id.id),e.\u0275\u0275advance(5),e.\u0275\u0275property("formGroup",n.entityForm),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(21,36,n.isLoading$)||!n.isEdit),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.entityForm.get("title").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("title").hasError("maxlength")),e.\u0275\u0275advance(),e.\u0275\u0275property("selectDefaultProfile",n.isAdd)("showDetailsPageLink",!0),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",null==n.entity?null:n.entity.id),e.\u0275\u0275advance(),e.\u0275\u0275property("parentForm",n.entityForm)("isEdit",n.isEdit))},dependencies:[p.NgIf,oa.DashboardAutocompleteComponent,x.MatButton,Te.MatCheckbox,E.MatIcon,L.MatInput,v.MatFormField,v.MatLabel,v.MatError,we.Uo,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,s.FormGroupName,u.TranslateDirective,ys.ContactComponent,hb.j,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-right:12px}}@media screen and (max-width: 959px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-bottom:12px}}@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:16px}}']})}}var vs=d(71420),xt=d(29414),_t=d(59948),tt=d(29760),nt=d(89432);function Cb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",6,0),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-attribute-table",7),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"attribute.attributes")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function xb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",6,1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-attribute-table",8),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"attribute.latest-telemetry")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function _b(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",6,2),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-alarm-table",9),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,3,"alarm.alarms")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)}}function Sb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",6,3),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-event-table",10),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"tenant.events")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultEventType",n.eventTypes.ERROR)("active",i.isActive)("tenantId",n.nullUid)("entityId",n.entity.id)}}function Tb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",6,4),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-relation-table",9),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,3,"relation.relations")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)}}class no extends Ee.P{constructor(t){super(t),this.store=t}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(i){return new(i||no)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:no,selectors:[["tb-tenant-tabs"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:5,vars:5,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"]],template:function(i,n){1&i&&e.\u0275\u0275template(0,Cb,4,7,"mat-tab",5)(1,xb,4,7,"mat-tab",5)(2,_b,4,5,"mat-tab",5)(3,Sb,4,7,"mat-tab",5)(4,Tb,4,5,"mat-tab",5),2&i&&(e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity))},dependencies:[p.NgIf,Q.MatTab,xt.EventTableComponent,_t.RelationTableComponent,tt.AlarmTableComponent,nt.AttributeTableComponent,u.TranslatePipe],encapsulation:2})}}class qt{constructor(t,i,n,o){this.tenantService=t,this.translate=i,this.datePipe=n,this.router=o,this.config=new y.M7,this.config.entityType=f.ck.TENANT,this.config.entityComponent=to,this.config.entityTabsComponent=no,this.config.entityTranslations=f.Mi.get(f.ck.TENANT),this.config.entityResources=f.BT.get(f.ck.TENANT),this.config.columns.push(new y.Qr("createdTime","common.created-time",this.datePipe,"150px"),new y.KK("title","tenant.title","20%"),new y.KK("tenantProfileName","tenant-profile.tenant-profile","20%"),new y.KK("email","contact.email","20%"),new y.KK("country","contact.country","20%"),new y.KK("city","contact.city","20%")),this.config.cellActionDescriptors.push({name:this.translate.instant("tenant.manage-tenant-admins"),icon:"account_circle",isEnabled:()=>!0,onAction:(r,l)=>this.manageTenantAdmins(r,l)}),this.config.deleteEntityTitle=r=>this.translate.instant("tenant.delete-tenant-title",{tenantTitle:r.title}),this.config.deleteEntityContent=()=>this.translate.instant("tenant.delete-tenant-text"),this.config.deleteEntitiesTitle=r=>this.translate.instant("tenant.delete-tenants-title",{count:r}),this.config.deleteEntitiesContent=()=>this.translate.instant("tenant.delete-tenants-text"),this.config.entitiesFetchFunction=r=>this.tenantService.getTenantInfos(r),this.config.loadEntity=r=>this.tenantService.getTenantInfo(r.id),this.config.saveEntity=r=>this.tenantService.saveTenant(r).pipe((0,Z.Z)(l=>this.tenantService.getTenantInfo(l.id.id))),this.config.deleteEntity=r=>this.tenantService.deleteTenant(r.id),this.config.onEntityAction=r=>this.onTenantAction(r,this.config)}resolve(){return this.config.tableTitle=this.translate.instant("tenant.tenants"),this.config}openTenant(t,i,n){t&&t.stopPropagation();const o=this.router.createUrlTree([i.id.id],{relativeTo:n.getActivatedRoute()});this.router.navigateByUrl(o)}manageTenantAdmins(t,i){t&&t.stopPropagation(),this.router.navigateByUrl(`tenants/${i.id.id}/users`)}onTenantAction(t,i){switch(t.action){case"open":return this.openTenant(t.event,t.entity,i),!0;case"manageTenantAdmins":return this.manageTenantAdmins(t.event,t.entity),!0}return!1}static{this.\u0275fac=function(i){return new(i||qt)(e.\u0275\u0275inject(vs.I),e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(p.DatePipe),e.\u0275\u0275inject(b.Router))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:qt,factory:qt.\u0275fac})}}function Ib(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",1),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275listener("click",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.onEntityAction(o,"loginAsUser"))}),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275classProp("!hidden",i.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(1,4,i.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,6,(null==i.entity?null:i.entity.authority)===i.authority.TENANT_ADMIN?"user.login-as-tenant-admin":"user.login-as-customer-user")," ")}}function wb(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"user.invalid-email-format")," "))}function Eb(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"user.email-required")," "))}function Mb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"section",19)(1,"section",20),e.\u0275\u0275element(2,"tb-dashboard-autocomplete",21),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementStart(4,"mat-checkbox",22),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(7,"section",20),e.\u0275\u0275element(8,"tb-dashboard-autocomplete",23),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementStart(10,"mat-checkbox",24),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd()()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(3,12,"user.default-dashboard")),e.\u0275\u0275property("dashboardsScope",(null==i.entity?null:i.entity.authority)===i.authority.TENANT_ADMIN?"tenant":"customer")("tenantId",null==i.entity||null==i.entity.tenantId?null:i.entity.tenantId.id)("customerId",null==i.entity||null==i.entity.customerId?null:i.entity.customerId.id)("selectFirstDashboard",!1),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(6,14,"user.always-fullscreen")," "),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(9,16,"dashboard.home-dashboard")),e.\u0275\u0275property("dashboardsScope",(null==i.entity?null:i.entity.authority)===i.authority.TENANT_ADMIN?"tenant":"customer")("tenantId",null==i.entity||null==i.entity.tenantId?null:i.entity.tenantId.id)("customerId",null==i.entity||null==i.entity.customerId?null:i.entity.customerId.id)("selectFirstDashboard",!1),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(12,18,"dashboard.home-dashboard-hide-toolbar")," ")}}class Wt extends xe.l{constructor(t,i,n,o,r,l){super(t,o,i,n,r),this.store=t,this.entityValue=i,this.entitiesTableConfigValue=n,this.fb=o,this.cd=r,this.translate=l,this.authority=g.s,this.loginAsUserEnabled$=this.store.pipe((0,C.select)(q.jc),(0,ie.T)(c=>c.userTokenAccessEnabled))}hideDelete(){return!!this.entitiesTableConfig&&!this.entitiesTableConfig.deleteEnabled(this.entity)}isUserCredentialsEnabled(){return!0===this.entity.additionalInfo.userCredentialsEnabled}isUserCredentialPresent(){return(0,_.f1)(this.entity?.additionalInfo?.userCredentialsEnabled)}buildForm(t){return this.fb.group({email:[t?t.email:"",[s.Validators.required,s.Validators.email]],firstName:[t?t.firstName:""],lastName:[t?t.lastName:""],phone:[t?t.phone:""],additionalInfo:this.fb.group({description:[t&&t.additionalInfo?t.additionalInfo.description:""],defaultDashboardId:[t&&t.additionalInfo?t.additionalInfo.defaultDashboardId:null],defaultDashboardFullscreen:[!(!t||!t.additionalInfo)&&t.additionalInfo.defaultDashboardFullscreen],homeDashboardId:[t&&t.additionalInfo?t.additionalInfo.homeDashboardId:null],homeDashboardHideToolbar:[!(t&&t.additionalInfo&&(0,_.f1)(t.additionalInfo.homeDashboardHideToolbar))||t.additionalInfo.homeDashboardHideToolbar]})})}updateForm(t){this.entityForm.patchValue({email:t.email}),this.entityForm.patchValue({firstName:t.firstName}),this.entityForm.patchValue({lastName:t.lastName}),this.entityForm.patchValue({phone:t.phone}),this.entityForm.patchValue({additionalInfo:{description:t.additionalInfo?t.additionalInfo.description:""}}),this.entityForm.patchValue({additionalInfo:{defaultDashboardId:t.additionalInfo?t.additionalInfo.defaultDashboardId:null}}),this.entityForm.patchValue({additionalInfo:{defaultDashboardFullscreen:!!t.additionalInfo&&t.additionalInfo.defaultDashboardFullscreen}}),this.entityForm.patchValue({additionalInfo:{homeDashboardId:t.additionalInfo?t.additionalInfo.homeDashboardId:null}}),this.entityForm.patchValue({additionalInfo:{homeDashboardHideToolbar:!t.additionalInfo||!(0,_.f1)(t.additionalInfo.homeDashboardHideToolbar)||t.additionalInfo.homeDashboardHideToolbar}})}onUserIdCopied(t){this.store.dispatch(new $.xo({message:this.translate.instant("user.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}static{this.\u0275fac=function(i){return new(i||Wt)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject("entity",8),e.\u0275\u0275directiveInject("entitiesTableConfig",8),e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(u.TranslateService))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Wt,selectors:[["tb-user"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:59,vars:69,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",3,"disabled","!hidden","click",4,"ngIf"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent","disabled"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["matInput","","type","email","formControlName","email","required",""],[4,"ngIf"],["matInput","","formControlName","firstName"],["matInput","","formControlName","lastName"],["formControlName","phone",3,"required","label","enableFlagsSelect"],["formGroupName","additionalInfo",1,"flex","flex-col"],["matInput","","formControlName","description","rows","2"],["class","tb-default-dashboard flex flex-1 flex-col",4,"ngIf"],[1,"tb-default-dashboard","flex","flex-1","flex-col"],[1,"flex","flex-1","flex-col","gt-sm:flex-row"],["formControlName","defaultDashboardId",1,"flex-1",3,"label","dashboardsScope","tenantId","customerId","selectFirstDashboard"],["formControlName","defaultDashboardFullscreen",1,"flex-1"],["formControlName","homeDashboardId",1,"flex-1",3,"label","dashboardsScope","tenantId","customerId","selectFirstDashboard"],["formControlName","homeDashboardHideToolbar",1,"flex-1"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"button",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"open")}),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",1),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"disableAccount")}),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"button",1),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"enableAccount")}),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"button",1),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"displayActivationLink")}),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"button",1),e.\u0275\u0275pipe(18,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"resendActivation")}),e.\u0275\u0275text(19),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(21,Ib,4,8,"button",2),e.\u0275\u0275pipe(22,"async"),e.\u0275\u0275elementStart(23,"button",1),e.\u0275\u0275pipe(24,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"delete")}),e.\u0275\u0275text(25),e.\u0275\u0275pipe(26,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(27,"div",3)(28,"button",4),e.\u0275\u0275pipe(29,"async"),e.\u0275\u0275listener("cbOnSuccess",function(r){return n.onUserIdCopied(r)}),e.\u0275\u0275element(30,"mat-icon",5),e.\u0275\u0275elementStart(31,"span",6),e.\u0275\u0275text(32,"user.copyId"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(33,"div",7)(34,"form",8)(35,"fieldset",9),e.\u0275\u0275pipe(36,"async"),e.\u0275\u0275elementStart(37,"mat-form-field",10)(38,"mat-label",6),e.\u0275\u0275text(39,"user.email"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(40,"input",11),e.\u0275\u0275template(41,wb,3,3,"mat-error",12)(42,Eb,3,3,"mat-error",12),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(43,"mat-form-field",10)(44,"mat-label",6),e.\u0275\u0275text(45,"user.first-name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(46,"input",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(47,"mat-form-field",10)(48,"mat-label",6),e.\u0275\u0275text(49,"user.last-name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(50,"input",14),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(51,"tb-phone-input",15),e.\u0275\u0275pipe(52,"translate"),e.\u0275\u0275elementStart(53,"div",16)(54,"mat-form-field",10)(55,"mat-label",6),e.\u0275\u0275text(56,"user.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(57,"textarea",17),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(58,Mb,13,20,"section",18),e.\u0275\u0275elementEnd()()()()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",n.isEdit||n.isDetailsPage),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(2,37,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,39,"common.open-details-page")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||!n.isUserCredentialPresent()||!n.isUserCredentialsEnabled()),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(6,41,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(8,43,"user.disable-account")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||!n.isUserCredentialPresent()||n.isUserCredentialsEnabled()),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(10,45,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(12,47,"user.enable-account")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||n.isUserCredentialPresent()),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(14,49,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,51,"user.display-activation-link")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||n.isUserCredentialPresent()),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(18,53,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(20,55,"user.resend-activation")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(22,57,n.loginAsUserEnabled$)),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.hideDelete()||n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(24,59,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(26,61,"user.delete")," "),e.\u0275\u0275advance(3),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("cbContent",null==n.entity||null==n.entity.id?null:n.entity.id.id)("disabled",e.\u0275\u0275pipeBind1(29,63,n.isLoading$)),e.\u0275\u0275advance(6),e.\u0275\u0275property("formGroup",n.entityForm),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(36,65,n.isLoading$)||!n.isEdit),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.entityForm.get("email").hasError("email")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("email").hasError("required")),e.\u0275\u0275advance(9),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(52,67,"contact.phone")),e.\u0275\u0275property("required",!1)("enableFlagsSelect",!0),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",null==n.entity?null:n.entity.id))},dependencies:[p.NgIf,oa.DashboardAutocompleteComponent,x.MatButton,Te.MatCheckbox,E.MatIcon,L.MatInput,v.MatFormField,v.MatLabel,v.MatError,we.Uo,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,s.FormGroupName,u.TranslateDirective,jo.U,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-right:12px}}@media screen and (max-width: 959px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-bottom:12px}}@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:16px}}']})}}var Ar=d(57021),Ln=d(1749),Nb=d(26597);const Ab=(a,t)=>({activationLink:a,activationLinkTtl:t});function Fb(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",17)}function Db(a,t){1&a&&e.\u0275\u0275element(0,"div",18)}class On extends se.m{constructor(t,i,n,o,r,l){super(t,i,o),this.store=t,this.router=i,this.data=n,this.dialogRef=o,this.translate=r,this.millisecondsToTimeStringPipe=l,this.activationLink=this.data.activationLinkInfo.value,this.activationLinkTtl=this.millisecondsToTimeStringPipe.transform(this.data.activationLinkInfo.ttlMs)}close(){this.dialogRef.close()}onActivationLinkCopied(){this.store.dispatch(new $.xo({message:this.translate.instant("user.activation-link-copied-message"),type:"success",target:"activationLinkDialogContent",duration:1200,verticalPosition:"bottom",horizontalPosition:"left"}))}static{this.\u0275fac=function(i){return new(i||On)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(S.MAT_DIALOG_DATA),e.\u0275\u0275directiveInject(S.MatDialogRef),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(Nb.MillisecondsToTimeStringPipe))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:On,selectors:[["tb-activation-link-dialog"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:28,vars:24,consts:[[2,"min-width","400px","position","relative"],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","","toastTarget","activationLinkDialogContent"],[1,"mat-content","flex","flex-col"],[3,"innerHTML"],[1,"flex","flex-row","items-center","justify-start"],[1,"tb-highlight","flex-1"],["mat-icon-button","","color","primary","ngxClipboard","","matTooltipPosition","above",3,"cbOnSuccess","cbContent","matTooltip"],["svgIcon","mdi:clipboard-arrow-left"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"form",0)(1,"mat-toolbar",1)(2,"h2",2),e.\u0275\u0275text(3,"user.activation-link"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"span",3),e.\u0275\u0275elementStart(5,"button",4),e.\u0275\u0275listener("click",function(){return n.close()}),e.\u0275\u0275elementStart(6,"mat-icon",5),e.\u0275\u0275text(7,"close"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(8,Fb,1,0,"mat-progress-bar",6),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275template(10,Db,1,0,"div",7),e.\u0275\u0275pipe(11,"async"),e.\u0275\u0275elementStart(12,"div",8)(13,"div",9),e.\u0275\u0275element(14,"span",10),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementStart(16,"div",11)(17,"pre",12)(18,"code"),e.\u0275\u0275text(19),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(20,"button",13),e.\u0275\u0275pipe(21,"translate"),e.\u0275\u0275listener("cbOnSuccess",function(){return n.onActivationLinkCopied()}),e.\u0275\u0275element(22,"mat-icon",14),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(23,"div",15)(24,"button",16),e.\u0275\u0275pipe(25,"async"),e.\u0275\u0275listener("click",function(){return n.close()}),e.\u0275\u0275text(26),e.\u0275\u0275pipe(27,"translate"),e.\u0275\u0275elementEnd()()()),2&i&&(e.\u0275\u0275advance(8),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(9,8,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(11,10,n.isLoading$)),e.\u0275\u0275advance(4),e.\u0275\u0275property("innerHTML",e.\u0275\u0275pipeBind2(15,12,"user.activation-link-text",e.\u0275\u0275pureFunction2(21,Ab,n.activationLink,n.activationLinkTtl)),e.\u0275\u0275sanitizeHtml),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(n.activationLink),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("cbContent",n.activationLink),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(21,15,"user.copy-activation-link")),e.\u0275\u0275advance(4),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(25,17,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(27,19,"action.ok")," "))},dependencies:[p.NgIf,pt.ToastDirective,x.MatButton,x.MatIconButton,E.MatIcon,K.MatProgressBar,ae.MatToolbar,S.MatDialogActions,S.MatDialogContent,_e.MatTooltip,we.Uo,s.\u0275NgNoValidate,s.NgControlStatusGroup,s.NgForm,u.TranslateDirective,p.AsyncPipe,u.TranslatePipe],encapsulation:2})}}var Cs=d(88549);const Pb=()=>({standalone:!0});function kb(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",16)}function Lb(a,t){1&a&&e.\u0275\u0275element(0,"div",17)}function Ob(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",18),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.activationMethodTranslations.get(n.activationMethodEnum[i]))," ")}}class io extends se.m{constructor(t,i,n,o,r,l){super(t,i,o),this.store=t,this.router=i,this.data=n,this.dialogRef=o,this.userService=r,this.dialog=l,this.activationMethods=Object.keys(Ln.y),this.activationMethodEnum=Ln.y,this.activationMethodTranslations=Ln.i,this.activationMethod=Ln.y.DISPLAY_ACTIVATION_LINK}ngOnInit(){this.user={},this.userComponent.isEdit=!0,this.userComponent.entity=this.user,this.detailsForm=this.userComponent.entityForm}cancel(){this.dialogRef.close(null)}add(){if(this.detailsForm.valid){this.user={...this.user,...this.userComponent.entityForm.value},this.user.authority=this.data.authority,this.user.tenantId=new Cs.a(this.data.tenantId),this.user.customerId=new Ar.G(this.data.customerId);const t=this.activationMethod===Ln.y.SEND_ACTIVATION_MAIL;this.userService.saveUser(this.user,t).subscribe(i=>{this.activationMethod===Ln.y.DISPLAY_ACTIVATION_LINK?this.userService.getActivationLinkInfo(i.id.id).subscribe(n=>{this.displayActivationLink(n).subscribe(()=>{this.dialogRef.close(i)})}):this.dialogRef.close(i)})}}displayActivationLink(t){return this.dialog.open(On,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{activationLinkInfo:t}}).afterClosed()}static{this.\u0275fac=function(i){return new(i||io)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(S.MAT_DIALOG_DATA),e.\u0275\u0275directiveInject(S.MatDialogRef),e.\u0275\u0275directiveInject(Ka.D),e.\u0275\u0275directiveInject(S.MatDialog))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:io,selectors:[["tb-add-user-dialog"]],viewQuery:function(i,n){if(1&i&&e.\u0275\u0275viewQuery(Wt,7),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.userComponent=o.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:29,vars:23,consts:[[2,"min-width","450px",3,"ngSubmit"],["color","primary"],["translate",""],[1,"flex-1"],[3,"tb-help"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content",""],[1,"mat-block"],[3,"ngModelChange","ngModelOptions","ngModel"],[3,"value",4,"ngFor","ngForOf"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[3,"value"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"form",0),e.\u0275\u0275listener("ngSubmit",function(){return n.add()}),e.\u0275\u0275elementStart(1,"mat-toolbar",1)(2,"h2",2),e.\u0275\u0275text(3,"user.add"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"span",3)(5,"div",4),e.\u0275\u0275elementStart(6,"button",5),e.\u0275\u0275listener("click",function(){return n.cancel()}),e.\u0275\u0275elementStart(7,"mat-icon",6),e.\u0275\u0275text(8,"close"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(9,kb,1,0,"mat-progress-bar",7),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275template(11,Lb,1,0,"div",8),e.\u0275\u0275pipe(12,"async"),e.\u0275\u0275elementStart(13,"div",9),e.\u0275\u0275element(14,"tb-user"),e.\u0275\u0275elementStart(15,"mat-form-field",10)(16,"mat-label",2),e.\u0275\u0275text(17,"user.activation-method"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"mat-select",11),e.\u0275\u0275twoWayListener("ngModelChange",function(r){return e.\u0275\u0275twoWayBindingSet(n.activationMethod,r)||(n.activationMethod=r),r}),e.\u0275\u0275template(19,Ob,3,4,"mat-option",12),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(20,"div",13)(21,"button",14),e.\u0275\u0275pipe(22,"async"),e.\u0275\u0275listener("click",function(){return n.cancel()}),e.\u0275\u0275text(23),e.\u0275\u0275pipe(24,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(25,"button",15),e.\u0275\u0275pipe(26,"async"),e.\u0275\u0275text(27),e.\u0275\u0275pipe(28,"translate"),e.\u0275\u0275elementEnd()()()),2&i&&(e.\u0275\u0275advance(5),e.\u0275\u0275property("tb-help","users"),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(10,10,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(12,12,n.isLoading$)),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngModelOptions",e.\u0275\u0275pureFunction0(22,Pb)),e.\u0275\u0275twoWayProperty("ngModel",n.activationMethod),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",n.activationMethods),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(22,14,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(24,16,"action.cancel")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(26,18,n.isLoading$)||n.detailsForm.invalid||!n.detailsForm.dirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(28,20,"action.add")," "))},dependencies:[p.NgForOf,p.NgIf,be.HelpComponent,x.MatButton,x.MatIconButton,E.MatIcon,K.MatProgressBar,v.MatFormField,v.MatLabel,ae.MatToolbar,S.MatDialogActions,S.MatDialogContent,ce.MatSelect,z.MatOption,s.\u0275NgNoValidate,s.NgControlStatus,s.NgControlStatusGroup,s.NgModel,s.NgForm,u.TranslateDirective,Wt,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]     .mat-padding{padding:0}']})}}function Rb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",5,0),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-attribute-table",6),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"attribute.attributes")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function Vb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",5,1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-attribute-table",7),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"attribute.latest-telemetry")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function Bb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",5,2),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-relation-table",8),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,3,"relation.relations")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)}}function Gb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",5,3),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-audit-log-table",9),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,4,"audit-log.audit-logs")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("auditLogMode",n.auditLogModes.USER)("userId",n.entity.id)}}class ao extends Ee.P{constructor(t){super(t),this.store=t}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(i){return new(i||ao)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:ao,selectors:[["tb-user-tabs"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:4,vars:4,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],["detailsMode","true",3,"active","auditLogMode","userId"]],template:function(i,n){1&i&&e.\u0275\u0275template(0,Rb,4,7,"mat-tab",4)(1,Vb,4,7,"mat-tab",4)(2,Bb,4,5,"mat-tab",4)(3,Gb,4,6,"mat-tab",4),2&i&&(e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity&&n.authUser.authority===n.authorities.TENANT_ADMIN))},dependencies:[p.NgIf,Q.MatTab,je.AuditLogTableComponent,_t.RelationTableComponent,nt.AttributeTableComponent,u.TranslatePipe],encapsulation:2})}}class qe{constructor(t,i,n,o,r,l,c,m,h){this.store=t,this.userService=i,this.authService=n,this.tenantService=o,this.customerService=r,this.translate=l,this.datePipe=c,this.router=m,this.dialog=h,this.config=new y.M7,this.config.entityType=f.ck.USER,this.config.entityComponent=Wt,this.config.entityTabsComponent=ao,this.config.entityTranslations=f.Mi.get(f.ck.USER),this.config.entityResources=f.BT.get(f.ck.USER),this.config.columns.push(new y.Qr("createdTime","common.created-time",this.datePipe,"150px"),new y.KK("firstName","user.first-name","33%"),new y.KK("lastName","user.last-name","33%"),new y.KK("email","user.email","33%")),this.config.deleteEnabled=T=>T&&T.id&&T.id.id!==this.authUser.id.id,this.config.deleteEntityTitle=T=>this.translate.instant("user.delete-user-title",{userEmail:T.email}),this.config.deleteEntityContent=()=>this.translate.instant("user.delete-user-text"),this.config.deleteEntitiesTitle=T=>this.translate.instant("user.delete-users-title",{count:T}),this.config.deleteEntitiesContent=()=>this.translate.instant("user.delete-users-text"),this.config.loadEntity=T=>this.userService.getUser(T.id),this.config.saveEntity=T=>this.saveUser(T),this.config.deleteEntity=T=>this.userService.deleteUser(T.id),this.config.onEntityAction=T=>this.onUserAction(T,this.config),this.config.addEntity=()=>this.addUser()}resolve(t){const i=t.params;return this.store.pipe((0,C.select)(q.jc),(0,Ve.s)(1)).pipe((0,ne.M)(n=>{this.authUser=n.userDetails,this.authority=i.tenantId?g.s.TENANT_ADMIN:g.s.CUSTOMER_USER,this.authority===g.s.TENANT_ADMIN?(this.tenantId=i.tenantId,this.customerId=R.k,this.config.entitiesFetchFunction=o=>this.userService.getTenantAdmins(this.tenantId,o)):(this.tenantId=this.authUser.tenantId.id,this.customerId=i.customerId,this.config.entitiesFetchFunction=o=>this.userService.getCustomerUsers(this.customerId,o)),this.updateActionCellDescriptors(n)}),(0,Z.Z)(()=>this.authority===g.s.TENANT_ADMIN?this.tenantService.getTenant(this.tenantId):(0,_.f1)(this.customerId)?this.customerService.getCustomer(this.customerId):(0,H.of)({title:""})),(0,ie.T)(n=>(this.authority===g.s.TENANT_ADMIN?this.config.tableTitle=n.title+": "+this.translate.instant("user.tenant-admins"):this.config.tableTitle=n.title+": "+this.translate.instant("user.customer-users"),this.config)))}updateActionCellDescriptors(t){this.config.cellActionDescriptors.splice(0),t.userTokenAccessEnabled&&this.config.cellActionDescriptors.push({name:this.authority===g.s.TENANT_ADMIN?this.translate.instant("user.login-as-tenant-admin"):this.translate.instant("user.login-as-customer-user"),icon:"mdi:login",isEnabled:()=>!0,onAction:(i,n)=>this.loginAsUser(i,n)})}saveUser(t){return t.tenantId=new Cs.a(this.tenantId),t.customerId=new Ar.G(this.customerId),t.authority=this.authority,this.userService.saveUser(t)}addUser(){return this.dialog.open(io,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{tenantId:this.tenantId,customerId:this.customerId,authority:this.authority}}).afterClosed()}openUser(t,i,n){t&&t.stopPropagation();const o=this.router.createUrlTree([i.id.id],{relativeTo:n.getActivatedRoute()});this.router.navigateByUrl(o)}loginAsUser(t,i){t&&t.stopPropagation(),this.authService.loginAsUser(i.id.id).subscribe()}displayActivationLink(t,i){t&&t.stopPropagation(),this.userService.getActivationLinkInfo(i.id.id).subscribe(n=>{this.dialog.open(On,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{activationLinkInfo:n}})})}resendActivation(t,i){t&&t.stopPropagation(),this.userService.sendActivationEmail(i.email).subscribe(()=>{this.store.dispatch(new $.xo({message:this.translate.instant("user.activation-email-sent-message"),type:"success"}))})}setUserCredentialsEnabled(t,i,n){t&&t.stopPropagation(),this.userService.setUserCredentialsEnabled(i.id.id,n).subscribe(()=>{i.additionalInfo||(i.additionalInfo={}),i.additionalInfo.userCredentialsEnabled=n,this.store.dispatch(new $.xo({message:this.translate.instant(n?"user.enable-account-message":"user.disable-account-message"),type:"success"}))})}onUserAction(t,i){switch(t.action){case"open":return this.openUser(t.event,t.entity,i),!0;case"loginAsUser":return this.loginAsUser(t.event,t.entity),!0;case"displayActivationLink":return this.displayActivationLink(t.event,t.entity),!0;case"resendActivation":return this.resendActivation(t.event,t.entity),!0;case"disableAccount":return this.setUserCredentialsEnabled(t.event,t.entity,!1),!0;case"enableAccount":return this.setUserCredentialsEnabled(t.event,t.entity,!0),!0}return!1}static{this.\u0275fac=function(i){return new(i||qe)(e.\u0275\u0275inject(C.Store),e.\u0275\u0275inject(Ka.D),e.\u0275\u0275inject(on.u),e.\u0275\u0275inject(vs.I),e.\u0275\u0275inject(Dt.m),e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(p.DatePipe),e.\u0275\u0275inject(b.Router),e.\u0275\u0275inject(S.MatDialog))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:qe,factory:qe.\u0275fac})}}const jb=[{path:"tenants",data:{breadcrumb:{menuId:F.D8.tenants}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.SYS_ADMIN],title:"tenant.tenants"},resolve:{entitiesTableConfig:qt}},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"supervisor_account"},auth:[g.s.SYS_ADMIN],title:"tenant.tenants"},resolve:{entitiesTableConfig:qt}},{path:":tenantId/users",data:{breadcrumb:{label:"user.tenant-admins",icon:"account_circle"}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.SYS_ADMIN],title:"user.tenant-admins"},resolve:{entitiesTableConfig:qe}},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"account_circle"},auth:[g.s.SYS_ADMIN],title:"user.tenant-admins"},resolve:{entitiesTableConfig:qe}}]}]}];class Rn{static{this.\u0275fac=function(i){return new(i||Rn)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Rn})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[qt],imports:[b.RouterModule.forChild(jb),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Rn,{imports:[b.RouterModule],exports:[b.RouterModule]});class Vn{static{this.\u0275fac=function(i){return new(i||Vn)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Vn})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,k.I,Rn]})}}function Ub(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"customer.title-required")," "))}function qb(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"customer.title-max-length")," "))}function Wb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"section",16)(1,"section",17),e.\u0275\u0275element(2,"tb-dashboard-autocomplete",18),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementStart(4,"mat-checkbox",19),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(3,5,"dashboard.home-dashboard")),e.\u0275\u0275property("dashboardsScope","customer")("customerId",null==i.entity?null:i.entity.id.id)("selectFirstDashboard",!1),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(6,7,"dashboard.home-dashboard-hide-toolbar")," ")}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Vn,{declarations:[to,no],imports:[p.CommonModule,w.G,k.I,Rn]});class oo extends er{constructor(t,i,n,o,r,l,c){super(t,r,n,o,l,c),this.store=t,this.translate=i,this.entityValue=n,this.entitiesTableConfigValue=o,this.fb=r,this.cd=l,this.countryData=c,this.isPublic=!1,this.authState=(0,q.rW)(this.store)}hideDelete(){return!!this.entitiesTableConfig&&!this.entitiesTableConfig.deleteEnabled(this.entity)}buildEntityForm(t){return this.fb.group({title:[t?t.title:"",[s.Validators.required,s.Validators.maxLength(255)]],additionalInfo:this.fb.group({description:[t&&t.additionalInfo?t.additionalInfo.description:""],homeDashboardId:[t&&t.additionalInfo?t.additionalInfo.homeDashboardId:null],homeDashboardHideToolbar:[!(t&&t.additionalInfo&&(0,_.f1)(t.additionalInfo.homeDashboardHideToolbar))||t.additionalInfo.homeDashboardHideToolbar]})})}updateEntityForm(t){this.isPublic=t.additionalInfo&&t.additionalInfo.isPublic,this.entityForm.patchValue({title:t.title}),this.entityForm.patchValue({additionalInfo:{description:t.additionalInfo?t.additionalInfo.description:""}}),this.entityForm.patchValue({additionalInfo:{homeDashboardId:t.additionalInfo?t.additionalInfo.homeDashboardId:null}}),this.entityForm.patchValue({additionalInfo:{homeDashboardHideToolbar:!t.additionalInfo||!(0,_.f1)(t.additionalInfo.homeDashboardHideToolbar)||t.additionalInfo.homeDashboardHideToolbar}})}onCustomerIdCopied(t){this.store.dispatch(new $.xo({message:this.translate.instant("customer.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}edgesSupportEnabled(){return this.authState.edgesSupportEnabled}static{this.\u0275fac=function(i){return new(i||oo)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject("entity"),e.\u0275\u0275directiveInject("entitiesTableConfig"),e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(bs.P))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:oo,selectors:[["tb-customer"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:51,vars:70,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["formGroupName","additionalInfo",1,"flex","flex-col"],["matInput","","formControlName","description","rows","2"],["class","tb-default-dashboard flex flex-1 flex-col",4,"ngIf"],[3,"parentForm","isEdit"],[1,"tb-default-dashboard","flex","flex-1","flex-col"],[1,"flex","flex-1","flex-col","gt-sm:flex-row"],["formControlName","homeDashboardId",1,"flex-1",3,"label","dashboardsScope","customerId","selectFirstDashboard"],["formControlName","homeDashboardHideToolbar",1,"flex-1"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"button",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"open")}),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",1),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"manageUsers")}),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"button",1),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"manageAssets")}),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"button",1),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"manageDevices")}),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"button",1),e.\u0275\u0275pipe(18,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"manageDashboards")}),e.\u0275\u0275text(19),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"button",1),e.\u0275\u0275pipe(22,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"manageEdges")}),e.\u0275\u0275text(23),e.\u0275\u0275pipe(24,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(25,"button",1),e.\u0275\u0275pipe(26,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"delete")}),e.\u0275\u0275text(27),e.\u0275\u0275pipe(28,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(29,"div",2)(30,"button",3),e.\u0275\u0275listener("cbOnSuccess",function(r){return n.onCustomerIdCopied(r)}),e.\u0275\u0275element(31,"mat-icon",4),e.\u0275\u0275elementStart(32,"span",5),e.\u0275\u0275text(33,"customer.copyId"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(34,"div",6)(35,"form",7)(36,"fieldset",8),e.\u0275\u0275pipe(37,"async"),e.\u0275\u0275elementStart(38,"mat-form-field",9)(39,"mat-label",5),e.\u0275\u0275text(40,"customer.title"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(41,"input",10),e.\u0275\u0275template(42,Ub,3,3,"mat-error",11)(43,qb,3,3,"mat-error",11),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(44,"div",12)(45,"mat-form-field",9)(46,"mat-label",5),e.\u0275\u0275text(47,"customer.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(48,"textarea",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(49,Wb,7,9,"section",14),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(50,"tb-contact",15),e.\u0275\u0275elementEnd()()()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",n.isEdit||n.isDetailsPage),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(2,40,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,42,"common.open-details-page")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||n.isPublic),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(6,44,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(8,46,"customer.manage-users")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(10,48,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(12,50,"customer.manage-assets")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(14,52,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,54,"customer.manage-devices")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(18,56,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(20,58,"customer.manage-dashboards")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(22,60,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(' *ngIf="edgesSupportEnabled()"> ',e.\u0275\u0275pipeBind1(24,62,"customer.manage-edges")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.hideDelete()||n.isEdit||n.isPublic),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(26,64,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(28,66,"customer.delete")," "),e.\u0275\u0275advance(3),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("cbContent",null==n.entity||null==n.entity.id?null:n.entity.id.id),e.\u0275\u0275advance(5),e.\u0275\u0275property("formGroup",n.entityForm),e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",n.isPublic),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(37,68,n.isLoading$)||!n.isEdit),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.entityForm.get("title").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("title").hasError("maxlength")),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",null==n.entity?null:n.entity.id),e.\u0275\u0275advance(),e.\u0275\u0275property("parentForm",n.entityForm)("isEdit",n.isEdit))},dependencies:[p.NgIf,oa.DashboardAutocompleteComponent,x.MatButton,Te.MatCheckbox,E.MatIcon,L.MatInput,v.MatFormField,v.MatLabel,v.MatError,we.Uo,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,s.FormGroupName,u.TranslateDirective,ys.ContactComponent,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-right:12px}}@media screen and (max-width: 959px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-bottom:12px}}@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:16px}}']})}}function $b(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,0),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-attribute-table",9),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"attribute.attributes")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function zb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-attribute-table",10),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"attribute.latest-telemetry")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function Hb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,2),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-alarm-table",11),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,3,"alarm.alarms")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)}}function Kb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,3),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-event-table",12),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"customer.events")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultEventType",n.eventTypes.ERROR)("active",i.isActive)("tenantId",n.entity.tenantId.id)("entityId",n.entity.id)}}function Yb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,4),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-relation-table",11),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,3,"relation.relations")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)}}function Qb(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,5),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-audit-log-table",13),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,4,"audit-log.audit-logs")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("auditLogMode",n.auditLogModes.CUSTOMER)("customerId",n.entity.id)}}function Jb(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-tab",8,6),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementStart(3,"tb-version-control",14),e.\u0275\u0275listener("versionRestored",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.entitiesTableConfig.updateData())}),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"version-control.version-control")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}class ro extends Ee.P{constructor(t){super(t),this.store=t}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(i){return new(i||ro)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:ro,selectors:[["tb-customer-tabs"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","customerId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(i,n){1&i&&e.\u0275\u0275template(0,$b,4,7,"mat-tab",7)(1,zb,4,7,"mat-tab",7)(2,Hb,4,5,"mat-tab",7)(3,Kb,4,7,"mat-tab",7)(4,Yb,4,5,"mat-tab",7)(5,Qb,4,6,"mat-tab",7)(6,Jb,4,7,"mat-tab",7),2&i&&(e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity&&n.authUser.authority===n.authorities.TENANT_ADMIN),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity&&n.authUser.authority===n.authorities.TENANT_ADMIN))},dependencies:[p.NgIf,Q.MatTab,je.AuditLogTableComponent,xt.EventTableComponent,_t.RelationTableComponent,tt.AlarmTableComponent,nt.AttributeTableComponent,ke.d,u.TranslatePipe],encapsulation:2})}}class $t{constructor(t,i,n,o,r,l){this.customerService=t,this.homeDialogs=i,this.translate=n,this.datePipe=o,this.router=r,this.store=l,this.config=new y.M7,this.config.entityType=f.ck.CUSTOMER,this.config.entityComponent=oo,this.config.entityTabsComponent=ro,this.config.entityTranslations=f.Mi.get(f.ck.CUSTOMER),this.config.entityResources=f.BT.get(f.ck.CUSTOMER);const c=(0,q.rW)(this.store);this.config.columns.push(new y.Qr("createdTime","common.created-time",this.datePipe,"150px"),new y.KK("title","customer.title","25%"),new y.KK("email","contact.email","25%"),new y.KK("country","contact.country","25%"),new y.KK("city","contact.city","25%")),this.config.cellActionDescriptors.push({name:this.translate.instant("customer.manage-customer-users"),icon:"account_circle",isEnabled:m=>!m.additionalInfo||!m.additionalInfo.isPublic,onAction:(m,h)=>this.manageCustomerUsers(m,h)},{name:this.translate.instant("customer.manage-customer-assets"),nameFunction:m=>m.additionalInfo&&m.additionalInfo.isPublic?this.translate.instant("customer.manage-public-assets"):this.translate.instant("customer.manage-customer-assets"),icon:"domain",isEnabled:m=>!0,onAction:(m,h)=>this.manageCustomerAssets(m,h)},{name:this.translate.instant("customer.manage-customer-devices"),nameFunction:m=>m.additionalInfo&&m.additionalInfo.isPublic?this.translate.instant("customer.manage-public-devices"):this.translate.instant("customer.manage-customer-devices"),icon:"devices_other",isEnabled:m=>!0,onAction:(m,h)=>this.manageCustomerDevices(m,h)},{name:this.translate.instant("customer.manage-customer-dashboards"),nameFunction:m=>m.additionalInfo&&m.additionalInfo.isPublic?this.translate.instant("customer.manage-public-dashboards"):this.translate.instant("customer.manage-customer-dashboards"),icon:"dashboard",isEnabled:m=>!0,onAction:(m,h)=>this.manageCustomerDashboards(m,h)}),c.edgesSupportEnabled&&this.config.cellActionDescriptors.push({name:this.translate.instant("customer.manage-customer-edges"),nameFunction:m=>m.additionalInfo&&m.additionalInfo.isPublic?this.translate.instant("customer.manage-public-edges"):this.translate.instant("customer.manage-customer-edges"),icon:"router",isEnabled:m=>!0,onAction:(m,h)=>this.manageCustomerEdges(m,h)}),this.config.deleteEntityTitle=m=>this.translate.instant("customer.delete-customer-title",{customerTitle:m.title}),this.config.deleteEntityContent=()=>this.translate.instant("customer.delete-customer-text"),this.config.deleteEntitiesTitle=m=>this.translate.instant("customer.delete-customers-title",{count:m}),this.config.deleteEntitiesContent=()=>this.translate.instant("customer.delete-customers-text"),this.config.entitiesFetchFunction=m=>this.customerService.getCustomers(m),this.config.loadEntity=m=>this.customerService.getCustomer(m.id),this.config.saveEntity=m=>this.customerService.saveCustomer(m),this.config.deleteEntity=m=>this.customerService.deleteCustomer(m.id),this.config.onEntityAction=m=>this.onCustomerAction(m,this.config),this.config.deleteEnabled=m=>m&&(!m.additionalInfo||!m.additionalInfo.isPublic),this.config.entitySelectionEnabled=m=>m&&(!m.additionalInfo||!m.additionalInfo.isPublic),this.config.detailsReadonly=m=>m&&m.additionalInfo&&m.additionalInfo.isPublic}resolve(){return this.config.tableTitle=this.translate.instant("customer.customers"),this.config}openCustomer(t,i,n){t&&t.stopPropagation();const o=this.router.createUrlTree([i.id.id],{relativeTo:n.getActivatedRoute()});this.router.navigateByUrl(o)}manageCustomerUsers(t,i){t&&t.stopPropagation(),this.router.navigateByUrl(`customers/${i.id.id}/users`)}manageCustomerAssets(t,i){t&&t.stopPropagation(),this.router.navigateByUrl(`customers/${i.id.id}/assets`)}manageCustomerDevices(t,i){t&&t.stopPropagation(),this.router.navigateByUrl(`customers/${i.id.id}/devices`)}manageCustomerDashboards(t,i){t&&t.stopPropagation(),this.router.navigateByUrl(`customers/${i.id.id}/dashboards`)}manageCustomerEdges(t,i){t&&t.stopPropagation(),this.router.navigateByUrl(`customers/${i.id.id}/edgeInstances`)}onCustomerAction(t,i){switch(t.action){case"open":return this.openCustomer(t.event,t.entity,i),!0;case"manageUsers":return this.manageCustomerUsers(t.event,t.entity),!0;case"manageAssets":return this.manageCustomerAssets(t.event,t.entity),!0;case"manageDevices":return this.manageCustomerDevices(t.event,t.entity),!0;case"manageDashboards":return this.manageCustomerDashboards(t.event,t.entity),!0;case"manageEdges":return this.manageCustomerEdges(t.event,t.entity),!0}return!1}static{this.\u0275fac=function(i){return new(i||$t)(e.\u0275\u0275inject(Dt.m),e.\u0275\u0275inject(mt.k),e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(p.DatePipe),e.\u0275\u0275inject(b.Router),e.\u0275\u0275inject(C.Store))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:$t,factory:$t.\u0275fac})}}var V=d(5095),it=d(93160),Zb=d(94588),xs=d(19325),Xb=d(36106),ye=d(14085);class Bn{get required(){return this.requiredValue}set required(t){this.requiredValue=(0,ye.coerceBooleanProperty)(t)}constructor(t,i){this.store=t,this.fb=i,this.propagateChange=n=>{}}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}ngOnInit(){this.defaultDeviceConfigurationFormGroup=this.fb.group({configuration:[null,s.Validators.required]}),this.defaultDeviceConfigurationFormGroup.valueChanges.subscribe(()=>{this.updateModel()})}setDisabledState(t){this.disabled=t,this.disabled?this.defaultDeviceConfigurationFormGroup.disable({emitEvent:!1}):this.defaultDeviceConfigurationFormGroup.enable({emitEvent:!1})}writeValue(t){this.defaultDeviceConfigurationFormGroup.patchValue({configuration:t},{emitEvent:!1})}updateModel(){let t=null;this.defaultDeviceConfigurationFormGroup.valid&&(t=this.defaultDeviceConfigurationFormGroup.getRawValue().configuration,t.type=V.IF.DEFAULT),this.propagateChange(t)}static{this.\u0275fac=function(i){return new(i||Bn)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Bn,selectors:[["tb-default-device-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>Bn),multi:!0}])],decls:1,vars:1,consts:[[2,"padding-bottom","16px",3,"formGroup"]],template:function(i,n){1&i&&e.\u0275\u0275element(0,"form",0),2&i&&e.\u0275\u0275property("formGroup",n.defaultDeviceConfigurationFormGroup)},dependencies:[s.\u0275NgNoValidate,s.NgControlStatusGroup,s.FormGroupDirective],encapsulation:2})}}function ey(a,t){if(1&a&&e.\u0275\u0275element(0,"tb-default-device-configuration",3),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("required",i.required)}}class Gn{get required(){return this.requiredValue}set required(t){this.requiredValue=(0,ye.coerceBooleanProperty)(t)}constructor(t,i){this.store=t,this.fb=i,this.deviceProfileType=V.IF,this.propagateChange=n=>{}}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}ngOnInit(){this.deviceConfigurationFormGroup=this.fb.group({configuration:[null,s.Validators.required]}),this.deviceConfigurationFormGroup.valueChanges.subscribe(()=>{this.updateModel()})}setDisabledState(t){this.disabled=t,this.disabled?this.deviceConfigurationFormGroup.disable({emitEvent:!1}):this.deviceConfigurationFormGroup.enable({emitEvent:!1})}writeValue(t){this.type=t?.type;const i=(0,_.Go)(t);i&&delete i.type,this.deviceConfigurationFormGroup.patchValue({configuration:i},{emitEvent:!1})}updateModel(){let t=null;this.deviceConfigurationFormGroup.valid&&(t=this.deviceConfigurationFormGroup.getRawValue().configuration,t.type=this.type),this.propagateChange(t)}static{this.\u0275fac=function(i){return new(i||Gn)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Gn,selectors:[["tb-device-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>Gn),multi:!0}])],decls:3,vars:3,consts:[[3,"formGroup"],[3,"ngSwitch"],[3,"ngSwitchCase"],["formControlName","configuration",3,"required"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1),e.\u0275\u0275template(2,ey,1,1,"ng-template",2),e.\u0275\u0275elementEnd()()),2&i&&(e.\u0275\u0275property("formGroup",n.deviceConfigurationFormGroup),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitch",n.type),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",n.deviceProfileType.DEFAULT))},dependencies:[p.NgSwitch,p.NgSwitchCase,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,Bn],encapsulation:2})}}class jn{get required(){return this.requiredValue}set required(t){this.requiredValue=(0,ye.coerceBooleanProperty)(t)}constructor(t,i){this.store=t,this.fb=i,this.propagateChange=n=>{}}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}ngOnInit(){this.defaultDeviceTransportConfigurationFormGroup=this.fb.group({configuration:[null,s.Validators.required]}),this.defaultDeviceTransportConfigurationFormGroup.valueChanges.subscribe(()=>{this.updateModel()})}setDisabledState(t){this.disabled=t,this.disabled?this.defaultDeviceTransportConfigurationFormGroup.disable({emitEvent:!1}):this.defaultDeviceTransportConfigurationFormGroup.enable({emitEvent:!1})}writeValue(t){this.defaultDeviceTransportConfigurationFormGroup.patchValue({configuration:t},{emitEvent:!1})}updateModel(){let t=null;this.defaultDeviceTransportConfigurationFormGroup.valid&&(t=this.defaultDeviceTransportConfigurationFormGroup.getRawValue().configuration,t.type=V.y0.DEFAULT),this.propagateChange(t)}static{this.\u0275fac=function(i){return new(i||jn)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:jn,selectors:[["tb-default-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>jn),multi:!0}])],decls:1,vars:1,consts:[[2,"padding-bottom","16px",3,"formGroup"]],template:function(i,n){1&i&&e.\u0275\u0275element(0,"form",0),2&i&&e.\u0275\u0275property("formGroup",n.defaultDeviceTransportConfigurationFormGroup)},dependencies:[s.\u0275NgNoValidate,s.NgControlStatusGroup,s.FormGroupDirective],encapsulation:2})}}class Un{get required(){return this.requiredValue}set required(t){this.requiredValue=(0,ye.coerceBooleanProperty)(t)}constructor(t,i){this.store=t,this.fb=i,this.propagateChange=n=>{}}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}ngOnInit(){this.mqttDeviceTransportConfigurationFormGroup=this.fb.group({configuration:[null,s.Validators.required]}),this.mqttDeviceTransportConfigurationFormGroup.valueChanges.subscribe(()=>{this.updateModel()})}setDisabledState(t){this.disabled=t,this.disabled?this.mqttDeviceTransportConfigurationFormGroup.disable({emitEvent:!1}):this.mqttDeviceTransportConfigurationFormGroup.enable({emitEvent:!1})}writeValue(t){this.mqttDeviceTransportConfigurationFormGroup.patchValue({configuration:t},{emitEvent:!1})}updateModel(){let t=null;this.mqttDeviceTransportConfigurationFormGroup.valid&&(t=this.mqttDeviceTransportConfigurationFormGroup.getRawValue().configuration,t.type=V.y0.MQTT),this.propagateChange(t)}static{this.\u0275fac=function(i){return new(i||Un)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Un,selectors:[["tb-mqtt-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>Un),multi:!0}])],decls:1,vars:1,consts:[[2,"padding-bottom","16px",3,"formGroup"]],template:function(i,n){1&i&&e.\u0275\u0275element(0,"form",0),2&i&&e.\u0275\u0275property("formGroup",n.mqttDeviceTransportConfigurationFormGroup)},dependencies:[s.\u0275NgNoValidate,s.NgControlStatusGroup,s.FormGroupDirective],encapsulation:2})}}var _s=d(84469);class qn{get required(){return this.requiredValue}set required(t){this.requiredValue=(0,ye.coerceBooleanProperty)(t)}constructor(t,i){this.store=t,this.fb=i,this.destroy$=new fe.B,this.propagateChange=n=>{}}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}ngOnInit(){this.coapDeviceTransportForm=this.fb.group({powerMode:[null],edrxCycle:[{disabled:!0,value:0},s.Validators.required],psmActivityTimer:[{disabled:!0,value:0},s.Validators.required],pagingTransmissionWindow:[{disabled:!0,value:0},s.Validators.required]}),this.coapDeviceTransportForm.valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(()=>{this.updateModel()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setDisabledState(t){this.disabled=t,this.disabled?this.coapDeviceTransportForm.disable({emitEvent:!1}):(this.coapDeviceTransportForm.enable({emitEvent:!1}),this.coapDeviceTransportForm.get("powerMode").updateValueAndValidity({onlySelf:!0}))}writeValue(t){(0,_.f1)(t)?this.coapDeviceTransportForm.patchValue(t,{emitEvent:!1}):this.coapDeviceTransportForm.get("powerMode").patchValue(null,{emitEvent:!1}),this.disabled||this.coapDeviceTransportForm.get("powerMode").updateValueAndValidity({onlySelf:!0})}updateModel(){let t=null;this.coapDeviceTransportForm.valid&&(t=this.coapDeviceTransportForm.value,t.type=V.y0.COAP),this.propagateChange(t)}static{this.\u0275fac=function(i){return new(i||qn)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:qn,selectors:[["tb-coap-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>qn),multi:!0}])],decls:2,vars:3,consts:[[2,"padding-bottom","16px",3,"formGroup"],[3,"parentForm","isDeviceSetting"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"form",0),e.\u0275\u0275element(1,"tb-power-mode-settings",1),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275property("formGroup",n.coapDeviceTransportForm),e.\u0275\u0275advance(),e.\u0275\u0275property("parentForm",n.coapDeviceTransportForm)("isDeviceSetting",!0))},dependencies:[s.\u0275NgNoValidate,s.NgControlStatusGroup,s.FormGroupDirective,_s.I],encapsulation:2})}}class Wn{get required(){return this.requiredValue}set required(t){this.requiredValue=(0,ye.coerceBooleanProperty)(t)}constructor(t,i){this.store=t,this.fb=i,this.destroy$=new fe.B,this.propagateChange=n=>{}}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}ngOnInit(){this.lwm2mDeviceTransportConfigurationFormGroup=this.fb.group({powerMode:[null],edrxCycle:[{disabled:!0,value:0},s.Validators.required],psmActivityTimer:[{disabled:!0,value:0},s.Validators.required],pagingTransmissionWindow:[{disabled:!0,value:0},s.Validators.required]}),this.lwm2mDeviceTransportConfigurationFormGroup.valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(()=>{this.updateModel()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setDisabledState(t){this.disabled=t,this.disabled?this.lwm2mDeviceTransportConfigurationFormGroup.disable({emitEvent:!1}):(this.lwm2mDeviceTransportConfigurationFormGroup.enable({emitEvent:!1}),this.lwm2mDeviceTransportConfigurationFormGroup.get("powerMode").updateValueAndValidity({onlySelf:!0}))}writeValue(t){(0,_.f1)(t)?this.lwm2mDeviceTransportConfigurationFormGroup.patchValue(t,{emitEvent:!1}):this.lwm2mDeviceTransportConfigurationFormGroup.get("powerMode").patchValue(null,{emitEvent:!1}),this.disabled||this.lwm2mDeviceTransportConfigurationFormGroup.get("powerMode").updateValueAndValidity({onlySelf:!0})}updateModel(){let t=null;this.lwm2mDeviceTransportConfigurationFormGroup.valid&&(t=this.lwm2mDeviceTransportConfigurationFormGroup.value,t.type=V.y0.LWM2M),this.propagateChange(t)}static{this.\u0275fac=function(i){return new(i||Wn)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Wn,selectors:[["tb-lwm2m-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>Wn),multi:!0}])],decls:2,vars:3,consts:[[2,"padding-bottom","16px",3,"formGroup"],[3,"parentForm","isDeviceSetting"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"form",0),e.\u0275\u0275element(1,"tb-power-mode-settings",1),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275property("formGroup",n.lwm2mDeviceTransportConfigurationFormGroup),e.\u0275\u0275advance(),e.\u0275\u0275property("parentForm",n.lwm2mDeviceTransportConfigurationFormGroup)("isDeviceSetting",!0))},dependencies:[s.\u0275NgNoValidate,s.NgControlStatusGroup,s.FormGroupDirective,_s.I],encapsulation:2})}}function ty(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"device-profile.snmp.host-required")," "))}function ny(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"device-profile.snmp.port-required")," "))}function iy(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"device-profile.snmp.port-format")," "))}function ay(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",10),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"lowercase"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit;e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,i)," ")}}function oy(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"device-profile.snmp.protocol-version-required")," "))}function ry(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"device-profile.snmp.community-required")," "))}function sy(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"section")(1,"mat-form-field",11)(2,"mat-label",3),e.\u0275\u0275text(3,"device-profile.snmp.community"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"input",12),e.\u0275\u0275template(5,ry,3,3,"mat-error",5),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.snmpDeviceTransportConfigurationFormGroup.get("community").hasError("required")||i.snmpDeviceTransportConfigurationFormGroup.get("community").hasError("pattern"))}}function ly(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"device-profile.snmp.user-name-required")," "))}function dy(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"device-profile.snmp.security-name-required")," "))}function cy(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",10),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",n.snmpAuthenticationProtocolTranslation.get(i)," ")}}function py(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"device-profile.snmp.authentication-protocol-required")," "))}function my(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"device-profile.snmp.authentication-passphrase-required")," "))}function uy(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",10),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",n.snmpPrivacyProtocolTranslation.get(i)," ")}}function gy(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"device-profile.snmp.privacy-protocol-required")," "))}function fy(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"device-profile.snmp.privacy-passphrase-required")," "))}function hy(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"section")(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),e.\u0275\u0275text(4,"device-profile.snmp.user-name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"input",13),e.\u0275\u0275template(6,ly,3,3,"mat-error",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"mat-form-field",2)(8,"mat-label",3),e.\u0275\u0275text(9,"device-profile.snmp.security-name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(10,"input",14),e.\u0275\u0275template(11,dy,3,3,"mat-error",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(12,"div",1)(13,"mat-form-field",15)(14,"mat-label",3),e.\u0275\u0275text(15,"device-profile.snmp.authentication-protocol"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"mat-select",16),e.\u0275\u0275template(17,cy,2,2,"mat-option",9),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(18,py,3,3,"mat-error",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"mat-form-field",2)(20,"mat-label",3),e.\u0275\u0275text(21,"device-profile.snmp.authentication-passphrase"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(22,"input",17),e.\u0275\u0275template(23,my,3,3,"mat-error",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(24,"div",1)(25,"mat-form-field",15)(26,"mat-label",3),e.\u0275\u0275text(27,"device-profile.snmp.privacy-protocol"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(28,"mat-select",18),e.\u0275\u0275template(29,uy,2,2,"mat-option",9),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(30,gy,3,3,"mat-error",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(31,"mat-form-field",2)(32,"mat-label",3),e.\u0275\u0275text(33,"device-profile.snmp.privacy-passphrase"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(34,"input",19),e.\u0275\u0275template(35,fy,3,3,"mat-error",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(36,"div",1)(37,"mat-form-field",2)(38,"mat-label",3),e.\u0275\u0275text(39,"device-profile.snmp.context-name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(40,"input",20),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(41,"mat-form-field",2)(42,"mat-label",3),e.\u0275\u0275text(43,"device-profile.snmp.engine-id"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(44,"input",21),e.\u0275\u0275elementEnd()()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",i.snmpDeviceTransportConfigurationFormGroup.get("username").hasError("required")||i.snmpDeviceTransportConfigurationFormGroup.get("username").hasError("pattern")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.snmpDeviceTransportConfigurationFormGroup.get("securityName").hasError("required")||i.snmpDeviceTransportConfigurationFormGroup.get("securityName").hasError("pattern")),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",i.snmpAuthenticationProtocols),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.snmpDeviceTransportConfigurationFormGroup.get("authenticationProtocol").hasError("required")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.snmpDeviceTransportConfigurationFormGroup.get("authenticationPassphrase").hasError("required")||i.snmpDeviceTransportConfigurationFormGroup.get("authenticationPassphrase").hasError("pattern")),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",i.snmpPrivacyProtocols),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.snmpDeviceTransportConfigurationFormGroup.get("privacyProtocol").hasError("required")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.snmpDeviceTransportConfigurationFormGroup.get("privacyPassphrase").hasError("required")||i.snmpDeviceTransportConfigurationFormGroup.get("privacyPassphrase").hasError("pattern"))}}class zt{get required(){return this.requiredValue}set required(t){this.requiredValue=(0,ye.coerceBooleanProperty)(t)}constructor(t,i){this.store=t,this.fb=i,this.snmpDeviceProtocolVersions=Object.values(V.LV),this.snmpAuthenticationProtocols=Object.values(V.fJ),this.snmpAuthenticationProtocolTranslation=V.Yc,this.snmpPrivacyProtocols=Object.values(V.b_),this.snmpPrivacyProtocolTranslation=V.sj,this.propagateChange=n=>{}}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}ngOnInit(){this.snmpDeviceTransportConfigurationFormGroup=this.fb.group({host:["",[s.Validators.required,s.Validators.pattern("(.|\\s)*\\S(.|\\s)*")]],port:[null,[s.Validators.required,s.Validators.min(0),s.Validators.pattern("[0-9]*")]],protocolVersion:[V.LV.V2C,s.Validators.required],community:["public",[s.Validators.required,s.Validators.pattern("(.|\\s)*\\S(.|\\s)*")]],username:["",[s.Validators.required,s.Validators.pattern("(.|\\s)*\\S(.|\\s)*")]],securityName:["public",[s.Validators.required,s.Validators.pattern("(.|\\s)*\\S(.|\\s)*")]],contextName:[null],authenticationProtocol:[V.fJ.SHA_512,s.Validators.required],authenticationPassphrase:["",[s.Validators.required,s.Validators.pattern("(.|\\s)*\\S(.|\\s)*")]],privacyProtocol:[V.b_.DES,s.Validators.required],privacyPassphrase:["",[s.Validators.required,s.Validators.pattern("(.|\\s)*\\S(.|\\s)*")]],engineId:[""]}),this.snmpDeviceTransportConfigurationFormGroup.get("protocolVersion").valueChanges.subscribe(t=>{this.updateDisabledFormValue(t)}),this.snmpDeviceTransportConfigurationFormGroup.valueChanges.subscribe(()=>{this.updateModel()})}validate(){return this.snmpDeviceTransportConfigurationFormGroup.valid?null:{snmpDeviceTransportConfiguration:!1}}setDisabledState(t){this.disabled=t,this.disabled?this.snmpDeviceTransportConfigurationFormGroup.disable({emitEvent:!1}):(this.snmpDeviceTransportConfigurationFormGroup.enable({emitEvent:!1}),this.updateDisabledFormValue(this.snmpDeviceTransportConfigurationFormGroup.get("protocolVersion").value||V.LV.V2C))}writeValue(t){(0,_.f1)(t)&&(this.snmpDeviceTransportConfigurationFormGroup.patchValue(t,{emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.enabled&&this.updateDisabledFormValue(t.protocolVersion||V.LV.V2C))}isV3protocolVersion(){return this.snmpDeviceTransportConfigurationFormGroup.get("protocolVersion").value===V.LV.V3}updateDisabledFormValue(t){t===V.LV.V3?(this.snmpDeviceTransportConfigurationFormGroup.get("community").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("username").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("securityName").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("contextName").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("authenticationProtocol").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("authenticationPassphrase").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("privacyProtocol").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("privacyPassphrase").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("engineId").enable({emitEvent:!1})):(this.snmpDeviceTransportConfigurationFormGroup.get("community").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("username").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("securityName").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("contextName").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("authenticationProtocol").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("authenticationPassphrase").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("privacyProtocol").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("privacyPassphrase").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("engineId").disable({emitEvent:!1}))}updateModel(){let t=null;this.snmpDeviceTransportConfigurationFormGroup.valid&&(t=this.snmpDeviceTransportConfigurationFormGroup.value,t.type=V.y0.SNMP),this.propagateChange(t)}static{this.\u0275fac=function(i){return new(i||zt)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:zt,selectors:[["tb-snmp-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>zt),multi:!0},{provide:s.NG_VALIDATORS,useExisting:(0,e.forwardRef)(()=>zt),multi:!0}])],decls:21,vars:8,consts:[[1,"flex","flex-col","gap-2","pb-4",3,"formGroup"],[1,"flex","flex-row","gap-2","xs:flex-col"],[1,"flex-1"],["translate",""],["matInput","","formControlName","host","required",""],[4,"ngIf"],["matInput","","formControlName","port","type","number","min","0","required",""],["floatLabel","always","hideRequiredMarker","",1,"mat-block"],["formControlName","protocolVersion","required",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"mat-block"],["matInput","","formControlName","community","required",""],["matInput","","formControlName","username","required",""],["matInput","","formControlName","securityName","required",""],["floatLabel","always","hideRequiredMarker","",1,"flex-1"],["formControlName","authenticationProtocol","required",""],["matInput","","formControlName","authenticationPassphrase","required",""],["formControlName","privacyProtocol","required",""],["matInput","","formControlName","privacyPassphrase","required",""],["matInput","","formControlName","contextName"],["matInput","","formControlName","engineId"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"form",0)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),e.\u0275\u0275text(4,"device-profile.snmp.host"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"input",4),e.\u0275\u0275template(6,ty,3,3,"mat-error",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"mat-form-field",2)(8,"mat-label",3),e.\u0275\u0275text(9,"device-profile.snmp.port"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(10,"input",6),e.\u0275\u0275template(11,ny,3,3,"mat-error",5)(12,iy,3,3,"mat-error",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(13,"mat-form-field",7)(14,"mat-label",3),e.\u0275\u0275text(15,"device-profile.snmp.protocol-version"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"mat-select",8),e.\u0275\u0275template(17,ay,3,4,"mat-option",9),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(18,oy,3,3,"mat-error",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(19,sy,6,1,"section",5)(20,hy,45,8,"section",5),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275property("formGroup",n.snmpDeviceTransportConfigurationFormGroup),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.snmpDeviceTransportConfigurationFormGroup.get("host").hasError("required")||n.snmpDeviceTransportConfigurationFormGroup.get("host").hasError("pattern")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",n.snmpDeviceTransportConfigurationFormGroup.get("port").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.snmpDeviceTransportConfigurationFormGroup.get("port").hasError("pattern")||n.snmpDeviceTransportConfigurationFormGroup.get("port").hasError("min")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",n.snmpDeviceProtocolVersions),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.snmpDeviceTransportConfigurationFormGroup.get("protocolVersion").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n.isV3protocolVersion()),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.isV3protocolVersion()))},dependencies:[p.NgForOf,p.NgIf,L.MatInput,v.MatFormField,v.MatLabel,v.MatError,ce.MatSelect,z.MatOption,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NumberValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.MinValidator,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,p.LowerCasePipe,u.TranslatePipe],encapsulation:2})}}function by(a,t){if(1&a&&e.\u0275\u0275element(0,"tb-default-device-transport-configuration",3),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("required",i.required)}}function yy(a,t){if(1&a&&e.\u0275\u0275element(0,"tb-mqtt-device-transport-configuration",3),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("required",i.required)}}function vy(a,t){if(1&a&&e.\u0275\u0275element(0,"tb-lwm2m-device-transport-configuration",3),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("required",i.required)}}function Cy(a,t){if(1&a&&e.\u0275\u0275element(0,"tb-coap-device-transport-configuration",3),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("required",i.required)}}function xy(a,t){if(1&a&&e.\u0275\u0275element(0,"tb-snmp-device-transport-configuration",3),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("required",i.required)}}class Ht{get required(){return this.requiredValue}set required(t){this.requiredValue=(0,ye.coerceBooleanProperty)(t)}constructor(t,i){this.store=t,this.fb=i,this.deviceTransportType=V.y0,this.propagateChange=n=>{}}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}ngOnInit(){this.deviceTransportConfigurationFormGroup=this.fb.group({configuration:[null,s.Validators.required]}),this.deviceTransportConfigurationFormGroup.valueChanges.subscribe(()=>{this.updateModel()})}setDisabledState(t){this.disabled=t,this.disabled?this.deviceTransportConfigurationFormGroup.disable({emitEvent:!1}):this.deviceTransportConfigurationFormGroup.enable({emitEvent:!1})}writeValue(t){this.transportType=t?.type;const i=(0,_.Go)(t);i&&delete i.type,this.deviceTransportConfigurationFormGroup.patchValue({configuration:i},{emitEvent:!1})}validate(){return this.deviceTransportConfigurationFormGroup.valid?null:{deviceTransportConfiguration:!1}}updateModel(){let t=null;this.deviceTransportConfigurationFormGroup.valid&&(t=this.deviceTransportConfigurationFormGroup.getRawValue().configuration,t.type=this.transportType),this.propagateChange(t)}static{this.\u0275fac=function(i){return new(i||Ht)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Ht,selectors:[["tb-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>Ht),multi:!0},{provide:s.NG_VALIDATORS,useExisting:(0,e.forwardRef)(()=>Ht),multi:!0}])],decls:7,vars:7,consts:[[3,"formGroup"],[3,"ngSwitch"],[3,"ngSwitchCase"],["formControlName","configuration",3,"required"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1),e.\u0275\u0275template(2,by,1,1,"ng-template",2)(3,yy,1,1,"ng-template",2)(4,vy,1,1,"ng-template",2)(5,Cy,1,1,"ng-template",2)(6,xy,1,1,"ng-template",2),e.\u0275\u0275elementEnd()()),2&i&&(e.\u0275\u0275property("formGroup",n.deviceTransportConfigurationFormGroup),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitch",n.transportType),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",n.deviceTransportType.DEFAULT),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",n.deviceTransportType.MQTT),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",n.deviceTransportType.LWM2M),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",n.deviceTransportType.COAP),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",n.deviceTransportType.SNMP))},dependencies:[p.NgSwitch,p.NgSwitchCase,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,jn,Un,qn,Wn,zt],encapsulation:2})}}function _y(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-expansion-panel",3)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"div",4),e.\u0275\u0275text(4,"device.device-configuration"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(5,"tb-device-configuration",5),e.\u0275\u0275elementEnd()),2&a&&e.\u0275\u0275property("expanded",!0)}function Sy(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-expansion-panel",3)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"div",4),e.\u0275\u0275text(4,"device.transport-configuration"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(5,"tb-device-transport-configuration",6),e.\u0275\u0275elementEnd()),2&a&&e.\u0275\u0275property("expanded",!0)}class Kt{get required(){return this.requiredValue}set required(t){this.requiredValue=(0,ye.coerceBooleanProperty)(t)}constructor(t,i){this.store=t,this.fb=i,this.propagateChange=n=>{}}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}ngOnInit(){this.deviceDataFormGroup=this.fb.group({configuration:[null,s.Validators.required],transportConfiguration:[null,s.Validators.required]}),this.deviceDataFormGroup.valueChanges.subscribe(()=>{this.updateModel()})}setDisabledState(t){this.disabled=t,this.disabled?this.deviceDataFormGroup.disable({emitEvent:!1}):this.deviceDataFormGroup.enable({emitEvent:!1})}writeValue(t){const i=t?.configuration?.type;this.displayDeviceConfiguration=i&&V.SI.get(i).hasDeviceConfiguration;const n=t?.transportConfiguration?.type;this.displayTransportConfiguration=n&&V.qA.get(n).hasDeviceConfiguration,this.deviceDataFormGroup.patchValue({configuration:t?.configuration},{emitEvent:!1}),this.deviceDataFormGroup.patchValue({transportConfiguration:t?.transportConfiguration},{emitEvent:!1})}validate(){return this.deviceDataFormGroup.valid?null:{deviceDataForm:!1}}updateModel(){let t=null;this.deviceDataFormGroup.valid&&(t=this.deviceDataFormGroup.getRawValue()),this.propagateChange(t)}static{this.\u0275fac=function(i){return new(i||Kt)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Kt,selectors:[["tb-device-data"]],inputs:{required:"required",disabled:"disabled"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>Kt),multi:!0},{provide:s.NG_VALIDATORS,useExisting:(0,e.forwardRef)(()=>Kt),multi:!0}])],decls:4,vars:3,consts:[[2,"padding-bottom","16px",3,"formGroup"],["multi","true"],[3,"expanded",4,"ngIf"],[3,"expanded"],["translate",""],["formControlName","configuration","required",""],["formControlName","transportConfiguration","required",""]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"mat-accordion",1),e.\u0275\u0275template(2,_y,6,1,"mat-expansion-panel",2)(3,Sy,6,1,"mat-expansion-panel",2),e.\u0275\u0275elementEnd()()),2&i&&(e.\u0275\u0275property("formGroup",n.deviceDataFormGroup),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.displayDeviceConfiguration),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.displayTransportConfiguration))},dependencies:[p.NgIf,U.MatAccordion,U.MatExpansionPanel,U.MatExpansionPanelHeader,U.MatExpansionPanelTitle,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,Gn,Ht],encapsulation:2})}}function Ty(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"device.name-required")," "))}function Iy(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"device.name-max-length")," "))}function wy(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"device.label-max-length")," "))}function Ey(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-slide-toggle",26),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"device.overwrite-activity-time")," "))}class so extends xe.l{constructor(t,i,n,o,r,l){super(t,r,n,o,l),this.store=t,this.translate=i,this.entityValue=n,this.entitiesTableConfigValue=o,this.fb=r,this.cd=l,this.entityType=f.ck,this.otaUpdateType=it.Mj}ngOnInit(){this.deviceScope=this.entitiesTableConfig.componentsData.deviceScope,this.deviceCredentials$=this.entitiesTableConfigValue.componentsData.deviceCredentials$,super.ngOnInit()}hideDelete(){return!!this.entitiesTableConfig&&!this.entitiesTableConfig.deleteEnabled(this.entity)}isAssignedToCustomer(t){return t&&t.customerId&&t.customerId.id!==R.k}buildForm(t){const i=this.fb.group({name:[t?t.name:"",[s.Validators.required,s.Validators.maxLength(255)]],deviceProfileId:[t?t.deviceProfileId:null,[s.Validators.required]],firmwareId:[t?t.firmwareId:null],softwareId:[t?t.softwareId:null],label:[t?t.label:"",[s.Validators.maxLength(255)]],deviceData:[t?t.deviceData:null,[s.Validators.required]],additionalInfo:this.fb.group({gateway:[!(!t||!t.additionalInfo)&&t.additionalInfo.gateway],overwriteActivityTime:[!(!t||!t.additionalInfo)&&t.additionalInfo.overwriteActivityTime],description:[t&&t.additionalInfo?t.additionalInfo.description:""]})});return i.get("deviceProfileId").valueChanges.pipe((0,yr.F)((n,o)=>n?.id===o?.id)).subscribe(n=>{n&&this.isEdit&&this.entityForm.patchValue({firmwareId:null,softwareId:null},{emitEvent:!1})}),i}updateForm(t){this.entityForm.patchValue({name:t.name,deviceProfileId:t.deviceProfileId,firmwareId:t.firmwareId,softwareId:t.softwareId,label:t.label,deviceData:t.deviceData,additionalInfo:{gateway:!!t.additionalInfo&&t.additionalInfo.gateway,overwriteActivityTime:!!t.additionalInfo&&t.additionalInfo.overwriteActivityTime,description:t.additionalInfo?t.additionalInfo.description:""}})}onDeviceIdCopied(t){this.store.dispatch(new $.xo({message:this.translate.instant("device.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onDeviceProfileUpdated(){this.entitiesTableConfig.updateData(!1)}onDeviceProfileChanged(t){if(t&&this.isEdit){const i=t.type,n=t.transportType;let o=this.entityForm.getRawValue().deviceData;if(o){let r=!1;o.configuration.type!==i&&(o.configuration=(0,V.NJ)(i),r=!0),o.transportConfiguration.type!==n&&(o.transportConfiguration=(0,V.mN)(n),r=!0),r&&(this.entityForm.patchValue({deviceData:o}),this.entityForm.markAsDirty())}else o={configuration:(0,V.NJ)(i),transportConfiguration:(0,V.mN)(n)},this.entityForm.patchValue({deviceData:o}),this.entityForm.markAsDirty()}}static{this.\u0275fac=function(i){return new(i||so)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject("entity"),e.\u0275\u0275directiveInject("entitiesTableConfig"),e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(e.ChangeDetectorRef))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:so,selectors:[["tb-device"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:77,vars:106,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",1,"xs:flex-1",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent","disabled"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[3,"disabled","credentials$","deviceId"],[1,"mat-padding","flex","flex-col"],[1,"mat-block"],["matInput","","disabled","",3,"ngModel"],[1,"tb-small",2,"padding-bottom","10px","padding-left","2px"],[3,"formGroup"],[3,"disabled"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["required","","formControlName","deviceProfileId",3,"deviceProfileUpdated","deviceProfileChanged","selectDefaultProfile","showDetailsPageLink"],["matInput","","formControlName","label"],["formControlName","firmwareId",3,"useFullEntityId","showDetailsPageLink","type","deviceProfileId"],["formControlName","softwareId",3,"useFullEntityId","showDetailsPageLink","type","deviceProfileId"],["formControlName","deviceData","required",""],["formGroupName","additionalInfo",1,"flex","flex-col"],[1,"toggle-group"],["formControlName","gateway",2,"min-width","165px"],["formControlName","overwriteActivityTime",4,"ngIf"],["matInput","","formControlName","description","rows","2"],["formControlName","overwriteActivityTime"]],template:function(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"button",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"open")}),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",1),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"makePublic")}),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"button",1),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"assignToCustomer")}),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"button",1),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"unassignFromCustomer")}),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"button",1),e.\u0275\u0275pipe(18,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"manageCredentials")}),e.\u0275\u0275text(19),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"button",1),e.\u0275\u0275pipe(22,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"checkConnectivity")}),e.\u0275\u0275text(23),e.\u0275\u0275pipe(24,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(25,"button",1),e.\u0275\u0275pipe(26,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"unassignFromEdge")}),e.\u0275\u0275text(27),e.\u0275\u0275pipe(28,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(29,"button",2),e.\u0275\u0275pipe(30,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"delete")}),e.\u0275\u0275text(31),e.\u0275\u0275pipe(32,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(33,"div",3)(34,"button",4),e.\u0275\u0275pipe(35,"async"),e.\u0275\u0275listener("cbOnSuccess",function(r){return n.onDeviceIdCopied(r)}),e.\u0275\u0275element(36,"mat-icon",5),e.\u0275\u0275elementStart(37,"span",6),e.\u0275\u0275text(38,"device.copyId"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(39,"tb-copy-device-credentials",7),e.\u0275\u0275pipe(40,"async"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(41,"div",8)(42,"mat-form-field",9)(43,"mat-label",6),e.\u0275\u0275text(44,"device.assignedToCustomer"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(45,"input",10),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(46,"div",11),e.\u0275\u0275text(47),e.\u0275\u0275pipe(48,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(49,"form",12)(50,"fieldset",13),e.\u0275\u0275pipe(51,"async"),e.\u0275\u0275elementStart(52,"mat-form-field",9)(53,"mat-label",6),e.\u0275\u0275text(54,"device.name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(55,"input",14),e.\u0275\u0275template(56,Ty,3,3,"mat-error",15)(57,Iy,3,3,"mat-error",15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(58,"tb-device-profile-autocomplete",16),e.\u0275\u0275listener("deviceProfileUpdated",function(){return n.onDeviceProfileUpdated()})("deviceProfileChanged",function(r){return n.onDeviceProfileChanged(r)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(59,"mat-form-field",9)(60,"mat-label",6),e.\u0275\u0275text(61,"device.label"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(62,"input",17),e.\u0275\u0275template(63,wy,3,3,"mat-error",15),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(64,"tb-ota-package-autocomplete",18)(65,"tb-ota-package-autocomplete",19)(66,"tb-device-data",20),e.\u0275\u0275elementStart(67,"div",21)(68,"div",22)(69,"mat-slide-toggle",23),e.\u0275\u0275text(70),e.\u0275\u0275pipe(71,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(72,Ey,3,3,"mat-slide-toggle",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(73,"mat-form-field",9)(74,"mat-label",6),e.\u0275\u0275text(75,"device.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(76,"textarea",25),e.\u0275\u0275elementEnd()()()()()),2&i){let o,r;e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",n.isEdit||n.isDetailsPage),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(2,64,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,66,"common.open-details-page")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||"tenant"!==n.deviceScope||n.isAssignedToCustomer(n.entity)||(null==n.entity?null:n.entity.customerIsPublic)),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(6,68,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(8,70,"device.make-public")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||"tenant"!==n.deviceScope||n.isAssignedToCustomer(n.entity)),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(10,72,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(12,74,"device.assign-to-customer")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||"customer"!==n.deviceScope&&"tenant"!==n.deviceScope||!n.isAssignedToCustomer(n.entity)),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(14,76,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,78,null!=n.entity&&n.entity.customerIsPublic?"device.make-private":"device.unassign-from-customer")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(18,80,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(20,82,"customer_user"===n.deviceScope||"edge_customer_user"===n.deviceScope?"device.view-credentials":"device.manage-credentials")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(22,84,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(24,86,"device.connectivity.check-connectivity")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||"edge"!==n.deviceScope),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(26,88,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(28,90,"edge.unassign-from-edge")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.hideDelete()||n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(30,92,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(32,94,"device.delete")," "),e.\u0275\u0275advance(3),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("cbContent",null==n.entity||null==n.entity.id?null:n.entity.id.id)("disabled",e.\u0275\u0275pipeBind1(35,96,n.isLoading$)),e.\u0275\u0275advance(5),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(40,98,n.isLoading$))("credentials$",n.deviceCredentials$)("deviceId",null==n.entity?null:n.entity.id),e.\u0275\u0275advance(3),e.\u0275\u0275classProp("!hidden",n.isEdit||!n.isAssignedToCustomer(n.entity)||(null==n.entity?null:n.entity.customerIsPublic)||"tenant"!==n.deviceScope),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngModel",null==n.entity?null:n.entity.customerTitle),e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",n.isEdit||!(null!=n.entity&&n.entity.customerIsPublic)||"customer"!==n.deviceScope&&"tenant"!==n.deviceScope),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(48,100,"device.device-public")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.entityForm),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(51,102,n.isLoading$)||!n.isEdit),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.entityForm.get("name").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("name").hasError("maxlength")),e.\u0275\u0275advance(),e.\u0275\u0275property("selectDefaultProfile",n.isAdd)("showDetailsPageLink",!0),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",n.entityForm.get("label").hasError("maxlength")),e.\u0275\u0275advance(),e.\u0275\u0275property("useFullEntityId",!0)("showDetailsPageLink",!0)("type",n.otaUpdateType.FIRMWARE)("deviceProfileId",null==(o=n.entityForm.get("deviceProfileId").value)?null:o.id),e.\u0275\u0275advance(),e.\u0275\u0275property("useFullEntityId",!0)("showDetailsPageLink",!0)("type",n.otaUpdateType.SOFTWARE)("deviceProfileId",null==(r=n.entityForm.get("deviceProfileId").value)?null:r.id),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(71,104,"device.is-gateway")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.entityForm.get("additionalInfo.gateway").value)}},dependencies:[p.NgIf,x.MatButton,E.MatIcon,L.MatInput,v.MatFormField,v.MatLabel,v.MatError,pe.MatSlideToggle,we.Uo,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.NgModel,s.FormGroupDirective,s.FormControlName,s.FormGroupName,u.TranslateDirective,Zb.OtaPackageAutocompleteComponent,xs.DeviceProfileAutocompleteComponent,Xb.v,Kt,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]   .toggle-group[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:16px;margin-bottom:16px}']})}}var Fr=d(49466),My=d(66951);class lo extends Ne.M{constructor(t){super(t),this.store=t,this.entityType=f.ck}deviceInfoFilterChanged(t){this.entitiesTableConfig.componentsData.deviceInfoFilter=t,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}static{this.\u0275fac=function(i){return new(i||lo)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:lo,selectors:[["tb-device-table-header"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[[3,"ngModelChange","ngModel"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"tb-device-info-filter",0),e.\u0275\u0275listener("ngModelChange",function(r){return n.deviceInfoFilterChanged(r)}),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngModel",n.entitiesTableConfig.componentsData.deviceInfoFilter)},dependencies:[s.NgControlStatus,s.NgModel,My.S],encapsulation:2})}}var Ss=d(14246),Ny=d(86508);function Ay(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",11)}function Fy(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"section")(1,"form",12),e.\u0275\u0275element(2,"tb-device-credentials",13),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("formGroup",i.deviceCredentialsFormGroup),e.\u0275\u0275advance(),e.\u0275\u0275property("deviceTransportType",i.deviceTransportType)}}function Dy(a,t){1&a&&(e.\u0275\u0275elementStart(0,"div",14),e.\u0275\u0275element(1,"mat-spinner",15),e.\u0275\u0275elementStart(2,"span",16),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()),2&a&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,1,"device.loading-device-credentials")," "))}function Py(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",17),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.save())}),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(1,2,i.isLoading$)||i.deviceCredentialsFormGroup.invalid||!i.deviceCredentialsFormGroup.dirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,4,"action.save")," ")}}class $n extends se.m{constructor(t,i,n,o,r,l,c,m){super(t,i,c),this.store=t,this.router=i,this.data=n,this.deviceService=o,this.deviceProfileService=r,this.errorStateMatcher=l,this.dialogRef=c,this.fb=m,this.loadingCredentials=!0,this.submitted=!1,this.isReadOnly=n.isReadOnly}ngOnInit(){this.deviceCredentialsFormGroup=this.fb.group({credential:[null]}),this.isReadOnly&&this.deviceCredentialsFormGroup.disable({emitEvent:!1}),this.loadDeviceCredentials()}isErrorState(t,i){const n=this.errorStateMatcher.isErrorState(t,i),o=!!(t&&t.invalid&&this.submitted);return n||o}loadDeviceCredentials(){const t=[this.deviceService.getDeviceCredentials(this.data.deviceId),this.deviceProfileService.getDeviceProfileInfo(this.data.deviceProfileId)];(0,Se.p)(t).subscribe(([i,n])=>{this.deviceTransportType=n.transportType,this.deviceCredentials=i,this.deviceCredentialsFormGroup.patchValue({credential:i},{emitEvent:!1}),this.loadingCredentials=!1})}cancel(){this.dialogRef.close(null)}save(){this.submitted=!0;const t=this.deviceCredentialsFormGroup.value.credential;this.deviceCredentials={...this.deviceCredentials,...t},this.deviceService.saveDeviceCredentials(this.deviceCredentials).pipe((0,cn.W)(i=>i.status===ha.HttpStatusCode.Conflict?this.deviceService.getDeviceCredentials(this.deviceCredentials.deviceId.id):(0,hr.$)(()=>i))).subscribe(i=>{this.dialogRef.close(i)})}static{this.\u0275fac=function(i){return new(i||$n)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(S.MAT_DIALOG_DATA),e.\u0275\u0275directiveInject(Fr.g),e.\u0275\u0275directiveInject(Ss.N),e.\u0275\u0275directiveInject(z.ErrorStateMatcher,4),e.\u0275\u0275directiveInject(S.MatDialogRef),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:$n,selectors:[["tb-device-credentials-dialog"]],features:[e.\u0275\u0275ProvidersFeature([{provide:z.ErrorStateMatcher,useExisting:$n}]),e.\u0275\u0275InheritDefinitionFeature],decls:20,vars:15,consts:[["loadCredentials",""],["color","primary"],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["mat-dialog-content",""],[4,"ngIf","ngIfElse"],["mat-dialog-actions","",1,"tb-dialog-actions"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","button",3,"disabled","click",4,"ngIf"],["color","warn","mode","indeterminate"],[3,"formGroup"],["formControlName","credential",3,"deviceTransportType"],[1,"flex","flex-col","items-center","justify-center"],["color","accent","diameter","65","strokeWidth","4",2,"margin-bottom","18px"],[1,"mat-subtitle-1",2,"margin-bottom","0"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-toolbar",1)(1,"h2"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"span",2),e.\u0275\u0275elementStart(5,"button",3),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.cancel())}),e.\u0275\u0275elementStart(6,"mat-icon",4),e.\u0275\u0275text(7,"close"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(8,Ay,1,0,"mat-progress-bar",5),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275elementStart(10,"div",6),e.\u0275\u0275template(11,Fy,3,2,"section",7)(12,Dy,5,3,"ng-template",null,0,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"div",8)(15,"button",9),e.\u0275\u0275pipe(16,"async"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.cancel())}),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(19,Py,4,6,"button",10),e.\u0275\u0275elementEnd()}if(2&i){const o=e.\u0275\u0275reference(13);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,7,"device.device-credentials")),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(9,9,n.isLoading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!n.loadingCredentials)("ngIfElse",o),e.\u0275\u0275advance(4),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(16,11,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(18,13,n.isReadOnly?"action.close":"action.cancel")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.isReadOnly)}},dependencies:[p.NgIf,x.MatButton,x.MatIconButton,E.MatIcon,K.MatProgressBar,ae.MatToolbar,S.MatDialogActions,S.MatDialogContent,$o.MatProgressSpinner,s.\u0275NgNoValidate,s.NgControlStatus,s.NgControlStatusGroup,s.FormGroupDirective,s.FormControlName,Ny.g,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]{height:100%;display:grid;grid-template-rows:min-content 4px auto min-content}@media screen and (min-width: 600px){[_nghost-%COMP%]{min-width:420px}}.mat-mdc-dialog-container[_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%]{grid-row:4;display:flex;gap:8px;justify-content:flex-end;flex:1}.mat-mdc-dialog-container[_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{grid-row:3;padding:24px 24px 4px}']})}}var tr=d(27738),nr=d(73414);function ky(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,0),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-attribute-table",9),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"attribute.attributes")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultAttributeScope",n.attributeScopes.CLIENT_SCOPE)("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function Ly(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-attribute-table",10),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"attribute.latest-telemetry")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function Oy(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,2),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-alarm-table",11),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,3,"alarm.alarms")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)}}function Ry(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,3),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-event-table",12),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"device.events")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultEventType",n.eventTypes.ERROR)("active",i.isActive)("tenantId",n.entity.tenantId.id)("entityId",n.entity.id)}}function Vy(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,4),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-relation-table",11),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,3,"relation.relations")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)}}function By(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,5),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-audit-log-table",13),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,4,"audit-log.audit-logs")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}function Gy(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-tab",8,6),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementStart(3,"tb-version-control",14),e.\u0275\u0275listener("versionRestored",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.entitiesTableConfig.updateData())}),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"version-control.version-control")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}class co extends Ee.P{constructor(t){super(t),this.store=t}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(i){return new(i||co)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:co,selectors:[["tb-device-tabs"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(i,n){1&i&&e.\u0275\u0275template(0,ky,4,7,"mat-tab",7)(1,Ly,4,7,"mat-tab",7)(2,Oy,4,5,"mat-tab",7)(3,Ry,4,7,"mat-tab",7)(4,Vy,4,5,"mat-tab",7)(5,By,4,6,"mat-tab",7)(6,Gy,4,7,"mat-tab",7),2&i&&(e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity&&n.authUser.authority===n.authorities.TENANT_ADMIN),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity&&n.authUser.authority===n.authorities.TENANT_ADMIN))},dependencies:[p.NgIf,Q.MatTab,je.AuditLogTableComponent,xt.EventTableComponent,_t.RelationTableComponent,tt.AlarmTableComponent,nt.AttributeTableComponent,ke.d,u.TranslatePipe],encapsulation:2})}}var jy=d(85612),Yt=d(44037),ir=d(28485),Uy=d(8850),qy=d(37955),zn=d(10320),Wy=d(64599),Ts=d(74427);const Dr=()=>({text:"",href:""}),Pr=(a,t,i)=>({noSecLabel:"HTTP",noSec:a,secLabel:"HTTPs",sec:t,doc:i}),at=a=>({cmd:a}),$y=()=>({text:"device.connectivity.sparkplug-command",href:"https://thingsboard.io/docs/reference/mqtt-sparkplug-api/"}),Hn=a=>({doc:a}),zy=()=>({text:"device.connectivity.install-mqtt-windows",href:"https://thingsboard.io/docs/reference/mqtt-api/?connectdevice=mqtt-windows#mqtt-connect"}),ar=()=>({text:"device.connectivity.mqtts-x509-command",href:"https://thingsboard.io/docs/user-guide/mqtt-over-ssl/"}),or=(a,t,i)=>({noSecLabel:"MQTT",noSec:a,secLabel:"MQTTs",sec:t,doc:i}),Is=()=>({text:"device.connectivity.coaps-x509-command",href:"https://thingsboard.io/docs/user-guide/ssl/coap-x509-certificates/"}),ws=(a,t,i)=>({noSecLabel:"CoAP",noSec:a,secLabel:"CoAPs",sec:t,doc:i}),Hy=()=>({text:"device.connectivity.install-coap-client",href:"https://thingsboard.io/docs/user-guide/ssl/coap-access-token/"}),Ky=()=>({text:"device.connectivity.snmp-command",href:"https://thingsboard.io/docs/reference/snmp-api/"}),Yy=()=>({text:"device.connectivity.lwm2m-command",href:"https://thingsboard.io/docs/reference/lwm2m-api/"});function Qy(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"tb-toggle-option",32),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i.BasicTransportType.HTTP),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,i.deviceTransportTypeTranslationMap.get(i.BasicTransportType.HTTP))," ")}}function Jy(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"tb-toggle-option",32),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i.DeviceTransportType.MQTT),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,i.deviceTransportTypeTranslationMap.get(i.DeviceTransportType.MQTT))," ")}}function Zy(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"tb-toggle-option",32),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i.DeviceTransportType.COAP),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,i.deviceTransportTypeTranslationMap.get(i.DeviceTransportType.COAP))," ")}}function Xy(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"tb-toggle-option",32),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i.DeviceTransportType.SNMP),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,i.deviceTransportTypeTranslationMap.get(i.DeviceTransportType.SNMP))," ")}}function ev(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"tb-toggle-option",32),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i.DeviceTransportType.LWM2M),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,i.deviceTransportTypeTranslationMap.get(i.DeviceTransportType.LWM2M))," ")}}function tv(a,t){1&a&&(e.\u0275\u0275element(0,"mat-icon",37),e.\u0275\u0275text(1," Windows "))}function nv(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function iv(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",38)(1,"div",23)(2,"div",25),e.\u0275\u0275text(3,"device.connectivity.install-necessary-client-tools"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",39),e.\u0275\u0275text(5,"device.connectivity.install-curl-windows"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(6,nv,1,0,"ng-container",40),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(3),n=e.\u0275\u0275reference(23);e.\u0275\u0275advance(6),e.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(7,at,e.\u0275\u0275pureFunction3(3,Pr,i.commands.http.http,i.commands.http.https,e.\u0275\u0275pureFunction0(2,Dr))))}}function av(a,t){1&a&&(e.\u0275\u0275element(0,"mat-icon",41),e.\u0275\u0275text(1," MacOS "))}function ov(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function rv(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",38)(1,"div",23)(2,"div",25),e.\u0275\u0275text(3,"device.connectivity.install-necessary-client-tools"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",39),e.\u0275\u0275text(5,"device.connectivity.install-curl-macos"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(6,ov,1,0,"ng-container",40),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(3),n=e.\u0275\u0275reference(23);e.\u0275\u0275advance(6),e.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(7,at,e.\u0275\u0275pureFunction3(3,Pr,i.commands.http.http,i.commands.http.https,e.\u0275\u0275pureFunction0(2,Dr))))}}function sv(a,t){1&a&&(e.\u0275\u0275element(0,"mat-icon",42),e.\u0275\u0275text(1," Linux "))}function lv(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function dv(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",38)(1,"div",23)(2,"div",25),e.\u0275\u0275text(3,"device.connectivity.install-necessary-client-tools"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"tb-markdown",43),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,lv,1,0,"ng-container",40),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(3),n=e.\u0275\u0275reference(23);e.\u0275\u0275advance(4),e.\u0275\u0275property("data",i.createMarkDownCommand("sudo apt-get install curl")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(8,at,e.\u0275\u0275pureFunction3(4,Pr,i.commands.http.http,i.commands.http.https,e.\u0275\u0275pureFunction0(3,Dr))))}}function cv(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",33),e.\u0275\u0275text(1,"device.connectivity.use-following-instructions"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(2,"mat-tab-group",34),e.\u0275\u0275twoWayListener("selectedIndexChange",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275twoWayBindingSet(r.httpTabIndex,o)||(r.httpTabIndex=o),e.\u0275\u0275resetView(o)}),e.\u0275\u0275elementStart(3,"mat-tab"),e.\u0275\u0275template(4,tv,2,0,"ng-template",35)(5,iv,7,9,"ng-template",36),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"mat-tab"),e.\u0275\u0275template(7,av,2,0,"ng-template",35)(8,rv,7,9,"ng-template",36),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"mat-tab"),e.\u0275\u0275template(10,sv,2,0,"ng-template",35)(11,dv,6,10,"ng-template",36),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275twoWayProperty("selectedIndex",i.httpTabIndex)}}function pv(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function mv(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",23),e.\u0275\u0275template(1,pv,1,0,"ng-container",40),e.\u0275\u0275elementEnd()),2&a){e.\u0275\u0275nextContext(3);const i=e.\u0275\u0275reference(25);e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",i)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(3,Hn,e.\u0275\u0275pureFunction0(2,$y)))}}function uv(a,t){1&a&&(e.\u0275\u0275element(0,"mat-icon",37),e.\u0275\u0275text(1," Windows "))}function gv(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function fv(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function hv(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",38)(1,"div",23)(2,"div",25),e.\u0275\u0275text(3,"device.connectivity.install-necessary-client-tools"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",46),e.\u0275\u0275template(5,gv,1,0,"ng-container",40),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(6,fv,1,0,"ng-container",40),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(4),n=e.\u0275\u0275reference(23),o=e.\u0275\u0275reference(25);e.\u0275\u0275advance(5),e.\u0275\u0275property("ngTemplateOutlet",o)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(5,Hn,e.\u0275\u0275pureFunction0(4,zy))),e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(12,at,e.\u0275\u0275pureFunction3(8,or,i.commands.mqtt.mqtt,i.commands.mqtt.mqtts,e.\u0275\u0275pureFunction0(7,ar))))}}function bv(a,t){1&a&&(e.\u0275\u0275element(0,"mat-icon",41),e.\u0275\u0275text(1," MacOS "))}function yv(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function vv(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",38)(1,"div",23)(2,"div",25),e.\u0275\u0275text(3,"device.connectivity.install-necessary-client-tools"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"tb-markdown",43),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,yv,1,0,"ng-container",40),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(4),n=e.\u0275\u0275reference(23);e.\u0275\u0275advance(4),e.\u0275\u0275property("data",i.createMarkDownCommand("brew install mosquitto")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(8,at,e.\u0275\u0275pureFunction3(4,or,i.commands.mqtt.mqtt,i.commands.mqtt.mqtts,e.\u0275\u0275pureFunction0(3,ar))))}}function Cv(a,t){1&a&&(e.\u0275\u0275element(0,"mat-icon",42),e.\u0275\u0275text(1," Linux "))}function xv(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function _v(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",38)(1,"div",23)(2,"div",25),e.\u0275\u0275text(3,"device.connectivity.install-necessary-client-tools"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"tb-markdown",43),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,xv,1,0,"ng-container",40),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(4),n=e.\u0275\u0275reference(23);e.\u0275\u0275advance(4),e.\u0275\u0275property("data",i.createMarkDownCommand("sudo apt-get install curl mosquitto-clients")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(8,at,e.\u0275\u0275pureFunction3(4,or,i.commands.mqtt.mqtt,i.commands.mqtt.mqtts,e.\u0275\u0275pureFunction0(3,ar))))}}function Sv(a,t){1&a&&(e.\u0275\u0275element(0,"mat-icon",47),e.\u0275\u0275text(1," Docker "))}function Tv(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function Iv(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",38),e.\u0275\u0275template(1,Tv,1,0,"ng-container",40),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(5),n=e.\u0275\u0275reference(23);e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(7,at,e.\u0275\u0275pureFunction3(3,or,i.commands.mqtt.docker.mqtt,i.commands.mqtt.docker.mqtts,e.\u0275\u0275pureFunction0(2,ar))))}}function wv(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-tab"),e.\u0275\u0275template(1,Sv,2,0,"ng-template",35)(2,Iv,2,9,"ng-template",36),e.\u0275\u0275elementEnd())}function Ev(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",33),e.\u0275\u0275text(1,"device.connectivity.use-following-instructions"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(2,"mat-tab-group",34),e.\u0275\u0275twoWayListener("selectedIndexChange",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext(3);return e.\u0275\u0275twoWayBindingSet(r.mqttTabIndex,o)||(r.mqttTabIndex=o),e.\u0275\u0275resetView(o)}),e.\u0275\u0275elementStart(3,"mat-tab"),e.\u0275\u0275template(4,uv,2,0,"ng-template",35)(5,hv,7,14,"ng-template",36),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"mat-tab"),e.\u0275\u0275template(7,bv,2,0,"ng-template",35)(8,vv,6,10,"ng-template",36),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"mat-tab"),e.\u0275\u0275template(10,Cv,2,0,"ng-template",35)(11,_v,6,10,"ng-template",36),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(12,wv,3,0,"mat-tab",45),e.\u0275\u0275elementEnd()}if(2&a){const i=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(2),e.\u0275\u0275twoWayProperty("selectedIndex",i.mqttTabIndex),e.\u0275\u0275advance(10),e.\u0275\u0275property("ngIf",!!i.commands.mqtt.docker)}}function Mv(a,t){if(1&a&&e.\u0275\u0275template(0,mv,2,5,"div",44)(1,Ev,13,2,"ng-template",null,5,e.\u0275\u0275templateRefExtractor),2&a){const i=e.\u0275\u0275reference(2),n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("ngIf",n.commands.mqtt.sparkplug)("ngIfElse",i)}}function Nv(a,t){1&a&&(e.\u0275\u0275element(0,"mat-icon",42),e.\u0275\u0275text(1," Linux "))}function Av(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function Fv(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",23)(1,"div",25),e.\u0275\u0275text(2,"device.connectivity.install-necessary-client-tools"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",46),e.\u0275\u0275template(4,Av,1,0,"ng-container",40),e.\u0275\u0275elementEnd()()),2&a){e.\u0275\u0275nextContext(4);const i=e.\u0275\u0275reference(25);e.\u0275\u0275advance(4),e.\u0275\u0275property("ngTemplateOutlet",i)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(3,Hn,e.\u0275\u0275pureFunction0(2,Hy)))}}function Dv(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function Pv(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",38),e.\u0275\u0275template(1,Fv,5,5,"div",48)(2,Dv,1,0,"ng-container",40),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(3),n=e.\u0275\u0275reference(23);e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf","Check documentation"!==i.commands.coap.coaps),e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(8,at,e.\u0275\u0275pureFunction3(4,ws,i.commands.coap.coap,i.commands.coap.coaps,e.\u0275\u0275pureFunction0(3,Is))))}}function kv(a,t){1&a&&(e.\u0275\u0275element(0,"mat-icon",47),e.\u0275\u0275text(1," Docker "))}function Lv(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function Ov(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",38),e.\u0275\u0275template(1,Lv,1,0,"ng-container",40),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(4),n=e.\u0275\u0275reference(23);e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(7,at,e.\u0275\u0275pureFunction3(3,ws,i.commands.coap.docker.coap,i.commands.coap.docker.coaps,e.\u0275\u0275pureFunction0(2,Is))))}}function Rv(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-tab"),e.\u0275\u0275template(1,kv,2,0,"ng-template",35)(2,Ov,2,9,"ng-template",36),e.\u0275\u0275elementEnd())}function Vv(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",33),e.\u0275\u0275text(1,"device.connectivity.use-following-instructions"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(2,"mat-tab-group",34),e.\u0275\u0275twoWayListener("selectedIndexChange",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275twoWayBindingSet(r.coapTabIndex,o)||(r.coapTabIndex=o),e.\u0275\u0275resetView(o)}),e.\u0275\u0275elementStart(3,"mat-tab"),e.\u0275\u0275template(4,Nv,2,0,"ng-template",35)(5,Pv,3,10,"ng-template",36),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(6,Rv,3,0,"mat-tab",45),e.\u0275\u0275elementEnd()}if(2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275twoWayProperty("selectedIndex",i.coapTabIndex),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",!!i.commands.coap.docker)}}function Bv(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function Gv(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",23),e.\u0275\u0275template(1,Bv,1,0,"ng-container",40),e.\u0275\u0275elementEnd()),2&a){e.\u0275\u0275nextContext(2);const i=e.\u0275\u0275reference(25);e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",i)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(3,Hn,e.\u0275\u0275pureFunction0(2,Ky)))}}function jv(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function Uv(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",23),e.\u0275\u0275template(1,jv,1,0,"ng-container",40),e.\u0275\u0275elementEnd()),2&a){e.\u0275\u0275nextContext(2);const i=e.\u0275\u0275reference(25);e.\u0275\u0275advance(),e.\u0275\u0275property("ngTemplateOutlet",i)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(3,Hn,e.\u0275\u0275pureFunction0(2,Yy)))}}function qv(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",51)(1,"div",52),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"date"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",52),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",52),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd()()),2&a){const i=t.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(3,3,i.lastUpdateTs,"yyyy-MM-dd HH:mm:ss")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(i.key),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(i.value)}}function Wv(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",49),e.\u0275\u0275template(1,qv,8,6,"div",50),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",i.latestTelemetry)}}function $v(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"section",18)(1,"tb-toggle-header",19,4),e.\u0275\u0275template(3,Qy,3,4,"tb-toggle-option",20)(4,Jy,3,4,"tb-toggle-option",20)(5,Zy,3,4,"tb-toggle-option",20)(6,Xy,3,4,"tb-toggle-option",20)(7,ev,3,4,"tb-toggle-option",20),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"div",18),e.\u0275\u0275elementContainerStart(9,21),e.\u0275\u0275template(10,cv,12,1,"ng-template",22)(11,Mv,3,2,"ng-template",22)(12,Vv,7,2,"ng-template",22)(13,Gv,2,5,"ng-template",22)(14,Uv,2,5,"ng-template",22),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"div",23)(16,"div",24)(17,"div",25),e.\u0275\u0275text(18,"device.state"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"div",26),e.\u0275\u0275text(20),e.\u0275\u0275pipe(21,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(22,"div",27),e.\u0275\u0275text(23,"attribute.latest-telemetry"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(24,"div",28)(25,"div",29)(26,"div",30),e.\u0275\u0275text(27,"device.time"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(28,"div",30),e.\u0275\u0275text(29,"attribute.key"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(30,"div",30),e.\u0275\u0275text(31,"attribute.value"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(32,Wv,2,1,"div",31),e.\u0275\u0275elementEnd()()()),2&a){const i=e.\u0275\u0275reference(2),n=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(21);e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",n.allowTransportType.size<2),e.\u0275\u0275propertyInterpolate("value",n.selectTransportType),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.allowTransportType.has(n.BasicTransportType.HTTP)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.allowTransportType.has(n.DeviceTransportType.MQTT)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.allowTransportType.has(n.DeviceTransportType.COAP)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.allowTransportType.has(n.DeviceTransportType.SNMP)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.allowTransportType.has(n.DeviceTransportType.LWM2M)),e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",!n.allowTransportType.size),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitch",i.value),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",n.BasicTransportType.HTTP),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",n.DeviceTransportType.MQTT),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",n.DeviceTransportType.COAP),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",n.DeviceTransportType.SNMP),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",n.DeviceTransportType.LWM2M),e.\u0275\u0275advance(5),e.\u0275\u0275classProp("inactive",!n.status)("hide",void 0===n.status),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(21,23,n.status?"device.active":"device.inactive")," "),e.\u0275\u0275advance(12),e.\u0275\u0275property("ngIf",n.latestTelemetry.length)("ngIfElse",o)}}function zv(a,t){1&a&&(e.\u0275\u0275elementStart(0,"div",53),e.\u0275\u0275element(1,"mat-spinner",54),e.\u0275\u0275elementStart(2,"span",55),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()),2&a&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,1,"device.connectivity.loading-check-connectivity-command")," "))}function Hv(a,t){1&a&&(e.\u0275\u0275elementStart(0,"div",56),e.\u0275\u0275element(1,"div",57),e.\u0275\u0275elementStart(2,"div",33),e.\u0275\u0275text(3,"attribute.no-latest-telemetry"),e.\u0275\u0275elementEnd()())}function Kv(a,t){if(1&a&&e.\u0275\u0275element(0,"tb-markdown",43),2&a){const i=e.\u0275\u0275nextContext().cmd,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("data",n.createMarkDownCommand(i.noSec))}}function Yv(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275element(1,"tb-markdown",43),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(2).cmd,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("data",n.createMarkDownCommand(i.sec))}}function Qv(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function Jv(a,t){if(1&a&&e.\u0275\u0275template(0,Qv,1,0,"ng-container",40),2&a){const i=e.\u0275\u0275nextContext(2).cmd;e.\u0275\u0275nextContext();const n=e.\u0275\u0275reference(25);e.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",e.\u0275\u0275pureFunction1(2,Hn,i.doc))}}function Zv(a,t){if(1&a&&e.\u0275\u0275template(0,Yv,2,1,"div",62)(1,Jv,1,4,"ng-template",null,7,e.\u0275\u0275templateRefExtractor),2&a){const i=e.\u0275\u0275reference(2),n=e.\u0275\u0275nextContext().cmd;e.\u0275\u0275property("ngIf","Check documentation"!==n.sec)("ngIfElse",i)}}function Xv(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",23)(1,"div",58)(2,"div",25),e.\u0275\u0275text(3,"device.connectivity.execute-following-command"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"tb-toggle-header",59,6)(6,"tb-toggle-option",60),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"tb-toggle-option",61),e.\u0275\u0275text(9),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementContainerStart(10,21),e.\u0275\u0275template(11,Kv,1,1,"ng-template",22)(12,Zv,3,2,"ng-template",22),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()),2&a){const i=t.cmd,n=e.\u0275\u0275reference(5);e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",!(i.noSec||"Check documentation"!==i.sec)),e.\u0275\u0275advance(3),e.\u0275\u0275classProp("!hidden",!i.noSec||!i.sec),e.\u0275\u0275propertyInterpolate("value",i.noSec?"noSec":"sec"),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(i.noSecLabel),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(i.secLabel),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitch",n.value),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase","noSec"),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase","sec")}}function e1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",63)(1,"div",64),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"a",65)(5,"mat-icon"),e.\u0275\u0275text(6,"description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd()()),2&a){const i=t.doc;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,3,i.text)),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("href",i.href,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(8,5,"common.documentation")," ")}}class po extends se.m{constructor(t,i,n,o,r,l,c){super(t,i,o),this.store=t,this.router=i,this.data=n,this.dialogRef=o,this.deviceService=r,this.telemetryWsService=l,this.zone=c,this.loadedCommand=!1,this.latestTelemetry=[],this.allowTransportType=new Set,this.BasicTransportType=V.aD,this.DeviceTransportType=V.y0,this.deviceTransportTypeTranslationMap=V.Tk,this.notShowAgain=!1,this.httpTabIndex=0,this.mqttTabIndex=0,this.coapTabIndex=0,this.currentTime=Date.now(),this.transportTypes=[...Object.keys(V.aD),...Object.keys(V.y0)],this.data.afterAdd?(this.dialogTitle="device.connectivity.device-created-check-connectivity",this.showDontShowAgain=!0):(this.dialogTitle="device.connectivity.check-connectivity",this.showDontShowAgain=!1)}ngOnInit(){this.loadCommands(),this.subscribeToLatestTelemetry()}ngOnDestroy(){super.ngOnDestroy(),this.telemetrySubscriber?.complete(),this.telemetrySubscriber?.unsubscribe()}close(){this.notShowAgain&&this.showDontShowAgain?(this.store.dispatch(new Ko.uX({notDisplayConnectivityAfterAddDevice:!0})),this.dialogRef.close(null)):this.dialogRef.close(null)}createMarkDownCommand(t){if(Array.isArray(t)){const i=[];return t.forEach(n=>i.push(this.createMarkDownSingleCommand(n))),i.join("\n<br />\n\n")}return this.createMarkDownSingleCommand(t)}createMarkDownSingleCommand(t){return"```bash\n"+t+"{:copy-code}\n```"}loadCommands(){this.deviceService.getDevicePublishTelemetryCommands(this.data.deviceId.id).subscribe(t=>{this.commands=t;const i=Object.keys(t);this.transportTypes.forEach(n=>{i.find(r=>r.toUpperCase().startsWith(n))&&this.allowTransportType.add(n)}),this.selectTransportType=this.allowTransportType.values().next().value,this.selectTabIndexForUserOS(),this.loadedCommand=!0})}subscribeToLatestTelemetry(){this.store.pipe((0,C.select)(q.Ik)).pipe((0,Ve.s)(1)).subscribe(t=>{if(this.telemetrySubscriber=zn.eb.createEntityAttributesSubscription(this.telemetryWsService,this.data.deviceId,zn.bX.LATEST_TELEMETRY,this.zone),!t){const i=new zn.HS;i.entityType=this.data.deviceId.entityType,i.entityId=this.data.deviceId.id,i.scope=zn.BY.SERVER_SCOPE,i.keys="active",this.telemetrySubscriber.subscriptionCommands.push(i)}this.telemetrySubscriber.subscribe(),this.telemetrySubscriber.attributeData$().subscribe(i=>{const n=i.reduce((o,r)=>("active"===r.key?this.status=(0,ye.coerceBooleanProperty)(r.value):r.lastUpdateTs>this.currentTime&&o.push(r),o),[]);this.latestTelemetry=n.sort((o,r)=>r.lastUpdateTs-o.lastUpdateTs)})})}selectTabIndexForUserOS(){switch((0,_.R0)()){case"linux":case"android":this.httpTabIndex=2,this.mqttTabIndex=2;break;case"macos":case"ios":this.httpTabIndex=1,this.mqttTabIndex=1,this.coapTabIndex=1;break;case"windows":this.httpTabIndex=0,this.mqttTabIndex=0,this.coapTabIndex=1;break;default:this.mqttTabIndex=this.commands.mqtt?.docker?3:0,this.coapTabIndex=this.commands.coap?.docker?1:0}}static{this.\u0275fac=function(i){return new(i||po)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(S.MAT_DIALOG_DATA),e.\u0275\u0275directiveInject(S.MatDialogRef),e.\u0275\u0275directiveInject(Fr.g),e.\u0275\u0275directiveInject(Wy.W),e.\u0275\u0275directiveInject(e.NgZone))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:po,selectors:[["tb-device-check-connectivity-dialog"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:26,vars:15,consts:[["loadingCommand",""],["noData",""],["executeCommand",""],["seeDocumentation",""],["transportProtocol",""],["mqttCommands",""],["protocolType",""],["checkDocumentation",""],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["mat-dialog-content",""],["class","tb-form-panel no-padding no-border",4,"ngIf","ngIfElse"],["mat-dialog-actions","",1,"tb-dialog-actions"],[3,"ngModelChange","ngModel"],["mat-button","",3,"click","disabled"],[1,"tb-form-panel","no-padding","no-border"],["name","TransportProtocol","useSelectOnMdLg","false","appearance","fill",3,"value"],[3,"value",4,"ngIf"],[3,"ngSwitch"],[3,"ngSwitchCase"],[1,"tb-form-panel","stroked"],[1,"flex","flex-1","flex-row"],["translate","",1,"tb-form-panel-title"],[1,"status"],["translate","",1,"tb-form-panel-hint","tb-font-14"],[1,"tb-form-table"],[1,"tb-form-table-header"],["translate","",1,"tb-form-table-header-cell","flex-1"],["class","tb-form-table-body",4,"ngIf","ngIfElse"],[3,"value"],["translate","",1,"tb-no-data-text"],[3,"selectedIndexChange","selectedIndex"],["mat-tab-label",""],["matTabContent",""],["svgIcon","windows",1,"tabs-icon"],[1,"tb-form-panel","no-padding","no-border","tb-tab-body"],["translate","",1,"tb-install-instruction-text"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["svgIcon","macos",1,"tabs-icon"],["svgIcon","linux",1,"tabs-icon"],["usePlainMarkdown","","containerClass","tb-command-code",3,"data"],["class","tb-form-panel stroked",4,"ngIf","ngIfElse"],[4,"ngIf"],[1,"tb-install-instruction-text"],["svgIcon","docker",1,"tabs-icon"],["class","tb-form-panel stroked",4,"ngIf"],[1,"tb-form-table-body"],["class","tb-form-table-row",4,"ngFor","ngForOf"],[1,"tb-form-table-row"],[1,"tb-form-table-row-cell","flex-1"],[1,"tb-loader"],["color","accent","diameter","65","strokeWidth","4"],[1,"mat-subtitle-1","label"],[1,"tb-no-data-available"],[1,"tb-no-data-bg"],[1,"flex","flex-row","items-center","justify-between"],["name","protocolType","useSelectOnMdLg","false",3,"value"],["value","noSec"],["value","sec"],[4,"ngIf","ngIfElse"],[1,"tb-form-row","no-border","no-padding","space-between"],[1,"tb-font-14","tb-flex-1"],["mat-stroked-button","","color","primary","target","_blank",3,"href"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-toolbar",8)(1,"h2",9),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"span",10),e.\u0275\u0275elementStart(4,"button",11),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.close())}),e.\u0275\u0275elementStart(5,"mat-icon",12),e.\u0275\u0275text(6,"close"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(7,"div",13),e.\u0275\u0275template(8,$v,33,25,"section",14),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"div",15)(10,"mat-slide-toggle",16),e.\u0275\u0275twoWayListener("ngModelChange",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275twoWayBindingSet(n.notShowAgain,l)||(n.notShowAgain=l),e.\u0275\u0275resetView(l)}),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(13,"span",10),e.\u0275\u0275elementStart(14,"button",17),e.\u0275\u0275pipe(15,"async"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.close())}),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(18,zv,5,3,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)(20,Hv,4,0,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)(22,Xv,13,10,"ng-template",null,2,e.\u0275\u0275templateRefExtractor)(24,e1,9,7,"ng-template",null,3,e.\u0275\u0275templateRefExtractor)}if(2&i){const o=e.\u0275\u0275reference(19);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(n.dialogTitle),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.loadedCommand)("ngIfElse",o),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",!n.showDontShowAgain),e.\u0275\u0275twoWayProperty("ngModel",n.notShowAgain),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,9,"action.dont-show-again")),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(15,11,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,13,"action.close"))}},dependencies:[p.NgForOf,p.NgIf,p.NgTemplateOutlet,p.NgSwitch,p.NgSwitchCase,Ts.TbMarkdownComponent,x.MatAnchor,x.MatButton,x.MatIconButton,E.MatIcon,ae.MatToolbar,S.MatDialogActions,S.MatDialogContent,$o.MatProgressSpinner,Q.MatTabContent,Q.MatTabLabel,Q.MatTab,Q.MatTabGroup,pe.MatSlideToggle,s.NgControlStatus,s.NgModel,u.TranslateDirective,sn.ToggleHeaderComponent,sn.ToggleOption,p.AsyncPipe,p.DatePipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]{height:100%;max-height:100vh;display:grid;grid-template-rows:min-content minmax(auto,1fr) min-content}[_nghost-%COMP%]   .tb-loader[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;height:300px;max-height:100%}[_nghost-%COMP%]   .tb-loader[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-bottom:0;text-align:center}[_nghost-%COMP%]   .status[_ngcontent-%COMP%]{margin-left:12px;border-radius:12px;height:24px;line-height:24px;padding:0 8px;width:fit-content;color:#198038;background-color:#19803814;font-size:14px}[_nghost-%COMP%]   .status.inactive[_ngcontent-%COMP%]{color:#d12730;background-color:#d1273014}[_nghost-%COMP%]   .tb-hint-instruction[_ngcontent-%COMP%]{border-radius:6px;background-color:#3056800a;padding:6px 16px}[_nghost-%COMP%]   .tb-hint-instruction[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{vertical-align:middle}[_nghost-%COMP%]   .tb-font-14[_ngcontent-%COMP%]{font-size:14px}[_nghost-%COMP%]   .tb-flex-1[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   .tb-form-table-body[_ngcontent-%COMP%]{max-height:108px;min-height:108px;overflow-y:auto;scrollbar-gutter:stable}[_nghost-%COMP%]   .tb-form-table-body[_ngcontent-%COMP%]   .tb-form-table-row[_ngcontent-%COMP%]{min-height:38px}[_nghost-%COMP%]   .tb-no-data-available[_ngcontent-%COMP%]   .tb-no-data-bg[_ngcontent-%COMP%]{min-height:68px}[_nghost-%COMP%]   .tb-install-instruction-text[_ngcontent-%COMP%]{min-height:42px}@media screen and (min-width: 600px) and (max-width: 959px){[_nghost-%COMP%]{width:470px}}@media screen and (min-width: 960px){[_nghost-%COMP%]{width:720px}}.mat-mdc-dialog-container[_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%]{display:flex;gap:8px;padding:8px 16px}.mat-mdc-dialog-container[_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{max-height:80vh;padding:16px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper{padding:0}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper pre[class*=language-]{margin:0;background:#f3f6fa;border-color:#305680;padding-right:38px;overflow:scroll;padding-bottom:4px;min-height:42px;scrollbar-width:thin}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper pre[class*=language-]::-webkit-scrollbar{width:4px;height:4px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn{right:-2px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn p{color:#305680}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn p, [_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div{background-color:#f3f6fa}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div img{display:none}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div:after{content:"";position:initial;display:block;width:18px;height:18px;background:#305680;mask-image:url(/assets/copy-code-icon.svg);-webkit-mask-image:url(/assets/copy-code-icon.svg);mask-repeat:no-repeat;-webkit-mask-repeat:no-repeat}[_nghost-%COMP%]     .mdc-button__label>span .mat-icon{vertical-align:text-bottom;box-sizing:initial}[_nghost-%COMP%]     .tabs-icon{margin-right:8px}[_nghost-%COMP%]     .tb-form-panel.tb-tab-body{padding:16px 0 0}']})}}class Le{constructor(t,i,n,o,r,l,c,m,h,T,N){this.store=t,this.broadcast=i,this.deviceService=n,this.customerService=o,this.dialogService=r,this.edgeService=l,this.homeDialogs=c,this.translate=m,this.datePipe=h,this.router=T,this.dialog=N,this.config=new y.M7,this.config.entityType=f.ck.DEVICE,this.config.entityComponent=so,this.config.entityTabsComponent=co,this.config.entityTranslations=f.Mi.get(f.ck.DEVICE),this.config.entityResources=f.BT.get(f.ck.DEVICE),this.config.addDialogStyle={width:"600px"},this.config.deleteEntityTitle=O=>this.translate.instant("device.delete-device-title",{deviceName:O.name}),this.config.deleteEntityContent=()=>this.translate.instant("device.delete-device-text"),this.config.deleteEntitiesTitle=O=>this.translate.instant("device.delete-devices-title",{count:O}),this.config.deleteEntitiesContent=()=>this.translate.instant("device.delete-devices-text"),this.config.loadEntity=O=>this.deviceService.getDeviceInfo(O.id),this.config.saveEntity=O=>this.deviceService.saveDevice(O).pipe((0,ne.M)(()=>{this.broadcast.broadcast("deviceSaved")}),(0,Z.Z)(re=>this.deviceService.getDeviceInfo(re.id.id))),this.config.onEntityAction=O=>this.onDeviceAction(O,this.config),this.config.detailsReadonly=()=>"customer_user"===this.config.componentsData.deviceScope||"edge_customer_user"===this.config.componentsData.deviceScope,this.config.onLoadAction=O=>this.onLoadAction(O),this.config.headerComponent=lo}resolve(t){const i=t.params;return this.config.componentsData={deviceScope:t.data.devicesType,deviceInfoFilter:{},deviceCredentials$:new fe.B,edgeId:i.edgeId},this.customerId=i.customerId,this.config.componentsData.edgeId=i.edgeId,this.store.pipe((0,C.select)(q.SW),(0,Ve.s)(1)).pipe((0,ne.M)(n=>{n.authority===g.s.CUSTOMER_USER&&("edge"===t.data.devicesType?this.config.componentsData.deviceScope="edge_customer_user":this.config.componentsData.deviceScope="customer_user",this.customerId=n.customerId)}),(0,Z.Z)(()=>this.customerId?this.customerService.getCustomer(this.customerId):(0,H.of)(null)),(0,ie.T)(n=>(n?n.additionalInfo&&n.additionalInfo.isPublic?this.config.tableTitle=this.translate.instant("customer.public-devices"):this.config.tableTitle=n.title+": "+this.translate.instant("device.devices"):"edge"===this.config.componentsData.deviceScope?this.edgeService.getEdge(this.config.componentsData.edgeId).subscribe(o=>this.config.tableTitle=o.name+": "+this.translate.instant("device.devices")):this.config.tableTitle=this.translate.instant("device.devices"),this.config.columns=this.configureColumns(this.config.componentsData.deviceScope),this.configureEntityFunctions(this.config.componentsData.deviceScope),this.config.cellActionDescriptors=this.configureCellActions(this.config.componentsData.deviceScope),this.config.groupActionDescriptors=this.configureGroupActions(this.config.componentsData.deviceScope),this.config.addActionDescriptors=this.configureAddActions(this.config.componentsData.deviceScope),this.config.addEnabled=!("customer_user"===this.config.componentsData.deviceScope||"edge_customer_user"===this.config.componentsData.deviceScope),this.config.entitiesDeleteEnabled="tenant"===this.config.componentsData.deviceScope,this.config.deleteEnabled=()=>"tenant"===this.config.componentsData.deviceScope,this.config)))}onLoadAction(t){const i=t.snapshot.queryParams;if(i){const n=(0,_.Go)(i);let o=!1;i?.deviceProfileId&&(this.config.componentsData.deviceInfoFilter.deviceProfileId=new qy.T(i?.deviceProfileId),delete n.deviceProfileId,o=!0),(0,_.O9)(i?.active)&&(this.config.componentsData.deviceInfoFilter.active=!0===i?.active||"true"===i?.active,delete n.active,o=!0),o&&this.router.navigate([],{relativeTo:t,queryParams:n,queryParamsHandling:"",replaceUrl:!0})}}configureColumns(t){const i=[new y.Qr("createdTime","common.created-time",this.datePipe,"150px"),new y.KK("name","device.name","25%"),new y.KK("deviceProfileName","device-profile.device-profile","25%"),new y.KK("label","device.label","25%"),new y.KK("active","device.state","80px",n=>this.deviceState(n),n=>this.deviceStateStyle(n))];return"tenant"===t&&i.push(new y.KK("customerTitle","customer.customer","25%"),new y.KK("customerIsPublic","device.public","60px",n=>(0,y.ov)(n.customerIsPublic),()=>({}))),i.push(new y.KK("gateway","device.is-gateway","60px",n=>(0,y.ov)(n.additionalInfo&&n.additionalInfo.gateway),()=>({}),!1)),i}deviceState(t){let i="device.active",n="rgba(25, 128, 56, 0.08)";return t.active||(i="device.inactive",n="rgba(209, 39, 48, 0.08)"),`<div class="status" style="border-radius: 16px; height: 32px;\n                line-height: 32px; padding: 0 12px; width: fit-content; background-color: ${n}">\n                ${this.translate.instant(i)}\n            </div>`}deviceStateStyle(t){const i={fontSize:"14px",color:"#198038",cursor:"pointer"};return t.active||(i.color="#d12730"),i}configureEntityFunctions(t){this.config.entitiesFetchFunction=i=>this.deviceService.getDeviceInfosByQuery(this.prepareDeviceInfoQuery(i)),this.config.deleteEntity="tenant"===t?i=>this.deviceService.deleteDevice(i.id):()=>(0,H.of)()}prepareDeviceInfoQuery(t){const i=(0,_.Go)(this.config.componentsData.deviceInfoFilter);return"edge"===this.config.componentsData.deviceScope||"edge_customer_user"===this.config.componentsData.deviceScope?i.edgeId=new Uy.z(this.config.componentsData.edgeId):"tenant"!==this.config.componentsData.deviceScope&&(i.customerId=new Ar.G(this.customerId)),new V.Nq(t,i)}configureCellActions(t){const i=[];return"tenant"===t&&i.push({name:this.translate.instant("device.make-public"),icon:"share",isEnabled:n=>!n.customerId||n.customerId.id===R.k,onAction:(n,o)=>this.makePublic(n,o)},{name:this.translate.instant("device.assign-to-customer"),icon:"assignment_ind",isEnabled:n=>!n.customerId||n.customerId.id===R.k,onAction:(n,o)=>this.assignToCustomer(n,[o.id])},{name:this.translate.instant("device.unassign-from-customer"),icon:"assignment_return",isEnabled:n=>n.customerId&&n.customerId.id!==R.k&&!n.customerIsPublic,onAction:(n,o)=>this.unassignFromCustomer(n,o)},{name:this.translate.instant("device.make-private"),icon:"reply",isEnabled:n=>n.customerId&&n.customerId.id!==R.k&&n.customerIsPublic,onAction:(n,o)=>this.unassignFromCustomer(n,o)},{name:this.translate.instant("device.manage-credentials"),icon:"security",isEnabled:()=>!0,onAction:(n,o)=>this.manageCredentials(n,o)}),"customer"===t&&i.push({name:this.translate.instant("device.unassign-from-customer"),icon:"assignment_return",isEnabled:n=>n.customerId&&n.customerId.id!==R.k&&!n.customerIsPublic,onAction:(n,o)=>this.unassignFromCustomer(n,o)},{name:this.translate.instant("device.make-private"),icon:"reply",isEnabled:n=>n.customerId&&n.customerId.id!==R.k&&n.customerIsPublic,onAction:(n,o)=>this.unassignFromCustomer(n,o)},{name:this.translate.instant("device.manage-credentials"),icon:"security",isEnabled:()=>!0,onAction:(n,o)=>this.manageCredentials(n,o)}),("customer_user"===t||"edge_customer_user"===t)&&i.push({name:this.translate.instant("device.view-credentials"),icon:"security",isEnabled:()=>!0,onAction:(n,o)=>this.manageCredentials(n,o)}),"edge"===t&&i.push({name:this.translate.instant("edge.unassign-from-edge"),icon:"assignment_return",isEnabled:n=>!0,onAction:(n,o)=>this.unassignFromEdge(n,o)}),i}configureGroupActions(t){const i=[];return"tenant"===t&&i.push({name:this.translate.instant("device.assign-devices"),icon:"assignment_ind",isEnabled:!0,onAction:(n,o)=>this.assignToCustomer(n,o.map(r=>r.id))}),"customer"===t&&i.push({name:this.translate.instant("device.unassign-devices"),icon:"assignment_return",isEnabled:!0,onAction:(n,o)=>this.unassignDevicesFromCustomer(n,o)}),"edge"===t&&i.push({name:this.translate.instant("device.unassign-devices-from-edge"),icon:"assignment_return",isEnabled:!0,onAction:(n,o)=>this.unassignDevicesFromEdge(n,o)}),i}configureAddActions(t){this.config.addEntity=null;const i=[];return"tenant"===t&&(i.push({name:this.translate.instant("device.add-device-text"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:n=>this.deviceWizard(n)},{name:this.translate.instant("device.import"),icon:"file_upload",isEnabled:()=>!0,onAction:n=>this.importDevices(n)}),this.config.addEntity=()=>(this.deviceWizard(null),(0,H.of)(null))),"customer"===t&&i.push({name:this.translate.instant("device.assign-new-device"),icon:"add",isEnabled:()=>!0,onAction:n=>this.addDevicesToCustomer(n)}),"edge"===t&&i.push({name:this.translate.instant("device.assign-new-device"),icon:"add",isEnabled:()=>!0,onAction:n=>this.addDevicesToEdge(n)}),i}openDevice(t,i,n){t&&t.stopPropagation();const o=this.router.createUrlTree([i.id.id],{relativeTo:n.getActivatedRoute()});this.router.navigateByUrl(o)}importDevices(t){this.homeDialogs.importEntities(f.ck.DEVICE).subscribe(i=>{i&&(this.broadcast.broadcast("deviceSaved"),this.config.updateData())})}deviceWizard(t){this.dialog.open(jy.DeviceWizardDialogComponent,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"]}).afterClosed().subscribe(i=>{i&&this.store.pipe((0,C.select)((0,q.O7)("notDisplayConnectivityAfterAddDevice"))).pipe((0,Ve.s)(1)).subscribe(n=>{n?this.config.updateData():this.checkConnectivity(null,i.id,!0)})})}addDevicesToCustomer(t){t&&t.stopPropagation(),this.dialog.open(nr.j,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{customerId:this.customerId,entityType:f.ck.DEVICE}}).afterClosed().subscribe(i=>{i&&this.config.updateData()})}makePublic(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("device.make-public-device-title",{deviceName:i.name}),this.translate.instant("device.make-public-device-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{n&&this.deviceService.makeDevicePublic(i.id.id).subscribe(()=>{this.config.updateData()})})}assignToCustomer(t,i){t&&t.stopPropagation(),this.dialog.open(tr.i,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entityIds:i,entityType:f.ck.DEVICE}}).afterClosed().subscribe(n=>{n&&this.config.updateData()})}unassignFromCustomer(t,i){t&&t.stopPropagation();let o,r;i.customerIsPublic?(o=this.translate.instant("device.make-private-device-title",{deviceName:i.name}),r=this.translate.instant("device.make-private-device-text")):(o=this.translate.instant("device.unassign-device-title",{deviceName:i.name}),r=this.translate.instant("device.unassign-device-text")),this.dialogService.confirm(o,r,this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(l=>{l&&this.deviceService.unassignDeviceFromCustomer(i.id.id).subscribe(()=>{this.config.updateData("tenant"!==this.config.componentsData.deviceScope)})})}unassignDevicesFromCustomer(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("device.unassign-devices-title",{count:i.length}),this.translate.instant("device.unassign-devices-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{if(n){const o=[];i.forEach(r=>{o.push(this.deviceService.unassignDeviceFromCustomer(r.id.id))}),(0,Se.p)(o).subscribe(()=>{this.config.updateData()})}})}manageCredentials(t,i){t&&t.stopPropagation(),this.dialog.open($n,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{deviceId:i.id.id,deviceProfileId:i.deviceProfileId.id,isReadOnly:"customer_user"===this.config.componentsData.deviceScope||"edge_customer_user"===this.config.componentsData.deviceScope}}).afterClosed().subscribe(n=>{(0,_.f1)(n)&&this.config.componentsData.deviceCredentials$.next(n)})}onDeviceAction(t,i){switch(t.action){case"open":return this.openDevice(t.event,t.entity,i),!0;case"makePublic":return this.makePublic(t.event,t.entity),!0;case"assignToCustomer":return this.assignToCustomer(t.event,[t.entity.id]),!0;case"unassignFromCustomer":return this.unassignFromCustomer(t.event,t.entity),!0;case"unassignFromEdge":return this.unassignFromEdge(t.event,t.entity),!0;case"manageCredentials":return this.manageCredentials(t.event,t.entity),!0;case"checkConnectivity":return this.checkConnectivity(t.event,t.entity.id),!0}return!1}addDevicesToEdge(t){t&&t.stopPropagation(),this.dialog.open(ir.M,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edgeId:this.config.componentsData.edgeId,entityType:f.ck.DEVICE}}).afterClosed().subscribe(i=>{i&&this.config.updateData()})}unassignFromEdge(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("device.unassign-device-from-edge-title",{deviceName:i.name}),this.translate.instant("device.unassign-device-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{n&&this.deviceService.unassignDeviceFromEdge(this.config.componentsData.edgeId,i.id.id).subscribe(()=>{this.config.updateData("tenant"!==this.config.componentsData.deviceScope)})})}unassignDevicesFromEdge(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("device.unassign-devices-from-edge-title",{count:i.length}),this.translate.instant("device.unassign-devices-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{if(n){const o=[];i.forEach(r=>{o.push(this.deviceService.unassignDeviceFromEdge(this.config.componentsData.edgeId,r.id.id))}),(0,Se.p)(o).subscribe(()=>{this.config.updateData()})}})}checkConnectivity(t,i,n=!1){t&&t.stopPropagation(),this.dialog.open(po,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{deviceId:i,afterAdd:n}}).afterClosed().subscribe(()=>{n&&this.config.updateData()})}static{this.\u0275fac=function(i){return new(i||Le)(e.\u0275\u0275inject(C.Store),e.\u0275\u0275inject(ca.D),e.\u0275\u0275inject(Fr.g),e.\u0275\u0275inject(Dt.m),e.\u0275\u0275inject(Ce.o),e.\u0275\u0275inject(Yt.p),e.\u0275\u0275inject(mt.k),e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(p.DatePipe),e.\u0275\u0275inject(b.Router),e.\u0275\u0275inject(S.MatDialog))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Le,factory:Le.\u0275fac})}}var t1=d(20580),n1=d(39828),Es=d(831);function i1(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"asset.name-required")," "))}function a1(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"asset.name-max-length")," "))}function o1(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"asset.label-max-length")," "))}function r1(a,t){if(1&a&&e.\u0275\u0275element(0,"tb-entity-autocomplete",19),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("entityType",i.entityType.CUSTOMER)}}class mo extends xe.l{constructor(t,i,n,o,r,l){super(t,r,n,o,l),this.store=t,this.translate=i,this.entityValue=n,this.entitiesTableConfigValue=o,this.fb=r,this.cd=l,this.entityType=f.ck}ngOnInit(){this.assetScope=this.entitiesTableConfig.componentsData.assetScope,super.ngOnInit()}hideDelete(){return!!this.entitiesTableConfig&&!this.entitiesTableConfig.deleteEnabled(this.entity)}isAssignedToCustomer(t){return t&&t.customerId&&t.customerId.id!==R.k}buildForm(t){return this.fb.group({name:[t?t.name:"",[s.Validators.required,s.Validators.maxLength(255)]],assetProfileId:[t?t.assetProfileId:null,[s.Validators.required]],label:[t?t.label:"",s.Validators.maxLength(255)],customerId:[t?t.customerId:""],additionalInfo:this.fb.group({description:[t&&t.additionalInfo?t.additionalInfo.description:""]})})}updateForm(t){this.entityForm.patchValue({name:t.name}),this.entityForm.patchValue({assetProfileId:t.assetProfileId}),this.entityForm.patchValue({label:t.label}),this.entityForm.patchValue({customerId:t.customerId}),this.entityForm.patchValue({additionalInfo:{description:t.additionalInfo?t.additionalInfo.description:""}})}onAssetIdCopied(t){this.store.dispatch(new $.xo({message:this.translate.instant("asset.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onAssetProfileUpdated(){this.entitiesTableConfig.updateData(!1)}static{this.\u0275fac=function(i){return new(i||mo)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject("entity"),e.\u0275\u0275directiveInject("entitiesTableConfig"),e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(e.ChangeDetectorRef))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:mo,selectors:[["tb-asset"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:59,vars:69,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[1,"mat-block"],["matInput","","disabled","",3,"ngModel"],[1,"tb-small",2,"padding-bottom","10px","padding-left","2px"],[3,"formGroup"],[3,"disabled"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["matInput","","formControlName","label"],["required","","formControlName","assetProfileId",3,"assetProfileUpdated","selectDefaultProfile","showDetailsPageLink"],["useFullEntityId","","formControlName","customerId","labelText","asset.assign-to-customer",3,"entityType",4,"ngIf"],["formGroupName","additionalInfo"],["matInput","","formControlName","description","rows","2"],["useFullEntityId","","formControlName","customerId","labelText","asset.assign-to-customer",3,"entityType"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"button",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"open")}),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",1),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"makePublic")}),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"button",1),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"assignToCustomer")}),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"button",1),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"unassignFromCustomer")}),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"button",1),e.\u0275\u0275pipe(18,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"unassignFromEdge")}),e.\u0275\u0275text(19),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"button",1),e.\u0275\u0275pipe(22,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"delete")}),e.\u0275\u0275text(23),e.\u0275\u0275pipe(24,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(25,"div",2)(26,"button",3),e.\u0275\u0275listener("cbOnSuccess",function(r){return n.onAssetIdCopied(r)}),e.\u0275\u0275element(27,"mat-icon",4),e.\u0275\u0275elementStart(28,"span",5),e.\u0275\u0275text(29,"asset.copyId"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(30,"div",6)(31,"mat-form-field",7)(32,"mat-label",5),e.\u0275\u0275text(33,"asset.assignedToCustomer"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(34,"input",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(35,"div",9),e.\u0275\u0275text(36),e.\u0275\u0275pipe(37,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(38,"form",10)(39,"fieldset",11),e.\u0275\u0275pipe(40,"async"),e.\u0275\u0275elementStart(41,"mat-form-field",7)(42,"mat-label",5),e.\u0275\u0275text(43,"asset.name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(44,"input",12),e.\u0275\u0275template(45,i1,3,3,"mat-error",13)(46,a1,3,3,"mat-error",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(47,"mat-form-field",7)(48,"mat-label",5),e.\u0275\u0275text(49,"asset.label"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(50,"input",14),e.\u0275\u0275template(51,o1,3,3,"mat-error",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(52,"tb-asset-profile-autocomplete",15),e.\u0275\u0275listener("assetProfileUpdated",function(){return n.onAssetProfileUpdated()}),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(53,r1,1,1,"tb-entity-autocomplete",16),e.\u0275\u0275elementStart(54,"div",17)(55,"mat-form-field",7)(56,"mat-label",5),e.\u0275\u0275text(57,"asset.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(58,"textarea",18),e.\u0275\u0275elementEnd()()()()()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",n.isEdit||n.isDetailsPage),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(2,41,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,43,"common.open-details-page")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||"tenant"!==n.assetScope||n.isAssignedToCustomer(n.entity)||(null==n.entity?null:n.entity.customerIsPublic)),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(6,45,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(8,47,"asset.make-public")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||"tenant"!==n.assetScope||n.isAssignedToCustomer(n.entity)),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(10,49,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(12,51,"asset.assign-to-customer")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||"customer"!==n.assetScope&&"tenant"!==n.assetScope||!n.isAssignedToCustomer(n.entity)),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(14,53,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,55,null!=n.entity&&n.entity.customerIsPublic?"asset.make-private":"asset.unassign-from-customer")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||"edge"!==n.assetScope),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(18,57,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(20,59,"edge.unassign-from-edge")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.hideDelete()||n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(22,61,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(24,63,"asset.delete")," "),e.\u0275\u0275advance(3),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("cbContent",null==n.entity||null==n.entity.id?null:n.entity.id.id),e.\u0275\u0275advance(5),e.\u0275\u0275classProp("!hidden",n.isEdit||!n.isAssignedToCustomer(n.entity)||(null==n.entity?null:n.entity.customerIsPublic)||"tenant"!==n.assetScope),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngModel",null==n.entity?null:n.entity.customerTitle),e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",n.isEdit||!(null!=n.entity&&n.entity.customerIsPublic)||"customer"!==n.assetScope&&"tenant"!==n.assetScope),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(37,65,"asset.asset-public")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.entityForm),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(40,67,n.isLoading$)||!n.isEdit),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.entityForm.get("name").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("name").hasError("maxlength")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",n.entityForm.get("label").hasError("maxlength")),e.\u0275\u0275advance(),e.\u0275\u0275property("selectDefaultProfile",n.isAdd)("showDetailsPageLink",!0),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.isAdd))},dependencies:[p.NgIf,n1.EntityAutocompleteComponent,x.MatButton,E.MatIcon,L.MatInput,v.MatFormField,v.MatLabel,v.MatError,we.Uo,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.NgModel,s.FormGroupDirective,s.FormControlName,s.FormGroupName,u.TranslateDirective,Es.AssetProfileAutocompleteComponent,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";']})}}class uo extends Ne.M{constructor(t){super(t),this.store=t,this.entityType=f.ck}assetProfileChanged(t){this.entitiesTableConfig.componentsData.assetProfileId=t,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}static{this.\u0275fac=function(i){return new(i||uo)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:uo,selectors:[["tb-asset-table-header"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:4,consts:[["subscriptSizing","dynamic",3,"ngModelChange","ngModel","addNewProfile","displayAllOnEmpty","editProfileEnabled"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"tb-asset-profile-autocomplete",0),e.\u0275\u0275listener("ngModelChange",function(r){return n.assetProfileChanged(r)}),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("ngModel",n.entitiesTableConfig.componentsData.assetProfileId)("addNewProfile",!1)("displayAllOnEmpty",!0)("editProfileEnabled",!1)},dependencies:[s.NgControlStatus,s.NgModel,Es.AssetProfileAutocompleteComponent],encapsulation:2})}}function s1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,0),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-attribute-table",9),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"attribute.attributes")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function l1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-attribute-table",10),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"attribute.latest-telemetry")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function d1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,2),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-alarm-table",11),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,3,"alarm.alarms")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)}}function c1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,3),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-event-table",12),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"asset.events")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultEventType",n.eventTypes.ERROR)("active",i.isActive)("tenantId",n.entity.tenantId.id)("entityId",n.entity.id)}}function p1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,4),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-relation-table",11),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,3,"relation.relations")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)}}function m1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,5),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-audit-log-table",13),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,4,"audit-log.audit-logs")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}function u1(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-tab",8,6),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementStart(3,"tb-version-control",14),e.\u0275\u0275listener("versionRestored",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.entitiesTableConfig.updateData())}),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"version-control.version-control")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}class go extends Ee.P{constructor(t){super(t),this.store=t}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(i){return new(i||go)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:go,selectors:[["tb-asset-tabs"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(i,n){1&i&&e.\u0275\u0275template(0,s1,4,7,"mat-tab",7)(1,l1,4,7,"mat-tab",7)(2,d1,4,5,"mat-tab",7)(3,c1,4,7,"mat-tab",7)(4,p1,4,5,"mat-tab",7)(5,m1,4,6,"mat-tab",7)(6,u1,4,7,"mat-tab",7),2&i&&(e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity&&n.authUser.authority===n.authorities.TENANT_ADMIN),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity&&n.authUser.authority===n.authorities.TENANT_ADMIN))},dependencies:[p.NgIf,Q.MatTab,je.AuditLogTableComponent,xt.EventTableComponent,_t.RelationTableComponent,tt.AlarmTableComponent,nt.AttributeTableComponent,ke.d,u.TranslatePipe],encapsulation:2})}}class Oe{constructor(t,i,n,o,r,l,c,m,h,T,N){this.store=t,this.broadcast=i,this.assetService=n,this.customerService=o,this.edgeService=r,this.dialogService=l,this.homeDialogs=c,this.translate=m,this.datePipe=h,this.router=T,this.dialog=N,this.config=new y.M7,this.config.entityType=f.ck.ASSET,this.config.entityComponent=mo,this.config.entityTabsComponent=go,this.config.entityTranslations=f.Mi.get(f.ck.ASSET),this.config.entityResources=f.BT.get(f.ck.ASSET),this.config.deleteEntityTitle=O=>this.translate.instant("asset.delete-asset-title",{assetName:O.name}),this.config.deleteEntityContent=()=>this.translate.instant("asset.delete-asset-text"),this.config.deleteEntitiesTitle=O=>this.translate.instant("asset.delete-assets-title",{count:O}),this.config.deleteEntitiesContent=()=>this.translate.instant("asset.delete-assets-text"),this.config.loadEntity=O=>this.assetService.getAssetInfo(O.id),this.config.saveEntity=O=>this.assetService.saveAsset(O).pipe((0,ne.M)(()=>{this.broadcast.broadcast("assetSaved")}),(0,Z.Z)(re=>this.assetService.getAssetInfo(re.id.id))),this.config.onEntityAction=O=>this.onAssetAction(O,this.config),this.config.detailsReadonly=()=>"customer_user"===this.config.componentsData.assetScope||"edge_customer_user"===this.config.componentsData.assetScope,this.config.headerComponent=uo}resolve(t){const i=t.params;return this.config.componentsData={assetScope:t.data.assetsType,assetProfileId:null,assetType:"",edgeId:i.edgeId},this.customerId=i.customerId,this.store.pipe((0,C.select)(q.SW),(0,Ve.s)(1)).pipe((0,ne.M)(n=>{n.authority===g.s.CUSTOMER_USER&&("edge"===t.data.assetsType?this.config.componentsData.assetScope="edge_customer_user":this.config.componentsData.assetScope="customer_user",this.customerId=n.customerId)}),(0,Z.Z)(()=>this.customerId?this.customerService.getCustomer(this.customerId):(0,H.of)(null)),(0,ie.T)(n=>(n?n.additionalInfo&&n.additionalInfo.isPublic?this.config.tableTitle=this.translate.instant("customer.public-assets"):this.config.tableTitle=n.title+": "+this.translate.instant("asset.assets"):"edge"===this.config.componentsData.assetScope?this.edgeService.getEdge(this.config.componentsData.edgeId).subscribe(o=>this.config.tableTitle=o.name+": "+this.translate.instant("asset.assets")):this.config.tableTitle=this.translate.instant("asset.assets"),this.config.columns=this.configureColumns(this.config.componentsData.assetScope),this.configureEntityFunctions(this.config.componentsData.assetScope),this.config.cellActionDescriptors=this.configureCellActions(this.config.componentsData.assetScope),this.config.groupActionDescriptors=this.configureGroupActions(this.config.componentsData.assetScope),this.config.addActionDescriptors=this.configureAddActions(this.config.componentsData.assetScope),this.config.addEnabled=!("customer_user"===this.config.componentsData.assetScope||"edge_customer_user"===this.config.componentsData.assetScope),this.config.entitiesDeleteEnabled="tenant"===this.config.componentsData.assetScope,this.config.deleteEnabled=()=>"tenant"===this.config.componentsData.assetScope,this.config)))}configureColumns(t){const i=[new y.Qr("createdTime","common.created-time",this.datePipe,"150px"),new y.KK("name","asset.name","25%"),new y.KK("assetProfileName","asset-profile.asset-profile","25%"),new y.KK("label","asset.label","25%")];return"tenant"===t&&i.push(new y.KK("customerTitle","customer.customer","25%"),new y.KK("customerIsPublic","asset.public","60px",n=>(0,y.ov)(n.customerIsPublic),()=>({}),!1)),i}configureEntityFunctions(t){"tenant"===t?(this.config.entitiesFetchFunction=i=>this.assetService.getTenantAssetInfosByAssetProfileId(i,null!==this.config.componentsData.assetProfileId?this.config.componentsData.assetProfileId.id:""),this.config.deleteEntity=i=>this.assetService.deleteAsset(i.id)):"edge"===t||"edge_customer_user"===t?this.config.entitiesFetchFunction=i=>this.assetService.getEdgeAssets(this.config.componentsData.edgeId,i,this.config.componentsData.assetType):(this.config.entitiesFetchFunction=i=>this.assetService.getCustomerAssetInfosByAssetProfileId(this.customerId,i,null!==this.config.componentsData.assetProfileId?this.config.componentsData.assetProfileId.id:""),this.config.deleteEntity=i=>this.assetService.unassignAssetFromCustomer(i.id))}configureCellActions(t){const i=[];return"tenant"===t&&i.push({name:this.translate.instant("asset.make-public"),icon:"share",isEnabled:n=>!n.customerId||n.customerId.id===R.k,onAction:(n,o)=>this.makePublic(n,o)},{name:this.translate.instant("asset.assign-to-customer"),icon:"assignment_ind",isEnabled:n=>!n.customerId||n.customerId.id===R.k,onAction:(n,o)=>this.assignToCustomer(n,[o.id])},{name:this.translate.instant("asset.unassign-from-customer"),icon:"assignment_return",isEnabled:n=>n.customerId&&n.customerId.id!==R.k&&!n.customerIsPublic,onAction:(n,o)=>this.unassignFromCustomer(n,o)},{name:this.translate.instant("asset.make-private"),icon:"reply",isEnabled:n=>n.customerId&&n.customerId.id!==R.k&&n.customerIsPublic,onAction:(n,o)=>this.unassignFromCustomer(n,o)}),"customer"===t&&i.push({name:this.translate.instant("asset.unassign-from-customer"),icon:"assignment_return",isEnabled:n=>n.customerId&&n.customerId.id!==R.k&&!n.customerIsPublic,onAction:(n,o)=>this.unassignFromCustomer(n,o)},{name:this.translate.instant("asset.make-private"),icon:"reply",isEnabled:n=>n.customerId&&n.customerId.id!==R.k&&n.customerIsPublic,onAction:(n,o)=>this.unassignFromCustomer(n,o)}),"edge"===t&&i.push({name:this.translate.instant("edge.unassign-from-edge"),icon:"assignment_return",isEnabled:n=>!0,onAction:(n,o)=>this.unassignFromEdge(n,o)}),i}configureGroupActions(t){const i=[];return"tenant"===t&&i.push({name:this.translate.instant("asset.assign-assets"),icon:"assignment_ind",isEnabled:!0,onAction:(n,o)=>this.assignToCustomer(n,o.map(r=>r.id))}),"customer"===t&&i.push({name:this.translate.instant("asset.unassign-assets"),icon:"assignment_return",isEnabled:!0,onAction:(n,o)=>this.unassignAssetsFromCustomer(n,o)}),"edge"===t&&i.push({name:this.translate.instant("asset.unassign-assets-from-edge"),icon:"assignment_return",isEnabled:!0,onAction:(n,o)=>this.unassignAssetsFromEdge(n,o)}),i}configureAddActions(t){const i=[];return"tenant"===t&&i.push({name:this.translate.instant("asset.add-asset-text"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:n=>this.config.getTable().addEntity(n)},{name:this.translate.instant("asset.import"),icon:"file_upload",isEnabled:()=>!0,onAction:n=>this.importAssets(n)}),"customer"===t&&i.push({name:this.translate.instant("asset.assign-new-asset"),icon:"add",isEnabled:()=>!0,onAction:n=>this.addAssetsToCustomer(n)}),"edge"===t&&i.push({name:this.translate.instant("asset.assign-new-asset"),icon:"add",isEnabled:()=>!0,onAction:n=>this.addAssetsToEdge(n)}),i}importAssets(t){this.homeDialogs.importEntities(f.ck.ASSET).subscribe(i=>{i&&(this.broadcast.broadcast("assetSaved"),this.config.updateData())})}openAsset(t,i,n){t&&t.stopPropagation();const o=this.router.createUrlTree([i.id.id],{relativeTo:n.getActivatedRoute()});this.router.navigateByUrl(o)}addAssetsToCustomer(t){t&&t.stopPropagation(),this.dialog.open(nr.j,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{customerId:this.customerId,entityType:f.ck.ASSET}}).afterClosed().subscribe(i=>{i&&this.config.updateData()})}makePublic(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("asset.make-public-asset-title",{assetName:i.name}),this.translate.instant("asset.make-public-asset-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{n&&this.assetService.makeAssetPublic(i.id.id).subscribe(()=>{this.config.updateData()})})}assignToCustomer(t,i){t&&t.stopPropagation(),this.dialog.open(tr.i,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entityIds:i,entityType:f.ck.ASSET}}).afterClosed().subscribe(n=>{n&&this.config.updateData()})}unassignFromCustomer(t,i){t&&t.stopPropagation();let o,r;i.customerIsPublic?(o=this.translate.instant("asset.make-private-asset-title",{assetName:i.name}),r=this.translate.instant("asset.make-private-asset-text")):(o=this.translate.instant("asset.unassign-asset-title",{assetName:i.name}),r=this.translate.instant("asset.unassign-asset-text")),this.dialogService.confirm(o,r,this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(l=>{l&&this.assetService.unassignAssetFromCustomer(i.id.id).subscribe(()=>{this.config.updateData("tenant"!==this.config.componentsData.assetScope)})})}unassignAssetsFromCustomer(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("asset.unassign-assets-title",{count:i.length}),this.translate.instant("asset.unassign-assets-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{if(n){const o=[];i.forEach(r=>{o.push(this.assetService.unassignAssetFromCustomer(r.id.id))}),(0,Se.p)(o).subscribe(()=>{this.config.updateData()})}})}onAssetAction(t,i){switch(t.action){case"open":return this.openAsset(t.event,t.entity,i),!0;case"makePublic":return this.makePublic(t.event,t.entity),!0;case"assignToCustomer":return this.assignToCustomer(t.event,[t.entity.id]),!0;case"unassignFromCustomer":return this.unassignFromCustomer(t.event,t.entity),!0;case"unassignFromEdge":return this.unassignFromEdge(t.event,t.entity),!0}return!1}addAssetsToEdge(t){t&&t.stopPropagation(),this.dialog.open(ir.M,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edgeId:this.config.componentsData.edgeId,entityType:f.ck.ASSET}}).afterClosed().subscribe(i=>{i&&this.config.updateData()})}unassignFromEdge(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("asset.unassign-asset-from-edge-title",{assetName:i.name}),this.translate.instant("asset.unassign-asset-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{n&&this.assetService.unassignAssetFromEdge(this.config.componentsData.edgeId,i.id.id).subscribe(()=>{this.config.updateData("tenant"!==this.config.componentsData.assetScope)})})}unassignAssetsFromEdge(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("asset.unassign-assets-from-edge-title",{count:i.length}),this.translate.instant("asset.unassign-assets-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{if(n){const o=[];i.forEach(r=>{o.push(this.assetService.unassignAssetFromEdge(this.config.componentsData.edgeId,r.id.id))}),(0,Se.p)(o).subscribe(()=>{this.config.updateData()})}})}static{this.\u0275fac=function(i){return new(i||Oe)(e.\u0275\u0275inject(C.Store),e.\u0275\u0275inject(ca.D),e.\u0275\u0275inject(t1.I),e.\u0275\u0275inject(Dt.m),e.\u0275\u0275inject(Yt.p),e.\u0275\u0275inject(Ce.o),e.\u0275\u0275inject(mt.k),e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(p.DatePipe),e.\u0275\u0275inject(b.Router),e.\u0275\u0275inject(S.MatDialog))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Oe,factory:Oe.\u0275fac})}}var Ms=d(97887),Kn=d(35027),Ns=d(65613);function g1(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"button",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275listener("click",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.onEntityAction(o,"openInstallInstructions"))}),e.\u0275\u0275elementStart(3,"mat-icon"),e.\u0275\u0275text(4,"info_outline"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"span"),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",i.isEdit||"customer_user"===i.edgeScope),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(2,4,i.isLoading$)),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(7,6,"edge.install-connect-instructions"))}}function f1(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"button",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275listener("click",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.onEntityAction(o,"openUpgradeInstructions"))}),e.\u0275\u0275elementStart(3,"mat-icon"),e.\u0275\u0275text(4,"info_outline"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"span"),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",i.isEdit||"customer_user"===i.edgeScope),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(2,4,i.isLoading$)),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(7,6,"edge.upgrade-instructions"))}}function h1(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"edge.name-required")," "))}function b1(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"edge.name-max-length")," "))}function y1(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"edge.label-max-length")," "))}class fo extends xe.l{constructor(t,i,n,o,r,l,c){super(t,l,o,r,c),this.store=t,this.translate=i,this.edgeService=n,this.entityValue=o,this.entitiesTableConfigValue=r,this.fb=l,this.cd=c,this.entityType=f.ck,this.upgradeAvailable=!1}ngOnInit(){this.edgeScope=this.entitiesTableConfig.componentsData.edgeScope,super.ngOnInit()}hideDelete(){return!!this.entitiesTableConfig&&!this.entitiesTableConfig.deleteEnabled(this.entity)}isAssignedToCustomer(t){return t&&t.customerId&&t.customerId.id!==R.k}buildForm(t){const i=this.fb.group({name:[t?t.name:"",[s.Validators.required,s.Validators.maxLength(255)]],type:[t?.type?t.type:"default",[s.Validators.required,s.Validators.maxLength(255)]],label:[t?t.label:"",s.Validators.maxLength(255)],routingKey:this.fb.control({value:t?t.routingKey:null,disabled:!0}),secret:this.fb.control({value:t?t.secret:null,disabled:!0}),additionalInfo:this.fb.group({description:[t&&t.additionalInfo?t.additionalInfo.description:""]})});return this.generateRoutingKeyAndSecret(t,i),i}updateForm(t){this.entityForm.patchValue({name:t.name,type:t.type,label:t.label,routingKey:t.routingKey,secret:t.secret,additionalInfo:{description:t.additionalInfo?t.additionalInfo.description:""}}),this.generateRoutingKeyAndSecret(t,this.entityForm),this.edgeService.isEdgeUpgradeAvailable(this.entity.id.id).subscribe(i=>{this.upgradeAvailable=i})}updateFormState(){super.updateFormState(),this.entityForm.get("routingKey").disable({emitEvent:!1}),this.entityForm.get("secret").disable({emitEvent:!1})}onEdgeIdCopied(t){this.store.dispatch(new $.xo({message:this.translate.instant("edge.id-copied-message"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onEdgeInfoCopied(t){const i="key"===t?"edge.edge-key-copied-message":"edge.edge-secret-copied-message";this.store.dispatch(new $.xo({message:this.translate.instant(i),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}generateRoutingKeyAndSecret(t,i){t&&!t.id&&(i.get("routingKey").patchValue((0,_.Os)(),{emitEvent:!1}),i.get("secret").patchValue((0,_.Kl)(20),{emitEvent:!1}))}static{this.\u0275fac=function(i){return new(i||fo)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(Yt.p),e.\u0275\u0275directiveInject("entity"),e.\u0275\u0275directiveInject("entitiesTableConfig"),e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(e.ChangeDetectorRef))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:fo,selectors:[["tb-edge"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:112,vars:138,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",1,"xs:flex-1",3,"click","disabled"],[1,"flex","flex-row","flex-wrap","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent","disabled"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],["mat-raised-button","","ngxClipboard","",3,"click","disabled"],["svgIcon","mdi:sync"],[1,"flex","flex-row","xs:flex-col"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"mat-padding","flex","flex-col"],[1,"mat-block"],["matInput","","disabled","",3,"ngModel"],[1,"tb-small",2,"padding-bottom","10px","padding-left","2px"],[3,"formGroup"],[3,"disabled"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","type",3,"required","entityType"],[1,"flex","flex-row"],[1,"mat-block","flex-1"],["matInput","","formControlName","routingKey"],["mat-icon-button","","type","button","ngxClipboard","",3,"cbOnSuccess","cbContent","matTooltip"],["matInput","","formControlName","secret"],["matInput","","formControlName","label"],["formGroupName","additionalInfo",1,"flex","flex-col"],["matInput","","formControlName","description","rows","2"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"button",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"open")}),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",1),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"makePublic")}),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"button",1),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"assignToCustomer")}),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"button",1),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"unassignFromCustomer")}),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"button",1),e.\u0275\u0275pipe(18,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"openEdgeAssets")}),e.\u0275\u0275text(19),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"button",1),e.\u0275\u0275pipe(22,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"openEdgeDevices")}),e.\u0275\u0275text(23),e.\u0275\u0275pipe(24,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(25,"button",1),e.\u0275\u0275pipe(26,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"openEdgeEntityViews")}),e.\u0275\u0275text(27),e.\u0275\u0275pipe(28,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(29,"button",1),e.\u0275\u0275pipe(30,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"openEdgeDashboards")}),e.\u0275\u0275text(31),e.\u0275\u0275pipe(32,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(33,"button",1),e.\u0275\u0275pipe(34,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"openEdgeRuleChains")}),e.\u0275\u0275text(35),e.\u0275\u0275pipe(36,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(37,"button",2),e.\u0275\u0275pipe(38,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"delete")}),e.\u0275\u0275text(39),e.\u0275\u0275pipe(40,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(41,"div",3)(42,"button",4),e.\u0275\u0275pipe(43,"async"),e.\u0275\u0275listener("cbOnSuccess",function(r){return n.onEdgeIdCopied(r)}),e.\u0275\u0275element(44,"mat-icon",5),e.\u0275\u0275elementStart(45,"span",6),e.\u0275\u0275text(46,"edge.copy-id"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(47,"button",4),e.\u0275\u0275pipe(48,"async"),e.\u0275\u0275listener("cbOnSuccess",function(){return n.onEdgeInfoCopied("key")}),e.\u0275\u0275element(49,"mat-icon",5),e.\u0275\u0275elementStart(50,"span",6),e.\u0275\u0275text(51,"edge.copy-edge-key"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(52,"button",4),e.\u0275\u0275pipe(53,"async"),e.\u0275\u0275listener("cbOnSuccess",function(){return n.onEdgeInfoCopied("secret")}),e.\u0275\u0275element(54,"mat-icon",5),e.\u0275\u0275elementStart(55,"span",6),e.\u0275\u0275text(56,"edge.copy-edge-secret"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(57,"button",7),e.\u0275\u0275pipe(58,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"syncEdge")}),e.\u0275\u0275element(59,"mat-icon",8),e.\u0275\u0275elementStart(60,"span",6),e.\u0275\u0275text(61,"edge.sync"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(62,"div",9)(63,"div",10),e.\u0275\u0275template(64,g1,8,8,"ng-container",11)(65,f1,8,8,"ng-container",11),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(66,"div",12)(67,"mat-form-field",13)(68,"mat-label",6),e.\u0275\u0275text(69,"edge.assignedToCustomer"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(70,"input",14),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(71,"div",15),e.\u0275\u0275text(72),e.\u0275\u0275pipe(73,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(74,"form",16)(75,"fieldset",17),e.\u0275\u0275pipe(76,"async"),e.\u0275\u0275elementStart(77,"mat-form-field",13)(78,"mat-label",6),e.\u0275\u0275text(79,"edge.name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(80,"input",18),e.\u0275\u0275template(81,h1,3,3,"mat-error",19)(82,b1,3,3,"mat-error",19),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(83,"tb-entity-subtype-autocomplete",20),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(84,"div",21)(85,"mat-form-field",22)(86,"mat-label",6),e.\u0275\u0275text(87,"edge.edge-key"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(88,"input",23),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(89,"button",24),e.\u0275\u0275pipe(90,"translate"),e.\u0275\u0275listener("cbOnSuccess",function(){return n.onEdgeInfoCopied("key")}),e.\u0275\u0275element(91,"mat-icon",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(92,"div",21)(93,"mat-form-field",22)(94,"mat-label",6),e.\u0275\u0275text(95,"edge.edge-secret"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(96,"input",25),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(97,"button",24),e.\u0275\u0275pipe(98,"translate"),e.\u0275\u0275listener("cbOnSuccess",function(){return n.onEdgeInfoCopied("secret")}),e.\u0275\u0275element(99,"mat-icon",5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(100,"fieldset",17),e.\u0275\u0275pipe(101,"async"),e.\u0275\u0275elementStart(102,"mat-form-field",13)(103,"mat-label",6),e.\u0275\u0275text(104,"edge.label"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(105,"input",26),e.\u0275\u0275template(106,y1,3,3,"mat-error",19),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(107,"div",27)(108,"mat-form-field",13)(109,"mat-label",6),e.\u0275\u0275text(110,"edge.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(111,"textarea",28),e.\u0275\u0275elementEnd()()()()()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",n.isEdit||n.isDetailsPage),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(2,80,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,82,"common.open-details-page")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||"tenant"!==n.edgeScope||n.isAssignedToCustomer(n.entity)||(null==n.entity?null:n.entity.customerIsPublic)),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(6,84,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(8,86,"edge.make-public")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||"tenant"!==n.edgeScope||n.isAssignedToCustomer(n.entity)),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(10,88,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(12,90,"edge.assign-to-customer")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||"customer"!==n.edgeScope&&"tenant"!==n.edgeScope||!n.isAssignedToCustomer(n.entity)),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(14,92,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,94,null!=n.entity&&n.entity.customerIsPublic?"edge.make-private":"edge.unassign-from-customer")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||"customer"===n.edgeScope),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(18,96,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(20,98,"edge.manage-assets")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||"customer"===n.edgeScope),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(22,100,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(24,102,"edge.manage-devices")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||"customer"===n.edgeScope),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(26,104,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(28,106,"edge.manage-entity-views")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||"customer"===n.edgeScope),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(30,108,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(32,110,"edge.manage-dashboards")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||"tenant"!==n.edgeScope),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(34,112,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(36,114,"edge.manage-rulechains")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.hideDelete()||n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(38,116,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(40,118,"edge.delete")," "),e.\u0275\u0275advance(3),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("cbContent",null==n.entity||null==n.entity.id?null:n.entity.id.id)("disabled",e.\u0275\u0275pipeBind1(43,120,n.isLoading$)),e.\u0275\u0275advance(5),e.\u0275\u0275classProp("!hidden",n.isEdit||"customer_user"===n.edgeScope),e.\u0275\u0275property("cbContent",null==n.entity?null:n.entity.routingKey)("disabled",e.\u0275\u0275pipeBind1(48,122,n.isLoading$)),e.\u0275\u0275advance(5),e.\u0275\u0275classProp("!hidden",n.isEdit||"customer_user"===n.edgeScope),e.\u0275\u0275property("cbContent",null==n.entity?null:n.entity.secret)("disabled",e.\u0275\u0275pipeBind1(53,124,n.isLoading$)),e.\u0275\u0275advance(5),e.\u0275\u0275classProp("!hidden",n.isEdit||"customer_user"===n.edgeScope),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(58,126,n.isLoading$)),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngSwitch",n.upgradeAvailable),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",!1),e.\u0275\u0275advance(),e.\u0275\u0275property("ngSwitchCase",!0),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||!n.isAssignedToCustomer(n.entity)||(null==n.entity?null:n.entity.customerIsPublic)||"tenant"!==n.edgeScope),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngModel",null==n.entity?null:n.entity.customerTitle),e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",n.isEdit||!(null!=n.entity&&n.entity.customerIsPublic)||"tenant"!==n.edgeScope),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(73,128,"edge.edge-public")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.entityForm),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(76,130,n.isLoading$)||!n.isEdit),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.entityForm.get("name").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("name").hasError("maxlength")),e.\u0275\u0275advance(),e.\u0275\u0275property("required",!0)("entityType",n.entityType.EDGE),e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden","customer_user"===n.edgeScope),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(90,132,"edge.copy-edge-key")),e.\u0275\u0275property("cbContent",null==n.entityForm?null:n.entityForm.get("routingKey").value),e.\u0275\u0275advance(3),e.\u0275\u0275classProp("!hidden","customer_user"===n.edgeScope),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(98,134,"edge.copy-edge-secret")),e.\u0275\u0275property("cbContent",null==n.entityForm?null:n.entityForm.get("secret").value),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(101,136,n.isLoading$)||!n.isEdit),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.entityForm.get("label").hasError("maxlength")))},dependencies:[p.NgIf,p.NgSwitch,p.NgSwitchCase,Ns.EntitySubTypeAutocompleteComponent,x.MatButton,x.MatIconButton,E.MatIcon,L.MatInput,v.MatFormField,v.MatLabel,v.MatError,_e.MatTooltip,we.Uo,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.NgModel,s.FormGroupDirective,s.FormControlName,s.FormGroupName,u.TranslateDirective,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";']})}}var As=d(90429);class ho extends Ne.M{constructor(t){super(t),this.store=t,this.entityType=f.ck}edgeTypeChanged(t){this.entitiesTableConfig.componentsData.edgeType=t,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}static{this.\u0275fac=function(i){return new(i||ho)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:ho,selectors:[["tb-edge-table-header"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:3,consts:[["subscriptSizing","dynamic",3,"ngModelChange","showLabel","entityType","ngModel"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"tb-entity-subtype-select",0),e.\u0275\u0275listener("ngModelChange",function(r){return n.edgeTypeChanged(r)}),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("showLabel",!0)("entityType",n.entityType.EDGE)("ngModel",n.entitiesTableConfig.componentsData.edgeType)},dependencies:[As.EntitySubTypeSelectComponent,s.NgControlStatus,s.NgModel],encapsulation:2})}}var v1=d(58512);function C1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,0),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-attribute-table",9),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"attribute.attributes")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function x1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-attribute-table",10),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"attribute.latest-telemetry")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function _1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,2),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-alarm-table",11),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,3,"alarm.alarms")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)}}function S1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,3),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-event-table",12),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"edge.events")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultEventType",n.eventTypes.ERROR)("active",i.isActive)("tenantId",n.entity.tenantId.id)("entityId",n.entity.id)}}function T1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,4),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-edge-downlink-table",11),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,3,"edge.downlinks")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)}}function I1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,5),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-relation-table",11),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,3,"relation.relations")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)}}function w1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,6),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-audit-log-table",13),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,4,"audit-log.audit-logs")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}class bo extends Ee.P{constructor(t){super(t),this.store=t}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(i){return new(i||bo)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:bo,selectors:[["tb-edge-tabs"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["downLinksTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","entityId"]],template:function(i,n){1&i&&e.\u0275\u0275template(0,C1,4,7,"mat-tab",7)(1,x1,4,7,"mat-tab",7)(2,_1,4,5,"mat-tab",7)(3,S1,4,7,"mat-tab",7)(4,T1,4,5,"mat-tab",7)(5,I1,4,5,"mat-tab",7)(6,w1,4,6,"mat-tab",7),2&i&&(e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity&&n.authUser.authority===n.authorities.TENANT_ADMIN),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity&&n.authUser.authority===n.authorities.TENANT_ADMIN))},dependencies:[p.NgIf,Q.MatTab,je.AuditLogTableComponent,xt.EventTableComponent,v1.EdgeDownlinkTableComponent,_t.RelationTableComponent,tt.AlarmTableComponent,nt.AttributeTableComponent,u.TranslatePipe],encapsulation:2})}}var rr=d(72358),E1=d(97068);function M1(a,t){1&a&&(e.\u0275\u0275element(0,"mat-icon",15),e.\u0275\u0275text(1," Ubuntu "))}function N1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",11)(1,"div",16),e.\u0275\u0275element(2,"tb-markdown",17),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("data",i.contentData.ubuntu)}}function A1(a,t){1&a&&(e.\u0275\u0275element(0,"mat-icon",18),e.\u0275\u0275text(1," CentOS/RHEL "))}function F1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",11)(1,"div",16),e.\u0275\u0275element(2,"tb-markdown",17),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("data",i.contentData.centos)}}function D1(a,t){1&a&&(e.\u0275\u0275element(0,"mat-icon",19),e.\u0275\u0275text(1," Docker "))}function P1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",11)(1,"div",16),e.\u0275\u0275element(2,"tb-markdown",17),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("data",i.contentData.docker)}}function k1(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"section",11)(1,"div",11)(2,"mat-tab-group",12),e.\u0275\u0275twoWayListener("selectedIndexChange",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275twoWayBindingSet(r.tabIndex,o)||(r.tabIndex=o),e.\u0275\u0275resetView(o)}),e.\u0275\u0275listener("selectedTabChange",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.selectedTabChange(o.tabIndex))}),e.\u0275\u0275elementStart(3,"mat-tab"),e.\u0275\u0275template(4,M1,2,0,"ng-template",13)(5,N1,3,1,"ng-template",14),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"mat-tab"),e.\u0275\u0275template(7,A1,2,0,"ng-template",13)(8,F1,3,1,"ng-template",14),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"mat-tab"),e.\u0275\u0275template(10,D1,2,0,"ng-template",13)(11,P1,3,1,"ng-template",14),e.\u0275\u0275elementEnd()()()()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275twoWayProperty("selectedIndex",i.tabIndex)}}function L1(a,t){1&a&&(e.\u0275\u0275elementStart(0,"div",20),e.\u0275\u0275element(1,"mat-spinner",21),e.\u0275\u0275elementStart(2,"span",22),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()),2&a&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,1,"edge.loading-edge-instructions")," "))}class yo extends se.m{constructor(t,i,n,o,r,l){super(t,i,o),this.store=t,this.router=i,this.data=n,this.dialogRef=o,this.attributeService=r,this.edgeService=l,this.loadedInstructions=!1,this.notShowAgain=!1,this.tabIndex=0,this.instructionsMethod=rr.sv,this.contentData={},this.data.afterAdd?(this.dialogTitle="edge.install-connect-instructions-edge-created",this.showDontShowAgain=!0):this.data.upgradeAvailable?(this.dialogTitle="edge.upgrade-instructions",this.showDontShowAgain=!1):(this.dialogTitle="edge.install-connect-instructions",this.showDontShowAgain=!1)}ngOnInit(){this.getInstructions(this.instructionsMethod[this.tabIndex])}ngOnDestroy(){super.ngOnDestroy()}close(){this.notShowAgain&&this.showDontShowAgain?(this.store.dispatch(new Ko.uX({notDisplayInstructionsAfterAddEdge:!0})),this.dialogRef.close(null)):this.dialogRef.close(null)}selectedTabChange(t){this.getInstructions(this.instructionsMethod[t])}getInstructions(t){if(!this.contentData[t]){let i;this.loadedInstructions=!1,i=this.data.upgradeAvailable?this.attributeService.getEntityAttributes(this.data.edge.id,zn.BY.SERVER_SCOPE,[rr.RJ]).pipe((0,Z.Z)(n=>{if(n.length){const o=n[0].value;return this.edgeService.getEdgeUpgradeInstructions(o,t)}})):this.edgeService.getEdgeInstallInstructions(this.data.edge.id.id,t),i.subscribe(n=>{this.contentData[t]=n.instructions,this.loadedInstructions=!0})}}static{this.\u0275fac=function(i){return new(i||yo)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(S.MAT_DIALOG_DATA),e.\u0275\u0275directiveInject(S.MatDialogRef),e.\u0275\u0275directiveInject(E1.e),e.\u0275\u0275directiveInject(Yt.p))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:yo,selectors:[["tb-edge-installation-dialog"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:20,vars:15,consts:[["loadingInstructions",""],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["mat-dialog-content",""],["class","tb-form-panel no-padding no-border",4,"ngIf","ngIfElse"],["mat-dialog-actions","",1,"tb-dialog-actions"],[3,"ngModelChange","ngModel"],["mat-button","",3,"click","disabled"],[1,"tb-form-panel","no-padding","no-border"],[3,"selectedIndexChange","selectedTabChange","selectedIndex"],["mat-tab-label",""],["matTabContent",""],["svgIcon","mdi:ubuntu",1,"tabs-icon"],[1,"tb-form-panel","no-padding","stroked"],[3,"data"],["svgIcon","mdi:centos",1,"tabs-icon"],["svgIcon","docker",1,"tabs-icon"],[1,"tb-loader"],["color","accent","diameter","65","strokeWidth","4"],[1,"mat-subtitle-1","label"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-toolbar",1)(1,"h2",2),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"span",3),e.\u0275\u0275elementStart(4,"button",4),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.close())}),e.\u0275\u0275elementStart(5,"mat-icon",5),e.\u0275\u0275text(6,"close"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(7,"div",6),e.\u0275\u0275template(8,k1,12,1,"section",7),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"div",8)(10,"mat-slide-toggle",9),e.\u0275\u0275twoWayListener("ngModelChange",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275twoWayBindingSet(n.notShowAgain,l)||(n.notShowAgain=l),e.\u0275\u0275resetView(l)}),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(13,"span",3),e.\u0275\u0275elementStart(14,"button",10),e.\u0275\u0275pipe(15,"async"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.close())}),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(18,L1,5,3,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)}if(2&i){const o=e.\u0275\u0275reference(19);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(n.dialogTitle),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.loadedInstructions)("ngIfElse",o),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",!n.showDontShowAgain),e.\u0275\u0275twoWayProperty("ngModel",n.notShowAgain),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,9,"action.dont-show-again")),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(15,11,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,13,"action.close"))}},dependencies:[p.NgIf,Ts.TbMarkdownComponent,x.MatButton,x.MatIconButton,E.MatIcon,ae.MatToolbar,S.MatDialogActions,S.MatDialogContent,$o.MatProgressSpinner,Q.MatTabContent,Q.MatTabLabel,Q.MatTab,Q.MatTabGroup,pe.MatSlideToggle,s.NgControlStatus,s.NgModel,u.TranslateDirective,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]{height:100%;max-height:100vh;display:grid;grid-template-rows:min-content minmax(auto,1fr) min-content}[_nghost-%COMP%]   .tb-loader[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;height:300px;max-height:100%}[_nghost-%COMP%]   .tb-loader[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-bottom:0;text-align:center}[_nghost-%COMP%]   .tb-font-14[_ngcontent-%COMP%]{font-size:14px}[_nghost-%COMP%]   .tb-flex-1[_ngcontent-%COMP%]{flex:1}@media screen and (min-width: 600px) and (max-width: 959px){[_nghost-%COMP%]{width:705px}}@media screen and (min-width: 960px){[_nghost-%COMP%]{width:1080px}}.mat-mdc-dialog-container[_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%]{display:flex;gap:8px;padding:8px 16px}.mat-mdc-dialog-container[_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{max-height:80vh;padding:0 16px 16px;border-top:16px solid #fff}[_nghost-%COMP%]     .tb-markdown-view{padding:16px 16px 32px}[_nghost-%COMP%]     .tb-markdown-view div{background-color:#f3f6fa}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn{right:-2px!important}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn p{color:#305680!important}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn p, [_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn div{background-color:unset!important}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn div img{display:none}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn div:after{content:"";position:initial;display:block;width:18px;height:18px;background:#305680;mask-image:url(/assets/copy-code-icon.svg);-webkit-mask-image:url(/assets/copy-code-icon.svg);mask-repeat:no-repeat;-webkit-mask-repeat:no-repeat}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn.multiline{right:-2px!important}[_nghost-%COMP%]     .tb-markdown-view>*:not(ul){padding-right:unset!important;padding-left:unset!important}[_nghost-%COMP%]     .tb-markdown-view pre[class*=language-]{border:1px solid #305680!important}[_nghost-%COMP%]     .mdc-button__label>span .mat-icon{vertical-align:text-bottom;box-sizing:initial}[_nghost-%COMP%]     .mat-mdc-tab-header{position:sticky;top:0;z-index:10;background-color:#fff}[_nghost-%COMP%]     .tabs-icon{margin-right:8px}[_nghost-%COMP%]     .tb-form-panel.tb-tab-body{padding:16px 0 0}[_nghost-%COMP%]     .mat-mdc-tab-body{padding:16px 0}']})}}var O1=d(83274);class ot{constructor(t,i,n,o,r,l,c,m,h,T){this.store=t,this.broadcast=i,this.edgeService=n,this.customerService=o,this.dialogService=r,this.homeDialogs=l,this.translate=c,this.datePipe=m,this.router=h,this.dialog=T,this.config=new y.M7,this.config.entityType=f.ck.EDGE,this.config.entityComponent=fo,this.config.entityTabsComponent=bo,this.config.entityTranslations=f.Mi.get(f.ck.EDGE),this.config.entityResources=f.BT.get(f.ck.EDGE),this.config.deleteEntityTitle=N=>this.translate.instant("edge.delete-edge-title",{edgeName:N.name}),this.config.deleteEntityContent=()=>this.translate.instant("edge.delete-edge-text"),this.config.deleteEntitiesTitle=N=>this.translate.instant("edge.delete-edges-title",{count:N}),this.config.deleteEntitiesContent=()=>this.translate.instant("edge.delete-edges-text"),this.config.loadEntity=N=>this.edgeService.getEdgeInfo(N.id),this.config.saveEntity=N=>this.edgeService.saveEdge(N).pipe((0,ne.M)(()=>{this.broadcast.broadcast("edgeSaved")}),(0,Z.Z)(O=>this.edgeService.getEdgeInfo(O.id.id))),this.config.onEntityAction=N=>this.onEdgeAction(N,this.config),this.config.detailsReadonly=()=>"customer_user"===this.config.componentsData.edgeScope,this.config.headerComponent=ho}resolve(t){const i=t.params;return this.config.componentsData={edgeScope:t.data.edgesType,edgeType:""},this.customerId=i.customerId,this.store.pipe((0,C.select)(q.SW),(0,Ve.s)(1)).pipe((0,ne.M)(n=>{n.authority===g.s.CUSTOMER_USER&&(this.config.componentsData.edgeScope="customer_user",this.customerId=n.customerId)}),(0,Z.Z)(()=>this.customerId?this.customerService.getCustomer(this.customerId):(0,H.of)(null)),(0,ie.T)(n=>(n?n.additionalInfo&&n.additionalInfo.isPublic?this.config.tableTitle=this.translate.instant("customer.public-edges"):this.config.tableTitle=n.title+": "+this.translate.instant("edge.edge-instances"):this.config.tableTitle=this.translate.instant("edge.edge-instances"),this.config.columns=this.configureColumns(this.config.componentsData.edgeScope),this.configureEntityFunctions(this.config.componentsData.edgeScope),this.config.cellActionDescriptors=this.configureCellActions(this.config.componentsData.edgeScope),this.config.groupActionDescriptors=this.configureGroupActions(this.config.componentsData.edgeScope),this.config.addActionDescriptors=this.configureAddActions(this.config.componentsData.edgeScope),this.config.addEnabled="customer_user"!==this.config.componentsData.edgeScope,this.config.entitiesDeleteEnabled="tenant"===this.config.componentsData.edgeScope,this.config.deleteEnabled=()=>"tenant"===this.config.componentsData.edgeScope,this.config.addEntity=()=>(this.addEdge(),(0,H.of)(null)),this.config)))}configureColumns(t){const i=[new y.Qr("createdTime","common.created-time",this.datePipe,"150px"),new y.KK("name","edge.name","25%"),new y.KK("type","edge.edge-type","25%"),new y.KK("label","edge.label","25%")];return"tenant"===t&&i.push(new y.KK("customerTitle","customer.customer","25%"),new y.KK("customerIsPublic","edge.public","60px",n=>(0,y.ov)(n.customerIsPublic),()=>({}),!1)),i}configureEntityFunctions(t){"tenant"===t&&(this.config.entitiesFetchFunction=i=>this.edgeService.getTenantEdgeInfos(i,this.config.componentsData.edgeType),this.config.deleteEntity=i=>this.edgeService.deleteEdge(i.id)),"customer"===t&&(this.config.entitiesFetchFunction=i=>this.edgeService.getCustomerEdgeInfos(this.customerId,i,this.config.componentsData.edgeType),this.config.deleteEntity=i=>this.edgeService.unassignEdgeFromCustomer(i.id)),"customer_user"===t&&(this.config.entitiesFetchFunction=i=>this.edgeService.getCustomerEdgeInfos(this.customerId,i,this.config.componentsData.edgeType),this.config.deleteEntity=i=>this.edgeService.unassignEdgeFromCustomer(i.id))}configureCellActions(t){const i=[];return"tenant"===t&&i.push({name:this.translate.instant("edge.make-public"),icon:"share",isEnabled:n=>!n.customerId||n.customerId.id===R.k,onAction:(n,o)=>this.makePublic(n,o)},{name:this.translate.instant("edge.assign-to-customer"),icon:"assignment_ind",isEnabled:n=>!n.customerId||n.customerId.id===R.k,onAction:(n,o)=>this.assignToCustomer(n,[o.id])},{name:this.translate.instant("edge.unassign-from-customer"),icon:"assignment_return",isEnabled:n=>n.customerId&&n.customerId.id!==R.k&&!n.customerIsPublic,onAction:(n,o)=>this.unassignFromCustomer(n,o)},{name:this.translate.instant("edge.make-private"),icon:"reply",isEnabled:n=>n.customerId&&n.customerId.id!==R.k&&n.customerIsPublic,onAction:(n,o)=>this.unassignFromCustomer(n,o)},{name:this.translate.instant("edge.manage-assets"),icon:"domain",isEnabled:n=>!0,onAction:(n,o)=>this.openEdgeEntitiesByType(n,o,f.ck.ASSET)},{name:this.translate.instant("edge.manage-devices"),icon:"devices_other",isEnabled:n=>!0,onAction:(n,o)=>this.openEdgeEntitiesByType(n,o,f.ck.DEVICE)},{name:this.translate.instant("edge.manage-entity-views"),icon:"view_quilt",isEnabled:n=>!0,onAction:(n,o)=>this.openEdgeEntitiesByType(n,o,f.ck.ENTITY_VIEW)},{name:this.translate.instant("edge.manage-dashboards"),icon:"dashboard",isEnabled:n=>!0,onAction:(n,o)=>this.openEdgeEntitiesByType(n,o,f.ck.DASHBOARD)},{name:this.translate.instant("edge.manage-rulechains"),icon:"settings_ethernet",isEnabled:n=>!0,onAction:(n,o)=>this.openEdgeEntitiesByType(n,o,f.ck.RULE_CHAIN)}),"customer"===t&&i.push({name:this.translate.instant("edge.unassign-from-customer"),icon:"assignment_return",isEnabled:n=>n.customerId&&n.customerId.id!==R.k&&!n.customerIsPublic,onAction:(n,o)=>this.unassignFromCustomer(n,o)},{name:this.translate.instant("edge.make-private"),icon:"reply",isEnabled:n=>n.customerId&&n.customerId.id!==R.k&&n.customerIsPublic,onAction:(n,o)=>this.unassignFromCustomer(n,o)}),"customer_user"===t&&i.push({name:this.translate.instant("edge.manage-assets"),icon:"domain",isEnabled:n=>!0,onAction:(n,o)=>this.openEdgeEntitiesByType(n,o,f.ck.ASSET)},{name:this.translate.instant("edge.manage-devices"),icon:"devices_other",isEnabled:n=>!0,onAction:(n,o)=>this.openEdgeEntitiesByType(n,o,f.ck.DEVICE)},{name:this.translate.instant("edge.manage-entity-views"),icon:"view_quilt",isEnabled:n=>!0,onAction:(n,o)=>this.openEdgeEntitiesByType(n,o,f.ck.ENTITY_VIEW)},{name:this.translate.instant("edge.manage-dashboards"),icon:"dashboard",isEnabled:n=>!0,onAction:(n,o)=>this.openEdgeEntitiesByType(n,o,f.ck.DASHBOARD)}),i}configureGroupActions(t){const i=[];return"tenant"===t&&i.push({name:this.translate.instant("edge.assign-edge-to-customer-text"),icon:"assignment_ind",isEnabled:!0,onAction:(n,o)=>this.assignToCustomer(n,o.map(r=>r.id))}),"customer"===t&&i.push({name:this.translate.instant("edge.unassign-from-customer"),icon:"assignment_return",isEnabled:!0,onAction:(n,o)=>this.unassignEdgesFromCustomer(n,o)}),i}configureAddActions(t){const i=[];return"tenant"===t&&i.push({name:this.translate.instant("edge.add-edge-text"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:n=>this.config.getTable().addEntity(n)},{name:this.translate.instant("edge.import"),icon:"file_upload",isEnabled:()=>!0,onAction:n=>this.importEdges(n)}),"customer"===t&&i.push({name:this.translate.instant("edge.assign-new-edge"),icon:"add",isEnabled:()=>!0,onAction:n=>this.addEdgesToCustomer(n)}),i}importEdges(t){this.homeDialogs.importEntities(f.ck.EDGE).subscribe(i=>{i&&(this.broadcast.broadcast("edgeSaved"),this.config.updateData())})}addEdgesToCustomer(t){t&&t.stopPropagation(),this.dialog.open(nr.j,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{customerId:this.customerId,entityType:f.ck.EDGE}}).afterClosed().subscribe(i=>{i&&this.config.updateData()})}openEdge(t,i,n){t&&t.stopPropagation();const o=this.router.createUrlTree([i.id.id],{relativeTo:n.getActivatedRoute()});this.router.navigateByUrl(o)}makePublic(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("edge.make-public-edge-title",{edgeName:i.name}),this.translate.instant("edge.make-public-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{n&&this.edgeService.makeEdgePublic(i.id.id).subscribe(()=>{this.config.updateData()})})}openEdgeEntitiesByType(t,i,n){let o;switch(t&&t.stopPropagation(),n){case f.ck.DEVICE:o="devices";break;case f.ck.ASSET:case f.ck.EDGE:o="assets";break;case f.ck.ENTITY_VIEW:o="entityViews";break;case f.ck.DASHBOARD:o="dashboards";break;case f.ck.RULE_CHAIN:o="ruleChains"}this.router.navigateByUrl(`edgeManagement/instances/${i.id.id}/${o}`)}assignToCustomer(t,i){t&&t.stopPropagation(),this.dialog.open(tr.i,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entityIds:i,entityType:f.ck.EDGE}}).afterClosed().subscribe(n=>{n&&this.config.updateData()})}unassignFromCustomer(t,i){t&&t.stopPropagation();let o,r;i.customerIsPublic?(o=this.translate.instant("edge.make-private-edge-title",{edgeName:i.name}),r=this.translate.instant("edge.make-private-edge-text")):(o=this.translate.instant("edge.unassign-edge-title",{edgeName:i.name}),r=this.translate.instant("edge.unassign-edge-text")),this.dialogService.confirm(o,r,this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(l=>{l&&this.edgeService.unassignEdgeFromCustomer(i.id.id).subscribe(()=>{this.config.updateData("tenant"!==this.config.componentsData.edgeScope)})})}unassignEdgesFromCustomer(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("edge.unassign-edges-title",{count:i.length}),this.translate.instant("edge.unassign-edges-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{if(n){const o=[];i.forEach(r=>{o.push(this.edgeService.unassignEdgeFromCustomer(r.id.id))}),(0,Se.p)(o).subscribe(()=>{this.config.updateData()})}})}syncEdge(t,i){t&&t.stopPropagation(),this.edgeService.syncEdge(i.id.id).subscribe(()=>{this.store.dispatch(new $.xo({message:this.translate.instant("edge.sync-process-started-successfully"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))})}addEdge(){this.dialog.open(O1.AddEntityDialogComponent,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entitiesTableConfig:this.config}}).afterClosed().subscribe(t=>{t&&this.store.pipe((0,C.select)((0,q.O7)("notDisplayInstructionsAfterAddEdge"))).pipe((0,Ve.s)(1)).subscribe(i=>{i?(this.config.updateData(),this.config.entityAdded(t)):this.openInstructions(null,t,!0)})})}openInstructions(t,i,n=!1,o=!1){t&&t.stopPropagation(),this.dialog.open(yo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edge:i,afterAdd:n,upgradeAvailable:o}}).afterClosed().subscribe(()=>{n&&this.config.updateData()})}onEdgeAction(t,i){switch(t.action){case"open":return this.openEdge(t.event,t.entity,i),!0;case"makePublic":return this.makePublic(t.event,t.entity),!0;case"assignToCustomer":return this.assignToCustomer(t.event,[t.entity.id]),!0;case"unassignFromCustomer":return this.unassignFromCustomer(t.event,t.entity),!0;case"openEdgeAssets":return this.openEdgeEntitiesByType(t.event,t.entity,f.ck.ASSET),!0;case"openEdgeDevices":return this.openEdgeEntitiesByType(t.event,t.entity,f.ck.DEVICE),!0;case"openEdgeEntityViews":return this.openEdgeEntitiesByType(t.event,t.entity,f.ck.ENTITY_VIEW),!0;case"openEdgeDashboards":return this.openEdgeEntitiesByType(t.event,t.entity,f.ck.DASHBOARD),!0;case"openEdgeRuleChains":return this.openEdgeEntitiesByType(t.event,t.entity,f.ck.RULE_CHAIN),!0;case"syncEdge":return this.syncEdge(t.event,t.entity),!0;case"openInstallInstructions":return this.openInstructions(t.event,t.entity),!0;case"openUpgradeInstructions":return this.openInstructions(t.event,t.entity,!1,!0),!0}}static{this.\u0275fac=function(i){return new(i||ot)(e.\u0275\u0275inject(C.Store),e.\u0275\u0275inject(ca.D),e.\u0275\u0275inject(Yt.p),e.\u0275\u0275inject(Dt.m),e.\u0275\u0275inject(Ce.o),e.\u0275\u0275inject(mt.k),e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(p.DatePipe),e.\u0275\u0275inject(b.Router),e.\u0275\u0275inject(S.MatDialog))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:ot,factory:ot.\u0275fac})}}const R1=[{path:"customers",data:{breadcrumb:{menuId:F.D8.customers}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN],title:"customer.customers"},resolve:{entitiesTableConfig:$t}},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"supervisor_account"},auth:[g.s.TENANT_ADMIN],title:"customer.customers"},resolve:{entitiesTableConfig:$t}},{path:":customerId/users",data:{breadcrumb:{label:"user.customer-users",icon:"account_circle"}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN],title:"user.customer-users"},resolve:{entitiesTableConfig:qe}},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"account_circle"},auth:[g.s.TENANT_ADMIN],title:"user.customer-users"},resolve:{entitiesTableConfig:qe}}]},{path:":customerId/devices",data:{breadcrumb:{label:"customer.devices",icon:"devices_other"}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN],title:"customer.devices",devicesType:"customer"},resolve:{entitiesTableConfig:Le}},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"devices_other"},auth:[g.s.TENANT_ADMIN],title:"customer.devices",devicesType:"customer"},resolve:{entitiesTableConfig:Le}}]},{path:":customerId/assets",data:{breadcrumb:{label:"customer.assets",icon:"domain"}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN],title:"customer.assets",assetsType:"customer"},resolve:{entitiesTableConfig:Oe}},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"domain"},auth:[g.s.TENANT_ADMIN],title:"customer.assets",assetsType:"customer"},resolve:{entitiesTableConfig:Oe}}]},{path:":customerId/edgeInstances",data:{breadcrumb:{label:"customer.edges",icon:"router"}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN],title:"customer.edges",edgesType:"customer"},resolve:{entitiesTableConfig:ot}},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"router"},auth:[g.s.TENANT_ADMIN],title:"customer.edges",edgesType:"customer"},resolve:{entitiesTableConfig:ot}}]},{path:":customerId/dashboards",data:{breadcrumb:{label:"customer.dashboards",icon:"dashboard"}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN],title:"customer.dashboards",dashboardsType:"customer"},resolve:{entitiesTableConfig:Ms.S}},{path:":dashboardId",component:Er.DashboardPageComponent,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:Kn.QU,icon:"dashboard"},auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"customer.dashboard",widgetEditMode:!1},resolve:{dashboard:Kn.Pj}}]}]}];class Yn{static{this.\u0275fac=function(i){return new(i||Yn)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Yn})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[$t],imports:[b.RouterModule.forChild(R1),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Yn,{imports:[b.RouterModule],exports:[b.RouterModule]});class Qn{static{this.\u0275fac=function(i){return new(i||Qn)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Qn})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,k.I,Yn]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Qn,{declarations:[oo,ro],imports:[p.CommonModule,w.G,k.I,Yn]});class Jn{static{this.\u0275fac=function(i){return new(i||Jn)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Jn})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,gn]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Jn,{imports:[p.CommonModule,w.G,gn]});const V1=[{path:"users",data:{breadcrumb:{skip:!0}},children:[{path:"",redirectTo:"/",pathMatch:"full"},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"account_circle"},auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN],title:"user.user"},resolve:{entitiesTableConfig:qe}}]}];class Zn{static{this.\u0275fac=function(i){return new(i||Zn)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Zn})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[qe],imports:[b.RouterModule.forChild(V1),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Zn,{imports:[b.RouterModule],exports:[b.RouterModule]});class Xn{static{this.\u0275fac=function(i){return new(i||Xn)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Xn})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,k.I,Zn]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Xn,{declarations:[Wt,ao,io,On],imports:[p.CommonModule,w.G,k.I,Zn]});const B1=[{path:"devices",data:{breadcrumb:{menuId:F.D8.devices}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"device.devices",devicesType:"tenant"},resolve:{entitiesTableConfig:Le}},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"devices_other"},auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"device.devices",devicesType:"tenant"},resolve:{entitiesTableConfig:Le}}]}],G1=[{path:"devices",pathMatch:"full",redirectTo:"/entities/devices"},{path:"devices/:entityId",redirectTo:"/entities/devices/:entityId"}];class ei{static{this.\u0275fac=function(i){return new(i||ei)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:ei})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[Le],imports:[b.RouterModule.forChild(G1),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(ei,{imports:[b.RouterModule],exports:[b.RouterModule]});var Fe=d(52627),Fs=d(15003),Ds=d(59780);class ti{static{this.\u0275fac=function(i){return new(i||ti)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:ti})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,k.I,Fe.L,Fs.R,Ds.N,ei]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(ti,{declarations:[Bn,Gn,jn,Un,qn,Wn,zt,Ht,Kt,so,co,lo,$n,po],imports:[p.CommonModule,w.G,k.I,Fe.L,Fs.R,Ds.N,ei]});const j1=[{path:"assets",data:{breadcrumb:{menuId:F.D8.assets}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"asset.assets",assetsType:"tenant"},resolve:{entitiesTableConfig:Oe}},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"domain"},auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"asset.assets",assetsType:"tenant"},resolve:{entitiesTableConfig:Oe}}]}],U1=[{path:"assets",pathMatch:"full",redirectTo:"/entities/assets"},{path:"assets/:entityId",redirectTo:"/entities/assets/:entityId"}];class ni{static{this.\u0275fac=function(i){return new(i||ni)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:ni})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[Oe],imports:[b.RouterModule.forChild(U1),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(ni,{imports:[b.RouterModule],exports:[b.RouterModule]});class ii{static{this.\u0275fac=function(i){return new(i||ii)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:ii})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,k.I,Fe.L,ni]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(ii,{declarations:[mo,go,uo],imports:[p.CommonModule,w.G,k.I,Fe.L,ni]});var q1=d(51485),W1=d(12120),$1=d(57451);function z1(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"entity-view.name-required")," "))}function H1(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"entity-view.name-max-length")," "))}class vo extends xe.l{constructor(t,i,n,o,r,l){super(t,r,n,o,l),this.store=t,this.translate=i,this.entityValue=n,this.entitiesTableConfigValue=o,this.fb=r,this.cd=l,this.entityType=f.ck,this.dataKeyType=zn.yw,this.allowedEntityTypes=[f.ck.DEVICE,f.ck.ASSET]}ngOnInit(){this.entityViewScope=this.entitiesTableConfig.componentsData.entityViewScope,super.ngOnInit(),this.maxStartTimeMs=this.entityForm.get("endTimeMs").valueChanges,this.minEndTimeMs=this.entityForm.get("startTimeMs").valueChanges,this.selectedEntityId=this.entityForm.get("entityId").valueChanges}hideDelete(){return!!this.entitiesTableConfig&&!this.entitiesTableConfig.deleteEnabled(this.entity)}isAssignedToCustomer(t){return t&&t.customerId&&t.customerId.id!==R.k}buildForm(t){return this.fb.group({name:[t?t.name:"",[s.Validators.required,s.Validators.maxLength(255)]],type:[t?t.type:null,s.Validators.required],entityId:[t?t.entityId:null,[s.Validators.required]],startTimeMs:[t?t.startTimeMs:null],endTimeMs:[t?t.endTimeMs:null],keys:this.fb.group({attributes:this.fb.group({cs:[t&&t.keys&&t.keys.attributes?t.keys.attributes.cs:null],sh:[t&&t.keys&&t.keys.attributes?t.keys.attributes.sh:null],ss:[t&&t.keys&&t.keys.attributes?t.keys.attributes.ss:null]}),timeseries:[t&&t.keys&&t.keys.timeseries?t.keys.timeseries:null]}),additionalInfo:this.fb.group({description:[t&&t.additionalInfo?t.additionalInfo.description:""]})})}updateForm(t){this.entityForm.patchValue({name:t.name}),this.entityForm.patchValue({type:t.type}),this.entityForm.patchValue({entityId:t.entityId}),this.entityForm.patchValue({startTimeMs:t.startTimeMs}),this.entityForm.patchValue({endTimeMs:t.endTimeMs}),this.entityForm.patchValue({keys:{attributes:{cs:t.keys&&t.keys.attributes?t.keys.attributes.cs:null,sh:t.keys&&t.keys.attributes?t.keys.attributes.sh:null,ss:t.keys&&t.keys.attributes?t.keys.attributes.ss:null},timeseries:t.keys&&t.keys.timeseries?t.keys.timeseries:null}}),this.entityForm.patchValue({additionalInfo:{description:t.additionalInfo?t.additionalInfo.description:""}})}onEntityViewIdCopied(t){this.store.dispatch(new $.xo({message:this.translate.instant("entity-view.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}static{this.\u0275fac=function(i){return new(i||vo)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject("entity"),e.\u0275\u0275directiveInject("entitiesTableConfig"),e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(e.ChangeDetectorRef))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:vo,selectors:[["tb-entity-view"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:93,vars:94,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[1,"mat-block"],["matInput","","disabled","",3,"ngModel"],[1,"tb-small",2,"padding-bottom","10px","padding-left","2px"],[3,"formGroup"],[3,"disabled"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","type",3,"required","entityType"],[1,"flex","flex-col"],["translate","",1,"tb-title","no-padding"],["formControlName","entityId",1,"flex-1",3,"required","allowedEntityTypes"],["formGroupName","keys",1,"mat-accordion-container"],[3,"multi"],["formGroupName","attributes",3,"expanded"],["translate","",1,"tb-panel-title"],["translate","",1,"tb-hint"],["formControlName","cs","keysText","entity-view.client-attributes-placeholder",3,"entityId","dataKeyType"],["formControlName","sh","keysText","entity-view.shared-attributes-placeholder",3,"entityId","dataKeyType"],["formControlName","ss","keysText","entity-view.server-attributes-placeholder",3,"entityId","dataKeyType"],[3,"expanded"],["formControlName","timeseries","keysText","entity-view.timeseries-placeholder",3,"entityId","dataKeyType"],["dateText","entity-view.start-date","timeText","entity-view.start-ts","formControlName","startTimeMs",3,"maxDate"],["dateText","entity-view.end-date","timeText","entity-view.end-ts","formControlName","endTimeMs",3,"minDate"],["formGroupName","additionalInfo"],["matInput","","formControlName","description","rows","2"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"button",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"open")}),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",1),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"makePublic")}),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"button",1),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"assignToCustomer")}),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"button",1),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"unassignFromCustomer")}),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"button",1),e.\u0275\u0275pipe(18,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"unassignFromEdge")}),e.\u0275\u0275text(19),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"button",1),e.\u0275\u0275pipe(22,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"delete")}),e.\u0275\u0275text(23),e.\u0275\u0275pipe(24,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(25,"div",2)(26,"button",3),e.\u0275\u0275listener("cbOnSuccess",function(r){return n.onEntityViewIdCopied(r)}),e.\u0275\u0275element(27,"mat-icon",4),e.\u0275\u0275elementStart(28,"span",5),e.\u0275\u0275text(29,"entity-view.copyId"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(30,"div",6)(31,"mat-form-field",7)(32,"mat-label",5),e.\u0275\u0275text(33,"entity-view.assignedToCustomer"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(34,"input",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(35,"div",9),e.\u0275\u0275text(36),e.\u0275\u0275pipe(37,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(38,"form",10)(39,"fieldset",11),e.\u0275\u0275pipe(40,"async"),e.\u0275\u0275elementStart(41,"mat-form-field",7)(42,"mat-label",5),e.\u0275\u0275text(43,"entity-view.name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(44,"input",12),e.\u0275\u0275template(45,z1,3,3,"mat-error",13)(46,H1,3,3,"mat-error",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(47,"tb-entity-subtype-autocomplete",14),e.\u0275\u0275elementStart(48,"section",15)(49,"label",16),e.\u0275\u0275text(50,"entity-view.target-entity"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(51,"tb-entity-select",17),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(52,"div",18)(53,"mat-accordion",19)(54,"mat-expansion-panel",20)(55,"mat-expansion-panel-header")(56,"mat-panel-title")(57,"div",21),e.\u0275\u0275text(58,"entity-view.attributes-propagation"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(59,"div",22),e.\u0275\u0275text(60,"entity-view.attributes-propagation-hint"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(61,"label",16),e.\u0275\u0275text(62,"entity-view.client-attributes"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(63,"tb-entity-keys-list",23),e.\u0275\u0275pipe(64,"async"),e.\u0275\u0275elementStart(65,"label",16),e.\u0275\u0275text(66,"entity-view.shared-attributes"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(67,"tb-entity-keys-list",24),e.\u0275\u0275pipe(68,"async"),e.\u0275\u0275elementStart(69,"label",16),e.\u0275\u0275text(70,"entity-view.server-attributes"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(71,"tb-entity-keys-list",25),e.\u0275\u0275pipe(72,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(73,"mat-expansion-panel",26)(74,"mat-expansion-panel-header")(75,"mat-panel-title")(76,"div",21),e.\u0275\u0275text(77,"entity-view.timeseries-data"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(78,"div",22),e.\u0275\u0275text(79,"entity-view.timeseries-data-hint"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(80,"label",16),e.\u0275\u0275text(81,"entity-view.timeseries"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(82,"tb-entity-keys-list",27),e.\u0275\u0275pipe(83,"async"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(84,"tb-datetime",28),e.\u0275\u0275pipe(85,"async"),e.\u0275\u0275element(86,"tb-datetime",29),e.\u0275\u0275pipe(87,"async"),e.\u0275\u0275elementStart(88,"div",30)(89,"mat-form-field",7)(90,"mat-label",5),e.\u0275\u0275text(91,"entity-view.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(92,"textarea",31),e.\u0275\u0275elementEnd()()()()()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",n.isEdit||n.isDetailsPage),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(2,54,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,56,"common.open-details-page")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||"tenant"!==n.entityViewScope||n.isAssignedToCustomer(n.entity)||(null==n.entity?null:n.entity.customerIsPublic)),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(6,58,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(8,60,"entity-view.make-public")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||"tenant"!==n.entityViewScope||n.isAssignedToCustomer(n.entity)),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(10,62,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(12,64,"entity-view.assign-to-customer")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||"customer"!==n.entityViewScope&&"tenant"!==n.entityViewScope||!n.isAssignedToCustomer(n.entity)),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(14,66,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,68,null!=n.entity&&n.entity.customerIsPublic?"entity-view.make-private":"entity-view.unassign-from-customer")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||"edge"!==n.entityViewScope),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(18,70,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(20,72,"edge.unassign-from-edge")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.hideDelete()||n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(22,74,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(24,76,"entity-view.delete")," "),e.\u0275\u0275advance(3),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("cbContent",null==n.entity||null==n.entity.id?null:n.entity.id.id),e.\u0275\u0275advance(5),e.\u0275\u0275classProp("!hidden",n.isEdit||!n.isAssignedToCustomer(n.entity)||(null==n.entity?null:n.entity.customerIsPublic)||"tenant"!==n.entityViewScope),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngModel",null==n.entity?null:n.entity.customerTitle),e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",n.isEdit||!(null!=n.entity&&n.entity.customerIsPublic)||"customer"!==n.entityViewScope&&"tenant"!==n.entityViewScope),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(37,78,"entity-view.entity-view-public")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.entityForm),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(40,80,n.isLoading$)||!n.isEdit),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.entityForm.get("name").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("name").hasError("maxlength")),e.\u0275\u0275advance(),e.\u0275\u0275property("required",!0)("entityType",n.entityType.ENTITY_VIEW),e.\u0275\u0275advance(4),e.\u0275\u0275property("required",!0)("allowedEntityTypes",n.allowedEntityTypes),e.\u0275\u0275advance(2),e.\u0275\u0275property("multi",!0),e.\u0275\u0275advance(),e.\u0275\u0275property("expanded",!0),e.\u0275\u0275advance(9),e.\u0275\u0275property("entityId",e.\u0275\u0275pipeBind1(64,82,n.selectedEntityId))("dataKeyType",n.dataKeyType.attribute),e.\u0275\u0275advance(4),e.\u0275\u0275property("entityId",e.\u0275\u0275pipeBind1(68,84,n.selectedEntityId))("dataKeyType",n.dataKeyType.attribute),e.\u0275\u0275advance(4),e.\u0275\u0275property("entityId",e.\u0275\u0275pipeBind1(72,86,n.selectedEntityId))("dataKeyType",n.dataKeyType.attribute),e.\u0275\u0275advance(2),e.\u0275\u0275property("expanded",!0),e.\u0275\u0275advance(9),e.\u0275\u0275property("entityId",e.\u0275\u0275pipeBind1(83,88,n.selectedEntityId))("dataKeyType",n.dataKeyType.timeseries),e.\u0275\u0275advance(2),e.\u0275\u0275property("maxDate",e.\u0275\u0275pipeBind1(85,90,n.maxStartTimeMs)),e.\u0275\u0275advance(2),e.\u0275\u0275property("minDate",e.\u0275\u0275pipeBind1(87,92,n.minEndTimeMs)))},dependencies:[p.NgIf,q1.DatetimeComponent,Ns.EntitySubTypeAutocompleteComponent,W1.EntitySelectComponent,$1.EntityKeysListComponent,x.MatButton,E.MatIcon,L.MatInput,v.MatFormField,v.MatLabel,v.MatError,U.MatAccordion,U.MatExpansionPanel,U.MatExpansionPanelHeader,U.MatExpansionPanelTitle,we.Uo,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.NgModel,s.FormGroupDirective,s.FormControlName,s.FormGroupName,u.TranslateDirective,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-accordion-container[_ngcontent-%COMP%]{margin-bottom:16px}']})}}class Co extends Ne.M{constructor(t){super(t),this.store=t,this.entityType=f.ck}entityViewTypeChanged(t){this.entitiesTableConfig.componentsData.entityViewType=t,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}static{this.\u0275fac=function(i){return new(i||Co)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Co,selectors:[["tb-entity-view-table-header"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:3,consts:[["subscriptSizing","dynamic",3,"ngModelChange","showLabel","entityType","ngModel"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"tb-entity-subtype-select",0),e.\u0275\u0275listener("ngModelChange",function(r){return n.entityViewTypeChanged(r)}),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("showLabel",!0)("entityType",n.entityType.ENTITY_VIEW)("ngModel",n.entitiesTableConfig.componentsData.entityViewType)},dependencies:[As.EntitySubTypeSelectComponent,s.NgControlStatus,s.NgModel],encapsulation:2})}}var K1=d(80727);function Y1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,0),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-attribute-table",9),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"attribute.attributes")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultAttributeScope",n.attributeScopes.CLIENT_SCOPE)("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function Q1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-attribute-table",10),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"attribute.latest-telemetry")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function J1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,2),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-alarm-table",11),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,3,"alarm.alarms")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)}}function Z1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,3),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-event-table",12),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"entity-view.events")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultEventType",n.eventTypes.ERROR)("active",i.isActive)("tenantId",n.entity.tenantId.id)("entityId",n.entity.id)}}function X1(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,4),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-relation-table",11),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,3,"relation.relations")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)}}function eC(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,5),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-audit-log-table",13),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,4,"audit-log.audit-logs")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}function tC(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-tab",8,6),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementStart(3,"tb-version-control",14),e.\u0275\u0275listener("versionRestored",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.entitiesTableConfig.updateData())}),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"version-control.version-control")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}class xo extends Ee.P{constructor(t){super(t),this.store=t}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(i){return new(i||xo)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:xo,selectors:[["tb-entity-view-tabs"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(i,n){1&i&&e.\u0275\u0275template(0,Y1,4,7,"mat-tab",7)(1,Q1,4,7,"mat-tab",7)(2,J1,4,5,"mat-tab",7)(3,Z1,4,7,"mat-tab",7)(4,X1,4,5,"mat-tab",7)(5,eC,4,6,"mat-tab",7)(6,tC,4,7,"mat-tab",7),2&i&&(e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity&&n.authUser.authority===n.authorities.TENANT_ADMIN),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity&&n.authUser.authority===n.authorities.TENANT_ADMIN))},dependencies:[p.NgIf,Q.MatTab,je.AuditLogTableComponent,xt.EventTableComponent,_t.RelationTableComponent,tt.AlarmTableComponent,nt.AttributeTableComponent,ke.d,u.TranslatePipe],encapsulation:2})}}class rt{constructor(t,i,n,o,r,l,c,m,h,T){this.store=t,this.broadcast=i,this.entityViewService=n,this.customerService=o,this.edgeService=r,this.dialogService=l,this.translate=c,this.datePipe=m,this.router=h,this.dialog=T,this.config=new y.M7,this.config.entityType=f.ck.ENTITY_VIEW,this.config.entityComponent=vo,this.config.entityTabsComponent=xo,this.config.entityTranslations=f.Mi.get(f.ck.ENTITY_VIEW),this.config.entityResources=f.BT.get(f.ck.ENTITY_VIEW),this.config.addDialogStyle={maxWidth:"800px"},this.config.deleteEntityTitle=N=>this.translate.instant("entity-view.delete-entity-view-title",{entityViewName:N.name}),this.config.deleteEntityContent=()=>this.translate.instant("entity-view.delete-entity-view-text"),this.config.deleteEntitiesTitle=N=>this.translate.instant("entity-view.delete-entity-views-title",{count:N}),this.config.deleteEntitiesContent=()=>this.translate.instant("entity-view.delete-entity-views-text"),this.config.loadEntity=N=>this.entityViewService.getEntityViewInfo(N.id),this.config.saveEntity=N=>this.entityViewService.saveEntityView(N).pipe((0,ne.M)(()=>{this.broadcast.broadcast("entityViewSaved")}),(0,Z.Z)(O=>this.entityViewService.getEntityViewInfo(O.id.id))),this.config.onEntityAction=N=>this.onEntityViewAction(N,this.config),this.config.detailsReadonly=()=>"customer_user"===this.config.componentsData.entityViewScope||"edge_customer_user"===this.config.componentsData.entityViewScope,this.config.headerComponent=Co}resolve(t){const i=t.params;return this.config.componentsData={entityViewScope:t.data.entityViewsType,entityViewType:"",edgeId:i.edgeId},this.customerId=i.customerId,this.store.pipe((0,C.select)(q.SW),(0,Ve.s)(1)).pipe((0,ne.M)(n=>{n.authority===g.s.CUSTOMER_USER&&("edge"===t.data.entityViewsType?this.config.componentsData.entityViewScope="edge_customer_user":this.config.componentsData.entityViewScope="customer_user",this.customerId=n.customerId)}),(0,Z.Z)(()=>this.customerId?this.customerService.getCustomer(this.customerId):(0,H.of)(null)),(0,ie.T)(n=>(n?n.additionalInfo&&n.additionalInfo.isPublic?this.config.tableTitle=this.translate.instant("customer.public-entity-views"):this.config.tableTitle=n.title+": "+this.translate.instant("entity-view.entity-views"):"edge"===this.config.componentsData.entityViewScope?this.edgeService.getEdge(this.config.componentsData.edgeId).subscribe(o=>this.config.tableTitle=o.name+": "+this.translate.instant("entity-view.entity-views")):this.config.tableTitle=this.translate.instant("entity-view.entity-views"),this.config.columns=this.configureColumns(this.config.componentsData.entityViewScope),this.configureEntityFunctions(this.config.componentsData.entityViewScope),this.config.cellActionDescriptors=this.configureCellActions(this.config.componentsData.entityViewScope),this.config.groupActionDescriptors=this.configureGroupActions(this.config.componentsData.entityViewScope),this.config.addActionDescriptors=this.configureAddActions(this.config.componentsData.entityViewScope),this.config.addEnabled=!("customer_user"===this.config.componentsData.entityViewScope||"edge_customer_user"===this.config.componentsData.entityViewScope),this.config.entitiesDeleteEnabled="tenant"===this.config.componentsData.entityViewScope,this.config.deleteEnabled=()=>"tenant"===this.config.componentsData.entityViewScope,this.config)))}configureColumns(t){const i=[new y.Qr("createdTime","common.created-time",this.datePipe,"150px"),new y.KK("name","entity-view.name","33%"),new y.KK("type","entity-view.entity-view-type","33%")];return"tenant"===t&&i.push(new y.KK("customerTitle","customer.customer","33%"),new y.KK("customerIsPublic","entity-view.public","60px",n=>(0,y.ov)(n.customerIsPublic),()=>({}),!1)),i}configureEntityFunctions(t){"tenant"===t?(this.config.entitiesFetchFunction=i=>this.entityViewService.getTenantEntityViewInfos(i,this.config.componentsData.entityViewType),this.config.deleteEntity=i=>this.entityViewService.deleteEntityView(i.id)):"edge"===t||"edge_customer_user"===t?this.config.entitiesFetchFunction=i=>this.entityViewService.getEdgeEntityViews(this.config.componentsData.edgeId,i,this.config.componentsData.entityViewType):(this.config.entitiesFetchFunction=i=>this.entityViewService.getCustomerEntityViewInfos(this.customerId,i,this.config.componentsData.entityViewType),this.config.deleteEntity=i=>this.entityViewService.unassignEntityViewFromCustomer(i.id))}configureCellActions(t){const i=[];return"tenant"===t&&i.push({name:this.translate.instant("entity-view.make-public"),icon:"share",isEnabled:n=>!n.customerId||n.customerId.id===R.k,onAction:(n,o)=>this.makePublic(n,o)},{name:this.translate.instant("entity-view.assign-to-customer"),icon:"assignment_ind",isEnabled:n=>!n.customerId||n.customerId.id===R.k,onAction:(n,o)=>this.assignToCustomer(n,[o.id])},{name:this.translate.instant("entity-view.unassign-from-customer"),icon:"assignment_return",isEnabled:n=>n.customerId&&n.customerId.id!==R.k&&!n.customerIsPublic,onAction:(n,o)=>this.unassignFromCustomer(n,o)},{name:this.translate.instant("entity-view.make-private"),icon:"reply",isEnabled:n=>n.customerId&&n.customerId.id!==R.k&&n.customerIsPublic,onAction:(n,o)=>this.unassignFromCustomer(n,o)}),"customer"===t&&i.push({name:this.translate.instant("entity-view.unassign-from-customer"),icon:"assignment_return",isEnabled:n=>n.customerId&&n.customerId.id!==R.k&&!n.customerIsPublic,onAction:(n,o)=>this.unassignFromCustomer(n,o)},{name:this.translate.instant("entity-view.make-private"),icon:"reply",isEnabled:n=>n.customerId&&n.customerId.id!==R.k&&n.customerIsPublic,onAction:(n,o)=>this.unassignFromCustomer(n,o)}),"edge"===t&&i.push({name:this.translate.instant("edge.unassign-from-edge"),icon:"assignment_return",isEnabled:()=>!0,onAction:(n,o)=>this.unassignFromEdge(n,o)}),i}configureGroupActions(t){const i=[];return"tenant"===t&&i.push({name:this.translate.instant("entity-view.assign-entity-views"),icon:"assignment_ind",isEnabled:!0,onAction:(n,o)=>this.assignToCustomer(n,o.map(r=>r.id))}),"customer"===t&&i.push({name:this.translate.instant("entity-view.unassign-entity-views"),icon:"assignment_return",isEnabled:!0,onAction:(n,o)=>this.unassignEntityViewsFromCustomer(n,o)}),"edge"===t&&i.push({name:this.translate.instant("entity-view.unassign-entity-views-from-edge"),icon:"assignment_return",isEnabled:!0,onAction:(n,o)=>this.unassignEntityViewsFromEdge(n,o)}),i}configureAddActions(t){const i=[];return"customer"===t&&i.push({name:this.translate.instant("entity-view.assign-new-entity-view"),icon:"add",isEnabled:()=>!0,onAction:n=>this.addEntityViewsToCustomer(n)}),"edge"===t&&i.push({name:this.translate.instant("entity-view.assign-new-entity-view"),icon:"add",isEnabled:()=>!0,onAction:n=>this.addEntityViewsToEdge(n)}),i}addEntityViewsToCustomer(t){t&&t.stopPropagation(),this.dialog.open(nr.j,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{customerId:this.customerId,entityType:f.ck.ENTITY_VIEW}}).afterClosed().subscribe(i=>{i&&this.config.updateData()})}openEntityView(t,i,n){t&&t.stopPropagation();const o=this.router.createUrlTree([i.id.id],{relativeTo:n.getActivatedRoute()});this.router.navigateByUrl(o)}makePublic(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("entity-view.make-public-entity-view-title",{entityViewName:i.name}),this.translate.instant("entity-view.make-public-entity-view-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{n&&this.entityViewService.makeEntityViewPublic(i.id.id).subscribe(()=>{this.config.updateData()})})}assignToCustomer(t,i){t&&t.stopPropagation(),this.dialog.open(tr.i,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entityIds:i,entityType:f.ck.ENTITY_VIEW}}).afterClosed().subscribe(n=>{n&&this.config.updateData()})}unassignFromCustomer(t,i){t&&t.stopPropagation();let o,r;i.customerIsPublic?(o=this.translate.instant("entity-view.make-private-entity-view-title",{entityViewName:i.name}),r=this.translate.instant("entity-view.make-private-entity-view-text")):(o=this.translate.instant("entity-view.unassign-entity-view-title",{entityViewName:i.name}),r=this.translate.instant("entity-view.unassign-entity-view-text")),this.dialogService.confirm(o,r,this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(l=>{l&&this.entityViewService.unassignEntityViewFromCustomer(i.id.id).subscribe(()=>{this.config.updateData("tenant"!==this.config.componentsData.entityViewScope)})})}unassignEntityViewsFromCustomer(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("entity-view.unassign-entity-views-title",{count:i.length}),this.translate.instant("entity-view.unassign-entity-views-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{if(n){const o=[];i.forEach(r=>{o.push(this.entityViewService.unassignEntityViewFromCustomer(r.id.id))}),(0,Se.p)(o).subscribe(()=>{this.config.updateData()})}})}onEntityViewAction(t,i){switch(t.action){case"open":return this.openEntityView(t.event,t.entity,i),!0;case"makePublic":return this.makePublic(t.event,t.entity),!0;case"assignToCustomer":return this.assignToCustomer(t.event,[t.entity.id]),!0;case"unassignFromCustomer":return this.unassignFromCustomer(t.event,t.entity),!0;case"unassignFromEdge":return this.unassignFromEdge(t.event,t.entity),!0}return!1}addEntityViewsToEdge(t){t&&t.stopPropagation(),this.dialog.open(ir.M,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edgeId:this.config.componentsData.edgeId,entityType:f.ck.ENTITY_VIEW}}).afterClosed().subscribe(i=>{i&&this.config.updateData()})}unassignFromEdge(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("entity-view.unassign-entity-view-from-edge-title",{entityViewName:i.name}),this.translate.instant("entity-view.unassign-entity-view-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{n&&this.entityViewService.unassignEntityViewFromEdge(this.config.componentsData.edgeId,i.id.id).subscribe(()=>{this.config.updateData("tenant"!==this.config.componentsData.entityViewScope)})})}unassignEntityViewsFromEdge(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("entity-view.unassign-entity-views-from-edge-title",{count:i.length}),this.translate.instant("entity-view.unassign-entity-views-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{if(n){const o=[];i.forEach(r=>{o.push(this.entityViewService.unassignEntityViewFromEdge(this.config.componentsData.edgeId,r.id.id))}),(0,Se.p)(o).subscribe(()=>{this.config.updateData()})}})}static{this.\u0275fac=function(i){return new(i||rt)(e.\u0275\u0275inject(C.Store),e.\u0275\u0275inject(ca.D),e.\u0275\u0275inject(K1.o),e.\u0275\u0275inject(Dt.m),e.\u0275\u0275inject(Yt.p),e.\u0275\u0275inject(Ce.o),e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(p.DatePipe),e.\u0275\u0275inject(b.Router),e.\u0275\u0275inject(S.MatDialog))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:rt,factory:rt.\u0275fac})}}const nC=[{path:"entityViews",data:{breadcrumb:{menuId:F.D8.entity_views}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"entity-view.entity-views",entityViewsType:"tenant"},resolve:{entitiesTableConfig:rt}},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"view_quilt"},auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"entity-view.entity-views",entityViewsType:"tenant"},resolve:{entitiesTableConfig:rt}}]}],iC=[{path:"entityViews",pathMatch:"full",redirectTo:"/entities/entityViews"},{path:"entityViews/:entityId",redirectTo:"/entities/entityViews/:entityId"}];class ai{static{this.\u0275fac=function(i){return new(i||ai)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:ai})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[rt],imports:[b.RouterModule.forChild(iC),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(ai,{imports:[b.RouterModule],exports:[b.RouterModule]});class oi{static{this.\u0275fac=function(i){return new(i||oi)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:oi})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,k.I,Fe.L,ai]})}}function aC(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"rulechain.name-required")," "))}function oC(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"rulechain.name-max-length")," "))}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(oi,{declarations:[vo,xo,Co],imports:[p.CommonModule,w.G,k.I,Fe.L,ai]});class _o extends xe.l{constructor(t,i,n,o,r,l){super(t,r,n,o,l),this.store=t,this.translate=i,this.entityValue=n,this.entitiesTableConfigValue=o,this.fb=r,this.cd=l}ngOnInit(){this.ruleChainScope=this.entitiesTableConfig.componentsData.ruleChainScope,super.ngOnInit()}hideDelete(){return!!this.entitiesTableConfig&&!this.entitiesTableConfig.deleteEnabled(this.entity)}buildForm(t){return this.fb.group({name:[t?t.name:"",[s.Validators.required,s.Validators.maxLength(255)]],debugMode:[!!t&&t.debugMode],additionalInfo:this.fb.group({description:[t&&t.additionalInfo?t.additionalInfo.description:""]})})}updateForm(t){this.entityForm.patchValue({name:t.name}),this.entityForm.patchValue({debugMode:t.debugMode}),this.entityForm.patchValue({additionalInfo:{description:t.additionalInfo?t.additionalInfo.description:""}})}onRuleChainIdCopied(t){this.store.dispatch(new $.xo({message:this.translate.instant("rulechain.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}isEdgeRootRuleChain(){return!(!this.entitiesTableConfig||!this.entityValue)&&this.entitiesTableConfig.componentsData.edge?.rootRuleChainId?.id==this.entityValue.id.id}isAutoAssignToEdgeRuleChain(){return!(!this.entitiesTableConfig||!this.entityValue)&&(!this.entityValue.root&&this.entitiesTableConfig.componentsData?.autoAssignToEdgeRuleChainIds?.includes(this.entityValue.id.id))}isNotAutoAssignToEdgeRuleChain(){return!(!this.entitiesTableConfig||!this.entityValue)&&(!this.entityValue.root&&!this.entitiesTableConfig.componentsData?.autoAssignToEdgeRuleChainIds?.includes(this.entityValue.id.id))}static{this.\u0275fac=function(i){return new(i||_o)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject("entity"),e.\u0275\u0275directiveInject("entitiesTableConfig"),e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(e.ChangeDetectorRef))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:_o,selectors:[["tb-rulechain"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:56,vars:76,consts:[[1,"tb-details-buttons"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","debugMode",1,"flex-1",2,"padding-bottom","16px"],["formGroupName","additionalInfo"],["matInput","","formControlName","description","rows","2"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"button",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"open")}),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",1),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"export")}),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"button",1),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"setRoot")}),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"button",1),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"setEdgeTemplateRoot")}),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"button",1),e.\u0275\u0275pipe(18,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"setAutoAssignToEdge")}),e.\u0275\u0275text(19),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"button",1),e.\u0275\u0275pipe(22,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"unsetAutoAssignToEdge")}),e.\u0275\u0275text(23),e.\u0275\u0275pipe(24,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(25,"button",1),e.\u0275\u0275pipe(26,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"unassignFromEdge")}),e.\u0275\u0275text(27),e.\u0275\u0275pipe(28,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(29,"button",1),e.\u0275\u0275pipe(30,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"delete")}),e.\u0275\u0275text(31),e.\u0275\u0275pipe(32,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(33,"div",2)(34,"button",3),e.\u0275\u0275listener("cbOnSuccess",function(r){return n.onRuleChainIdCopied(r)}),e.\u0275\u0275element(35,"mat-icon",4),e.\u0275\u0275elementStart(36,"span",5),e.\u0275\u0275text(37,"rulechain.copyId"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(38,"div",6)(39,"form",7)(40,"fieldset",8),e.\u0275\u0275pipe(41,"async"),e.\u0275\u0275elementStart(42,"mat-form-field",9)(43,"mat-label",5),e.\u0275\u0275text(44,"rulechain.name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(45,"input",10),e.\u0275\u0275template(46,aC,3,3,"mat-error",11)(47,oC,3,3,"mat-error",11),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(48,"mat-checkbox",12),e.\u0275\u0275text(49),e.\u0275\u0275pipe(50,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(51,"div",13)(52,"mat-form-field",9)(53,"mat-label",5),e.\u0275\u0275text(54,"rulechain.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(55,"textarea",14),e.\u0275\u0275elementEnd()()()()()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(2,40,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,42,"rulechain.open-rulechain")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(6,44,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(8,46,"rulechain.export")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||!((null==n.entity||!n.entity.root)&&"tenant"===n.ruleChainScope||!n.isEdgeRootRuleChain()&&"edge"===n.ruleChainScope)),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(10,48,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(12,50,"rulechain.set-root")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||(null==n.entity?null:n.entity.root)||"edges"!==n.ruleChainScope),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(14,52,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,54,"rulechain.set-edge-template-root-rulechain")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||!n.isNotAutoAssignToEdgeRuleChain()||"edges"!==n.ruleChainScope),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(18,56,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(20,58,"rulechain.set-auto-assign-to-edge")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||!n.isAutoAssignToEdgeRuleChain()||"edges"!==n.ruleChainScope),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(22,60,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(24,62,"rulechain.unset-auto-assign-to-edge")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit||n.isEdgeRootRuleChain()||"edges"!==n.ruleChainScope),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(26,64,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(28,66,"edge.unassign-from-edge")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.hideDelete()||n.isEdit||"edge"===n.ruleChainScope),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(30,68,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(32,70,"rulechain.delete")," "),e.\u0275\u0275advance(3),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("cbContent",null==n.entity||null==n.entity.id?null:n.entity.id.id),e.\u0275\u0275advance(5),e.\u0275\u0275property("formGroup",n.entityForm),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(41,72,n.isLoading$)||!n.isEdit),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.entityForm.get("name").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("name").hasError("maxlength")),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(50,74,"rulechain.debug-mode")," "))},dependencies:[p.NgIf,x.MatButton,Te.MatCheckbox,E.MatIcon,L.MatInput,v.MatFormField,v.MatLabel,v.MatError,we.Uo,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,s.FormGroupName,u.TranslateDirective,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";']})}}var ue=d(89815),St=d(16450);const rC=a=>[a];function sC(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,0),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-attribute-table",9),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"attribute.attributes")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function lC(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-attribute-table",10),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"attribute.latest-telemetry")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function dC(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,2),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-alarm-table",11),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,3,"alarm.alarms")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)}}function cC(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,3),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-event-table",12),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,6,"rulechain.events")),e.\u0275\u0275advance(3),e.\u0275\u0275property("debugEventTypes",e.\u0275\u0275pureFunction1(8,rC,n.debugEventTypes.DEBUG_RULE_CHAIN))("defaultEventType",n.debugEventTypes.DEBUG_RULE_CHAIN)("active",i.isActive)("tenantId",n.entity.tenantId.id)("entityId",n.entity.id)}}function pC(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,4),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-relation-table",11),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,3,"relation.relations")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)}}function mC(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",8,5),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-audit-log-table",13),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,4,"audit-log.audit-logs")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}function uC(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-tab",8,6),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementStart(3,"tb-version-control",14),e.\u0275\u0275listener("versionRestored",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.entitiesTableConfig.updateData())}),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"version-control.version-control")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}class So extends Ee.P{constructor(t){super(t),this.store=t}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(i){return new(i||So)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:So,selectors:[["tb-rulechain-tabs"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"debugEventTypes","defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(i,n){1&i&&e.\u0275\u0275template(0,sC,4,7,"mat-tab",7)(1,lC,4,7,"mat-tab",7)(2,dC,4,5,"mat-tab",7)(3,cC,4,10,"mat-tab",7)(4,pC,4,5,"mat-tab",7)(5,mC,4,6,"mat-tab",7)(6,uC,4,7,"mat-tab",7),2&i&&(e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity&&n.authUser.authority===n.authorities.TENANT_ADMIN),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity&&n.authUser.authority===n.authorities.TENANT_ADMIN))},dependencies:[p.NgIf,Q.MatTab,je.AuditLogTableComponent,xt.EventTableComponent,_t.RelationTableComponent,tt.AlarmTableComponent,nt.AttributeTableComponent,ke.d,u.TranslatePipe],encapsulation:2})}}var Ps=d(77848);class Tt{constructor(t,i,n,o,r,l,c,m,h,T){this.ruleChainService=t,this.dialogService=i,this.dialog=n,this.importExport=o,this.itembuffer=r,this.edgeService=l,this.homeDialogs=c,this.translate=m,this.datePipe=h,this.router=T,this.config=new y.M7,this.config.entityType=f.ck.RULE_CHAIN,this.config.entityComponent=_o,this.config.entityTabsComponent=So,this.config.entityTranslations=f.Mi.get(f.ck.RULE_CHAIN),this.config.entityResources=f.BT.get(f.ck.RULE_CHAIN),this.config.rowPointer=!0,this.config.deleteEntityTitle=N=>this.translate.instant("rulechain.delete-rulechain-title",{ruleChainName:N.name}),this.config.deleteEntityContent=()=>this.translate.instant("rulechain.delete-rulechain-text"),this.config.deleteEntitiesTitle=N=>this.translate.instant("rulechain.delete-rulechains-title",{count:N}),this.config.deleteEntitiesContent=()=>this.translate.instant("rulechain.delete-rulechains-text"),this.config.loadEntity=N=>this.ruleChainService.getRuleChain(N.id),this.config.saveEntity=N=>this.saveRuleChain(N),this.config.deleteEntity=N=>this.ruleChainService.deleteRuleChain(N.id),this.config.onEntityAction=N=>this.onRuleChainAction(N),this.config.handleRowClick=(N,O)=>(this.config.isDetailsOpen()?this.config.toggleEntityDetails(N,O):this.openRuleChain(N,O),!0)}resolve(t){const i=t.params?.edgeId,n=t.data?.ruleChainsType?t.data?.ruleChainsType:"tenant";return this.config.componentsData={ruleChainScope:n,edgeId:i},this.config.columns=this.configureEntityTableColumns(n),this.config.entitiesFetchFunction=this.configureEntityFunctions(n,i),this.config.groupActionDescriptors=this.configureGroupActions(n),this.config.addActionDescriptors=this.configureAddActions(n),this.config.cellActionDescriptors=this.configureCellActions(n),"tenant"===n||"edges"===n?(this.config.entitySelectionEnabled=o=>o&&!o.root,this.config.deleteEnabled=o=>o&&!o.root,this.config.entitiesDeleteEnabled=!0,this.config.tableTitle=this.configureTableTitle(n,null)):"edge"===n&&(this.config.entitySelectionEnabled=o=>this.config.componentsData.edge.rootRuleChainId.id!==o.id.id,this.edgeService.getEdge(i).subscribe(o=>{this.config.componentsData.edge=o,this.config.tableTitle=this.configureTableTitle(n,o)}),this.config.entitiesDeleteEnabled=!1),this.config}configureEntityTableColumns(t){const i=[];return i.push(new y.Qr("createdTime","common.created-time",this.datePipe,"150px"),new y.KK("name","rulechain.name","100%")),"tenant"===t||"edge"===t?i.push(new y.KK("root","rulechain.root","60px",n=>"edge"===t?(0,y.ov)(this.config.componentsData.edge.rootRuleChainId.id===n.id.id):(0,y.ov)(n.root))):"edges"===t&&i.push(new y.KK("root","rulechain.edge-template-root","100px",n=>(0,y.ov)(n.root)),new y.KK("assignToEdge","rulechain.assign-to-edge","100px",n=>(0,y.ov)(this.isAutoAssignToEdgeRuleChain(n)),()=>({}),!1)),i}configureAddActions(t){const i=[];return("tenant"===t||"edges"===t)&&i.push({name:this.translate.instant("rulechain.create-new-rulechain"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:n=>this.config.getTable().addEntity(n)},{name:this.translate.instant("rulechain.import"),icon:"file_upload",isEnabled:()=>!0,onAction:n=>this.importRuleChain(n)}),"edge"===t&&i.push({name:this.translate.instant("rulechain.assign-to-edge"),icon:"add",isEnabled:()=>!0,onAction:n=>this.assignRuleChainsToEdge(n)}),i}configureEntityFunctions(t,i){return"tenant"===t?n=>this.fetchRuleChains(n):"edges"===t?n=>this.fetchEdgeRuleChains(n):"edge"===t?n=>this.ruleChainService.getEdgeRuleChains(i,n):void 0}configureTableTitle(t,i){return"tenant"===t?this.translate.instant("rulechain.rulechains"):"edges"===t?this.translate.instant("edge.rulechain-templates"):"edge"===t?this.config.tableTitle=i.name+": "+this.translate.instant("rulechain.rulechains"):void 0}configureGroupActions(t){const i=[];return"edge"===t&&i.push({name:this.translate.instant("rulechain.unassign-rulechains"),icon:"assignment_return",isEnabled:!0,onAction:(n,o)=>this.unassignRuleChainsFromEdge(n,o)}),i}configureCellActions(t){const i=[];return i.push({name:this.translate.instant("rulechain.export"),icon:"file_download",isEnabled:()=>!0,onAction:(n,o)=>this.exportRuleChain(n,o)}),"tenant"===t&&i.push({name:this.translate.instant("rulechain.set-root"),icon:"flag",isEnabled:n=>this.isNonRootRuleChain(n),onAction:(n,o)=>this.setRootRuleChain(n,o)}),"edges"===t&&i.push({name:this.translate.instant("rulechain.set-edge-template-root-rulechain"),icon:"flag",isEnabled:n=>this.isNonRootRuleChain(n),onAction:(n,o)=>this.setEdgeTemplateRootRuleChain(n,o)},{name:this.translate.instant("rulechain.set-auto-assign-to-edge"),icon:"bookmark_outline",isEnabled:n=>this.isNotAutoAssignToEdgeRuleChain(n),onAction:(n,o)=>this.setAutoAssignToEdgeRuleChain(n,o)},{name:this.translate.instant("rulechain.unset-auto-assign-to-edge"),icon:"bookmark",isEnabled:n=>this.isAutoAssignToEdgeRuleChain(n),onAction:(n,o)=>this.unsetAutoAssignToEdgeRuleChain(n,o)}),"edge"===t&&i.push({name:this.translate.instant("rulechain.set-root"),icon:"flag",isEnabled:n=>this.isNonRootRuleChain(n),onAction:(n,o)=>this.setRootRuleChain(n,o)},{name:this.translate.instant("edge.unassign-from-edge"),icon:"assignment_return",isEnabled:n=>n.id.id!==this.config.componentsData.edge.rootRuleChainId.id,onAction:(n,o)=>this.unassignFromEdge(n,o)}),i.push({name:this.translate.instant("rulechain.rulechain-details"),icon:"edit",isEnabled:()=>!0,onAction:(n,o)=>this.config.toggleEntityDetails(n,o)}),i}importRuleChain(t){t&&t.stopPropagation();const i="tenant"===this.config.componentsData.ruleChainScope?ue.UR.CORE:ue.UR.EDGE;this.importExport.importRuleChain(i).subscribe(n=>{n&&(this.itembuffer.storeRuleChainImport(n),"edges"===this.config.componentsData.ruleChainScope?this.router.navigateByUrl("edgeManagement/ruleChains/ruleChain/import"):this.router.navigateByUrl("ruleChains/ruleChain/import"))})}openRuleChain(t,i){t&&t.stopPropagation(),"edges"===this.config.componentsData.ruleChainScope?this.router.navigateByUrl(`edgeManagement/ruleChains/${i.id.id}`):"edge"===this.config.componentsData.ruleChainScope?this.router.navigateByUrl(`edgeInstances/${this.config.componentsData.edgeId}/ruleChains/${i.id.id}`):this.router.navigateByUrl(`ruleChains/${i.id.id}`)}saveRuleChain(t){return(0,_.b0)(t.type)&&("tenant"===this.config.componentsData.ruleChainScope?t.type=ue.UR.CORE:"edges"===this.config.componentsData.ruleChainScope?t.type=ue.UR.EDGE:t.type=ue.UR.CORE),this.ruleChainService.saveRuleChain(t)}exportRuleChain(t,i){t&&t.stopPropagation(),this.importExport.exportRuleChain(i.id.id)}setRootRuleChain(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.set-root-rulechain-title",{ruleChainName:i.name}),this.translate.instant("rulechain.set-root-rulechain-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{n&&("edge"===this.config.componentsData.ruleChainScope?this.ruleChainService.setEdgeRootRuleChain(this.config.componentsData.edgeId,i.id.id).subscribe(o=>{this.config.componentsData.edge=o,this.config.updateData()}):this.ruleChainService.setRootRuleChain(i.id.id).subscribe(()=>{this.config.updateData()}))})}onRuleChainAction(t){switch(t.action){case"open":return this.openRuleChain(t.event,t.entity),!0;case"export":return this.exportRuleChain(t.event,t.entity),!0;case"setRoot":return this.setRootRuleChain(t.event,t.entity),!0;case"setEdgeTemplateRoot":return this.setEdgeTemplateRootRuleChain(t.event,t.entity),!0;case"unassignFromEdge":return this.unassignFromEdge(t.event,t.entity),!0;case"setAutoAssignToEdge":return this.setAutoAssignToEdgeRuleChain(t.event,t.entity),!0;case"unsetAutoAssignToEdge":return this.unsetAutoAssignToEdgeRuleChain(t.event,t.entity),!0}return!1}setEdgeTemplateRootRuleChain(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.set-edge-template-root-rulechain-title",{ruleChainName:i.name}),this.translate.instant("rulechain.set-edge-template-root-rulechain-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{n&&this.ruleChainService.setEdgeTemplateRootRuleChain(i.id.id).subscribe(()=>{this.config.updateData()})})}checkMissingToRelatedRuleChains(){this.edgeService.findMissingToRelatedRuleChains(this.config.componentsData.edgeId).subscribe(t=>{if(t&&Object.keys(t).length>0){const i=new Array;for(const o of Object.keys(t)){const l="- '"+o+"': '"+t[o].join("', ")+"'";i.push(l)}const n=this.translate.instant("edge.missing-related-rule-chains-text",{missingRuleChains:i.join("<br>")});this.dialogService.alert(this.translate.instant("edge.missing-related-rule-chains-title"),n,this.translate.instant("action.close"),!0).subscribe(()=>{this.config.updateData()})}else this.config.updateData()})}assignRuleChainsToEdge(t){t&&t.stopPropagation(),this.dialog.open(ir.M,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edgeId:this.config.componentsData.edgeId,entityType:f.ck.RULE_CHAIN}}).afterClosed().subscribe(i=>{i&&this.checkMissingToRelatedRuleChains()})}unassignFromEdge(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.unassign-rulechain-title",{ruleChainName:i.name}),this.translate.instant("rulechain.unassign-rulechain-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{n&&this.ruleChainService.unassignRuleChainFromEdge(this.config.componentsData.edgeId,i.id.id).subscribe(()=>{this.checkMissingToRelatedRuleChains()})})}unassignRuleChainsFromEdge(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.unassign-rulechains-from-edge-title",{count:i.length}),this.translate.instant("rulechain.unassign-rulechains-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{if(n){const o=[];i.forEach(r=>{o.push(this.ruleChainService.unassignRuleChainFromEdge(this.config.componentsData.edgeId,r.id.id))}),(0,Se.p)(o).subscribe(()=>{this.checkMissingToRelatedRuleChains()})}})}setAutoAssignToEdgeRuleChain(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.set-auto-assign-to-edge-title",{ruleChainName:i.name}),this.translate.instant("rulechain.set-auto-assign-to-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{n&&this.ruleChainService.setAutoAssignToEdgeRuleChain(i.id.id).subscribe(()=>{this.config.updateData()})})}unsetAutoAssignToEdgeRuleChain(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.unset-auto-assign-to-edge-title",{ruleChainName:i.name}),this.translate.instant("rulechain.unset-auto-assign-to-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{n&&this.ruleChainService.unsetAutoAssignToEdgeRuleChain(i.id.id).subscribe(()=>{this.config.updateData()})})}isNonRootRuleChain(t){return"edge"===this.config.componentsData.ruleChainScope?this.config.componentsData.edge.rootRuleChainId&&this.config.componentsData.edge.rootRuleChainId.id!==t.id.id:!t.root}isAutoAssignToEdgeRuleChain(t){return!t.root&&this.config.componentsData.autoAssignToEdgeRuleChainIds.includes(t.id.id)}isNotAutoAssignToEdgeRuleChain(t){return!t.root&&!this.config.componentsData.autoAssignToEdgeRuleChainIds.includes(t.id.id)}fetchRuleChains(t){return this.ruleChainService.getRuleChains(t,ue.UR.CORE)}fetchEdgeRuleChains(t){return this.ruleChainService.getAutoAssignToEdgeRuleChains().pipe((0,Z.Z)(i=>(this.config.componentsData.autoAssignToEdgeRuleChainIds=[],i.map(n=>this.config.componentsData.autoAssignToEdgeRuleChainIds.push(n.id.id)),this.ruleChainService.getRuleChains(t,ue.UR.EDGE))))}static{this.\u0275fac=function(i){return new(i||Tt)(e.\u0275\u0275inject(St.P),e.\u0275\u0275inject(Ce.o),e.\u0275\u0275inject(S.MatDialog),e.\u0275\u0275inject(ut.ImportExportService),e.\u0275\u0275inject(Ps.Z),e.\u0275\u0275inject(Yt.p),e.\u0275\u0275inject(mt.k),e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(p.DatePipe),e.\u0275\u0275inject(b.Router))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Tt,factory:Tt.\u0275fac})}}var Y=d(31060),B=d(10890),gC=d(35060),fC=d(65245),hC=d(92771),bC=d(89183);const yC=["definedConfigContent"],vC=["jsonObjectEditComponent"];function CC(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",5),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(i.definedDirectiveError)}}function xC(a,t){if(1&a&&(e.\u0275\u0275element(0,"tb-json-object-edit",6,1),e.\u0275\u0275pipe(2,"translate")),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("label",e.\u0275\u0275pipeBind1(2,3,"rulenode.configuration"))("jsonRequired",i.required)("fillHeight",!0)}}class ri{get required(){return this.requiredValue}set required(t){this.requiredValue=(0,ye.coerceBooleanProperty)(t)}set nodeDefinition(t){this.nodeDefinitionValue!==t&&(this.nodeDefinitionValue=t,this.nodeDefinitionValue&&this.validateDefinedDirective(),setTimeout(()=>this.initRuleNode.emit()))}get nodeDefinition(){return this.nodeDefinitionValue}constructor(t,i){this.ruleChainService=t,this.fb=i,this.initRuleNode=new e.EventEmitter,this.changeScript=new e.EventEmitter,this.propagateChange=n=>{},this.ruleNodeConfigFormGroup=this.fb.group({configuration:[null,s.Validators.required]})}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}ngOnDestroy(){this.definedConfigComponentRef&&this.definedConfigComponentRef.destroy(),this.changeSubscription&&(this.changeSubscription.unsubscribe(),this.changeSubscription=null),this.changeScriptSubscription&&(this.changeScriptSubscription.unsubscribe(),this.changeScriptSubscription=null)}setDisabledState(t){this.disabled=t,this.disabled?this.ruleNodeConfigFormGroup.disable({emitEvent:!1}):this.ruleNodeConfigFormGroup.enable({emitEvent:!1}),this.definedConfigComponent&&(this.definedConfigComponent.disabled=this.disabled)}writeValue(t){this.configuration=(0,_.Go)(t),this.changeSubscription&&(this.changeSubscription.unsubscribe(),this.changeSubscription=null),this.definedConfigComponent?(this.definedConfigComponent.configuration=this.configuration,this.changeSubscription=this.definedConfigComponent.configurationChanged.subscribe(i=>{this.updateModel(i)})):(this.ruleNodeConfigFormGroup.get("configuration").patchValue(this.configuration,{emitEvent:!1}),this.changeSubscription=this.ruleNodeConfigFormGroup.get("configuration").valueChanges.subscribe(i=>{this.updateModel(i)}))}useDefinedDirective(){return this.nodeDefinition&&this.nodeDefinition.configDirective&&this.nodeDefinition.configDirective.length&&!this.definedDirectiveError}updateModel(t){this.definedConfigComponent||this.ruleNodeConfigFormGroup.valid?this.propagateChange(t):this.propagateChange(this.required?null:t)}validateDefinedDirective(){if(this.definedConfigComponentRef&&(this.definedConfigComponentRef.destroy(),this.definedConfigComponentRef=null),this.nodeDefinition.uiResourceLoadError&&this.nodeDefinition.uiResourceLoadError.length)this.definedDirectiveError=this.nodeDefinition.uiResourceLoadError;else if(this.nodeDefinition.configDirective&&this.nodeDefinition.configDirective.length){this.changeSubscription&&(this.changeSubscription.unsubscribe(),this.changeSubscription=null),this.definedConfigContainer.clear();const t=this.ruleChainService.getRuleNodeConfigComponent(this.nodeDefinition.configDirective);this.definedConfigComponentRef=this.definedConfigContainer.createComponent(t),this.definedConfigComponent=this.definedConfigComponentRef.instance,this.definedConfigComponent.ruleNodeId=this.ruleNodeId,this.definedConfigComponent.ruleChainId=this.ruleChainId,this.definedConfigComponent.ruleChainType=this.ruleChainType,this.definedConfigComponent.configuration=this.configuration,this.changeSubscription=this.definedConfigComponent.configurationChanged.subscribe(i=>{this.updateModel(i)}),this.definedConfigComponent?.changeScript&&(this.changeScriptSubscription=this.definedConfigComponent.changeScript.subscribe(()=>this.changeScript.emit()))}}validate(){this.useDefinedDirective()&&this.definedConfigComponent.validate()}static{this.\u0275fac=function(i){return new(i||ri)(e.\u0275\u0275directiveInject(St.P),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:ri,selectors:[["tb-rule-node-config"]],viewQuery:function(i,n){if(1&i&&(e.\u0275\u0275viewQuery(yC,7,e.ViewContainerRef),e.\u0275\u0275viewQuery(vC,5)),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.definedConfigContainer=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.jsonObjectEditComponent=o.first)}},inputs:{required:"required",disabled:"disabled",ruleNodeId:"ruleNodeId",ruleChainId:"ruleChainId",ruleChainType:"ruleChainType",nodeDefinition:"nodeDefinition"},outputs:{initRuleNode:"initRuleNode",changeScript:"changeScript"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>ri),multi:!0}])],decls:5,vars:3,consts:[["definedConfigContent",""],["jsonObjectEditComponent",""],[3,"formGroup"],["class","tb-rulenode-directive-error",4,"ngIf"],["class","tb-rule-node-configuration-json","formControlName","configuration",3,"label","jsonRequired","fillHeight",4,"ngIf"],[1,"tb-rulenode-directive-error"],["formControlName","configuration",1,"tb-rule-node-configuration-json",3,"label","jsonRequired","fillHeight"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",2),e.\u0275\u0275elementContainer(1,null,0),e.\u0275\u0275template(3,CC,2,1,"div",3)(4,xC,3,5,"tb-json-object-edit",4),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275property("formGroup",n.ruleNodeConfigFormGroup),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",n.definedDirectiveError),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n.useDefinedDirective()))},dependencies:[p.NgIf,bC.JsonObjectEditComponent,s.NgControlStatus,s.NgControlStatusGroup,s.FormGroupDirective,s.FormControlName,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   tb-json-object-edit.tb-rule-node-configuration-json[_ngcontent-%COMP%]{display:block;height:300px}[_nghost-%COMP%]   .tb-rulenode-directive-error[_ngcontent-%COMP%]{font-size:13px;font-weight:400;color:#dd2c00}']})}}var sr=d(11108),_C=d(48676);const SC=["ruleNodeConfigComponent"];function TC(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",17)(1,"button",18),e.\u0275\u0275listener("click",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.openRuleChain(o))}),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()}2&a&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"rulechain.open-rulechain")," "))}function IC(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"rulenode.name-required")," "))}function wC(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"rulenode.name-max-length")," "))}function EC(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-slide-toggle",19),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"rulenode.singleton-mode")," "))}function MC(a,t){if(1&a&&e.\u0275\u0275element(0,"tb-queue-autocomplete",20),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("queueType",i.serviceType)("autocompleteHint",i.isSingleton()?"rulenode.queue-singleton-hint":"rulenode.queue-hint")}}class It extends de.H{constructor(t,i,n){super(t),this.store=t,this.fb=i,this.router=n,this.disabled=!1,this.isAdd=!1,this.initRuleNode=new e.EventEmitter,this.changeScript=new e.EventEmitter,this.ruleNodeType=B.zu,this.entityType=f.ck,this.serviceType=Uo.C0.TB_RULE_ENGINE,this.destroy$=new fe.B,this.ruleNodeFormGroup=this.fb.group({})}buildForm(){this.ruleNode?(this.ruleNodeFormGroup=this.fb.group({name:[this.ruleNode.name,[s.Validators.required,s.Validators.pattern("(.|\\s)*\\S(.|\\s)*"),s.Validators.maxLength(255)]],debugMode:[this.ruleNode.debugMode,[]],singletonMode:[this.ruleNode.singletonMode,[]],configuration:[this.ruleNode.configuration,[s.Validators.required]],additionalInfo:this.fb.group({description:[this.ruleNode.additionalInfo?this.ruleNode.additionalInfo.description:""]})}),this.isAddQueue()&&(this.ruleNodeFormGroup.addControl("queueName",this.fb.control(this.ruleNode?.queueName?this.ruleNode.queueName:null)),this.isSingleton()&&(this.isSingletonEditAllowed()||this.ruleNodeFormGroup.get("singletonMode").disable({emitEvent:!1}),this.ruleNodeFormGroup.get("singletonMode").value||this.ruleNodeFormGroup.get("queueName").disable({emitEvent:!1}),this.ruleNodeFormGroup.get("singletonMode").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(t=>{t?this.ruleNodeFormGroup.get("queueName").enable({emitEvent:!1}):this.ruleNodeFormGroup.get("queueName").disable({emitEvent:!1})}))),this.ruleNodeFormGroup.valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(()=>this.updateRuleNode())):this.ruleNodeFormGroup=this.fb.group({}),this.disabled&&this.ruleNodeFormGroup.disable({emitEvent:!1})}updateRuleNode(){const t=this.ruleNodeFormGroup.value||{};t.name=t.name.trim(),Object.assign(this.ruleNode,t)}ngOnInit(){this.disabled&&this.ruleNodeFormGroup.disable({emitEvent:!1})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}ngOnChanges(t){for(const i of Object.keys(t)){const n=t[i];n.currentValue!==n.previousValue&&"ruleNode"===i&&this.buildForm()}}validate(){this.ruleNodeConfigComponent.validate()}openRuleChain(t){t&&t.stopPropagation();const i=this.ruleNodeFormGroup.get("configuration")?.value?.ruleChainId;i&&(this.ruleChainType===ue.UR.EDGE?this.router.navigateByUrl(`/edgeManagement/ruleChains/${i}`):this.router.navigateByUrl(`/ruleChains/${i}`))}isAddQueue(){return this.isSingleton()||this.ruleNode.component.hasQueueName}isSingleton(){return this.ruleNode.component.clusteringMode===sr.VG.SINGLETON||this.ruleNode.component.clusteringMode===sr.VG.USER_PREFERENCE}isSingletonEditAllowed(){return this.ruleNode.component.clusteringMode===sr.VG.USER_PREFERENCE}static{this.\u0275fac=function(i){return new(i||It)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(b.Router))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:It,selectors:[["tb-rule-node"]],viewQuery:function(i,n){if(1&i&&e.\u0275\u0275viewQuery(SC,5),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.ruleNodeConfigComponent=o.first)}},inputs:{ruleNode:"ruleNode",ruleChainId:"ruleChainId",ruleChainType:"ruleChainType",disabled:"disabled",isAdd:"isAdd"},outputs:{initRuleNode:"initRuleNode",changeScript:"changeScript"},features:[e.\u0275\u0275InheritDefinitionFeature,e.\u0275\u0275NgOnChangesFeature],decls:23,vars:13,consts:[["ruleNodeConfigComponent",""],["class","tb-details-buttons",4,"ngIf"],[1,"mat-padding",3,"formGroup"],[1,"title-row"],[1,"mat-block","flex-1"],["translate",""],["matInput","","formControlName","name","required",""],[4,"ngIf"],[1,"node-setting"],["formControlName","debugMode"],["formControlName","singletonMode",4,"ngIf"],["formControlName","configuration",3,"initRuleNode","changeScript","ruleNodeId","ruleChainId","ruleChainType","nodeDefinition"],[1,"description-block"],["subscriptSizing","dynamic","formControlName","queueName",3,"queueType","autocompleteHint",4,"ngIf"],["formGroupName","additionalInfo"],[1,"mat-block"],["matInput","","formControlName","description","rows","1"],[1,"tb-details-buttons"],["mat-raised-button","","color","primary",3,"click"],["formControlName","singletonMode"],["subscriptSizing","dynamic","formControlName","queueName",3,"queueType","autocompleteHint"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275template(0,TC,4,3,"div",1),e.\u0275\u0275elementStart(1,"form",2)(2,"section",3)(3,"mat-form-field",4)(4,"mat-label",5),e.\u0275\u0275text(5,"rulenode.name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(6,"input",6),e.\u0275\u0275template(7,IC,3,3,"mat-error",7)(8,wC,3,3,"mat-error",7),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"section",8)(10,"mat-slide-toggle",9),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(13,EC,3,3,"mat-slide-toggle",10),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(14,"tb-rule-node-config",11,0),e.\u0275\u0275listener("initRuleNode",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.initRuleNode.emit(l))})("changeScript",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.changeScript.emit(l))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"div",12),e.\u0275\u0275template(17,MC,1,2,"tb-queue-autocomplete",13),e.\u0275\u0275elementStart(18,"div",14)(19,"mat-form-field",15)(20,"mat-label",5),e.\u0275\u0275text(21,"rulenode.rule-node-description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(22,"textarea",16),e.\u0275\u0275elementEnd()()()()}2&i&&(e.\u0275\u0275property("ngIf",!n.isAdd&&(null==n.ruleNode.component||null==n.ruleNode.component.configurationDescriptor||null==n.ruleNode.component.configurationDescriptor.nodeDefinition?null:n.ruleNode.component.configurationDescriptor.nodeDefinition.ruleChainNode)),e.\u0275\u0275advance(),e.\u0275\u0275property("formGroup",n.ruleNodeFormGroup),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.ruleNodeFormGroup.get("name").hasError("required")||n.ruleNodeFormGroup.get("name").hasError("pattern")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.ruleNodeFormGroup.get("name").hasError("maxlength")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(12,11,"rulenode.debug-mode")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.isSingleton()),e.\u0275\u0275advance(),e.\u0275\u0275property("ruleNodeId",null==n.ruleNode.ruleNodeId?null:n.ruleNode.ruleNodeId.id)("ruleChainId",n.ruleChainId)("ruleChainType",n.ruleChainType)("nodeDefinition",n.ruleNode.component.configurationDescriptor.nodeDefinition),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",n.isAddQueue()))},dependencies:[p.NgIf,_C.QueueAutocompleteComponent,x.MatButton,L.MatInput,v.MatFormField,v.MatLabel,v.MatError,pe.MatSlideToggle,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,s.FormGroupName,u.TranslateDirective,ri,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]   form[_ngcontent-%COMP%]{overflow-x:hidden!important}[_nghost-%COMP%]   .title-row[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .title-row[_ngcontent-%COMP%]   .node-setting[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin-bottom:22px}@media screen and (min-width: 960px){[_nghost-%COMP%]   .title-row[_ngcontent-%COMP%]{flex-direction:row;gap:8px;align-items:center}[_nghost-%COMP%]   .title-row[_ngcontent-%COMP%]   .node-setting[_ngcontent-%COMP%]{margin-top:5px}}[_nghost-%COMP%]   .description-block[_ngcontent-%COMP%]{margin-top:22px}']})}}(0,Ge.__decorate)([(0,_a.coerceBoolean)(),(0,Ge.__metadata)("design:type",Object)],It.prototype,"disabled",void 0),(0,Ge.__decorate)([(0,_a.coerceBoolean)(),(0,Ge.__metadata)("design:type",Object)],It.prototype,"isAdd",void 0);var ks=d(97435);const NC=["chipList"],AC=["labelAutocomplete"],FC=["labelInput"],DC=a=>({label:a});function PC(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-icon",13),e.\u0275\u0275text(1,"close"),e.\u0275\u0275elementEnd())}function kC(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-chip-row",11),e.\u0275\u0275listener("removed",function(){const o=e.\u0275\u0275restoreView(i).$implicit,r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.remove(o))}),e.\u0275\u0275text(1),e.\u0275\u0275template(2,PC,2,0,"mat-icon",12),e.\u0275\u0275elementEnd()}if(2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("removable",!n.disabled),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",i.name," "),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n.disabled)}}function LC(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",14),e.\u0275\u0275element(1,"span",15),e.\u0275\u0275pipe(2,"highlight"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275property("innerHTML",e.\u0275\u0275pipeBind2(2,2,i.name,n.searchText),e.\u0275\u0275sanitizeHtml)}}function OC(a,t){1&a&&(e.\u0275\u0275elementStart(0,"div")(1,"span",5),e.\u0275\u0275text(2,"rulenode.no-link-labels-found"),e.\u0275\u0275elementEnd()())}function RC(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,i.translate.get("rulenode.no-link-label-matching",e.\u0275\u0275pureFunction1(3,DC,i.truncate.transform(i.searchText,!0,6,"..."))))," ")}}function VC(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"span")(1,"a",20),e.\u0275\u0275listener("click",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(r.createLinkLabel(o,r.searchText))}),e.\u0275\u0275text(2,"rulenode.create-new-link-label"),e.\u0275\u0275elementEnd()()}}function BC(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-option",16)(1,"div",17),e.\u0275\u0275listener("click",function(o){return e.\u0275\u0275restoreView(i),e.\u0275\u0275resetView(o.stopPropagation())}),e.\u0275\u0275template(2,OC,3,0,"div",18)(3,RC,3,5,"ng-template",null,3,e.\u0275\u0275templateRefExtractor)(5,VC,3,0,"span",19),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275reference(4),n=e.\u0275\u0275nextContext();e.\u0275\u0275property("value",null),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.textIsNotEmpty(n.searchText))("ngIfElse",i),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",n.allowCustom)}}class si{get required(){return this.requiredValue}set required(t){this.requiredValue=(0,ye.coerceBooleanProperty)(t)}get allowCustom(){return this.allowCustomValue}set allowCustom(t){this.allowCustomValue=(0,ye.coerceBooleanProperty)(t),this.separatorKeysCodes=this.allowCustomValue?[ct.ENTER,ct.COMMA,ct.SEMICOLON]:[]}constructor(t,i,n,o){this.fb=t,this.truncate=i,this.translate=n,this.ruleChainService=o,this.labelsList=[],this.separatorKeysCodes=[],this.labels=[],this.searchText="",this.propagateChange=r=>{},this.linksFormGroup=this.fb.group({label:[null]})}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}ngOnInit(){this.filteredLabels=this.linksFormGroup.get("label").valueChanges.pipe((0,sa.Z)(""),(0,ie.T)(t=>t||""),(0,Z.Z)(t=>this.fetchLabels(t)),(0,Kr.u)())}ngOnChanges(t){let i=!1;for(const n of Object.keys(t)){const o=t[n];o.currentValue!==o.previousValue&&["allowCustom","allowedLabels","sourceRuleChainId"].includes(n)&&(i=!0)}i&&this.linksFormGroup.get("label").patchValue("",{emitEvent:!0})}setDisabledState(t){this.disabled=t,this.disabled?this.linksFormGroup.disable({emitEvent:!1}):this.linksFormGroup.enable({emitEvent:!1})}writeValue(t){this.searchText="",this.labelsList.length=0,this.labels.length=0,this.modelValue=t,this.prepareLabelsList().subscribe(i=>{this.labelsList=i,t&&t.forEach(n=>{this.allowedLabels[n]?this.labels.push((0,_.Go)(this.allowedLabels[n])):this.labels.push({name:n,value:n})}),this.chipList&&this.required&&(this.chipList.errorState=!this.labels.length),this.linksFormGroup.get("label").patchValue("",{emitEvent:!0})})}prepareLabelsList(){const t=[];if(this.sourceRuleChainId)return this.ruleChainService.getRuleChainOutputLabels(this.sourceRuleChainId,{ignoreErrors:!0}).pipe((0,ie.T)(i=>{for(const n of i)t.push({name:n,value:n});return t}),(0,cn.W)(()=>(0,H.of)(t)));for(const i of Object.keys(this.allowedLabels))t.push({name:this.allowedLabels[i].name,value:this.allowedLabels[i].value});return(0,H.of)(t)}displayLabelFn(t){return t?t.name:void 0}textIsNotEmpty(t){return t&&t.length>0}createLinkLabel(t,i){t.preventDefault(),this.transformLinkLabel(i)}add(t){(!this.matAutocomplete.isOpen||this.allowCustom)&&this.transformLinkLabel(t.value)}fetchLabels(t){if(this.searchText=t,this.searchText&&this.searchText.length){const i=this.searchText.toUpperCase();return(0,H.of)(this.labelsList.filter(n=>n.name.toUpperCase().includes(i)))}return(0,H.of)(this.labelsList)}transformLinkLabel(t){if((t||"").trim()){let i=null;const n=t.trim(),o=this.labelsList.find(r=>r.name===n);o?i=(0,_.Go)(o):this.allowCustom&&(i={name:n,value:n}),i&&this.addLabel(i)}this.clear("")}remove(t){const i=this.labels.indexOf(t);i>=0&&(this.labels.splice(i,1),this.labels.length||this.required&&(this.chipList.errorState=!0),this.updateModel())}selected(t){this.addLabel(t.option.value),this.clear("")}addLabel(t){-1===this.labels.findIndex(n=>n.value===t.value)&&(this.labels.push(t),this.required&&(this.chipList.errorState=!1),this.updateModel())}onFocus(){this.linksFormGroup.get("label").updateValueAndValidity({onlySelf:!0,emitEvent:!0})}clear(t=""){this.labelInput.nativeElement.value=t,this.linksFormGroup.get("label").patchValue(null,{emitEvent:!0}),setTimeout(()=>{this.labelInput.nativeElement.blur(),this.labelInput.nativeElement.focus()},0)}updateModel(){const t=this.labels.map(i=>i.value);this.propagateChange(t)}static{this.\u0275fac=function(i){return new(i||si)(e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(ks.TruncatePipe),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(St.P))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:si,selectors:[["tb-link-labels"]],viewQuery:function(i,n){if(1&i&&(e.\u0275\u0275viewQuery(NC,5),e.\u0275\u0275viewQuery(AC,5),e.\u0275\u0275viewQuery(FC,5)),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.chipList=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.matAutocomplete=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.labelInput=o.first)}},inputs:{required:"required",disabled:"disabled",allowCustom:"allowCustom",allowedLabels:"allowedLabels",sourceRuleChainId:"sourceRuleChainId"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>si),multi:!0}]),e.\u0275\u0275NgOnChangesFeature],decls:16,vars:16,consts:[["chipList",""],["labelInput","","origin","matAutocompleteOrigin"],["labelAutocomplete","matAutocomplete"],["searchNotEmpty",""],[2,"width","100%",3,"formGroup"],["translate",""],[3,"removable","removed",4,"ngFor","ngForOf"],["matInput","","type","text","formControlName","label","matAutocompleteOrigin","",2,"max-width","200px",3,"focusin","matChipInputTokenEnd","placeholder","matAutocompleteConnectedTo","matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes"],[1,"tb-autocomplete",3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],["class","tb-not-found",3,"value",4,"ngIf"],[3,"removed","removable"],["matChipRemove","",4,"ngIf"],["matChipRemove",""],[3,"value"],[3,"innerHTML"],[1,"tb-not-found",3,"value"],[1,"tb-not-found-content",3,"click"],[4,"ngIf","ngIfElse"],[4,"ngIf"],["translate","",3,"click"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-form-field",4)(1,"mat-label",5),e.\u0275\u0275text(2,"rulenode.link-labels"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"mat-chip-grid",null,0),e.\u0275\u0275template(5,kC,3,3,"mat-chip-row",6),e.\u0275\u0275elementStart(6,"input",7,1),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275listener("focusin",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.onFocus())})("matChipInputTokenEnd",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.add(l))}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(10,"mat-autocomplete",8,2),e.\u0275\u0275listener("optionSelected",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.selected(l))}),e.\u0275\u0275template(12,LC,3,5,"mat-option",9),e.\u0275\u0275pipe(13,"async"),e.\u0275\u0275template(14,BC,6,4,"mat-option",10),e.\u0275\u0275pipe(15,"async"),e.\u0275\u0275elementEnd()()}if(2&i){let o;const r=e.\u0275\u0275reference(4),l=e.\u0275\u0275reference(8),c=e.\u0275\u0275reference(11);e.\u0275\u0275property("formGroup",n.linksFormGroup),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",n.labels),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("placeholder",n.disabled?"":e.\u0275\u0275pipeBind1(9,10,"rulenode.link-label")),e.\u0275\u0275property("matAutocompleteConnectedTo",l)("matAutocomplete",c)("matChipInputFor",r)("matChipInputSeparatorKeyCodes",n.separatorKeysCodes),e.\u0275\u0275advance(4),e.\u0275\u0275property("displayWith",n.displayLabelFn),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(13,12,n.filteredLabels)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",0===(null==(o=e.\u0275\u0275pipeBind1(15,14,n.filteredLabels))?null:o.length))}},dependencies:[p.NgForOf,p.NgIf,E.MatIcon,L.MatInput,v.MatFormField,v.MatLabel,z.MatOption,Sa.MatAutocomplete,Sa.MatAutocompleteTrigger,Sa.MatAutocompleteOrigin,Ie.MatChipGrid,Ie.MatChipInput,Ie.MatChipRemove,Ie.MatChipRow,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,p.AsyncPipe,Yr.HighlightPipe,u.TranslatePipe],encapsulation:2})}}class Qt{get required(){return this.requiredValue}set required(t){this.requiredValue=(0,ye.coerceBooleanProperty)(t)}get allowCustom(){return this.allowCustomValue}set allowCustom(t){this.allowCustomValue=(0,ye.coerceBooleanProperty)(t)}constructor(t,i,n){this.fb=t,this.truncate=i,this.translate=n,this.propagateChange=o=>{},this.ruleNodeLinkFormGroup=this.fb.group({labels:[[],s.Validators.required]}),this.ruleNodeLinkFormGroup.get("labels").valueChanges.subscribe(o=>this.updateModel(o))}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}ngOnInit(){}setDisabledState(t){this.disabled=t,this.disabled?this.ruleNodeLinkFormGroup.disable({emitEvent:!1}):this.ruleNodeLinkFormGroup.enable({emitEvent:!1})}writeValue(t){this.modelValue=t;const i=this.modelValue&&this.modelValue.labels?this.modelValue.labels:[];this.ruleNodeLinkFormGroup.get("labels").patchValue(i,{emitEvent:!1})}updateModel(t){t&&t.length?(this.modelValue.labels=t,this.modelValue.label=t.join(" / "),this.propagateChange(this.modelValue)):this.propagateChange(this.required?null:this.modelValue)}static{this.\u0275fac=function(i){return new(i||Qt)(e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(ks.TruncatePipe),e.\u0275\u0275directiveInject(u.TranslateService))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Qt,selectors:[["tb-rule-node-link"]],inputs:{required:"required",disabled:"disabled",allowCustom:"allowCustom",allowedLabels:"allowedLabels",sourceRuleChainId:"sourceRuleChainId"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>Qt),multi:!0}])],decls:3,vars:4,consts:[[1,"mat-padding","flex","flex-col"],[3,"formGroup"],["required","","formControlName","labels",3,"allowedLabels","allowCustom","sourceRuleChainId"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"form",1),e.\u0275\u0275element(2,"tb-link-labels",2),e.\u0275\u0275elementEnd()()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275property("formGroup",n.ruleNodeLinkFormGroup),e.\u0275\u0275advance(),e.\u0275\u0275property("allowedLabels",n.allowedLabels)("allowCustom",n.allowCustom)("sourceRuleChainId",n.sourceRuleChainId))},dependencies:[s.\u0275NgNoValidate,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,si],encapsulation:2})}}var Ls=d(84117),GC=d(12887),jC=d(63514),UC=d(15571),qC=d(20226),li=d(42415);const WC=["ruleChainCanvas"],$C=["ruleChainMenuTrigger"],zC=["drawer"],Os=["tbRuleNode"],HC=["tbRuleNodeLink"],KC=["ruleNodeTypeExpansionPanels"],YC=a=>[a];function QC(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tb-rule-chain-select",38),e.\u0275\u0275twoWayListener("ngModelChange",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275twoWayBindingSet(r.ruleChain,o)||(r.ruleChain=o),e.\u0275\u0275resetView(o)}),e.\u0275\u0275listener("ngModelChange",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.currentRuleChainIdChanged(null==o.ruleChain.id?null:o.ruleChain.id.id))}),e.\u0275\u0275elementEnd()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("ruleChainType",i.ruleChainType)("disabled",i.isDirtyValue),e.\u0275\u0275twoWayProperty("ngModel",i.ruleChain)}}function JC(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-expansion-panel",39,5)(2,"mat-expansion-panel-header",40),e.\u0275\u0275listener("mouseenter",function(o){const r=e.\u0275\u0275restoreView(i).$implicit,l=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(l.typeHeaderMouseEnter(o,r))})("mouseleave",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.destroyTooltips())}),e.\u0275\u0275elementStart(3,"mat-panel-title")(4,"mat-icon"),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",41),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275element(8,"fc-canvas",42),e.\u0275\u0275elementEnd()}if(2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("expanded",!0),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(n.ruleNodeTypeDescriptorsMap.get(i).icon),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(n.ruleNodeTypeDescriptorsMap.get(i).name),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate1("id","tb-rulchain-",i,""),e.\u0275\u0275property("model",n.ruleNodeTypesModel[i].model)("selectedObjects",n.ruleNodeTypesModel[i].selectedObjects)("automaticResize",!1)("userCallbacks",n.nodeLibCallbacks)("nodeWidth",170)("nodeHeight",50)("dropTargetId","tb-rulchain-canvas")}}function ZC(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-tab",47,7),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementStart(3,"tb-event-table",55),e.\u0275\u0275listener("debugEventSelected",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(r.onDebugEventSelected(o))}),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,7,"rulenode.events")),e.\u0275\u0275advance(3),e.\u0275\u0275property("debugEventTypes",e.\u0275\u0275pureFunction1(9,YC,n.debugEventTypes.DEBUG_RULE_NODE))("defaultEventType",n.debugEventTypes.DEBUG_RULE_NODE)("active",i.isActive)("tenantId",n.ruleChain.tenantId.id)("entityId",n.editingRuleNode.ruleNodeId)("functionTestButtonLabel",n.ruleNodeTestButtonLabel)}}function XC(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tb-details-panel",43),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275listener("closeDetails",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.onEditRuleNodeClosed())})("toggleDetailsEditMode",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.onRevertRuleNodeEdit())})("applyDetails",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.saveRuleNode())}),e.\u0275\u0275elementStart(2,"div",44),e.\u0275\u0275element(3,"div",45),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"mat-tab-group",46),e.\u0275\u0275twoWayListener("selectedIndexChange",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275twoWayBindingSet(r.selectedRuleNodeTabIndex,o)||(r.selectedRuleNodeTabIndex=o),e.\u0275\u0275resetView(o)}),e.\u0275\u0275elementStart(5,"mat-tab",47),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementStart(7,"tb-rule-node",48,6),e.\u0275\u0275listener("initRuleNode",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.onRuleNodeInit())})("changeScript",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.switchToFirstTab())}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(9,ZC,4,11,"mat-tab",49),e.\u0275\u0275elementStart(10,"mat-tab",47),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementStart(12,"div",50)(13,"div",51)(14,"div",52),e.\u0275\u0275text(15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"div"),e.\u0275\u0275text(17,"\xa0"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(18,"div",53),e.\u0275\u0275pipe(19,"safe"),e.\u0275\u0275elementStart(20,"div"),e.\u0275\u0275text(21,"\xa0"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(22,"div",54),e.\u0275\u0275pipe(23,"safe"),e.\u0275\u0275elementEnd()()()()()}if(2&a){const i=e.\u0275\u0275reference(8),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("headerTitle",n.editingRuleNode.name),e.\u0275\u0275propertyInterpolate("headerSubtitle",e.\u0275\u0275pipeBind1(1,16,n.ruleNodeTypeDescriptorsMap.get(n.editingRuleNode.component.type).name)+" - "+n.editingRuleNode.component.name),e.\u0275\u0275property("isReadOnly",n.selectedRuleNodeTabIndex>0)("isAlwaysEdit",!0)("theForm",i.ruleNodeFormGroup),e.\u0275\u0275advance(3),e.\u0275\u0275property("tb-help",n.helpLinkIdForRuleNodeType()),e.\u0275\u0275advance(),e.\u0275\u0275twoWayProperty("selectedIndex",n.selectedRuleNodeTabIndex),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(6,18,"rulenode.details")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ruleNode",n.editingRuleNode)("ruleChainId",null==n.ruleChain.id?null:n.ruleChain.id.id)("ruleChainType",n.ruleChainType),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.editingRuleNode.ruleNodeId),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(11,20,"rulenode.help")),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(n.editingRuleNode.component.name),e.\u0275\u0275advance(3),e.\u0275\u0275property("innerHtml",e.\u0275\u0275pipeBind2(19,22,n.editingRuleNode.component.configurationDescriptor.nodeDefinition.description,"html"),e.\u0275\u0275sanitizeHtml),e.\u0275\u0275advance(4),e.\u0275\u0275property("innerHtml",e.\u0275\u0275pipeBind2(23,25,n.editingRuleNode.component.configurationDescriptor.nodeDefinition.details,"html"),e.\u0275\u0275sanitizeHtml)}}function ex(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tb-details-panel",43),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275listener("closeDetails",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.onEditRuleNodeLinkClosed())})("toggleDetailsEditMode",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.onRevertRuleNodeLinkEdit())})("applyDetails",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.saveRuleNodeLink())}),e.\u0275\u0275elementStart(2,"div",44),e.\u0275\u0275element(3,"div",45),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"tb-rule-node-link",56,8),e.\u0275\u0275twoWayListener("ngModelChange",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275twoWayBindingSet(r.editingRuleNodeLink,o)||(r.editingRuleNodeLink=o),e.\u0275\u0275resetView(o)}),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275reference(5),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("headerTitle",n.editingRuleNodeLink.label),e.\u0275\u0275propertyInterpolate("headerSubtitle",e.\u0275\u0275pipeBind1(1,10,"rulenode.link-details")),e.\u0275\u0275property("isReadOnly",!1)("isAlwaysEdit",!0)("theForm",i.ruleNodeLinkFormGroup),e.\u0275\u0275advance(3),e.\u0275\u0275property("tb-help","ruleEngine"),e.\u0275\u0275advance(),e.\u0275\u0275twoWayProperty("ngModel",n.editingRuleNodeLink),e.\u0275\u0275property("allowedLabels",n.editingRuleNodeLinkLabels)("allowCustom",n.editingRuleNodeAllowCustomLabels)("sourceRuleChainId",n.editingRuleNodeSourceRuleChainId)}}function tx(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",57,9),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275listener("click",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275reference(1),l=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(l.toggleVersionControl(o,r))}),e.\u0275\u0275elementStart(3,"mat-icon"),e.\u0275\u0275text(4,"history"),e.\u0275\u0275elementEnd()()}2&a&&e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(2,1,"version-control.version-control"))}function nx(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-icon"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext().contextInfo;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(i.icon)}}function ix(a,t){if(1&a&&e.\u0275\u0275element(0,"img",65),2&a){const i=e.\u0275\u0275nextContext().contextInfo;e.\u0275\u0275property("src",i.iconUrl,e.\u0275\u0275sanitizeUrl)}}function ax(a,t){1&a&&e.\u0275\u0275element(0,"mat-divider")}function ox(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"span",70),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"keyboardShortcut"),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(2).$implicit;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,i.shortcut),"")}}function rx(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-icon"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(2).$implicit;e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(i.icon)}}function sx(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",67),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext().$implicit,r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(o.action(r.contextMenuEvent))}),e.\u0275\u0275template(1,ox,3,3,"span",68)(2,rx,2,1,"mat-icon",59),e.\u0275\u0275elementStart(3,"span",69),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275property("disabled",!i.enabled),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.shortcut),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.icon),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(i.value)}}function lx(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275template(1,ax,1,0,"mat-divider",59)(2,sx,5,4,"button",66),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit;e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.divider),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!i.divider)}}function dx(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",58),e.\u0275\u0275listener("mouseleave",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.onRuleChainContextMenuMouseLeave())}),e.\u0275\u0275elementStart(1,"div"),e.\u0275\u0275template(2,nx,2,1,"mat-icon",59)(3,ix,1,1,"img",60),e.\u0275\u0275elementStart(4,"div",61)(5,"div",62),e.\u0275\u0275text(6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div",63),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(9,lx,3,2,"div",64),e.\u0275\u0275elementEnd()}if(2&a){const i=t.contextInfo;e.\u0275\u0275advance(),e.\u0275\u0275classMapInterpolate1("tb-context-menu-header ",i.headerClass,""),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!i.iconUrl),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.iconUrl),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(i.title),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(i.subtitle),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",i.menuItems)}}function cx(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",14)}function px(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",14)}function mx(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",19)}function ux(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"rulechain.name-required")," "))}function gx(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"rulechain.name-max-length")," "))}class st extends de.H{get isDirty(){return this.isDirtyValue||this.isImport}set isDirty(t){this.isDirtyValue=t}constructor(t,i,n,o,r,l,c,m,h,T,N,O,re,At){super(t),this.store=t,this.route=i,this.router=n,this.ruleChainService=o,this.authService=r,this.translate=l,this.itembuffer=c,this.popoverService=m,this.renderer=h,this.viewContainerRef=T,this.changeDetector=N,this.dialog=O,this.dialogService=re,this.fb=At,this.width="100%",this.height="100%",this.eventTypes=Ls.Bx,this.debugEventTypes=Ls.U3,this.ruleChainMenuPosition={x:"0px",y:"0px"},this.ruleNodeTypeDescriptorsMap=B.T_,this.ruleNodeTypesLibraryArray=B.XC,this.isInvalid=!1,this.errorTooltips={},this.isFullscreen=!1,this.selectedRuleNodeTabIndex=0,this.editingRuleNode=null,this.isEditingRuleNode=!1,this.editingRuleNodeIndex=-1,this.editingRuleNodeAllowCustomLabels=!1,this.editingRuleNodeLink=null,this.isEditingRuleNodeLink=!1,this.editingRuleNodeLinkIndex=-1,this.hotKeys=[],this.enableHotKeys=!0,this.ruleNodeSearch="",this.ruleNodeTypeSearch=this.fb.control("",{nonNullable:!0}),this.ruleChainModel={nodes:[],edges:[]},this.selectedObjects=[],this.editCallbacks={edgeDoubleClick:(lt,I)=>{this.openLinkDetails(I)},edgeEdit:(lt,I)=>{this.openLinkDetails(I)},nodeCallbacks:{doubleClick:(lt,I)=>{this.openNodeDetails(I)},nodeEdit:(lt,I)=>{this.openNodeDetails(I)},mouseEnter:this.displayNodeDescriptionTooltip.bind(this),mouseLeave:this.destroyTooltips.bind(this),mouseDown:this.destroyTooltips.bind(this)},isValidEdge:(lt,I)=>lt.type===Y._0.rightConnectorType&&I.type===Y._0.leftConnectorType,createEdge:(lt,I)=>{const oe=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(I.source);if(oe.component.type===B.zu.INPUT){const ve=this.ruleChainModel.edges.find(ge=>ge.source===this.inputConnectorId+"");return ve&&this.ruleChainCanvas.modelService.edges.delete(ve),(0,H.of)(I)}if(I.label)return I.labels||(I.labels=I.label.split(" / ")),(0,H.of)(I);{const ve=this.ruleChainService.getRuleNodeSupportedLinks(oe.component),ge=this.ruleChainService.ruleNodeAllowCustomLinks(oe.component),De=this.ruleChainService.ruleNodeSourceRuleChainId(oe.component,oe.configuration);return this.enableHotKeys=!1,this.addRuleNodeLink(I,ve,ge,De).pipe((0,ne.M)(()=>{this.enableHotKeys=!0}),(0,Z.Z)(ze=>ze?(0,H.of)(ze):gC.t))}},dropNode:(lt,I)=>{this.addRuleNode(I)}},this.ruleNodeTypesModel={},this.nodeLibCallbacks={nodeCallbacks:{mouseEnter:this.displayLibNodeDescriptionTooltip.bind(this),mouseLeave:this.destroyTooltips.bind(this),mouseDown:this.destroyTooltips.bind(this)}},this.flowchartConstants=Y._0,this.updateBreadcrumbs=new e.EventEmitter,this.destroy$=new fe.B,this.route.data.pipe((0,j.Q)(this.destroy$)).subscribe(()=>{this.reset(),this.init()})}ngOnInit(){this.ruleNodeTypeSearch.valueChanges.pipe((0,Hr.B)(150),(0,sa.Z)(""),(0,yr.F)((t,i)=>t.trim()===i.trim()),(0,fC.i)(1),(0,j.Q)(this.destroy$)).subscribe(()=>this.updateRuleChainLibrary())}ngAfterViewChecked(){this.changeDetector.detectChanges()}ngAfterViewInit(){this.ruleChainCanvas.adjustCanvasSize(!0)}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}currentRuleChainIdChanged(t){this.ruleChainType===ue.UR.CORE?this.router.navigateByUrl(`ruleChains/${t}`):this.router.navigateByUrl(`edgeManagement/ruleChains/${t}`)}onSearchTextUpdated(t){this.ruleNodeSearch=t,this.updateRuleNodesHighlight()}init(){if(this.initHotKeys(),this.isImport=this.route.snapshot.data.import,this.ruleChainType=this.route.snapshot.data.ruleChainType,this.isImport){const t=this.itembuffer.getRuleChainImport();this.ruleChain=t.ruleChain,this.ruleChainMetaData=t.metadata}else this.ruleChain=this.route.snapshot.data.ruleChain,this.ruleChainMetaData=this.route.snapshot.data.ruleChainMetaData;this.ruleNodeComponents=this.route.snapshot.data.ruleNodeComponents;for(const t of B.XC)B.T_.get(t).special||(this.ruleNodeTypesModel[t]={model:{nodes:[],edges:[]},selectedObjects:[]});this.updateRuleChainLibrary(),this.createRuleChainModel()}reset(){this.selectedObjects=[],this.ruleChainModel.nodes=[],this.ruleChainModel.edges=[],this.ruleNodeTypesModel={},this.ruleChainCanvas&&this.ruleChainCanvas.adjustCanvasSize(!0),this.isEditingRuleNode=!1,this.isEditingRuleNodeLink=!1,this.updateRuleNodesHighlight()}initHotKeys(){this.hotKeys.length||(this.hotKeys.push(new Me.t5("ctrl+a",t=>!this.enableHotKeys||(t.preventDefault(),this.ruleChainCanvas.modelService.selectAll(),!1),[],this.translate.instant("rulenode.select-all-objects"))),this.hotKeys.push(new Me.t5("ctrl+c",t=>!this.enableHotKeys||(t.preventDefault(),this.copyRuleNodes(),!1),[],this.translate.instant("rulenode.copy-selected"))),this.hotKeys.push(new Me.t5("ctrl+v",t=>!this.enableHotKeys||(t.preventDefault(),this.itembuffer.hasRuleNodes()&&this.pasteRuleNodes(),!1),[],this.translate.instant("action.paste"))),this.hotKeys.push(new Me.t5("esc",t=>!this.enableHotKeys||(t.preventDefault(),t.stopPropagation(),this.ruleChainCanvas.modelService.deselectAll(),!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("rulenode.deselect-all-objects"))),this.hotKeys.push(new Me.t5("ctrl+s",t=>!this.enableHotKeys||(t.preventDefault(),this.saveRuleChain(),!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("action.apply"))),this.hotKeys.push(new Me.t5("ctrl+z",t=>!this.enableHotKeys||(t.preventDefault(),this.revertRuleChain(),!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("action.decline-changes"))),this.hotKeys.push(new Me.t5("del",t=>!this.enableHotKeys||(t.preventDefault(),this.ruleChainCanvas.modelService.deleteSelected(),!1),[],this.translate.instant("rulenode.delete-selected-objects"))),this.hotKeys.push(new Me.t5("ctrl+r",t=>!this.enableHotKeys||!this.canCreateNestedRuleChain()||(t.preventDefault(),this.createNestedRuleChain(),!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("rulenode.create-nested-rulechain"))))}updateRuleChainLibrary(){const t=this.ruleNodeTypeSearch.value.trim().toUpperCase(),i=this.ruleNodeComponents.filter(n=>n.name.toUpperCase().includes(t));this.loadRuleChainLibrary(i)}loadRuleChainLibrary(t){for(const i of Object.keys(this.ruleNodeTypesModel))this.ruleNodeTypesModel[i].model.nodes.length=0;if(t.forEach(i=>{const n=i.type,o=this.ruleNodeTypesModel[n].model,r=B.T_.get(B.zu[n]);let l=r.icon,c=null;i.configurationDescriptor.nodeDefinition.icon&&(l=i.configurationDescriptor.nodeDefinition.icon),i.configurationDescriptor.nodeDefinition.iconUrl&&(c=i.configurationDescriptor.nodeDefinition.iconUrl);const m={id:"node-lib-"+n+"-"+o.nodes.length,component:i,name:"",nodeClass:r.nodeClass,singletonMode:i.clusteringMode!==sr.VG.ENABLED,icon:l,iconUrl:c,x:30,y:10+50*o.nodes.length,connectors:[]};i.configurationDescriptor.nodeDefinition.inEnabled&&m.connectors.push({type:Y._0.leftConnectorType,id:2*o.nodes.length+""}),i.configurationDescriptor.nodeDefinition.outEnabled&&m.connectors.push({type:Y._0.rightConnectorType,id:2*o.nodes.length+1+""}),o.nodes.push(m)}),this.expansionPanels)for(let i=0;i<B.XC.length;i++){const n=this.expansionPanels.find((o,r)=>r===i);if(n){const o=B.XC[i];this.ruleNodeTypesModel[o].model.nodes.length?n.open():n.close()}}}createRuleChainModel(){this.nextNodeID=1,this.nextConnectorID=1,this.selectedObjects=[],this.ruleChainModel.nodes=[],this.ruleChainModel.edges=[],this.inputConnectorId=this.nextConnectorID++,this.ruleChainModel.nodes.push({id:"rule-chain-node-"+this.nextNodeID++,component:ue.IW,name:"",nodeClass:B.T_.get(B.zu.INPUT).nodeClass,icon:B.T_.get(B.zu.INPUT).icon,readonly:!0,x:50,y:150,connectors:[{type:Y._0.rightConnectorType,id:this.inputConnectorId+""}]});const t=[];if(this.ruleChainMetaData.nodes.forEach(i=>{const n=this.ruleChainService.getRuleNodeComponentByClazz(this.ruleChainType,i.type),o=B.T_.get(n.type);let r=o.icon,l=null;n.configurationDescriptor.nodeDefinition.icon&&(r=n.configurationDescriptor.nodeDefinition.icon),n.configurationDescriptor.nodeDefinition.iconUrl&&(l=n.configurationDescriptor.nodeDefinition.iconUrl);const c={id:"rule-chain-node-"+this.nextNodeID++,ruleNodeId:i.id,additionalInfo:i.additionalInfo,configuration:i.configuration,configurationVersion:(0,_.f1)(i.configurationVersion)?i.configurationVersion:0,debugMode:i.debugMode,singletonMode:i.singletonMode,queueName:i.queueName,x:Math.round(i.additionalInfo.layoutX),y:Math.round(i.additionalInfo.layoutY),component:n,name:i.name,nodeClass:o.nodeClass,icon:r,iconUrl:l,connectors:[],ruleChainType:this.ruleChainType};n.configurationDescriptor.nodeDefinition.inEnabled&&c.connectors.push({type:Y._0.leftConnectorType,id:this.nextConnectorID+++""}),n.configurationDescriptor.nodeDefinition.outEnabled&&c.connectors.push({type:Y._0.rightConnectorType,id:this.nextConnectorID+++""}),t.push(c),this.ruleChainModel.nodes.push(c)}),this.ruleChainMetaData.firstNodeIndex>-1){const i=t[this.ruleChainMetaData.firstNodeIndex];if(i){const n=i.connectors.filter(o=>o.type===Y._0.leftConnectorType);if(n&&n.length){const o={source:this.inputConnectorId+"",destination:n[0].id};this.ruleChainModel.edges.push(o)}}}if(this.ruleChainMetaData.connections){const i={};this.ruleChainMetaData.connections.forEach(n=>{const o=t[n.fromIndex],r=t[n.toIndex];if(o&&r){const l=o.connectors.filter(m=>m.type===Y._0.rightConnectorType),c=r.connectors.filter(m=>m.type===Y._0.leftConnectorType);if(l&&l.length&&c&&c.length){const m=l[0].id,h=c[0].id,T=m+"_"+h;let N=i[T];N?(N.label+=" / "+n.type,N.labels.push(n.type)):(N={source:m,destination:h,label:n.type,labels:[n.type]},i[T]=N,this.ruleChainModel.edges.push(N))}}})}this.ruleChainCanvas&&this.ruleChainCanvas.adjustCanvasSize(!0),this.isDirtyValue=!1,this.updateRuleNodesHighlight(),this.validate()}openRuleChainContextMenu(t){if(this.ruleChainCanvas.modelService&&!t.ctrlKey&&!t.metaKey){const i=t.clientX,n=t.clientY,o=this.ruleChainCanvas.modelService.getItemInfoAtPoint(i,n),r=this.prepareContextMenu(o);r.menuItems&&r.menuItems.length>0&&(t.preventDefault(),t.stopPropagation(),this.contextMenuEvent=t,this.ruleChainMenuPosition.x=i+"px",this.ruleChainMenuPosition.y=n+"px",this.ruleChainMenuTrigger.menuData={contextInfo:r},this.ruleChainMenuTrigger.openMenu())}}onRuleChainContextMenuMouseLeave(){this.ruleChainMenuTrigger.closeMenu()}prepareContextMenu(t){return this.objectsSelected()||!t.node&&!t.edge?this.prepareRuleChainContextMenu():t.node?this.prepareRuleNodeContextMenu(t.node):t.edge?this.prepareEdgeContextMenu(t.edge):void 0}prepareRuleChainContextMenu(){const t={headerClass:"tb-rulechain-header",icon:"settings_ethernet",title:this.ruleChain.name,subtitle:this.translate.instant("rulechain.rulechain"),menuItems:[]};return this.ruleChainCanvas.modelService.nodes.getSelectedNodes().length&&t.menuItems.push({action:()=>{this.copyRuleNodes()},enabled:!0,value:"rulenode.copy-selected",icon:"content_copy",shortcut:"M-C"}),t.menuItems.push({action:i=>{this.pasteRuleNodes(i)},enabled:this.itembuffer.hasRuleNodes(),value:"action.paste",icon:"content_paste",shortcut:"M-V"}),t.menuItems.push({divider:!0}),this.objectsSelected()?(t.menuItems.push({action:()=>{this.ruleChainCanvas.modelService.deselectAll()},enabled:!0,value:"rulenode.deselect-all",icon:"tab_unselected",shortcut:"Esc"}),this.canCreateNestedRuleChain()&&t.menuItems.push({action:()=>{this.createNestedRuleChain()},enabled:!0,value:"rulenode.create-nested-rulechain",icon:"settings_ethernet",shortcut:"M-R"}),t.menuItems.push({action:()=>{this.ruleChainCanvas.modelService.deleteSelected()},enabled:!0,value:"rulenode.delete-selected",icon:"clear",shortcut:"Del"})):t.menuItems.push({action:()=>{this.ruleChainCanvas.modelService.selectAll()},enabled:!0,value:"rulenode.select-all",icon:"select_all",shortcut:"M-A"}),t.menuItems.push({divider:!0}),t.menuItems.push({action:()=>{this.saveRuleChain()},enabled:!(this.isInvalid||!this.isDirty&&!this.isImport),value:"action.apply-changes",icon:"done",shortcut:"M-S"}),t.menuItems.push({action:()=>{this.revertRuleChain()},enabled:this.isDirty,value:"action.decline-changes",icon:"close",shortcut:"M-Z"}),t}prepareRuleNodeContextMenu(t){const i={headerClass:t.nodeClass,icon:t.icon,iconUrl:t.iconUrl,title:t.name,subtitle:t.component.name,menuItems:[]};return t.readonly||(i.menuItems.push({action:()=>{this.openNodeDetails(t)},enabled:!0,value:"rulenode.details",icon:"menu"}),i.menuItems.push({action:()=>{this.copyNode(t)},enabled:!0,value:"action.copy",icon:"content_copy"}),i.menuItems.push({action:()=>{this.ruleChainCanvas.modelService.nodes.delete(t)},enabled:!0,value:"action.delete",icon:"clear",shortcut:"M-X"})),i}prepareEdgeContextMenu(t){const i={headerClass:"tb-link-header",icon:"trending_flat",title:t.label,subtitle:this.translate.instant("rulenode.link"),menuItems:[]};return this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(t.source).component.type!==B.zu.INPUT&&i.menuItems.push({action:()=>{this.openLinkDetails(t)},enabled:!0,value:"rulenode.details",icon:"menu"}),i.menuItems.push({action:()=>{this.ruleChainCanvas.modelService.edges.delete(t)},enabled:!0,value:"action.delete",icon:"clear",shortcut:"M-X"}),i}canCreateNestedRuleChain(){const t=this.ruleChainCanvas.modelService.nodes.getSelectedNodes(),i=this.ruleChainCanvas.modelService.edges.getSelectedEdges();if(t.length>1){const n=new Set;return i.forEach(r=>{const l=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(r.source),c=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(r.destination),m=t.indexOf(l),h=t.indexOf(c);m>-1&&h>-1&&n.add(h)}),t.filter((r,l)=>!n.has(l)).filter(r=>r.component.configurationDescriptor.nodeDefinition.inEnabled).length<=1}return!1}createNestedRuleChain(){const t=this.ruleChainCanvas.modelService.nodes.getSelectedNodes(),i=this.ruleChainCanvas.modelService.edges.getSelectedEdges();this.dialog.open(pi,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{ruleChainType:this.ruleChainType}}).afterClosed().subscribe(n=>{if(n){this.ruleChainCanvas.modelService.deselectAll();const o={ruleChainId:n.id,nodes:[],connections:[]};let r=[],l=null,c=0,m=null,h=0;t.forEach(I=>{const oe={type:I.component.clazz,name:I.name,configuration:(0,_.Go)(I.configuration),additionalInfo:I.additionalInfo?(0,_.Go)(I.additionalInfo):{},debugMode:I.debugMode,singletonMode:I.singletonMode,queueName:I.queueName};l=null===l?I.x:Math.min(l,I.x),m=null===m?I.y:Math.min(m,I.y),c=Math.max(c,I.x),h=Math.max(h,I.y),oe.additionalInfo.layoutX=Math.round(I.x),oe.additionalInfo.layoutY=Math.round(I.y),o.nodes.push(oe),this.ruleChainCanvas.modelService.nodes.getConnectorsByType(I,Y._0.rightConnectorType).forEach(ge=>{const ze=this.ruleChainCanvas.modelService.model.edges.filter(He=>He.source===ge.id).filter(He=>{const dt=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(He.destination);return-1===t.indexOf(dt)});r=r.concat(ze)})});const T=new Set;i.forEach(I=>{const oe=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(I.source),ve=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(I.destination);if(oe.component.type!==B.zu.INPUT){const ge=t.indexOf(oe),De=t.indexOf(ve);if(ge>-1&&De>-1){const ze={fromIndex:ge,toIndex:De};I.labels.forEach(He=>{const dt=(0,_.Go)(ze);dt.type=He,o.connections.push(dt)}),T.add(De)}}});const O=t.filter((I,oe)=>!T.has(oe)).filter(I=>I.component.configurationDescriptor.nodeDefinition.inEnabled);let re=[];if(O.length){const I=O[0],oe=this.ruleChainCanvas.modelService.nodes.getConnectorsByType(I,Y._0.leftConnectorType);if(oe.length){const ve=oe[0],ge=this.ruleChainCanvas.modelService.model.edges.filter(De=>De.destination===ve.id);re=re.concat(ge)}o.firstNodeIndex=t.indexOf(I)}r.forEach(I=>{const oe=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(I.source),ve=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(I.destination),ge={type:B.S9,name:I.label,configuration:{},additionalInfo:{},debugMode:!1,singletonMode:!1};ge.additionalInfo.layoutX=Math.round(ve.x),ge.additionalInfo.layoutY=Math.round(ve.y),o.nodes.push(ge);const He={fromIndex:t.indexOf(oe),toIndex:o.nodes.length-1};I.labels.forEach(dt=>{const pr=(0,_.Go)(He);pr.type=dt,o.connections.push(pr)})});const At=Math.round(l-375),lt=Math.round(m-150);o.nodes.forEach(I=>{I.additionalInfo.layoutX-=At,I.additionalInfo.layoutY-=lt}),this.ruleChainService.saveRuleChainMetadata(o).subscribe(()=>{const I=this.ruleChainService.getRuleNodeComponentByClazz(this.ruleChainType,B.g4),oe=B.T_.get(I.type);let ve=oe.icon,ge=null;I.configurationDescriptor.nodeDefinition.icon&&(ve=I.configurationDescriptor.nodeDefinition.icon),I.configurationDescriptor.nodeDefinition.iconUrl&&(ge=I.configurationDescriptor.nodeDefinition.iconUrl);const De=(l+c)/2,ze=(m+h)/2,He=this.nextConnectorID+++"",dt=this.nextConnectorID+++"",pr={name:n.name,component:I,id:"rule-chain-node-"+this.nextNodeID++,configuration:{ruleChainId:n.id.id},debugMode:!1,singletonMode:!1,x:Math.round(De),y:Math.round(ze),nodeClass:oe.nodeClass,icon:ve,iconUrl:ge,ruleChainType:this.ruleChainType,connectors:[{type:Y._0.leftConnectorType,id:He},{type:Y._0.rightConnectorType,id:dt}]};this.ruleChainModel.nodes.push(pr),re.forEach(an=>{an.destination=He}),r.forEach(an=>{an.source=dt,an.labels=[an.label]}),t.forEach(an=>{this.ruleChainCanvas.modelService.nodes.delete(an)}),this.onModelChanged(),this.updateRuleNodesHighlight()})}})}onModelChanged(){this.isDirtyValue=!0,this.validate()}helpLinkIdForRuleNodeType(){let t=null;return this.editingRuleNode&&(t=this.editingRuleNode.component),(0,B.mL)(t)}openNodeDetails(t){t.component.type!==B.zu.INPUT&&(this.enableHotKeys=!1,this.updateErrorTooltips(!0),this.isEditingRuleNodeLink=!1,this.editingRuleNodeLink=null,this.isEditingRuleNode=!0,this.editingRuleNodeIndex=this.ruleChainModel.nodes.indexOf(t),this.editingRuleNode=(0,_.Go)(t,["component"]),setTimeout(()=>{this.ruleNodeComponent.ruleNodeFormGroup.markAsPristine()},0))}openLinkDetails(t){const i=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(t.source);i.component.type!==B.zu.INPUT&&(this.enableHotKeys=!1,this.updateErrorTooltips(!0),this.isEditingRuleNode=!1,this.editingRuleNode=null,this.editingRuleNodeLinkLabels=this.ruleChainService.getRuleNodeSupportedLinks(i.component),this.editingRuleNodeAllowCustomLabels=this.ruleChainService.ruleNodeAllowCustomLinks(i.component),this.editingRuleNodeSourceRuleChainId=this.ruleChainService.ruleNodeSourceRuleChainId(i.component,i.configuration),this.isEditingRuleNodeLink=!0,this.editingRuleNodeLinkIndex=this.ruleChainModel.edges.indexOf(t),this.editingRuleNodeLink=(0,_.Go)(t),setTimeout(()=>{this.ruleNodeLinkComponent.ruleNodeLinkFormGroup.markAsPristine()},0))}copyNode(t){this.itembuffer.copyRuleNodes([t],[])}copyRuleNodes(){const t=this.ruleChainCanvas.modelService.nodes.getSelectedNodes(),i=this.ruleChainCanvas.modelService.edges.getSelectedEdges(),n=[];i.forEach(o=>{const r=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(o.source),l=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(o.destination),c=r.component.type===B.zu.INPUT,m=t.indexOf(r),h=t.indexOf(l);if((c||m>-1)&&h>-1){const T={isInputSource:c,fromIndex:m,toIndex:h,label:o.label,labels:o.labels};n.push(T)}}),this.itembuffer.copyRuleNodes(t,n)}pasteRuleNodes(t){const i=li(this.ruleChainCanvas.modelService.canvasHtmlElement);let n,o;if(t){const l=i.offset();n=Math.round(t.clientX-l.left),o=Math.round(t.clientY-l.top)}else{const l=i.parent(),c=l.scrollTop();n=l.scrollLeft()+l.width()/2,o=c+l.height()/2}const r=this.itembuffer.pasteRuleNodes(n,o);if(r){this.ruleChainCanvas.modelService.deselectAll();const l=[];r.nodes.forEach(c=>{c.id="rule-chain-node-"+this.nextNodeID++;const m=c.component;m.configurationDescriptor.nodeDefinition.inEnabled&&c.connectors.push({type:Y._0.leftConnectorType,id:this.nextConnectorID+++""}),m.configurationDescriptor.nodeDefinition.outEnabled&&c.connectors.push({type:Y._0.rightConnectorType,id:this.nextConnectorID+++""}),l.push(c),this.ruleChainModel.nodes.push(c),this.ruleChainCanvas.modelService.nodes.select(c)}),r.connections.forEach(c=>{const m=l[c.fromIndex],h=l[c.toIndex];if((c.isInputSource||m)&&h){let T,N;if(c.isInputSource){T=this.inputConnectorId+"";const re=this.ruleChainModel.edges.find(At=>At.source===this.inputConnectorId+"");re&&this.ruleChainCanvas.modelService.edges.delete(re)}else{const re=this.ruleChainCanvas.modelService.nodes.getConnectorsByType(m,Y._0.rightConnectorType);re&&re.length&&(T=re[0].id)}const O=this.ruleChainCanvas.modelService.nodes.getConnectorsByType(h,Y._0.leftConnectorType);if(O&&O.length&&(N=O[0].id),T&&N){const re={source:T,destination:N,label:c.label,labels:c.labels};this.ruleChainModel.edges.push(re),this.ruleChainCanvas.modelService.edges.select(re)}}}),this.updateRuleNodesHighlight(),this.validate(),this.onModelChanged()}}onDetailsDrawerClosed(){this.onEditRuleNodeClosed(),this.onEditRuleNodeLinkClosed(),this.enableHotKeys=!0,this.updateErrorTooltips(!1)}onEditRuleNodeClosed(){this.editingRuleNode=null,this.isEditingRuleNode=!1}onEditRuleNodeLinkClosed(){this.editingRuleNodeLink=null,this.isEditingRuleNodeLink=!1}onRevertRuleNodeEdit(){this.ruleNodeComponent.ruleNodeFormGroup.markAsPristine();const t=this.ruleChainModel.nodes[this.editingRuleNodeIndex];this.editingRuleNode=(0,_.Go)(t,["component"])}onRevertRuleNodeLinkEdit(){this.ruleNodeLinkComponent.ruleNodeLinkFormGroup.markAsPristine();const t=this.ruleChainModel.edges[this.editingRuleNodeLinkIndex];this.editingRuleNodeLink=(0,_.Go)(t)}onDebugEventSelected(t){const i=this.ruleNodeComponent.ruleNodeConfigComponent,n=i.definedConfigComponent;i.useDefinedDirective()&&n.hasScript&&n.testScript&&n.testScript(t)}onRuleNodeInit(){const t=this.ruleNodeComponent.ruleNodeConfigComponent.definedConfigComponent;this.ruleNodeComponent.ruleNodeConfigComponent.useDefinedDirective()&&t.hasScript?this.ruleNodeTestButtonLabel=t.testScriptLabel:this.ruleNodeTestButtonLabel=""}switchToFirstTab(){this.selectedRuleNodeTabIndex=0}saveRuleNode(){this.ruleNodeComponent.validate(),this.ruleNodeComponent.ruleNodeFormGroup.valid&&(this.ruleNodeComponent.ruleNodeFormGroup.markAsPristine(),this.editingRuleNode.error&&delete this.editingRuleNode.error,this.ruleChainModel.nodes[this.editingRuleNodeIndex]=this.editingRuleNode,this.editingRuleNode=(0,_.Go)(this.editingRuleNode,["component"]),this.onModelChanged(),this.updateRuleNodesHighlight())}saveRuleNodeLink(){this.ruleNodeLinkComponent.ruleNodeLinkFormGroup.markAsPristine(),this.ruleChainModel.edges[this.editingRuleNodeLinkIndex]=this.editingRuleNodeLink,this.editingRuleNodeLink=(0,_.Go)(this.editingRuleNodeLink),this.onModelChanged()}typeHeaderMouseEnter(t,i){const n=B.T_.get(i);this.displayTooltip(t,'<div class="tb-rule-node-tooltip tb-lib-tooltip"><div id="tb-node-content"><div class="tb-node-title">'+this.translate.instant(n.name)+'</div><div class="tb-node-details">'+this.translate.instant(n.details)+"</div></div></div>")}displayLibNodeDescriptionTooltip(t,i){this.displayTooltip(t,'<div class="tb-rule-node-tooltip tb-lib-tooltip"><div id="tb-node-content"><div class="tb-node-title">'+i.component.name+'</div><div class="tb-node-description">'+i.component.configurationDescriptor.nodeDefinition.description+'</div><div class="tb-node-details">'+i.component.configurationDescriptor.nodeDefinition.details+"</div></div></div>")}displayNodeDescriptionTooltip(t,i){if(!this.errorTooltips[i.id]){let n,o,r;i.component.type===B.zu.INPUT?(n=this.translate.instant(B.T_.get(B.zu.INPUT).name),o=this.translate.instant(B.T_.get(B.zu.INPUT).details)):(n=i.name,o=this.translate.instant(B.T_.get(i.component.type).name)+" - "+i.component.name,i.additionalInfo&&(r=i.additionalInfo.description));let l='<div class="tb-rule-node-tooltip"><div id="tb-node-content"><div class="tb-node-title">'+n+'</div><div class="tb-node-description">'+o+"</div>";r&&(l+='<div class="tb-node-details">'+r+"</div>"),l+="</div></div>",this.displayTooltip(t,l)}}destroyTooltips(){this.tooltipTimeout&&(clearTimeout(this.tooltipTimeout),this.tooltipTimeout=null),li.tooltipster.instances().forEach(i=>{i.isErrorTooltip||i.destroy()})}updateRuleNodesHighlight(){for(const t of this.ruleChainModel.nodes)t.highlighted=!1;if(this.ruleNodeSearch){const t=this.ruleNodeSearch.toUpperCase(),i=this.ruleChainModel.nodes.filter(n=>n.name.toUpperCase().includes(t));if(i)for(const n of i)n.highlighted=!0}this.ruleChainCanvas&&this.ruleChainCanvas.modelService.detectChanges()}objectsSelected(){return this.ruleChainCanvas.modelService.nodes.getSelectedNodes().length>0||this.ruleChainCanvas.modelService.edges.getSelectedEdges().length>0}deleteSelected(){this.ruleChainCanvas.modelService.deleteSelected()}isDebugModeEnabled(){return typeof this.ruleChainModel.nodes.find(i=>i.debugMode)<"u"}resetDebugModeInAllNodes(){let t=!1;this.ruleChainModel.nodes.forEach(i=>{i.component.type!==B.zu.INPUT&&(t=t||i.debugMode,i.debugMode=!1)}),t&&this.onModelChanged()}validate(){setTimeout(()=>{this.isInvalid=!1,this.ruleChainModel.nodes.forEach(t=>{t.error&&(this.isInvalid=!0),this.updateNodeErrorTooltip(t)})},0)}saveRuleChain(){const t=new hC.m;let i;return i=this.isImport?this.ruleChainService.saveRuleChain(this.ruleChain):(0,H.of)(this.ruleChain),i.subscribe(n=>{this.ruleChain=n;const o={ruleChainId:this.ruleChain.id,nodes:[],connections:[],version:n.version},r=[];this.ruleChainModel.nodes.forEach(c=>{if(c.component.type!==B.zu.INPUT){const m={id:c.ruleNodeId,type:c.component.clazz,name:c.name,configurationVersion:(0,_.f1)(c.configurationVersion)?c.configurationVersion:c.component.configurationVersion,configuration:c.configuration,additionalInfo:c.additionalInfo?c.additionalInfo:{},debugMode:c.debugMode,singletonMode:c.singletonMode,queueName:c.queueName};m.additionalInfo.layoutX=Math.round(c.x),m.additionalInfo.layoutY=Math.round(c.y),o.nodes.push(m),r.push(c)}});const l=this.ruleChainModel.edges.find(c=>c.source===this.inputConnectorId+"");if(l){const c=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(l.destination);o.firstNodeIndex=r.indexOf(c)}this.ruleChainModel.edges.forEach(c=>{const m=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(c.source),h=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(c.destination);if(m.component.type!==B.zu.INPUT){const O={fromIndex:r.indexOf(m),toIndex:r.indexOf(h)};c.labels.forEach(re=>{const At=(0,_.Go)(O);At.type=re,o.connections.push(At)})}}),this.ruleChainService.saveRuleChainMetadata(o).pipe((0,cn.W)(c=>c.status===ha.HttpStatusCode.Conflict?this.ruleChainService.getRuleChainMetadata(o.ruleChainId.id):(0,hr.$)(()=>c))).subscribe(c=>{this.ruleChain.version=c.version,this.ruleChainMetaData=c,this.isImport?(this.isDirtyValue=!1,this.isImport=!1,this.ruleChainType!==ue.UR.EDGE?this.router.navigateByUrl(`ruleChains/${this.ruleChain.id.id}`):this.router.navigateByUrl(`edgeManagement/ruleChains/${this.ruleChain.id.id}`)):this.createRuleChainModel(),t.next()})}),t}reloadRuleChain(){this.ruleChainService.getRuleChain(this.ruleChain.id.id).subscribe(t=>{this.ruleChain=t,this.updateBreadcrumbs.emit(),this.ruleChainService.getRuleChainMetadata(this.ruleChain.id.id).subscribe(i=>{this.ruleChainMetaData=i,this.isDirtyValue=!1,this.createRuleChainModel()})})}revertRuleChain(){this.createRuleChainModel()}addRuleNode(t){t.configuration=(0,_.Go)(t.component.configurationDescriptor.nodeDefinition.defaultConfiguration);const i=this.ruleChain.id?this.ruleChain.id.id:null;this.enableHotKeys=!1;const n=this.ruleChainType;this.dialog.open(ci,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{ruleNode:t,ruleChainId:i,ruleChainType:n}}).afterClosed().subscribe(o=>{o&&(o.id="rule-chain-node-"+this.nextNodeID++,o.connectors=[],o.component.configurationDescriptor.nodeDefinition.inEnabled&&o.connectors.push({id:this.nextConnectorID+++"",type:Y._0.leftConnectorType}),o.component.configurationDescriptor.nodeDefinition.outEnabled&&o.connectors.push({id:this.nextConnectorID+++"",type:Y._0.rightConnectorType}),this.ruleChainModel.nodes.push(o),this.onModelChanged(),this.updateRuleNodesHighlight()),this.enableHotKeys=!0})}addRuleNodeLink(t,i,n,o){return this.dialog.open(di,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{link:t,labels:i,allowCustomLabels:n,sourceRuleChainId:o}}).afterClosed()}toggleVersionControl(t,i){t&&t.stopPropagation();const n=i._elementRef.nativeElement;if(this.popoverService.hasPopover(n))this.popoverService.hidePopover(n);else{const o=this.popoverService.displayPopover(n,this.renderer,this.viewContainerRef,ke.d,"leftTop",!0,null,{detailsMode:!0,active:!0,singleEntityMode:!0,externalEntityId:this.ruleChain.externalId||this.ruleChain.id,entityId:this.ruleChain.id,entityName:this.ruleChain.name,onBeforeCreateVersion:()=>this.isDirty?this.saveRuleChain():(0,H.of)(null)},{},{},{},!0);o.tbComponentRef.instance.popoverComponent=o,o.tbComponentRef.instance.versionRestored.subscribe(()=>{this.reloadRuleChain()})}}updateNodeErrorTooltip(t){if(t.error){const i=li("#"+t.id);let n=this.errorTooltips[t.id];if(!n||!i.hasClass("tooltipstered")){i.tooltipster({theme:"tooltipster-shadow",delay:0,animationDuration:0,trigger:"custom",triggerOpen:{click:!1,tap:!1},triggerClose:{click:!1,tap:!1,scroll:!1},side:"top",trackOrigin:!0});const o='<div class="tb-rule-node-error-tooltip"><div id="tooltip-content"><div class="tb-node-details">'+t.error+"</div></div></div>",r=li(o);n=i.tooltipster("instance"),n.isErrorTooltip=!0,n.content(r),this.errorTooltips[t.id]=n}setTimeout(()=>{n.open()},0)}else this.errorTooltips[t.id]&&(this.errorTooltips[t.id].destroy(),delete this.errorTooltips[t.id])}updateErrorTooltips(t){for(const i of Object.keys(this.errorTooltips)){const n=this.errorTooltips[i];t?n.close():n.open()}}displayTooltip(t,i){this.destroyTooltips(),this.tooltipTimeout=setTimeout(()=>{const n=li(t.target);n.tooltipster({theme:"tooltipster-shadow",delay:100,trigger:"custom",triggerOpen:{click:!1,tap:!1},triggerClose:{click:!0,tap:!0,scroll:!0},side:"right",distance:12,trackOrigin:!0});const o=li(i),r=n.tooltipster("instance");r.content(o),r.open()},500)}static{this.\u0275fac=function(i){return new(i||st)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.ActivatedRoute),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(St.P),e.\u0275\u0275directiveInject(on.u),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(Ps.Z),e.\u0275\u0275directiveInject(Zo.TbPopoverService),e.\u0275\u0275directiveInject(e.Renderer2),e.\u0275\u0275directiveInject(e.ViewContainerRef),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(S.MatDialog),e.\u0275\u0275directiveInject(Ce.o),e.\u0275\u0275directiveInject(s.FormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:st,selectors:[["tb-rulechain-page"]],viewQuery:function(i,n){if(1&i&&(e.\u0275\u0275viewQuery(WC,7),e.\u0275\u0275viewQuery($C,7),e.\u0275\u0275viewQuery(zC,5),e.\u0275\u0275viewQuery(Os,5),e.\u0275\u0275viewQuery(HC,5),e.\u0275\u0275viewQuery(KC,5,U.MatExpansionPanel)),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.ruleChainCanvas=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.ruleChainMenuTrigger=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.drawer=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.ruleNodeComponent=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.ruleNodeLinkComponent=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.expansionPanels=o)}},hostVars:4,hostBindings:function(i,n){2&i&&e.\u0275\u0275styleProp("width",n.width)("height",n.height)},features:[e.\u0275\u0275InheritDefinitionFeature],decls:67,vars:70,consts:[["cheatSheetComponent",""],["drawer",""],["ruleChainMenuTrigger","matMenuTrigger"],["ruleChainMenu","matMenu"],["ruleChainCanvas",""],["ruleNodeTypeExpansionPanels",""],["tbRuleNode",""],["eventsTab","matTab"],["tbRuleNodeLink",""],["versionControlButton",""],["tb-fullscreen","",1,"mat-content","tb-rulechain","flex","flex-1","flex-col",3,"fullscreen","tb-hotkeys","cheatSheet"],[1,"tb-rulechain-container","flex","flex-1","flex-col"],[1,"tb-rulechain-layout","flex","flex-1","flex-row"],[1,"size-full"],["disableClose","true","mode","side","opened","","position","start",1,"tb-rulechain-library","mat-elevation-z4","flex","flex-col"],["color","primary",1,"tb-dark"],["class","flex-1",3,"ruleChainType","disabled","ngModel","ngModelChange",4,"ngIf"],[1,"mat-toolbar-tools"],[1,"tb-appearance-transparent","flex-1"],["mat-icon-button","","matPrefix","","matTooltipPosition","above",1,"tb-small",3,"matTooltip"],["matInput","",3,"formControl","placeholder"],["mat-icon-button","","matSuffix","","matTooltipPosition","above",1,"tb-small",3,"click","matTooltip"],[1,"tb-rulechain-library-panel-group"],["class","mat-elevation-z2",3,"expanded",4,"ngFor","ngForOf"],["mode","over","position","end",1,"tb-details-drawer",3,"closed","opened"],["class","flex-1",3,"headerTitle","headerSubtitle","isReadOnly","isAlwaysEdit","theForm","closeDetails","toggleDetailsEditMode","applyDetails",4,"ngIf"],[1,"tb-rulechain-graph-content"],["color","primary","mat-mini-fab","","matTooltipPosition","above",1,"tb-library-node-btn",3,"click","matTooltip"],[1,"tb-library-node-btn-icon"],["color","primary","type","button","mat-mini-fab","","class","version-control-button","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["type","button","mat-icon-button","","matTooltipPosition","above",1,"tb-fullscreen-button","tb-mat-40",3,"click","matTooltip"],[1,"tb-absolute-fill","tb-rulechain-graph",3,"tbcontextmenu"],[2,"visibility","hidden","position","fixed",3,"matMenuTriggerFor"],[1,"tb-rule-chain-context-menu",3,"overlapTrigger"],["matMenuContent",""],["id","tb-rulchain-canvas","fitModelSizeByDefault","false",3,"modelChanged","model","selectedObjects","edgeStyle","automaticResize","nodeWidth","nodeHeight","dragAnimation","userCallbacks"],[1,"tb-footer-buttons","flex","flex-row","flex-wrap","items-end","justify-start"],["mat-fab","","color","accent","matTooltipPosition","above",1,"tb-btn-footer",3,"click","disabled","matTooltip"],[1,"flex-1",3,"ngModelChange","ruleChainType","disabled","ngModel"],[1,"mat-elevation-z2",3,"expanded"],["expandedHeight","48px",3,"mouseenter","mouseleave"],["translate","",1,"tb-panel-title"],["fitModelSizeByDefault","",3,"id","model","selectedObjects","automaticResize","userCallbacks","nodeWidth","nodeHeight","dropTargetId"],[1,"flex-1",3,"closeDetails","toggleDetailsEditMode","applyDetails","headerTitle","headerSubtitle","isReadOnly","isAlwaysEdit","theForm"],[1,"details-buttons"],[3,"tb-help"],["mat-stretch-tabs","false",1,"tb-absolute-fill","tb-rulenode-details","flex-1",3,"selectedIndexChange","selectedIndex"],[3,"label"],[3,"initRuleNode","changeScript","ruleNode","ruleChainId","ruleChainType"],[3,"label",4,"ngIf"],[1,"tb-rule-node-help"],["id","tb-node-content",1,"mat-padding","flex","flex-col"],[1,"tb-node-title"],[1,"tb-node-description",3,"innerHtml"],[1,"tb-node-details",3,"innerHtml"],[3,"debugEventSelected","debugEventTypes","defaultEventType","active","tenantId","entityId","functionTestButtonLabel"],[1,"flex-1",3,"ngModelChange","ngModel","allowedLabels","allowCustom","sourceRuleChainId"],["color","primary","type","button","mat-mini-fab","","matTooltipPosition","above",1,"version-control-button",3,"click","matTooltip"],[1,"tb-rule-chain-context-menu-container",3,"mouseleave"],[4,"ngIf"],[3,"src",4,"ngIf"],[1,"flex-1"],[1,"tb-context-menu-title"],[1,"tb-context-menu-subtitle"],[4,"ngFor","ngForOf"],[3,"src"],["mat-menu-item","",3,"disabled","click",4,"ngIf"],["mat-menu-item","",3,"click","disabled"],["class","tb-alt-text",4,"ngIf"],["translate",""],[1,"tb-alt-text"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",10),e.\u0275\u0275element(1,"tb-hotkeys-cheatsheet",null,0),e.\u0275\u0275elementStart(3,"section",11)(4,"div",12)(5,"mat-drawer-container",13)(6,"mat-drawer",14,1)(8,"mat-toolbar",15),e.\u0275\u0275template(9,QC,1,3,"tb-rule-chain-select",16),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"mat-toolbar")(11,"div",17)(12,"mat-form-field",18)(13,"button",19),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementStart(15,"mat-icon"),e.\u0275\u0275text(16,"search"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(17,"input",20),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementStart(19,"button",21),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.ruleNodeTypeSearch.reset())}),e.\u0275\u0275elementStart(21,"mat-icon"),e.\u0275\u0275text(22,"close"),e.\u0275\u0275elementEnd()()()()(),e.\u0275\u0275elementStart(23,"div",22),e.\u0275\u0275template(24,JC,9,12,"mat-expansion-panel",23),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(25,"mat-drawer",24),e.\u0275\u0275listener("closed",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.onDetailsDrawerClosed())}),e.\u0275\u0275template(26,XC,24,28,"tb-details-panel",25)(27,ex,6,12,"tb-details-panel",25),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(28,"mat-drawer-content",26)(29,"button",27),e.\u0275\u0275pipe(30,"translate"),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(o);const l=e.\u0275\u0275reference(7);return e.\u0275\u0275resetView(l.toggle())}),e.\u0275\u0275elementStart(31,"mat-icon",28),e.\u0275\u0275text(32,"chevron_right"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(33,tx,5,3,"button",29),e.\u0275\u0275elementStart(34,"button",30),e.\u0275\u0275pipe(35,"translate"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.isFullscreen=!n.isFullscreen)}),e.\u0275\u0275elementStart(36,"mat-icon"),e.\u0275\u0275text(37),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(38,"div",31),e.\u0275\u0275listener("tbcontextmenu",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.openRuleChainContextMenu(l))}),e.\u0275\u0275element(39,"div",32,2),e.\u0275\u0275elementStart(41,"mat-menu",33,3),e.\u0275\u0275template(43,dx,10,8,"ng-template",34),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(44,"fc-canvas",35,4),e.\u0275\u0275listener("modelChanged",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.onModelChanged())}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(46,"section",36)(47,"button",37),e.\u0275\u0275pipe(48,"translate"),e.\u0275\u0275pipe(49,"async"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.deleteSelected())}),e.\u0275\u0275elementStart(50,"mat-icon"),e.\u0275\u0275text(51,"delete"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(52,"button",37),e.\u0275\u0275pipe(53,"translate"),e.\u0275\u0275pipe(54,"async"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.resetDebugModeInAllNodes())}),e.\u0275\u0275elementStart(55,"mat-icon"),e.\u0275\u0275text(56,"bug_report"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(57,"button",37),e.\u0275\u0275pipe(58,"translate"),e.\u0275\u0275pipe(59,"async"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.saveRuleChain())}),e.\u0275\u0275elementStart(60,"mat-icon"),e.\u0275\u0275text(61,"done"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(62,"button",37),e.\u0275\u0275pipe(63,"translate"),e.\u0275\u0275pipe(64,"async"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.revertRuleChain())}),e.\u0275\u0275elementStart(65,"mat-icon"),e.\u0275\u0275text(66,"close"),e.\u0275\u0275elementEnd()()()()()()()()}if(2&i){const o=e.\u0275\u0275reference(2),r=e.\u0275\u0275reference(7),l=e.\u0275\u0275reference(42);e.\u0275\u0275property("fullscreen",n.isFullscreen)("tb-hotkeys",n.hotKeys)("cheatSheet",o),e.\u0275\u0275advance(9),e.\u0275\u0275property("ngIf",!n.isImport),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(14,44,"rulenode.search")),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(18,46,"rulenode.search")),e.\u0275\u0275property("formControl",n.ruleNodeTypeSearch),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",""===n.ruleNodeTypeSearch.value),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(20,48,"action.clear-search")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",n.ruleNodeTypesLibraryArray),e.\u0275\u0275advance(),e.\u0275\u0275property("opened",n.isEditingRuleNode||n.isEditingRuleNodeLink),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.editingRuleNode),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.editingRuleNodeLink),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(30,50,r.opened?"rulenode.close-node-library":"rulenode.open-node-library")),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("tb-library-node-btn-icon-toggled",r.opened),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.isImport),e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(35,52,n.isFullscreen?"fullscreen.exit":"fullscreen.expand")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(n.isFullscreen?"fullscreen_exit":"fullscreen"),e.\u0275\u0275advance(2),e.\u0275\u0275styleProp("left",n.ruleChainMenuPosition.x)("top",n.ruleChainMenuPosition.y),e.\u0275\u0275property("matMenuTriggerFor",l),e.\u0275\u0275advance(2),e.\u0275\u0275property("overlapTrigger",!0),e.\u0275\u0275advance(3),e.\u0275\u0275property("model",n.ruleChainModel)("selectedObjects",n.selectedObjects)("edgeStyle",n.flowchartConstants.curvedStyle)("automaticResize",!0)("nodeWidth",170)("nodeHeight",50)("dragAnimation",n.flowchartConstants.dragAnimationRepaint)("userCallbacks",n.editCallbacks),e.\u0275\u0275advance(3),e.\u0275\u0275classProp("tb-hide",!n.objectsSelected()),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(48,54,"rulenode.delete-selected-objects")),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(49,56,n.isLoading$)),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(53,58,"rulenode.reset-debug-mode")),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(54,60,n.isLoading$)||!n.isDebugModeEnabled()),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(58,62,"action.apply-changes")),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(59,64,n.isLoading$)||n.isInvalid||!n.isDirtyValue&&!n.isImport),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(63,66,"action.decline-changes")),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(64,68,n.isLoading$)||!n.isDirtyValue)}},dependencies:[p.NgForOf,p.NgIf,Wr.FullscreenDirective,$r.TbHotkeysDirective,be.HelpComponent,zr.TbCheatSheetComponent,x.MatIconButton,x.MatMiniFabButton,x.MatFabButton,E.MatIcon,L.MatInput,v.MatFormField,v.MatPrefix,v.MatSuffix,xn.MatDrawer,xn.MatDrawerContainer,xn.MatDrawerContent,ae.MatToolbar,Be.MatMenu,Be.MatMenuItem,Be.MatMenuContent,Be.MatMenuTrigger,_e.MatTooltip,Ye.MatDivider,Q.MatTab,Q.MatTabGroup,U.MatExpansionPanel,U.MatExpansionPanelHeader,U.MatExpansionPanelTitle,s.DefaultValueAccessor,s.NgControlStatus,s.NgModel,s.FormControlDirective,Y.HP,GC.Q,u.TranslateDirective,jC.RuleChainSelectComponent,us.DetailsPanelComponent,xt.EventTableComponent,It,Qt,p.AsyncPipe,UC.KeyboardShortcutPipe,qC.SafePipe,u.TranslatePipe],styles:['@charset "UTF-8";.tb-rulechain{width:100%;height:100%}.tb-rulechain .mat-mdc-tab-group.tb-rulenode-details>.mat-mdc-tab-body-wrapper{position:absolute;inset:49px 0 0}.tb-rulechain .mat-mdc-tab-group.tb-rulenode-details>.mat-mdc-tab-header .mat-mdc-tab{min-width:40px}.tb-rulechain button.mdc-icon-button.tb-fullscreen-button{position:absolute;top:10px;right:10px;background:#ccc;color:#666;opacity:.85;margin:0 6px;z-index:2}.tb-rulechain button.mdc-fab.version-control-button{position:absolute;top:10px;right:60px;opacity:.85;margin:0 6px;z-index:2}.tb-rulechain .tb-library-node-btn{width:20px;height:90px;position:absolute;top:50%;z-index:1000;opacity:.5;border-radius:0 15px 15px 0!important;transform:translateY(-50%)}.tb-rulechain .tb-library-node-btn-icon{transition:transform .4s!important}.tb-rulechain .tb-library-node-btn-icon-toggled{transform:rotate(180deg)}.tb-rulechain .tb-library-node-btn:before{width:20px;height:30px;top:-28px;left:0;content:"";pointer-events:none;border-radius:0 0 0 15px;box-shadow:-10px 0 #305680;border:none}.tb-rulechain .tb-library-node-btn:after{position:absolute;width:20px;height:30px;bottom:-28px;left:0;content:"";pointer-events:none;border-top-left-radius:15px;box-shadow:-10px 0 #305680;border:none}.tb-rulechain .tb-rulechain-library{z-index:1;width:250px;min-width:250px}.tb-rulechain .tb-rulechain-library .mat-toolbar{height:min-content;padding:0}.tb-rulechain .tb-rulechain-library .mat-toolbar .mat-toolbar-tools{height:48px;padding:0 6px;font-size:14px}.tb-rulechain .tb-rulechain-library .mat-toolbar .mat-toolbar-tools .mat-mdc-icon-button{margin:0}.tb-rulechain .tb-rulechain-library .mat-toolbar .mat-toolbar-tools .mat-mdc-icon-button.tb-small{width:32px;height:32px;min-height:32px;padding:6px;line-height:20px}.tb-rulechain .tb-rulechain-library .mat-toolbar .mat-toolbar-tools .mat-mdc-icon-button.tb-small .mat-icon{width:20px;min-width:20px;height:20px;min-height:20px;font-size:20px;line-height:20px}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group{overflow-x:hidden;overflow-y:auto}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel{border-radius:0}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel:last-child{margin-bottom:5px}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel .mat-expansion-panel-header{background:#e6e6e6}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel .mat-expansion-panel-header:hover{background:#dadada}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel .mat-expansion-panel-header .mat-expansion-panel-header-title{line-height:48px;height:48px;overflow:hidden}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel .mat-expansion-panel-header .mat-expansion-panel-header-title .mat-icon{min-width:24px;margin:auto 8px auto 0}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel .mat-expansion-panel-header .mat-expansion-panel-header-title .tb-panel-title{min-width:130px;-webkit-user-select:none;user-select:none}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel.mat-expanded .mat-expansion-panel-header{border-bottom:1px solid;border-color:#909090}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel-body{padding:0}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .fc-canvas{background:#f9f9f9}.tb-rulechain .mat-drawer-content.tb-rulechain-graph-content{overflow:hidden;z-index:0}.tb-rulechain .mat-drawer-content.tb-rulechain-graph-content .tb-rulechain-graph{z-index:0;overflow:auto}.tb-rulechain .fc-canvas .fc-node{border-radius:8px}.tb-rulechain .fc-canvas .fc-node.fc-selected{z-index:2}.tb-rulechain .fc-canvas .fc-node.fc-selected:not(.fc-edit){margin:-3px;border:solid 3px #f00}.tb-rulechain .fc-canvas .fc-edit .fc-nodeedit,.tb-rulechain .fc-canvas .fc-edit .fc-nodedelete{box-sizing:content-box;border:solid 2px #fff;background:#f83e05;outline:none}.tb-rulechain .fc-canvas .fc-nodeopen{display:block;position:absolute;top:11px;right:10px;border:1px solid #FFFFFF;border-radius:4px;line-height:18px;height:22px;width:22px;background:#886cb1;color:#fff;text-align:center;cursor:pointer;box-sizing:border-box}.tb-rulechain .fc-canvas .fc-nodeopen .mat-icon{width:16px;min-width:16px;height:16px;min-height:16px;font-size:16px}.tb-rulechain .fc-canvas .fc-nodeopen:hover{background-color:#4e2d7e}.tb-rulechain .fc-canvas .fc-arrow-marker polygon{fill:gray;stroke:gray}.tb-rulechain .fc-canvas .fc-arrow-marker-selected polygon{fill:red;stroke:red}.tb-rulechain .fc-canvas .fc-edge{outline:none;stroke:gray}.tb-rulechain .fc-canvas .fc-edge.fc-selected{stroke:red}.tb-rulechain .fc-canvas .fc-edge.fc-hover{stroke:gray}.tb-rulechain .fc-canvas .edge-endpoint{fill:gray}.tb-rulechain .fc-canvas .fc-edge-label{opacity:1!important}.tb-rulechain .fc-canvas .fc-edge-label:focus{outline:0}.tb-rulechain .fc-canvas .fc-edge-label.fc-selected .fc-edge-label-text span{color:#fff!important;background-color:red!important;border:solid #f00!important}.tb-rulechain .fc-canvas .fc-edge-label .fc-edge-label-text{font-size:14px!important;font-weight:600!important}.tb-rulechain .fc-canvas .fc-edge-label .fc-edge-label-text span{background-color:#fff!important;color:#003a79!important;border:solid 2px #003a79!important}.tb-rule-node-tooltip,.tb-rule-node-help{color:#333}.tb-rule-node-tooltip{max-width:300px;font-size:14px}.tb-rule-node-tooltip.tb-lib-tooltip{width:300px}.tb-rule-node-help{font-size:16px}.tb-rule-node-error-tooltip{font-size:16px;color:#ea0d0d}.tb-rule-node-tooltip #tb-node-content .tb-node-title,.tb-rule-node-error-tooltip #tb-node-content .tb-node-title,.tb-rule-node-help #tb-node-content .tb-node-title{font-weight:600}.tb-rule-node-tooltip #tb-node-content .tb-node-description,.tb-rule-node-error-tooltip #tb-node-content .tb-node-description,.tb-rule-node-help #tb-node-content .tb-node-description{font-style:italic;color:#555}.tb-rule-node-tooltip #tb-node-content .tb-node-details,.tb-rule-node-error-tooltip #tb-node-content .tb-node-details,.tb-rule-node-help #tb-node-content .tb-node-details{padding-top:10px;padding-bottom:10px}.tb-rule-node-tooltip #tb-node-content code,.tb-rule-node-error-tooltip #tb-node-content code,.tb-rule-node-help #tb-node-content code{padding:0 3px 2px;margin:1px;font-size:12px;color:#ad1625;white-space:nowrap;background-color:#f7f7f9;border:1px solid #e1e1e8;border-radius:2px}.tb-rule-chain-context-menu.mat-mdc-menu-panel{min-width:320px;max-height:404px;border-radius:8px;margin-left:-20px}.tb-rule-chain-context-menu.mat-mdc-menu-panel.mat-menu-below{margin-top:-60px}.tb-rule-chain-context-menu.mat-mdc-menu-panel .mat-mdc-menu-content{padding:0;display:flex;flex-direction:column}.tb-rule-chain-context-menu.mat-mdc-menu-panel .mat-mdc-menu-content .tb-rule-chain-context-menu-container{pointer-events:auto;padding:0 0 8px;display:flex;flex-direction:column;overflow-y:auto}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header{display:flex;box-sizing:content-box;flex-direction:row;height:36px;min-height:36px;padding:8px 5px 5px;font-size:14px}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-filter-type{background-color:#f1e861}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-enrichment-type{background-color:#cdf14e}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-transformation-type{background-color:#79cef1}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-action-type{background-color:#f1928f}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-external-type{background-color:#fbc766}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-flow-type{background-color:#d6c4f1}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-unknown-type{background-color:#f16c29}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-rulechain-header,.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-link-header{background-color:#aac7e4}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header .mat-icon{margin:auto 10px auto 2px}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header .tb-context-menu-title{font-weight:500;line-height:normal}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header .tb-context-menu-subtitle{font-size:12px;line-height:normal}\n'],encapsulation:2})}}class di extends se.m{constructor(t,i,n,o,r,l){super(t,i,r),this.store=t,this.router=i,this.data=n,this.errorStateMatcher=o,this.dialogRef=r,this.fb=l,this.submitted=!1,this.link=this.data.link,this.labels=this.data.labels,this.allowCustomLabels=this.data.allowCustomLabels,this.sourceRuleChainId=this.data.sourceRuleChainId,this.ruleNodeLinkFormGroup=this.fb.group({link:[(0,_.Go)(this.link),[s.Validators.required]]})}ngOnInit(){}isErrorState(t,i){const n=this.errorStateMatcher.isErrorState(t,i),o=!!(t&&t.invalid&&this.submitted);return n||o}cancel(){this.dialogRef.close(null)}add(){this.submitted=!0;const t=this.ruleNodeLinkFormGroup.get("link").value;this.link={...this.link,...t},this.dialogRef.close(this.link)}static{this.\u0275fac=function(i){return new(i||di)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(S.MAT_DIALOG_DATA),e.\u0275\u0275directiveInject(z.ErrorStateMatcher,4),e.\u0275\u0275directiveInject(S.MatDialogRef),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:di,selectors:[["tb-add-rule-node-link-dialog"]],features:[e.\u0275\u0275ProvidersFeature([{provide:z.ErrorStateMatcher,useExisting:di}]),e.\u0275\u0275InheritDefinitionFeature],decls:24,vars:23,consts:[[2,"width","480px",3,"ngSubmit","formGroup"],["color","primary"],["translate",""],[1,"flex-1"],[3,"tb-help"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["mat-dialog-content",""],[3,"disabled"],["required","","formControlName","link",3,"allowedLabels","allowCustom","sourceRuleChainId"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"form",0),e.\u0275\u0275listener("ngSubmit",function(){return n.add()}),e.\u0275\u0275elementStart(1,"mat-toolbar",1)(2,"h2",2),e.\u0275\u0275text(3,"rulenode.add-link"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"span",3)(5,"div",4),e.\u0275\u0275elementStart(6,"button",5),e.\u0275\u0275listener("click",function(){return n.cancel()}),e.\u0275\u0275elementStart(7,"mat-icon",6),e.\u0275\u0275text(8,"close"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(9,cx,1,0,"mat-progress-bar",7),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275elementStart(11,"div",8)(12,"fieldset",9),e.\u0275\u0275pipe(13,"async"),e.\u0275\u0275element(14,"tb-rule-node-link",10),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(15,"div",11)(16,"button",12),e.\u0275\u0275pipe(17,"async"),e.\u0275\u0275listener("click",function(){return n.cancel()}),e.\u0275\u0275text(18),e.\u0275\u0275pipe(19,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"button",13),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275text(22),e.\u0275\u0275pipe(23,"translate"),e.\u0275\u0275elementEnd()()()),2&i&&(e.\u0275\u0275property("formGroup",n.ruleNodeLinkFormGroup),e.\u0275\u0275advance(5),e.\u0275\u0275property("tb-help","ruleEngine"),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(10,11,n.isLoading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(13,13,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("allowedLabels",n.labels)("allowCustom",n.allowCustomLabels)("sourceRuleChainId",n.sourceRuleChainId),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(17,15,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(19,17,"action.cancel")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(21,19,n.isLoading$)||n.ruleNodeLinkFormGroup.invalid||!n.ruleNodeLinkFormGroup.dirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(23,21,"action.add")," "))},dependencies:[p.NgIf,be.HelpComponent,x.MatButton,x.MatIconButton,E.MatIcon,K.MatProgressBar,ae.MatToolbar,S.MatDialogActions,S.MatDialogContent,s.\u0275NgNoValidate,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,Qt,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]     tb-rule-node-link form{overflow:hidden!important}']})}}class ci extends se.m{constructor(t,i,n,o,r){super(t,i,r),this.store=t,this.router=i,this.data=n,this.errorStateMatcher=o,this.dialogRef=r,this.submitted=!1,this.ruleNode=this.data.ruleNode,this.ruleChainId=this.data.ruleChainId,this.ruleChainType=this.data.ruleChainType}ngOnInit(){}isErrorState(t,i){const n=this.errorStateMatcher.isErrorState(t,i),o=!!(t&&t.invalid&&this.submitted);return n||o}helpLinkIdForRuleNodeType(){return(0,B.mL)(this.ruleNode.component)}cancel(){this.dialogRef.close(null)}add(){this.submitted=!0,this.ruleNodeDetailsComponent.validate(),this.ruleNodeDetailsComponent.ruleNodeFormGroup.valid&&this.dialogRef.close(this.ruleNode)}static{this.\u0275fac=function(i){return new(i||ci)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(S.MAT_DIALOG_DATA),e.\u0275\u0275directiveInject(z.ErrorStateMatcher,4),e.\u0275\u0275directiveInject(S.MatDialogRef))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:ci,selectors:[["tb-add-rule-node-dialog"]],viewQuery:function(i,n){if(1&i&&e.\u0275\u0275viewQuery(Os,7),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.ruleNodeDetailsComponent=o.first)}},features:[e.\u0275\u0275ProvidersFeature([{provide:z.ErrorStateMatcher,useExisting:ci}]),e.\u0275\u0275InheritDefinitionFeature],decls:24,vars:20,consts:[["tbRuleNode",""],[1,"dialog-container",3,"ngSubmit"],["color","primary"],["translate",""],[1,"flex-1"],[3,"tb-help"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["mat-dialog-content",""],["isAdd","",3,"ruleNode","ruleChainId","ruleChainType"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"form",1),e.\u0275\u0275listener("ngSubmit",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.add())}),e.\u0275\u0275elementStart(1,"mat-toolbar",2)(2,"h2",3),e.\u0275\u0275text(3,"rulenode.add"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"span",4),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(6,"div",5),e.\u0275\u0275elementStart(7,"button",6),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.cancel())}),e.\u0275\u0275elementStart(8,"mat-icon",7),e.\u0275\u0275text(9,"close"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(10,px,1,0,"mat-progress-bar",8),e.\u0275\u0275pipe(11,"async"),e.\u0275\u0275elementStart(12,"div",9),e.\u0275\u0275element(13,"tb-rule-node",10,0),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"div",11)(16,"button",12),e.\u0275\u0275pipe(17,"async"),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.cancel())}),e.\u0275\u0275text(18),e.\u0275\u0275pipe(19,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"button",13),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275text(22),e.\u0275\u0275pipe(23,"translate"),e.\u0275\u0275elementEnd()()()}if(2&i){const o=e.\u0275\u0275reference(14);e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate1(": ",n.ruleNode.component.name,""),e.\u0275\u0275advance(),e.\u0275\u0275property("tb-help",n.helpLinkIdForRuleNodeType()),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(11,10,n.isLoading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ruleNode",n.ruleNode)("ruleChainId",n.ruleChainId)("ruleChainType",n.ruleChainType),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(17,12,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(19,14,"action.cancel")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(21,16,n.isLoading$)||o.ruleNodeFormGroup.invalid||!o.ruleNodeFormGroup.dirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(23,18,"action.add")," ")}},dependencies:[p.NgIf,be.HelpComponent,x.MatButton,x.MatIconButton,E.MatIcon,K.MatProgressBar,ae.MatToolbar,S.MatDialogActions,S.MatDialogContent,s.\u0275NgNoValidate,s.NgControlStatusGroup,s.NgForm,u.TranslateDirective,It,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]   .dialog-container[_ngcontent-%COMP%]{min-width:750px!important;max-width:750px!important}[_nghost-%COMP%]   .dialog-container[_ngcontent-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{padding:8px}@media screen and (max-width: 959px){[_nghost-%COMP%]   .dialog-container[_ngcontent-%COMP%]{min-width:100%!important}}']})}}class pi extends se.m{constructor(t,i,n,o,r,l,c){super(t,i,c),this.store=t,this.router=i,this.data=n,this.errorStateMatcher=o,this.fb=r,this.ruleChainService=l,this.dialogRef=c,this.submitted=!1}ngOnInit(){this.createNestedRuleChainFormGroup=this.fb.group({name:["",[s.Validators.required,s.Validators.maxLength(255)]],additionalInfo:this.fb.group({description:[""]})})}isErrorState(t,i){const n=this.errorStateMatcher.isErrorState(t,i),o=!!(t&&t.invalid&&this.submitted);return n||o}cancel(){this.dialogRef.close(null)}add(){this.submitted=!0;const t={name:this.createNestedRuleChainFormGroup.get("name").value,debugMode:!1,type:this.data.ruleChainType,additionalInfo:{description:this.createNestedRuleChainFormGroup.get("additionalInfo").get("description").value}};this.ruleChainService.saveRuleChain(t).subscribe(i=>{this.dialogRef.close(i)})}static{this.\u0275fac=function(i){return new(i||pi)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(S.MAT_DIALOG_DATA),e.\u0275\u0275directiveInject(z.ErrorStateMatcher,4),e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(St.P),e.\u0275\u0275directiveInject(S.MatDialogRef))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:pi,selectors:[["tb-create-nested-rulechain-dialog"]],features:[e.\u0275\u0275ProvidersFeature([{provide:z.ErrorStateMatcher,useExisting:pi}]),e.\u0275\u0275InheritDefinitionFeature],decls:34,vars:21,consts:[[2,"min-width","650px",3,"ngSubmit"],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["mat-dialog-content",""],[1,"mat-padding",3,"formGroup"],[3,"disabled"],[1,"mat-block","flex-1"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formGroupName","additionalInfo"],[1,"mat-block"],["matInput","","formControlName","description","rows","2"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"form",0),e.\u0275\u0275listener("ngSubmit",function(){return n.add()}),e.\u0275\u0275elementStart(1,"mat-toolbar",1)(2,"h2",2),e.\u0275\u0275text(3,"rulenode.create-nested-rulechain"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"span",3),e.\u0275\u0275elementStart(5,"button",4),e.\u0275\u0275listener("click",function(){return n.cancel()}),e.\u0275\u0275elementStart(6,"mat-icon",5),e.\u0275\u0275text(7,"close"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(8,mx,1,0,"mat-progress-bar",6),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275elementStart(10,"div",7)(11,"form",8)(12,"fieldset",9),e.\u0275\u0275pipe(13,"async"),e.\u0275\u0275elementStart(14,"mat-form-field",10)(15,"mat-label",2),e.\u0275\u0275text(16,"rulechain.name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(17,"input",11),e.\u0275\u0275template(18,ux,3,3,"mat-error",12)(19,gx,3,3,"mat-error",12),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"div",13)(21,"mat-form-field",14)(22,"mat-label",2),e.\u0275\u0275text(23,"rulechain.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(24,"textarea",15),e.\u0275\u0275elementEnd()()()()(),e.\u0275\u0275elementStart(25,"div",16)(26,"button",17),e.\u0275\u0275pipe(27,"async"),e.\u0275\u0275listener("click",function(){return n.cancel()}),e.\u0275\u0275text(28),e.\u0275\u0275pipe(29,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(30,"button",18),e.\u0275\u0275pipe(31,"async"),e.\u0275\u0275text(32),e.\u0275\u0275pipe(33,"translate"),e.\u0275\u0275elementEnd()()()),2&i&&(e.\u0275\u0275advance(8),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(9,9,n.isLoading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("formGroup",n.createNestedRuleChainFormGroup),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(13,11,n.isLoading$)),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",n.createNestedRuleChainFormGroup.get("name").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.createNestedRuleChainFormGroup.get("name").hasError("maxlength")),e.\u0275\u0275advance(7),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(27,13,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(29,15,"action.cancel")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(31,17,n.isLoading$)||n.createNestedRuleChainFormGroup.invalid||!n.createNestedRuleChainFormGroup.dirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(33,19,"action.create")," "))},dependencies:[p.NgIf,x.MatButton,x.MatIconButton,E.MatIcon,K.MatProgressBar,L.MatInput,v.MatFormField,v.MatLabel,v.MatError,ae.MatToolbar,S.MatDialogActions,S.MatDialogContent,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.NgForm,s.FormGroupDirective,s.FormControlName,s.FormGroupName,u.TranslateDirective,p.AsyncPipe,u.TranslatePipe],encapsulation:2})}}var Rs=d(772),fx=d(45876);class wt{constructor(t){this.ruleChainService=t}resolve(t){const i=t.params.ruleChainId;return this.ruleChainService.getRuleChain(i)}static{this.\u0275fac=function(i){return new(i||wt)(e.\u0275\u0275inject(St.P))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:wt,factory:wt.\u0275fac})}}class Et{constructor(t){this.ruleChainService=t}resolve(t){const i=t.params.ruleChainId;return this.ruleChainService.getRuleChainMetadata(i)}static{this.\u0275fac=function(i){return new(i||Et)(e.\u0275\u0275inject(St.P))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Et,factory:Et.\u0275fac})}}class We{constructor(t,i){this.ruleChainService=t,this.modulesMap=i}resolve(t){return this.ruleChainService.getRuleNodeComponents(this.modulesMap,t.data.ruleChainType)}static{this.\u0275fac=function(i){return new(i||We)(e.\u0275\u0275inject(St.P),e.\u0275\u0275inject(fx.MODULES_MAP,8))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:We,factory:We.\u0275fac})}}class $e{constructor(){}resolve(t){return(0,Cr.H)(d.e(89).then(d.t.bind(d,10089,23)))}static{this.\u0275fac=function(i){return new(i||$e)}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:$e,factory:$e.\u0275fac})}}class Jt{constructor(t,i){this.itembuffer=t,this.router=i}canActivate(t,i){return!!this.itembuffer.hasRuleChainImport()||this.router.parseUrl("ruleChains")}static{this.\u0275fac=function(i){return new(i||Jt)(e.\u0275\u0275inject(Rs.ItemBufferService),e.\u0275\u0275inject(b.Router))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Jt,factory:Jt.\u0275fac})}}const kr=(a,t,i)=>{let n=i.ruleChain.name;return i.ruleChain.root&&(n+=` (${t.instant("rulechain.root")})`),n},Vs=(a,t,i)=>`${t.instant("rulechain.import")}: ${i.ruleChain.name}`,hx=[{path:"ruleChains",data:{breadcrumb:{menuId:Rs.MenuId.rule_chains}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN],title:"rulechain.rulechains",ruleChainsType:"tenant"},resolve:{entitiesTableConfig:Tt}},{path:":ruleChainId",component:st,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:kr,icon:"settings_ethernet"},auth:[g.s.TENANT_ADMIN],title:"rulechain.rulechain",import:!1,ruleChainType:ue.UR.CORE},resolve:{ruleChain:wt,ruleChainMetaData:Et,ruleNodeComponents:We,tooltipster:$e}},{path:"ruleChain/import",component:st,canActivate:[Jt],canDeactivate:[P.L],data:{breadcrumb:{labelFunction:Vs,icon:"settings_ethernet"},auth:[g.s.TENANT_ADMIN],title:"rulechain.rulechain",import:!0,ruleChainType:ue.UR.CORE},resolve:{ruleNodeComponents:We,tooltipster:$e}}]}];class mi{static{this.\u0275fac=function(i){return new(i||mi)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:mi})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[Tt,wt,Et,We,$e,Jt],imports:[b.RouterModule.forChild(hx),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(mi,{imports:[b.RouterModule],exports:[b.RouterModule]});var bx=d(345),Bs=d(42415);function yx(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-icon",9),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(i.node.icon)}}function vx(a,t){if(1&a&&e.\u0275\u0275element(0,"img",10),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("src",i.iconUrl,e.\u0275\u0275sanitizeUrl)}}function Cx(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"span",11),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(i.node.name)}}function xx(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",12),e.\u0275\u0275element(1,"div",13),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("connector",i)("callbacks",n.callbacks),e.\u0275\u0275advance(),e.\u0275\u0275property("connector",i)("nodeRectInfo",n.nodeRectInfo)("mouseOverConnector",n.mouseOverConnector)("callbacks",n.callbacks)("modelservice",n.modelservice)}}function _x(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",12),e.\u0275\u0275element(1,"div",13),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("connector",i)("callbacks",n.callbacks),e.\u0275\u0275advance(),e.\u0275\u0275property("connector",i)("nodeRectInfo",n.nodeRectInfo)("mouseOverConnector",n.mouseOverConnector)("callbacks",n.callbacks)("modelservice",n.modelservice)}}function Sx(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"section")(1,"div",14),e.\u0275\u0275listener("click",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.userNodeCallbacks.nodeEdit(o,r.node))}),e.\u0275\u0275element(2,"i",15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",16),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.modelservice.nodes.delete(o.node))}),e.\u0275\u0275text(4," \xd7 "),e.\u0275\u0275elementEnd()()}}function Tx(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"section")(1,"div",17),e.\u0275\u0275listener("click",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.openRuleChain(o,r.node))})("mouseenter",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.displayOpenRuleChainTooltip(o,r.node))}),e.\u0275\u0275element(2,"mat-icon",18),e.\u0275\u0275elementEnd()()}}class To extends Y.J8{constructor(t,i,n){super(),this.sanitizer=t,this.translate=i,this.router=n,this.RuleNodeType=B.zu}ngOnInit(){super.ngOnInit(),this.node.iconUrl&&(this.iconUrl=this.sanitizer.bypassSecurityTrustResourceUrl(this.node.iconUrl))}openRuleChain(t,i){t&&t.stopPropagation(),i.configuration?.ruleChainId&&(i.ruleChainType===ue.UR.EDGE?this.router.navigateByUrl(`/edgeManagement/ruleChains/${i.configuration?.ruleChainId}`):this.router.navigateByUrl(`/ruleChains/${i.configuration?.ruleChainId}`))}displayOpenRuleChainTooltip(t,i){t&&t.stopPropagation(),this.userNodeCallbacks.mouseLeave(t,i);const n='<div class="tb-rule-node-tooltip"><div id="tb-node-content"><div class="tb-node-description">'+this.translate.instant("rulechain.open-rulechain")+"</div></div></div>",o=Bs(t.target);o.tooltipster({theme:"tooltipster-shadow",delay:100,trigger:"custom",triggerOpen:{click:!1,tap:!1},triggerClose:{click:!0,tap:!0,scroll:!0,mouseleave:!0},side:"top",distance:12,trackOrigin:!0});const r=o.tooltipster("instance"),l=Bs(n);r.content(l),r.open()}static{this.\u0275fac=function(i){return new(i||To)(e.\u0275\u0275directiveInject(bx.DomSanitizer),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(b.Router))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:To,selectors:[["rule-node"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:15,vars:21,consts:[[3,"dblclick","mousedown","mouseenter","mouseleave"],[1,"fc-node-overlay"],["class","max-w-15% flex-full",4,"ngIf"],["class","max-w-15% flex-full",3,"src",4,"ngIf"],[1,"flex","max-w-85%","flex-full","flex-col","items-stretch","justify-center"],[1,"tb-node-type"],["class","tb-node-title",4,"ngIf"],["fc-magnet","",3,"connector","callbacks",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"max-w-15%","flex-full"],[1,"max-w-15%","flex-full",3,"src"],[1,"tb-node-title"],["fc-magnet","",3,"connector","callbacks"],["fc-connector","",3,"connector","nodeRectInfo","mouseOverConnector","callbacks","modelservice"],[1,"fc-nodeedit",3,"click"],["aria-hidden","true",1,"fa","fa-pencil"],[1,"fc-nodedelete",3,"click"],[1,"fc-nodeopen",3,"click","mouseenter"],["svgIcon","mdi:login",1,"material-icons"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275listener("dblclick",function(r){return n.userNodeCallbacks.doubleClick(r,n.node)})("mousedown",function(r){return n.userNodeCallbacks.mouseDown(r,n.node)})("mouseenter",function(r){return n.userNodeCallbacks.mouseEnter(r,n.node)})("mouseleave",function(r){return n.userNodeCallbacks.mouseLeave(r,n.node)}),e.\u0275\u0275element(1,"div",1),e.\u0275\u0275elementStart(2,"div"),e.\u0275\u0275template(3,yx,2,1,"mat-icon",2)(4,vx,1,1,"img",3),e.\u0275\u0275elementStart(5,"div",4)(6,"span",5),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(8,Cx,2,1,"span",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"div"),e.\u0275\u0275template(10,xx,2,7,"div",7),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"div"),e.\u0275\u0275template(12,_x,2,7,"div",7),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(13,Sx,5,0,"section",8)(14,Tx,3,0,"section",8),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("tb-rule-node ",n.node.nodeClass,""),e.\u0275\u0275classProp("tb-rule-node-highlighted",n.node.highlighted)("tb-rule-node-invalid",n.node.error),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n.iconUrl),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.iconUrl),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(n.node.component.name),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.node.name),e.\u0275\u0275advance(),e.\u0275\u0275classMap(n.flowchartConstants.leftConnectorClass),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",n.modelservice.nodes.getConnectorsByType(n.node,n.flowchartConstants.leftConnectorType)),e.\u0275\u0275advance(),e.\u0275\u0275classMap(n.flowchartConstants.rightConnectorClass),e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",n.modelservice.nodes.getConnectorsByType(n.node,n.flowchartConstants.rightConnectorType)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.modelservice.isEditable()&&!n.node.readonly),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",(null==n.node.component||null==n.node.component.configurationDescriptor||null==n.node.component.configurationDescriptor.nodeDefinition?null:n.node.component.configurationDescriptor.nodeDefinition.ruleChainNode)&&n.modelservice.isEditable()))},dependencies:[p.NgForOf,p.NgIf,E.MatIcon,Y.Ve,Y.w6],styles:['@charset "UTF-8";[_nghost-%COMP%]   .fc-node-overlay[_ngcontent-%COMP%]{position:absolute;pointer-events:none;inset:0;background-color:#000;border-radius:5px;opacity:0}[_nghost-%COMP%]   .fc-hover[_nghost-%COMP%]   .fc-node-overlay[_ngcontent-%COMP%], .fc-hover   [_nghost-%COMP%]   .fc-node-overlay[_ngcontent-%COMP%]{opacity:.25;transition:opacity .2s}[_nghost-%COMP%]   .fc-selected[_nghost-%COMP%]   .fc-node-overlay[_ngcontent-%COMP%], .fc-selected   [_nghost-%COMP%]   .fc-node-overlay[_ngcontent-%COMP%]{opacity:.25}[_nghost-%COMP%]   .fc-edit[_nghost-%COMP%]   .fc-nodeedit[_ngcontent-%COMP%], .fc-edit   [_nghost-%COMP%]   .fc-nodeedit[_ngcontent-%COMP%], [_nghost-%COMP%]   .fc-edit[_nghost-%COMP%]   .fc-nodedelete[_ngcontent-%COMP%], .fc-edit   [_nghost-%COMP%]   .fc-nodedelete[_ngcontent-%COMP%]{box-sizing:content-box;border:solid 2px #fff;background:#f83e05;outline:none}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]{box-sizing:content-box;display:flex;flex-direction:row;min-width:150px;max-width:150px;height:32px;min-height:32px;max-height:32px;padding:5px 10px;font-size:12px;line-height:16px;color:#333;pointer-events:none;background-color:#f15b26;border:solid 1px #777;border-radius:5px}[_nghost-%COMP%]   .tb-rule-node.tb-filter-type[_ngcontent-%COMP%]{background-color:#f1e861}[_nghost-%COMP%]   .tb-rule-node.tb-enrichment-type[_ngcontent-%COMP%]{background-color:#cdf14e}[_nghost-%COMP%]   .tb-rule-node.tb-transformation-type[_ngcontent-%COMP%]{background-color:#79cef1}[_nghost-%COMP%]   .tb-rule-node.tb-action-type[_ngcontent-%COMP%]{background-color:#f1928f}[_nghost-%COMP%]   .tb-rule-node.tb-external-type[_ngcontent-%COMP%]{background-color:#fbc766}[_nghost-%COMP%]   .tb-rule-node.tb-flow-type[_ngcontent-%COMP%]{background-color:#d6c4f1}[_nghost-%COMP%]   .tb-rule-node.tb-unknown-type[_ngcontent-%COMP%]{background-color:#f16c29}[_nghost-%COMP%]   .tb-rule-node.tb-rule-node-highlighted[_ngcontent-%COMP%]:not(.tb-rule-node-invalid){box-shadow:0 0 10px 6px #51cbee}[_nghost-%COMP%]   .tb-rule-node.tb-rule-node-highlighted[_ngcontent-%COMP%]:not(.tb-rule-node-invalid)   .tb-node-title[_ngcontent-%COMP%]{font-weight:700;text-decoration:underline}[_nghost-%COMP%]   .tb-rule-node.tb-rule-node-invalid[_ngcontent-%COMP%]{box-shadow:0 0 10px 6px #ff5c50}[_nghost-%COMP%]   .tb-rule-node.tb-input-type[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;background-color:#a3eaa9}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin:auto;width:20px;min-width:20px;height:20px;min-height:20px;padding-right:4px;font-size:20px}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .tb-node-title[_ngcontent-%COMP%]{font-weight:500}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .tb-node-type[_ngcontent-%COMP%], [_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .tb-node-title[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-leftConnectors[_ngcontent-%COMP%], [_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-rightConnectors[_ngcontent-%COMP%]{position:absolute;top:0;z-index:0;display:flex;flex-direction:column;height:100%}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-leftConnectors[_ngcontent-%COMP%]   .fc-magnet[_ngcontent-%COMP%], [_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-rightConnectors[_ngcontent-%COMP%]   .fc-magnet[_ngcontent-%COMP%]{align-items:center}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-leftConnectors[_ngcontent-%COMP%]{left:-20px}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-rightConnectors[_ngcontent-%COMP%]{right:-20px}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-magnet[_ngcontent-%COMP%]{display:flex;flex-grow:1;justify-content:center;height:60px}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-connector[_ngcontent-%COMP%]{width:14px;height:14px;margin:10px;pointer-events:all;background-color:#ccc;border:1px solid #333;border-radius:5px}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-connector.fc-hover[_ngcontent-%COMP%]{background-color:#000}']})}}class ui{static{this.\u0275fac=function(i){return new(i||ui)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:ui})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[{provide:Y.i9,useValue:{nodeComponentType:To}}],imports:[p.CommonModule,w.G,k.I,mi]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(ui,{declarations:[_o,So,st,To,It,ri,si,Qt,di,ci,pi],imports:[p.CommonModule,w.G,k.I,mi]});var Gs=d(98432);class gi{static{this.\u0275fac=function(i){return new(i||gi)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:gi})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,k.I,un]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(gi,{declarations:[Ca,qo.B,Rt,Ta,ya,mn,dn,xa,fa,Gs.r],imports:[p.CommonModule,w.G,k.I,un]}),e.\u0275\u0275setComponentScope(qo.B,[p.NgIf,x.MatButton,L.MatInput,v.MatFormField,v.MatLabel,v.MatHint,v.MatError,pe.MatSlideToggle,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NumberValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.MaxLengthValidator,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,br.GalleryImageInputComponent],[p.AsyncPipe,u.TranslatePipe]),e.\u0275\u0275setComponentScope(Gs.r,[p.NgIf,x.MatButton,x.MatIconButton,E.MatIcon,K.MatProgressBar,ae.MatToolbar,S.MatDialogActions,S.MatDialogContent,s.\u0275NgNoValidate,s.NgControlStatusGroup,s.NgForm,u.TranslateDirective,qo.B],[p.AsyncPipe,u.TranslatePipe]);var Ix=d(34180),wx=d(46782),Ex=d(94775),Mx=d(19470);class fi{static{this.\u0275fac=function(i){return new(i||fi)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:fi})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,k.I,Fe.L,Kn.rk]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(fi,{declarations:[Ix.O,Mx.a,wx.K,Ex.x],imports:[p.CommonModule,w.G,k.I,Fe.L,Kn.rk]});var Nx=d(37324),Ax=d(26636);function Fx(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",4,0),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-attribute-table",5),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"attribute.attributes")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function Dx(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",4,1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-attribute-table",6),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"attribute.latest-telemetry")),e.\u0275\u0275advance(3),e.\u0275\u0275property("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function Px(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",4,2),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-alarm-table",7),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,3,"alarm.alarms")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)}}class Io extends Ee.P{constructor(t){super(t),this.store=t}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(i){return new(i||Io)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Io,selectors:[["tb-tenant-profile-tabs"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:3,vars:3,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"]],template:function(i,n){1&i&&e.\u0275\u0275template(0,Fx,4,7,"mat-tab",3)(1,Dx,4,7,"mat-tab",3)(2,Px,4,5,"mat-tab",3),2&i&&(e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity))},dependencies:[p.NgIf,Q.MatTab,tt.AlarmTableComponent,nt.AttributeTableComponent,u.TranslatePipe],encapsulation:2})}}class Zt{constructor(t,i,n,o,r,l){this.tenantProfileService=t,this.importExport=i,this.translate=n,this.datePipe=o,this.router=r,this.dialogService=l,this.config=new y.M7,this.config.entityType=f.ck.TENANT_PROFILE,this.config.entityComponent=Ax.TenantProfileComponent,this.config.entityTabsComponent=Io,this.config.entityTranslations=f.Mi.get(f.ck.TENANT_PROFILE),this.config.entityResources=f.BT.get(f.ck.TENANT_PROFILE),this.config.columns.push(new y.Qr("createdTime","common.created-time",this.datePipe,"150px"),new y.KK("name","tenant-profile.name","40%"),new y.KK("description","tenant-profile.description","60%"),new y.KK("isDefault","tenant-profile.default","60px",c=>(0,y.ov)(c.default))),this.config.cellActionDescriptors.push({name:this.translate.instant("tenant-profile.export"),icon:"file_download",isEnabled:()=>!0,onAction:(c,m)=>this.exportTenantProfile(c,m)},{name:this.translate.instant("tenant-profile.set-default"),icon:"flag",isEnabled:c=>!c.default,onAction:(c,m)=>this.setDefaultTenantProfile(c,m)}),this.config.deleteEntityTitle=c=>this.translate.instant("tenant-profile.delete-tenant-profile-title",{tenantProfileName:c.name}),this.config.deleteEntityContent=()=>this.translate.instant("tenant-profile.delete-tenant-profile-text"),this.config.deleteEntitiesTitle=c=>this.translate.instant("tenant-profile.delete-tenant-profiles-title",{count:c}),this.config.deleteEntitiesContent=()=>this.translate.instant("tenant-profile.delete-tenant-profiles-text"),this.config.entitiesFetchFunction=c=>this.tenantProfileService.getTenantProfiles(c),this.config.loadEntity=c=>this.tenantProfileService.getTenantProfile(c.id),this.config.saveEntity=c=>this.tenantProfileService.saveTenantProfile(c),this.config.deleteEntity=c=>this.tenantProfileService.deleteTenantProfile(c.id),this.config.onEntityAction=c=>this.onTenantProfileAction(c),this.config.deleteEnabled=c=>c&&!c.default,this.config.entitySelectionEnabled=c=>c&&!c.default,this.config.addActionDescriptors=this.configureAddActions()}resolve(){return this.config.tableTitle=this.translate.instant("tenant-profile.tenant-profiles"),this.config}configureAddActions(){const t=[];return t.push({name:this.translate.instant("tenant-profile.create-tenant-profile"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:i=>this.config.getTable().addEntity(i)},{name:this.translate.instant("tenant-profile.import"),icon:"file_upload",isEnabled:()=>!0,onAction:i=>this.importTenantProfile(i)}),t}openTenantProfile(t,i){t&&t.stopPropagation();const n=this.router.createUrlTree(["tenantProfiles",i.id.id]);this.router.navigateByUrl(n)}setDefaultTenantProfile(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("tenant-profile.set-default-tenant-profile-title",{tenantProfileName:i.name}),this.translate.instant("tenant-profile.set-default-tenant-profile-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{n&&this.tenantProfileService.setDefaultTenantProfile(i.id.id).subscribe(()=>{this.config.updateData()})})}importTenantProfile(t){this.importExport.importTenantProfile().subscribe(i=>{i&&this.config.updateData()})}exportTenantProfile(t,i){t&&t.stopPropagation(),this.importExport.exportTenantProfile(i.id.id)}onTenantProfileAction(t){switch(t.action){case"open":return this.openTenantProfile(t.event,t.entity),!0;case"setDefault":return this.setDefaultTenantProfile(t.event,t.entity),!0}return!1}static{this.\u0275fac=function(i){return new(i||Zt)(e.\u0275\u0275inject(Nx.H),e.\u0275\u0275inject(ut.ImportExportService),e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(p.DatePipe),e.\u0275\u0275inject(b.Router),e.\u0275\u0275inject(Ce.o))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Zt,factory:Zt.\u0275fac})}}const kx=[{path:"tenantProfiles",data:{breadcrumb:{menuId:F.D8.tenant_profiles}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.SYS_ADMIN],title:"tenant-profile.tenant-profiles"},resolve:{entitiesTableConfig:Zt}},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"mdi:alpha-t-box"},auth:[g.s.SYS_ADMIN],title:"tenant-profile.tenant-profiles"},resolve:{entitiesTableConfig:Zt}}]}];class hi{static{this.\u0275fac=function(i){return new(i||hi)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:hi})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[Zt],imports:[b.RouterModule.forChild(kx),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(hi,{imports:[b.RouterModule],exports:[b.RouterModule]});class bi{static{this.\u0275fac=function(i){return new(i||bi)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:bi})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,k.I,hi]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(bi,{declarations:[Io],imports:[p.CommonModule,w.G,k.I,hi]});var Lx=d(28998),Ox=d(14870),Rx=d(23313),Vx=d(62775);const Bx=a=>({count:a});function Gx(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",17),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.deviceTransportTypeTranslations.get(i))," ")}}function jx(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-hint"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,i.deviceTransportTypeHints.get(i.detailsForm.get("transportType").value))," ")}}function Ux(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"device-profile.transport-type-required")," "))}function qx(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",9)(1,"mat-form-field",10)(2,"mat-label",11),e.\u0275\u0275text(3,"device-profile.transport-type"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"mat-select",12),e.\u0275\u0275template(5,Gx,3,4,"mat-option",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(6,jx,3,3,"mat-hint",14)(7,Ux,3,3,"mat-error",14),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"div",15),e.\u0275\u0275element(9,"tb-device-profile-transport-configuration",16),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("formGroup",i.detailsForm),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",i.deviceTransportTypes),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.detailsForm.get("transportType").value),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.detailsForm.get("transportType").hasError("required")),e.\u0275\u0275advance(2),e.\u0275\u0275property("isAdd",i.isTransportTypeChanged)}}function Wx(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",7,0),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275template(3,qx,10,5,"div",8),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1);e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,2,"device-profile.transport-configuration")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",i.isActive)}}function $x(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",9)(1,"div",15),e.\u0275\u0275element(2,"tb-device-profile-alarms",18),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("formGroup",i.detailsForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("deviceProfileId",i.entity.id)}}function zx(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",7,1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275template(3,$x,3,2,"div",8),e.\u0275\u0275elementEnd()),2&a){let i;const n=e.\u0275\u0275reference(1),o=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind2(2,2,"device-profile.alarm-rules-with-count",e.\u0275\u0275pureFunction1(5,Bx,null!=(i=o.detailsForm.get("profileData.alarms").value)&&i.length?o.detailsForm.get("profileData.alarms").value.length:0))),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",n.isActive)}}function Hx(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",9)(1,"div",15),e.\u0275\u0275element(2,"tb-device-profile-provision-configuration",19),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("formGroup",i.detailsForm)}}function Kx(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",7,2),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275template(3,Hx,3,1,"div",8),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1);e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,2,"device-profile.device-provisioning")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",i.isActive)}}function Yx(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",7,3),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementStart(3,"div",9)(4,"div",15),e.\u0275\u0275element(5,"tb-device-profile-configuration",20),e.\u0275\u0275elementEnd()()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,2,"device-profile.profile-configuration")),e.\u0275\u0275advance(3),e.\u0275\u0275property("formGroup",i.detailsForm)}}function Qx(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",7,4),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-audit-log-table",21),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,4,"audit-log.audit-logs")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}function Jx(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-tab",7,5),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementStart(3,"tb-version-control",22),e.\u0275\u0275listener("versionRestored",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.entitiesTableConfig.updateData())}),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"version-control.version-control")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}class wo extends Ee.P{constructor(t){super(t),this.store=t,this.deviceTransportTypes=Object.values(V.y0),this.deviceTransportTypeTranslations=V.Tk,this.deviceTransportTypeHints=V.dQ,this.isTransportTypeChanged=!1}ngOnInit(){super.ngOnInit(),this.detailsForm.get("transportType").valueChanges.subscribe(()=>{this.isTransportTypeChanged=!0})}static{this.\u0275fac=function(i){return new(i||wo)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:wo,selectors:[["tb-device-profile-tabs"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:6,vars:6,consts:[["transportType","matTab"],["alarmRules","matTab"],["deviceProvisioning","matTab"],["deviceProfile","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],["class","mat-padding",3,"formGroup",4,"ngIf"],[1,"mat-padding",3,"formGroup"],[1,"mat-block"],["translate",""],["formControlName","transportType","required",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["formGroupName","profileData"],["formControlName","transportConfiguration",3,"isAdd"],[3,"value"],["formControlName","alarms",3,"deviceProfileId"],["formControlName","provisionConfiguration"],["formControlName","configuration"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(i,n){1&i&&e.\u0275\u0275template(0,Wx,4,4,"mat-tab",6)(1,zx,4,7,"mat-tab",6)(2,Kx,4,4,"mat-tab",6)(3,Yx,6,4,"mat-tab",6)(4,Qx,4,6,"mat-tab",6)(5,Jx,4,7,"mat-tab",6),2&i&&(e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!1),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity&&!n.isEdit),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity&&n.authUser.authority===n.authorities.TENANT_ADMIN&&!n.isEdit))},dependencies:[p.NgForOf,p.NgIf,v.MatFormField,v.MatLabel,v.MatHint,v.MatError,ce.MatSelect,z.MatOption,Q.MatTab,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,s.FormGroupName,u.TranslateDirective,je.AuditLogTableComponent,Lx.DeviceProfileConfigurationComponent,Ox.DeviceProfileTransportConfigurationComponent,Rx.DeviceProfileAlarmsComponent,Vx.DeviceProfileProvisionConfigurationComponent,ke.d,u.TranslatePipe],encapsulation:2})}}var Zx=d(98442),Xx=d(34019);class Xt{constructor(t,i,n,o,r,l,c,m){this.deviceProfileService=t,this.importExport=i,this.homeDialogs=n,this.translate=o,this.datePipe=r,this.dialogService=l,this.router=c,this.dialog=m,this.config=new y.M7,this.config.entityType=f.ck.DEVICE_PROFILE,this.config.entityComponent=Zx.DeviceProfileComponent,this.config.entityTabsComponent=wo,this.config.entityTranslations=f.Mi.get(f.ck.DEVICE_PROFILE),this.config.entityResources=f.BT.get(f.ck.DEVICE_PROFILE),this.config.hideDetailsTabsOnEdit=!1,this.config.addDialogStyle={width:"1000px"},this.config.columns.push(new y.Qr("createdTime","common.created-time",this.datePipe,"150px"),new y.KK("name","device-profile.name","20%"),new y.KK("type","device-profile.type","20%",h=>this.translate.instant(V.dx.get(h.type))),new y.KK("transportType","device-profile.transport-type","20%",h=>this.translate.instant(V.Tk.get(h.transportType))),new y.KK("description","device-profile.description","40%"),new y.KK("isDefault","device-profile.default","60px",h=>(0,y.ov)(h.default))),this.config.cellActionDescriptors.push({name:this.translate.instant("device-profile.export"),icon:"file_download",isEnabled:()=>!0,onAction:(h,T)=>this.exportDeviceProfile(h,T)},{name:this.translate.instant("device-profile.set-default"),icon:"flag",isEnabled:h=>!h.default,onAction:(h,T)=>this.setDefaultDeviceProfile(h,T)}),this.config.deleteEntityTitle=h=>this.translate.instant("device-profile.delete-device-profile-title",{deviceProfileName:h.name}),this.config.deleteEntityContent=()=>this.translate.instant("device-profile.delete-device-profile-text"),this.config.deleteEntitiesTitle=h=>this.translate.instant("device-profile.delete-device-profiles-title",{count:h}),this.config.deleteEntitiesContent=()=>this.translate.instant("device-profile.delete-device-profiles-text"),this.config.entitiesFetchFunction=h=>this.deviceProfileService.getDeviceProfiles(h),this.config.loadEntity=h=>this.deviceProfileService.getDeviceProfile(h.id),this.config.saveEntity=(h,T)=>this.deviceProfileService.saveDeviceProfileAndConfirmOtaChange(T,h),this.config.deleteEntity=h=>this.deviceProfileService.deleteDeviceProfile(h.id),this.config.onEntityAction=h=>this.onDeviceProfileAction(h),this.config.deleteEnabled=h=>h&&!h.default,this.config.entitySelectionEnabled=h=>h&&!h.default,this.config.addActionDescriptors=this.configureAddActions()}resolve(){return this.config.tableTitle=this.translate.instant("device-profile.device-profiles"),this.config}configureAddActions(){const t=[];return t.push({name:this.translate.instant("device-profile.create-device-profile"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:()=>this.addDeviceProfile()},{name:this.translate.instant("device-profile.import"),icon:"file_upload",isEnabled:()=>!0,onAction:i=>this.importDeviceProfile(i)}),t}addDeviceProfile(){this.dialog.open(Xx.AddDeviceProfileDialogComponent,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{deviceProfileName:null,transportType:null}}).afterClosed().subscribe(t=>{t&&this.config.updateData()})}setDefaultDeviceProfile(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("device-profile.set-default-device-profile-title",{deviceProfileName:i.name}),this.translate.instant("device-profile.set-default-device-profile-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{n&&this.deviceProfileService.setDefaultDeviceProfile(i.id.id).subscribe(()=>{this.config.updateData()})})}openDeviceProfile(t,i){t&&t.stopPropagation();const n=this.router.createUrlTree(["profiles","deviceProfiles",i.id.id]);this.router.navigateByUrl(n)}importDeviceProfile(t){this.importExport.importDeviceProfile().subscribe(i=>{i&&this.config.updateData()})}exportDeviceProfile(t,i){t&&t.stopPropagation(),this.importExport.exportDeviceProfile(i.id.id)}onDeviceProfileAction(t){switch(t.action){case"open":return this.openDeviceProfile(t.event,t.entity),!0;case"setDefault":return this.setDefaultDeviceProfile(t.event,t.entity),!0;case"export":return this.exportDeviceProfile(t.event,t.entity),!0}return!1}static{this.\u0275fac=function(i){return new(i||Xt)(e.\u0275\u0275inject(Ss.N),e.\u0275\u0275inject(ut.ImportExportService),e.\u0275\u0275inject(mt.k),e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(p.DatePipe),e.\u0275\u0275inject(Ce.o),e.\u0275\u0275inject(b.Router),e.\u0275\u0275inject(S.MatDialog))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Xt,factory:Xt.\u0275fac})}}const e_=[{path:"deviceProfiles",data:{breadcrumb:{menuId:F.D8.device_profiles}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN],title:"device-profile.device-profiles"},resolve:{entitiesTableConfig:Xt}},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"mdi:alpha-d-box"},auth:[g.s.TENANT_ADMIN],title:"device-profile.device-profiles"},resolve:{entitiesTableConfig:Xt}}]}];class Eo{static{this.\u0275fac=function(i){return new(i||Eo)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Eo})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[Xt]})}}class yi{static{this.\u0275fac=function(i){return new(i||yi)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:yi})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,k.I,Eo]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(yi,{declarations:[wo],imports:[p.CommonModule,w.G,k.I,Eo]});var js=d(83103);const i_=[{path:"usage",component:js.n,data:{auth:[g.s.TENANT_ADMIN],title:"api-usage.api-usage",breadcrumb:{menuId:F.D8.api_usage}},resolve:{dashboard:(a,t,i=(0,e.inject)(Mr.pQ))=>i.loadJsonResource("/assets/dashboard/api_usage.json")}}];class vi{static{this.\u0275fac=function(i){return new(i||vi)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:vi})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[b.RouterModule.forChild(i_),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(vi,{imports:[b.RouterModule],exports:[b.RouterModule]});class Ci{static{this.\u0275fac=function(i){return new(i||Ci)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Ci})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,k.I,vi]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Ci,{imports:[p.CommonModule,w.G,k.I,vi]});const a_=[{path:"edgeManagement",data:{breadcrumb:{menuId:F.D8.edge_management}},children:[{path:"",children:[],data:{auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],redirectTo:"/edgeManagement/instances"}},{path:"instances",data:{breadcrumb:{menuId:F.D8.edges}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"edge.edge-instances",edgesType:"tenant"},resolve:{entitiesTableConfig:ot}},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"router"},auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"edge.edge-instances",edgesType:"tenant"},resolve:{entitiesTableConfig:ot}},{path:":edgeId/assets",data:{breadcrumb:{label:"edge.assets",icon:"domain"}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"edge.assets",assetsType:"edge"},resolve:{entitiesTableConfig:Oe}},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"domain"},auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"edge.assets",assetsType:"edge"},resolve:{entitiesTableConfig:Oe}}]},{path:":edgeId/devices",data:{breadcrumb:{label:"edge.devices",icon:"devices_other"}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"edge.devices",devicesType:"edge"},resolve:{entitiesTableConfig:Le}},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"devices_other"},auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"edge.devices",devicesType:"edge"},resolve:{entitiesTableConfig:Le}}]},{path:":edgeId/entityViews",data:{breadcrumb:{label:"edge.entity-views",icon:"view_quilt"}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"edge.entity-views",entityViewsType:"edge"},resolve:{entitiesTableConfig:rt}},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"devices_other"},auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"edge.entity-views",entityViewsType:"edge"},resolve:{entitiesTableConfig:rt}}]},{path:":edgeId/dashboards",data:{breadcrumb:{label:"edge.dashboards",icon:"dashboard"}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],dashboardsType:"edge"},resolve:{entitiesTableConfig:Ms.S}},{path:":dashboardId",component:Er.DashboardPageComponent,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:Kn.QU,icon:"dashboard"},auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"edge.dashboard",widgetEditMode:!1},resolve:{dashboard:Kn.Pj}}]},{path:":edgeId/ruleChains",data:{breadcrumb:{label:"edge.rulechains",icon:"settings_ethernet"}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN],title:"edge.rulechains",ruleChainsType:"edge"},resolve:{entitiesTableConfig:Tt}},{path:":ruleChainId",component:st,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:kr,icon:"settings_ethernet"},auth:[g.s.TENANT_ADMIN],title:"rulechain.edge-rulechain",import:!1,ruleChainType:ue.UR.EDGE},resolve:{ruleChain:wt,ruleChainMetaData:Et,ruleNodeComponents:We,tooltipster:$e}}]}]},{path:"ruleChains",data:{breadcrumb:{menuId:F.D8.rulechain_templates}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN],title:"edge.rulechain-templates",ruleChainsType:"edges"},resolve:{entitiesTableConfig:Tt}},{path:":ruleChainId",component:st,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:kr,icon:"settings_ethernet"},auth:[g.s.TENANT_ADMIN],title:"rulechain.edge-rulechain",import:!1,ruleChainType:ue.UR.EDGE},resolve:{ruleChain:wt,ruleChainMetaData:Et,ruleNodeComponents:We,tooltipster:$e}},{path:"ruleChain/import",component:st,canActivate:[Jt],canDeactivate:[P.L],data:{breadcrumb:{labelFunction:Vs,icon:"settings_ethernet"},auth:[g.s.TENANT_ADMIN],title:"rulechain.edge-rulechain",import:!0,ruleChainType:ue.UR.EDGE},resolve:{ruleNodeComponents:We,tooltipster:$e}}]}]},{path:"edgeInstances",pathMatch:"full",redirectTo:"/edgeManagement/instances"},{path:"edgeInstances/:entityId",pathMatch:"full",redirectTo:"/edgeManagement/instances/:entityId"},{path:"edgeInstances/:edgeId/assets",pathMatch:"full",redirectTo:"/edgeManagement/instances/:edgeId/assets"},{path:"edgeInstances/:edgeId/assets/:entityId",redirectTo:"/edgeManagement/instances/:edgeId/assets/:entityId"},{path:"edgeInstances/:edgeId/devices",pathMatch:"full",redirectTo:"/edgeManagement/instances/:edgeId/devices"},{path:"edgeInstances/:edgeId/devices/:entityId",redirectTo:"/edgeManagement/instances/:edgeId/devices/:entityId"},{path:"edgeInstances/:edgeId/entityViews",pathMatch:"full",redirectTo:"/edgeManagement/instances/:edgeId/entityViews"},{path:"edgeInstances/:edgeId/entityViews/:entityId",redirectTo:"/edgeManagement/instances/:edgeId/entityViews/:entityId"},{path:"edgeInstances/:edgeId/dashboards",pathMatch:"full",redirectTo:"/edgeManagement/instances/:edgeId/dashboards"},{path:"edgeInstances/:edgeId/dashboards/:dashboardId",redirectTo:"/edgeManagement/instances/:edgeId/dashboards/:dashboardId"},{path:"edgeInstances/:edgeId/ruleChains",pathMatch:"full",redirectTo:"/edgeManagement/instances/:edgeId/ruleChains"},{path:"edgeInstances/:edgeId/ruleChains/:ruleChainId",redirectTo:"/edgeManagement/instances/:edgeId/ruleChains/:ruleChainId"}];class xi{static{this.\u0275fac=function(i){return new(i||xi)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:xi})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[ot],imports:[b.RouterModule.forChild(a_),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(xi,{imports:[b.RouterModule],exports:[b.RouterModule]});class _i{static{this.\u0275fac=function(i){return new(i||_i)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:_i})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,Fe.L,k.I,xi]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(_i,{declarations:[fo,ho,bo,yo],imports:[p.CommonModule,w.G,Fe.L,k.I,xi]});var o_=d(14251),r_=d(84572),s_=d(5964),Us=d(5951);function l_(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"ota-update.title-required")," "))}function d_(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"ota-update.title-max-length")," "))}function c_(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"ota-update.version-required")," "))}function p_(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"ota-update.version-max-length")," "))}function m_(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-hint",5),e.\u0275\u0275text(1,"ota-update.version-tag-hint"),e.\u0275\u0275elementEnd())}function u_(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",25),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.otaUpdateTypeTranslationMap.get(i))," ")}}function g_(a,t){1&a&&(e.\u0275\u0275elementStart(0,"section")(1,"div",26),e.\u0275\u0275text(2,"ota-update.warning-after-save-no-edit"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"mat-radio-group",27)(4,"mat-radio-button",25),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"mat-radio-button",25),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd()()()),2&a&&(e.\u0275\u0275advance(4),e.\u0275\u0275property("value",!1),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(6,4,"ota-update.upload-binary-file")),e.\u0275\u0275advance(2),e.\u0275\u0275property("value",!0),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,6,"ota-update.use-external-url")))}function f_(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"section"),e.\u0275\u0275element(1,"tb-file-input",29),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementStart(4,"mat-checkbox",30),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,4,"ota-update.package-file")),e.\u0275\u0275propertyInterpolate("dropLabel",e.\u0275\u0275pipeBind1(3,6,"ota-update.drop-package-file-or")),e.\u0275\u0275property("required",!i.entityForm.get("isURL").value),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(6,8,"ota-update.auto-generate-checksum")," ")}}function h_(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",25),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",n.checksumAlgorithmTranslationMap.get(i)," ")}}function b_(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-hint",5),e.\u0275\u0275text(1,"ota-update.checksum-hint"),e.\u0275\u0275elementEnd())}function y_(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",31)(1,"mat-form-field",32)(2,"mat-label",5),e.\u0275\u0275text(3,"ota-update.checksum-algorithm"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"mat-select",33),e.\u0275\u0275template(5,h_,2,2,"mat-option",21),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"mat-form-field",13)(7,"mat-label",5),e.\u0275\u0275text(8,"ota-update.checksum"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"input",34),e.\u0275\u0275template(10,b_,2,0,"mat-hint",17),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",i.checksumAlgorithms),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.isAdd)}}function v_(a,t){1&a&&(e.\u0275\u0275elementStart(0,"section")(1,"div",35)(2,"mat-form-field",32)(3,"mat-label",5),e.\u0275\u0275text(4,"ota-update.file-name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"input",36),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"mat-form-field",13)(7,"mat-label",5),e.\u0275\u0275text(8,"ota-update.file-size-bytes"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"input",37),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"mat-form-field",13)(11,"mat-label",5),e.\u0275\u0275text(12,"ota-update.content-type"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(13,"input",38),e.\u0275\u0275elementEnd()()())}function C_(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"section"),e.\u0275\u0275template(1,f_,7,10,"section",12)(2,y_,11,2,"div",28)(3,v_,14,0,"section",12),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.isAdd),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!(i.isAdd&&i.entityForm.get("generateChecksum").value)),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!i.isAdd)}}function x_(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error",5),e.\u0275\u0275text(1," ota-update.direct-url-required "),e.\u0275\u0275elementEnd())}function __(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"section",39)(1,"mat-form-field",19)(2,"mat-label",5),e.\u0275\u0275text(3,"ota-update.direct-url"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"input",40),e.\u0275\u0275template(5,x_,2,0,"mat-error",17),e.\u0275\u0275elementEnd()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275property("required",i.entityForm.get("isURL").value),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.entityForm.get("url").hasError("required")||i.entityForm.get("url").hasError("pattern"))}}class Mo extends xe.l{constructor(t,i,n,o,r,l){super(t,r,n,o,l),this.store=t,this.translate=i,this.entityValue=n,this.entitiesTableConfigValue=o,this.fb=r,this.cd=l,this.destroy$=new fe.B,this.checksumAlgorithms=Object.values(it.VD),this.checksumAlgorithmTranslationMap=it.oZ,this.packageTypes=Object.values(it.Mj),this.otaUpdateTypeTranslationMap=it.hX}ngOnInit(){super.ngOnInit(),this.isAdd&&(this.entityForm.get("isURL").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(t=>{!1===t?(this.entityForm.get("url").clearValidators(),this.entityForm.get("file").setValidators(s.Validators.required),this.entityForm.get("url").updateValueAndValidity({emitEvent:!1}),this.entityForm.get("file").updateValueAndValidity({emitEvent:!1})):(this.entityForm.get("file").clearValidators(),this.entityForm.get("url").setValidators([s.Validators.required,s.Validators.pattern("(.|\\s)*\\S(.|\\s)*")]),this.entityForm.get("file").updateValueAndValidity({emitEvent:!1}),this.entityForm.get("url").updateValueAndValidity({emitEvent:!1}))}),(0,r_.z)([this.entityForm.get("title").valueChanges.pipe((0,sa.Z)("")),this.entityForm.get("version").valueChanges.pipe((0,sa.Z)(""))]).pipe((0,s_.p)(()=>this.entityForm.get("tag").pristine),(0,j.Q)(this.destroy$)).subscribe(([t,i])=>{const n=`${t} ${i}`.trim();this.entityForm.get("tag").patchValue(n)}))}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}hideDelete(){return!!this.entitiesTableConfig&&!this.entitiesTableConfig.deleteEnabled(this.entity)}buildForm(t){const i=this.fb.group({title:[t?t.title:"",[s.Validators.required,s.Validators.maxLength(255)]],version:[t?t.version:"",[s.Validators.required,s.Validators.maxLength(255)]],tag:[t?t.tag:"",[s.Validators.maxLength(255)]],type:[t?.type?t.type:it.Mj.FIRMWARE,s.Validators.required],deviceProfileId:[t?t.deviceProfileId:null,s.Validators.required],checksumAlgorithm:[t&&t.checksumAlgorithm?t.checksumAlgorithm:it.VD.SHA256],checksum:[t?t.checksum:"",s.Validators.maxLength(1020)],url:[t?t.url:""],isURL:[!1],additionalInfo:this.fb.group({description:[t&&t.additionalInfo?t.additionalInfo.description:""]})});return this.isAdd?(i.addControl("file",this.fb.control(null,s.Validators.required)),i.addControl("generateChecksum",this.fb.control(!0))):(i.addControl("fileName",this.fb.control(null)),i.addControl("dataSize",this.fb.control(null)),i.addControl("contentType",this.fb.control(null))),i}updateForm(t){this.entityForm.patchValue({title:t.title,version:t.version,tag:t.tag,type:t.type,deviceProfileId:t.deviceProfileId,checksumAlgorithm:t.checksumAlgorithm,checksum:t.checksum,fileName:t.fileName,dataSize:t.dataSize,contentType:t.contentType,url:t.url,isURL:(0,_.Q8)(t.url),additionalInfo:{description:t.additionalInfo?t.additionalInfo.description:""}}),!this.isAdd&&this.entityForm.enabled&&(this.entityForm.disable({emitEvent:!1}),this.entityForm.get("additionalInfo").enable({emitEvent:!1}))}onPackageIdCopied(){this.store.dispatch(new $.xo({message:this.translate.instant("ota-update.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onPackageChecksumCopied(){this.store.dispatch(new $.xo({message:this.translate.instant("ota-update.checksum-copied-message"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onPackageDirectUrlCopied(){this.store.dispatch(new $.xo({message:this.translate.instant("ota-update.checksum-copied-message"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}prepareFormValue(t){return t.isURL?delete t.file:delete t.url,delete t.generateChecksum,super.prepareFormValue(t)}static{this.\u0275fac=function(i){return new(i||Mo)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject("entity"),e.\u0275\u0275directiveInject("entitiesTableConfig"),e.\u0275\u0275directiveInject(s.UntypedFormBuilder),e.\u0275\u0275directiveInject(e.ChangeDetectorRef))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Mo,selectors:[["tb-ota-update"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:62,vars:57,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",1,"xs:flex-1",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col","gap-2"],[3,"formGroup"],[1,"flex","flex-col",3,"disabled"],[1,"flex","flex-row","xs:flex-col","gt-xs:gap-2"],[1,"mat-block","flex-full","gt-xs:max-w-45%"],["matInput","","formControlName","title","type","text","required","",3,"readonly"],[4,"ngIf"],[1,"mat-block","flex-1"],["matInput","","formControlName","version","type","text","required","",3,"readonly"],[1,"mat-block","flex-1",2,"margin-bottom","8px"],["matInput","","formControlName","tag","type","text",3,"readonly"],["translate","",4,"ngIf"],["formControlName","deviceProfileId","required","",3,"hint","editProfileEnabled","addNewProfile","showDetailsPageLink"],[1,"mat-block"],["formControlName","type","required",""],[3,"value",4,"ngFor","ngForOf"],["style","margin-top: 8px",4,"ngIf"],["formGroupName","additionalInfo"],["matInput","","formControlName","description","rows","2"],[3,"value"],["translate","",1,"mat-caption",2,"margin","-8px 0 8px"],["formControlName","isURL",1,"gap-4"],["class","flex flex-row xs:flex-col sm:gap-2 md:flex-col gt-xs:gap-2",4,"ngIf"],["formControlName","file","workFromFileObj","true",3,"label","required","dropLabel"],["formControlName","generateChecksum",2,"margin-top","16px"],[1,"flex","flex-row","xs:flex-col","sm:gap-2","md:flex-col","gt-xs:gap-2"],[1,"mat-block","flex-full","gt-xs:max-w-33%"],["formControlName","checksumAlgorithm"],["matInput","","formControlName","checksum","type","text"],[1,"flex","flex-row","xs:flex-col","sm:gap-2","md:flex-col","gt-md:gap-2"],["matInput","","formControlName","fileName","type","text"],["matInput","","formControlName","dataSize","type","text"],["matInput","","formControlName","contentType","type","text"],[2,"margin-top","8px"],["matInput","","formControlName","url","type","text",3,"required"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"button",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"open")}),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",1),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"uploadPackage")}),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"button",1),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275listener("click",function(r){return n.onEntityAction(r,"delete")}),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"div",2)(14,"button",3),e.\u0275\u0275listener("cbOnSuccess",function(){return n.onPackageIdCopied()}),e.\u0275\u0275element(15,"mat-icon",4),e.\u0275\u0275elementStart(16,"span",5),e.\u0275\u0275text(17,"ota-update.copyId"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(18,"button",3),e.\u0275\u0275listener("cbOnSuccess",function(){return n.onPackageChecksumCopied()}),e.\u0275\u0275element(19,"mat-icon",4),e.\u0275\u0275elementStart(20,"span",5),e.\u0275\u0275text(21,"ota-update.copy-checksum"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(22,"button",3),e.\u0275\u0275listener("cbOnSuccess",function(){return n.onPackageDirectUrlCopied()}),e.\u0275\u0275element(23,"mat-icon",4),e.\u0275\u0275elementStart(24,"span",5),e.\u0275\u0275text(25,"ota-update.copy-direct-url"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(26,"div",6)(27,"form",7)(28,"fieldset",8),e.\u0275\u0275pipe(29,"async"),e.\u0275\u0275elementStart(30,"div",9)(31,"mat-form-field",10)(32,"mat-label",5),e.\u0275\u0275text(33,"ota-update.title"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(34,"input",11),e.\u0275\u0275template(35,l_,3,3,"mat-error",12)(36,d_,3,3,"mat-error",12),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(37,"mat-form-field",13)(38,"mat-label",5),e.\u0275\u0275text(39,"ota-update.version"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(40,"input",14),e.\u0275\u0275template(41,c_,3,3,"mat-error",12)(42,p_,3,3,"mat-error",12),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(43,"mat-form-field",15)(44,"mat-label",5),e.\u0275\u0275text(45,"ota-update.version-tag"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(46,"input",16),e.\u0275\u0275template(47,m_,2,0,"mat-hint",17),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(48,"tb-device-profile-autocomplete",18),e.\u0275\u0275elementStart(49,"mat-form-field",19)(50,"mat-label",5),e.\u0275\u0275text(51,"ota-update.package-type"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(52,"mat-select",20),e.\u0275\u0275template(53,u_,3,4,"mat-option",21),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(54,g_,10,8,"section",12)(55,C_,4,3,"section",12)(56,__,6,2,"section",22),e.\u0275\u0275elementStart(57,"div",23)(58,"mat-form-field",19)(59,"mat-label",5),e.\u0275\u0275text(60,"ota-update.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(61,"textarea",24),e.\u0275\u0275elementEnd()()()()()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275classProp("!hidden",n.isEdit||n.isDetailsPage),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(2,43,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,45,"common.open-details-page")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(6,47,n.isLoading$)||!(null!=n.entity&&n.entity.hasData&&(null==n.entity||!n.entity.url))),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(8,49,"ota-update.download")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.hideDelete()||n.isEdit),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(10,51,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(12,53,"ota-update.delete")," "),e.\u0275\u0275advance(3),e.\u0275\u0275classProp("!hidden",n.isEdit),e.\u0275\u0275property("cbContent",null==n.entity||null==n.entity.id?null:n.entity.id.id),e.\u0275\u0275advance(4),e.\u0275\u0275classProp("!hidden",n.isEdit||!(null!=n.entity&&n.entity.checksum)),e.\u0275\u0275property("cbContent",null==n.entity?null:n.entity.checksum),e.\u0275\u0275advance(4),e.\u0275\u0275classProp("!hidden",n.isEdit||!(null!=n.entity&&n.entity.url)),e.\u0275\u0275property("cbContent",null==n.entity?null:n.entity.url),e.\u0275\u0275advance(5),e.\u0275\u0275property("formGroup",n.entityForm),e.\u0275\u0275advance(),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(29,55,n.isLoading$)||!n.isEdit),e.\u0275\u0275advance(6),e.\u0275\u0275property("readonly",!n.isAdd),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("title").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("title").hasError("maxlength")),e.\u0275\u0275advance(4),e.\u0275\u0275property("readonly",!n.isAdd),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("version").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("version").hasError("maxlength")),e.\u0275\u0275advance(4),e.\u0275\u0275property("readonly",!n.isAdd),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.isAdd),e.\u0275\u0275advance(),e.\u0275\u0275classProp("pb-4",n.isAdd)("pb-0",!n.isAdd),e.\u0275\u0275property("hint","ota-update.chose-compatible-device-profile")("editProfileEnabled",!1)("addNewProfile",!1)("showDetailsPageLink",!0),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",n.packageTypes),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.isAdd),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n.entityForm.get("isURL").value),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entityForm.get("isURL").value))},dependencies:[p.NgForOf,p.NgIf,x.MatButton,Te.MatCheckbox,E.MatIcon,L.MatInput,v.MatFormField,v.MatLabel,v.MatHint,v.MatError,ce.MatSelect,z.MatOption,Us.MatRadioGroup,Us.MatRadioButton,we.Uo,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,s.FormGroupName,gr.FileInputComponent,u.TranslateDirective,xs.DeviceProfileAutocompleteComponent,p.AsyncPipe,u.TranslatePipe],encapsulation:2})}}var S_=d(44685);class en{constructor(t,i,n,o,r,l){this.translate=t,this.datePipe=i,this.store=n,this.otaPackageService=o,this.router=r,this.fileSize=l,this.config=new y.M7,this.config.entityType=f.ck.OTA_PACKAGE,this.config.entityComponent=Mo,this.config.entityTranslations=f.Mi.get(f.ck.OTA_PACKAGE),this.config.entityResources=f.BT.get(f.ck.OTA_PACKAGE),this.config.entityTitle=c=>c?c.title:"",this.config.columns.push(new y.Qr("createdTime","common.created-time",this.datePipe,"150px"),new y.KK("title","ota-update.title","15%"),new y.KK("version","ota-update.version","15%"),new y.KK("tag","ota-update.version-tag","15%"),new y.KK("type","ota-update.package-type","15%",c=>this.translate.instant(it.hX.get(c.type))),new y.KK("url","ota-update.direct-url","20%",c=>c.url?c.url.length>20?`${c.url.slice(0,20)}\u2026`:c.url:"",()=>({}),!0,()=>({}),()=>{},!1,{name:this.translate.instant("ota-update.copy-direct-url"),icon:"content_paste",style:{padding:"4px","font-size":"16px",color:"rgba(0,0,0,.87)"},isEnabled:c=>!!c.url,onAction:(c,m)=>m.url,type:y.Uk.COPY_BUTTON}),new y.KK("fileName","ota-update.file-name","20%"),new y.KK("dataSize","ota-update.file-size","70px",c=>c.dataSize?this.fileSize.transform(c.dataSize):""),new y.KK("checksum","ota-update.checksum","220px",c=>c.checksum?this.checksumText(c):"",()=>({}),!0,()=>({}),()=>{},!1,{name:this.translate.instant("ota-update.copy-checksum"),icon:"content_paste",style:{padding:"4px","font-size":"16px",color:"rgba(0,0,0,.87)"},isEnabled:c=>!!c.checksum,onAction:(c,m)=>m.checksum,type:y.Uk.COPY_BUTTON})),this.config.cellActionDescriptors.push({name:this.translate.instant("ota-update.download"),icon:"file_download",isEnabled:c=>c.hasData&&!c.url,onAction:(c,m)=>this.exportPackage(c,m)}),this.config.deleteEntityTitle=c=>this.translate.instant("ota-update.delete-ota-update-title",{title:c.title}),this.config.deleteEntityContent=()=>this.translate.instant("ota-update.delete-ota-update-text"),this.config.deleteEntitiesTitle=c=>this.translate.instant("ota-update.delete-ota-updates-title",{count:c}),this.config.deleteEntitiesContent=()=>this.translate.instant("ota-update.delete-ota-updates-text"),this.config.entitiesFetchFunction=c=>this.otaPackageService.getOtaPackages(c),this.config.loadEntity=c=>this.otaPackageService.getOtaPackageInfo(c.id),this.config.saveEntity=c=>this.otaPackageService.saveOtaPackage(c),this.config.deleteEntity=c=>this.otaPackageService.deleteOtaPackage(c.id),this.config.onEntityAction=c=>this.onPackageAction(c)}resolve(){return this.config.tableTitle=this.translate.instant("ota-update.packages-repository"),this.config}openOtaPackage(t,i){t&&t.stopPropagation();const n=this.router.createUrlTree(["otaUpdates",i.id.id]);this.router.navigateByUrl(n)}exportPackage(t,i){t&&t.stopPropagation(),i.url?window.open(i.url,"_blank"):this.otaPackageService.downloadOtaPackage(i.id.id).subscribe()}checksumText(t){let i=`${it.oZ.get(t.checksumAlgorithm)}: ${t.checksum}`;return i.length>20&&(i=`${i.slice(0,20)}\u2026`),i}onPackageAction(t){switch(t.action){case"open":return this.openOtaPackage(t.event,t.entity),!0;case"uploadPackage":return this.exportPackage(t.event,t.entity),!0}return!1}static{this.\u0275fac=function(i){return new(i||en)(e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(p.DatePipe),e.\u0275\u0275inject(C.Store),e.\u0275\u0275inject(o_.y),e.\u0275\u0275inject(b.Router),e.\u0275\u0275inject(S_.FileSizePipe))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:en,factory:en.\u0275fac})}}const T_=[{path:"otaUpdates",data:{breadcrumb:{menuId:F.D8.otaUpdates}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN],title:"ota-update.ota-updates"},resolve:{entitiesTableConfig:en}},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"memory"},auth:[g.s.TENANT_ADMIN],title:"ota-update.ota-updates"},resolve:{entitiesTableConfig:en}}]}],I_=[{path:"otaUpdates",pathMatch:"full",redirectTo:"/features/otaUpdates"},{path:"otaUpdates/:entityId",redirectTo:"/features/otaUpdates/:entityId"}];class Si{static{this.\u0275fac=function(i){return new(i||Si)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Si})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[en],imports:[b.RouterModule.forChild(I_),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Si,{imports:[b.RouterModule],exports:[b.RouterModule]});class Ti{static{this.\u0275fac=function(i){return new(i||Ti)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Ti})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,k.I,Si]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Ti,{declarations:[Mo],imports:[p.CommonModule,w.G,k.I,Si]});const w_=[{path:"vc",component:ke.d,canDeactivate:[P.L],data:{auth:[g.s.TENANT_ADMIN],title:"version-control.version-control",breadcrumb:{menuId:F.D8.version_control}}}],E_=[{path:"vc",redirectTo:"/features/vc"}];class Ii{static{this.\u0275fac=function(i){return new(i||Ii)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Ii})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[b.RouterModule.forChild(E_),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Ii,{imports:[b.RouterModule],exports:[b.RouterModule]});class wi{static{this.\u0275fac=function(i){return new(i||wi)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:wi})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,Ii]})}}function M_(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-tab",3,0),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275element(3,"tb-audit-log-table",4),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,4,"audit-log.audit-logs")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}function N_(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-tab",3,1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementStart(3,"tb-version-control",5),e.\u0275\u0275listener("versionRestored",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.entitiesTableConfig.updateData())}),e.\u0275\u0275elementEnd()()}if(2&a){const i=e.\u0275\u0275reference(1),n=e.\u0275\u0275nextContext();e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(2,5,"version-control.version-control")),e.\u0275\u0275advance(3),e.\u0275\u0275property("active",i.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(wi,{imports:[p.CommonModule,w.G,Ii]});class No extends Ee.P{constructor(t){super(t),this.store=t}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(i){return new(i||No)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:No,selectors:[["tb-asset-profile-tabs"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:2,consts:[["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(i,n){1&i&&e.\u0275\u0275template(0,M_,4,6,"mat-tab",2)(1,N_,4,7,"mat-tab",2),2&i&&(e.\u0275\u0275property("ngIf",n.entity&&!n.isEdit),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.entity&&n.authUser.authority===n.authorities.TENANT_ADMIN&&!n.isEdit))},dependencies:[p.NgIf,Q.MatTab,je.AuditLogTableComponent,ke.d,u.TranslatePipe],encapsulation:2})}}var A_=d(56564),F_=d(96036);class tn{constructor(t,i,n,o,r,l,c,m){this.assetProfileService=t,this.importExport=i,this.homeDialogs=n,this.translate=o,this.datePipe=r,this.dialogService=l,this.router=c,this.dialog=m,this.config=new y.M7,this.config.entityType=f.ck.ASSET_PROFILE,this.config.entityComponent=F_.AssetProfileComponent,this.config.entityTabsComponent=No,this.config.entityTranslations=f.Mi.get(f.ck.ASSET_PROFILE),this.config.entityResources=f.BT.get(f.ck.ASSET_PROFILE),this.config.hideDetailsTabsOnEdit=!1,this.config.columns.push(new y.Qr("createdTime","common.created-time",this.datePipe,"150px"),new y.KK("name","asset-profile.name","50%"),new y.KK("description","asset-profile.description","50%"),new y.KK("isDefault","asset-profile.default","60px",h=>(0,y.ov)(h.default))),this.config.cellActionDescriptors.push({name:this.translate.instant("asset-profile.export"),icon:"file_download",isEnabled:()=>!0,onAction:(h,T)=>this.exportAssetProfile(h,T)},{name:this.translate.instant("asset-profile.set-default"),icon:"flag",isEnabled:h=>!h.default,onAction:(h,T)=>this.setDefaultAssetProfile(h,T)}),this.config.deleteEntityTitle=h=>this.translate.instant("asset-profile.delete-asset-profile-title",{assetProfileName:h.name}),this.config.deleteEntityContent=()=>this.translate.instant("asset-profile.delete-asset-profile-text"),this.config.deleteEntitiesTitle=h=>this.translate.instant("asset-profile.delete-asset-profiles-title",{count:h}),this.config.deleteEntitiesContent=()=>this.translate.instant("asset-profile.delete-asset-profiles-text"),this.config.entitiesFetchFunction=h=>this.assetProfileService.getAssetProfiles(h),this.config.loadEntity=h=>this.assetProfileService.getAssetProfile(h.id),this.config.saveEntity=h=>this.assetProfileService.saveAssetProfile(h),this.config.deleteEntity=h=>this.assetProfileService.deleteAssetProfile(h.id),this.config.onEntityAction=h=>this.onAssetProfileAction(h),this.config.deleteEnabled=h=>h&&!h.default,this.config.entitySelectionEnabled=h=>h&&!h.default,this.config.addActionDescriptors=this.configureAddActions()}resolve(){return this.config.tableTitle=this.translate.instant("asset-profile.asset-profiles"),this.config}configureAddActions(){const t=[];return t.push({name:this.translate.instant("asset-profile.create-asset-profile"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:i=>this.config.getTable().addEntity(i)},{name:this.translate.instant("asset-profile.import"),icon:"file_upload",isEnabled:()=>!0,onAction:i=>this.importAssetProfile(i)}),t}setDefaultAssetProfile(t,i){t&&t.stopPropagation(),this.dialogService.confirm(this.translate.instant("asset-profile.set-default-asset-profile-title",{assetProfileName:i.name}),this.translate.instant("asset-profile.set-default-asset-profile-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(n=>{n&&this.assetProfileService.setDefaultAssetProfile(i.id.id).subscribe(()=>{this.config.updateData()})})}openAssetProfile(t,i){t&&t.stopPropagation();const n=this.router.createUrlTree(["profiles","assetProfiles",i.id.id]);this.router.navigateByUrl(n)}importAssetProfile(t){this.importExport.importAssetProfile().subscribe(i=>{i&&this.config.updateData()})}exportAssetProfile(t,i){t&&t.stopPropagation(),this.importExport.exportAssetProfile(i.id.id)}onAssetProfileAction(t){switch(t.action){case"open":return this.openAssetProfile(t.event,t.entity),!0;case"setDefault":return this.setDefaultAssetProfile(t.event,t.entity),!0;case"export":return this.exportAssetProfile(t.event,t.entity),!0}return!1}static{this.\u0275fac=function(i){return new(i||tn)(e.\u0275\u0275inject(A_.h),e.\u0275\u0275inject(ut.ImportExportService),e.\u0275\u0275inject(mt.k),e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(p.DatePipe),e.\u0275\u0275inject(Ce.o),e.\u0275\u0275inject(b.Router),e.\u0275\u0275inject(S.MatDialog))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:tn,factory:tn.\u0275fac})}}const D_=[{path:"assetProfiles",data:{breadcrumb:{menuId:F.D8.asset_profiles}},children:[{path:"",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN],title:"asset-profile.asset-profiles"},resolve:{entitiesTableConfig:tn}},{path:":entityId",component:X.i,canDeactivate:[P.L],data:{breadcrumb:{labelFunction:ee,icon:"mdi:alpha-a-box"},auth:[g.s.TENANT_ADMIN],title:"asset-profile.asset-profiles"},resolve:{entitiesTableConfig:tn}}]}];class Ao{static{this.\u0275fac=function(i){return new(i||Ao)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Ao})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[tn]})}}class Ei{static{this.\u0275fac=function(i){return new(i||Ei)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Ei})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,k.I,Ao]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Ei,{declarations:[No],imports:[p.CommonModule,w.G,k.I,Ao]});const P_=[{path:"profiles",data:{auth:[g.s.TENANT_ADMIN],breadcrumb:{menuId:F.D8.profiles}},children:[{path:"",children:[],data:{auth:[g.s.TENANT_ADMIN],redirectTo:"/profiles/deviceProfiles"}},...e_,...D_]}];class Mi{static{this.\u0275fac=function(i){return new(i||Mi)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Mi})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[b.RouterModule.forChild(P_),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Mi,{imports:[b.RouterModule],exports:[b.RouterModule]});class Ni{static{this.\u0275fac=function(i){return new(i||Ni)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Ni})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,Mi]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Ni,{imports:[p.CommonModule,w.G,Mi]});var Mt=d(2446);class lr{constructor(t){this.oauth2Service=t}resolve(){return this.oauth2Service.getLoginProcessingUrl()}static{this.\u0275fac=function(i){return new(i||lr)(e.\u0275\u0275inject(fn.P))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:lr,factory:lr.\u0275fac})}}const k_=[{path:"alarms",component:tt.AlarmTableComponent,data:{auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"alarm.alarms",breadcrumb:{menuId:F.D8.alarms},isPage:!0,alarmsMode:Mt.q6.ALL}}];class Ai{static{this.\u0275fac=function(i){return new(i||Ai)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Ai})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[b.RouterModule.forChild(k_),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Ai,{imports:[b.RouterModule],exports:[b.RouterModule]});class Fi{static{this.\u0275fac=function(i){return new(i||Fi)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Fi})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,k.I,Fe.L,Ai]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Fi,{imports:[p.CommonModule,w.G,k.I,Fe.L,Ai]});const R_=[{path:"gateways",component:js.n,data:{auth:[g.s.TENANT_ADMIN],title:"gateway.gateways",breadcrumb:{menuId:F.D8.gateways}},resolve:{dashboard:(a,t,i=(0,e.inject)(Mr.pQ))=>i.loadJsonResource("/api/resource/dashboard/system/gateways_dashboard.json")}}],V_=[{path:"gateways",pathMatch:"full",redirectTo:"/entities/gateways"}];class Di{static{this.\u0275fac=function(i){return new(i||Di)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Di})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[b.RouterModule.forChild(V_),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Di,{imports:[b.RouterModule],exports:[b.RouterModule]});const B_=[{path:"entities",data:{auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],breadcrumb:{skip:!0}},children:[{path:"",children:[],data:{auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],redirectTo:"/entities/devices"}},...B1,...j1,...nC,...R_]}];class Pi{static{this.\u0275fac=function(i){return new(i||Pi)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Pi})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[b.RouterModule.forChild(B_),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Pi,{imports:[b.RouterModule],exports:[b.RouterModule]});class ki{static{this.\u0275fac=function(i){return new(i||ki)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:ki})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,Pi]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(ki,{imports:[p.CommonModule,w.G,Pi]});const G_=[{path:"features",data:{auth:[g.s.TENANT_ADMIN],breadcrumb:{menuId:F.D8.features}},children:[{path:"",children:[],data:{auth:[g.s.TENANT_ADMIN],redirectTo:"/features/otaUpdates"}},...T_,...w_]}];class Li{static{this.\u0275fac=function(i){return new(i||Li)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Li})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[b.RouterModule.forChild(G_),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Li,{imports:[b.RouterModule],exports:[b.RouterModule]});class Oi{static{this.\u0275fac=function(i){return new(i||Oi)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Oi})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,Li]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Oi,{imports:[p.CommonModule,w.G,Li]});var M=d(83904);class Fo extends Ne.M{constructor(t){super(t),this.store=t}changeUnreadOnly(t){this.entitiesTableConfig.componentsData.unreadOnly=t,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}static{this.\u0275fac=function(i){return new(i||Fo)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Fo,selectors:[["tb-inbox-table-header"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:8,vars:9,consts:[[1,"flex","flex-full","flex-row","items-center","justify-start"],[1,"tb-notification-unread-toggle-group",2,"width","180px",3,"ngModelChange","ngModel"],[1,"flex-1",3,"value"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"mat-button-toggle-group",1),e.\u0275\u0275listener("ngModelChange",function(r){return n.changeUnreadOnly(r)}),e.\u0275\u0275elementStart(2,"mat-button-toggle",2),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"mat-button-toggle",2),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275elementEnd()()()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275property("ngModel",n.entitiesTableConfig.componentsData.unreadOnly),e.\u0275\u0275advance(),e.\u0275\u0275property("value",!0),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,5,"notification.unread")),e.\u0275\u0275advance(2),e.\u0275\u0275property("value",!1),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(7,7,"notification.all")))},dependencies:[rn.MatButtonToggleGroup,rn.MatButtonToggle,s.NgControlStatus,s.NgModel,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group.mat-button-toggle-group-appearance-standard{border:none;border-radius:14px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group.mat-button-toggle-group-appearance-standard .mat-button-toggle+.mat-button-toggle{border-left:none}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle{background:#0000000f;height:28px;align-items:center;display:flex}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle .mat-button-toggle-ripple{inset:2px;border-radius:14px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-button{color:#959595}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-focus-overlay{border-radius:14px;margin:2px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-checked .mat-button-toggle-button{background-color:#305680;color:#fff;border-radius:14px;margin-left:2px;margin-right:2px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-appearance-standard .mat-button-toggle-label-content{line-height:24px;font-size:14px;font-weight:500;letter-spacing:.25px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-appearance-standard .mat-button-toggle-label-content .mat-pseudo-checkbox{display:none}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-checked.mat-button-toggle-appearance-standard:not(.mat-button-toggle-disabled):hover .mat-button-toggle-focus-overlay{opacity:.01}']})}}var j_=d(76085);class Do extends se.m{constructor(t,i,n,o){super(t,i,n),this.store=t,this.router=i,this.dialogRef=n,this.data=o,this.notification=o.notification}markAsRead(t){this.dialogRef.close(t)}static{this.\u0275fac=function(i){return new(i||Do)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(S.MatDialogRef),e.\u0275\u0275directiveInject(S.MAT_DIALOG_DATA))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Do,selectors:[["tb-inbox-notification-dialog"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[[3,"markAsRead","notification"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"tb-notification",0),e.\u0275\u0275listener("markAsRead",function(r){return n.markAsRead(r)}),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("notification",n.notification)},dependencies:[j_.NotificationComponent],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block;max-width:400px;min-width:350px;padding:2px}']})}}class Ri{constructor(t,i,n,o,r){this.notificationService=t,this.translate=i,this.dialog=n,this.datePipe=o,this.utilsService=r,this.config=new y.M7,this.config.entityType=f.ck.NOTIFICATION,this.config.detailsPanelEnabled=!1,this.config.addEnabled=!1,this.config.rowPointer=!0,this.config.entityTranslations=f.Mi.get(f.ck.NOTIFICATION),this.config.entityResources={},this.config.deleteEntityTitle=()=>this.translate.instant("notification.delete-notification-title"),this.config.deleteEntityContent=()=>this.translate.instant("notification.delete-notification-text"),this.config.deleteEntitiesTitle=l=>this.translate.instant("notification.delete-notifications-title",{count:l}),this.config.deleteEntitiesContent=()=>this.translate.instant("notification.delete-notifications-text"),this.config.deleteEntity=l=>this.notificationService.deleteNotification(l.id),this.config.entitiesFetchFunction=l=>this.notificationService.getNotifications(l,this.config.componentsData.unreadOnly),this.config.defaultSortOrder={property:"createdTime",direction:Pe.O.DESC},this.config.handleRowClick=(l,c)=>(this.showNotification(l,c),!0),this.config.componentsData={unreadOnly:!0},this.config.cellActionDescriptors=this.configureCellActions(),this.config.headerComponent=Fo,this.config.headerActionDescriptors=[{name:this.translate.instant("notification.mark-all-as-read"),icon:"done_all",isEnabled:()=>!0,onAction:l=>this.markAllRead(l)}],this.config.columns.push(new y.Qr("createdTime","common.created-time",this.datePipe,"170px"),new y.KK("type","notification.type","10%",l=>this.translate.instant(M.iC.get(l.type).name)),new y.KK("subject","notification.subject","30%",l=>this.utilsService.customTranslation(l.subject,l.subject)),new y.KK("text","notification.message","60%",l=>this.utilsService.customTranslation(l.text,l.text)))}resolve(t){return this.config}configureCellActions(){return[{name:this.translate.instant("notification.mark-as-read"),icon:"check_circle_outline",isEnabled:t=>t.status!==M.Yb.READ,onAction:(t,i)=>this.markAsRead(t,i)}]}markAllRead(t){t&&t.stopPropagation(),this.notificationService.markAllNotificationsAsRead().subscribe(()=>{this.config.componentsData.unreadOnly?this.config.getTable().resetSortAndFilter(!0):this.config.updateData()})}markAsRead(t,i){t&&t.stopPropagation(),this.notificationService.markNotificationAsRead(i.id.id).subscribe(()=>{this.config.componentsData.unreadOnly?this.config.getTable().dataSource.pageData$.pipe((0,Ve.s)(1)).subscribe(n=>{1===n.data.length&&this.config.getTable().pageLink.page?this.config.getTable().paginator.previousPage():this.config.updateData()}):(i.status=M.Yb.READ,this.config.getTable().detectChanges())})}showNotification(t,i){t&&t.stopPropagation(),this.dialog.open(Do,{disableClose:!1,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{notification:i}}).afterClosed().subscribe(n=>{n&&this.markAsRead(null,i)})}static{this.\u0275fac=function(i){return new(i||Ri)(e.\u0275\u0275inject(Ke.J),e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(S.MatDialog),e.\u0275\u0275inject(p.DatePipe),e.\u0275\u0275inject(vr.T))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Ri,factory:Ri.\u0275fac})}}var qs=d(50670);function U_(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"tr")(1,"td")(2,"mat-chip"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"td",9),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()()),2&a){const i=t.$implicit;e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(i.key),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(i.value)}}function q_(a,t){1&a&&e.\u0275\u0275element(0,"mat-divider")}function W_(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div")(1,"h6"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"table",7),e.\u0275\u0275template(5,U_,6,2,"tr",6),e.\u0275\u0275pipe(6,"keyvalue"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(7,q_,1,0,"mat-divider",8),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=t.last,o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,3,o.NotificationDeliveryMethodInfoMap.get(i.key).name)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(6,5,i.value)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n)}}class Po extends se.m{constructor(t,i,n,o){super(t,i,n),this.store=t,this.router=i,this.dialogRef=n,this.data=o,this.NotificationDeliveryMethodInfoMap=M.d$,this.errorStats=o.notificationRequest.stats.errors}cancel(){this.dialogRef.close(null)}static{this.\u0275fac=function(i){return new(i||Po)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(S.MatDialogRef),e.\u0275\u0275directiveInject(S.MAT_DIALOG_DATA))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Po,selectors:[["tb-notification-send-error-dialog"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:10,vars:3,consts:[["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["mat-dialog-content",""],[4,"ngFor","ngForOf"],[1,"tb-table-list"],[4,"ngIf"],[1,"tb-row-error"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"mat-toolbar",0)(1,"h2",1),e.\u0275\u0275text(2,"notification.failed-send"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"span",2),e.\u0275\u0275elementStart(4,"button",3),e.\u0275\u0275listener("click",function(){return n.cancel()}),e.\u0275\u0275elementStart(5,"mat-icon",4),e.\u0275\u0275text(6,"close"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(7,"div",5),e.\u0275\u0275template(8,W_,8,7,"div",6),e.\u0275\u0275pipe(9,"keyvalue"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(8),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(9,1,n.errorStats)))},dependencies:[p.NgForOf,p.NgIf,x.MatIconButton,E.MatIcon,ae.MatToolbar,S.MatDialogContent,Ye.MatDivider,Ie.MatChip,u.TranslateDirective,p.KeyValuePipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block;width:600px;max-width:100%;color:#000000de}[_nghost-%COMP%]   h6[_ngcontent-%COMP%]{font-weight:500;font-size:16px;line-height:20px;margin-top:0}[_nghost-%COMP%]   .tb-table-list[_ngcontent-%COMP%]{table-layout:fixed;width:100%;border:hidden;border-collapse:collapse}[_nghost-%COMP%]   .tb-table-list[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:8px solid transparent;border-collapse:collapse;font-size:14px}[_nghost-%COMP%]   .tb-table-list[_ngcontent-%COMP%]   .tb-row-error[_ngcontent-%COMP%]{word-wrap:break-word}[_nghost-%COMP%]   .mat-divider[_ngcontent-%COMP%]{margin:24px 0}']})}}class Vi{constructor(t,i,n,o){this.notificationService=t,this.translate=i,this.dialog=n,this.datePipe=o,this.config=new y.M7,this.config.entityType=f.ck.NOTIFICATION_REQUEST,this.config.detailsPanelEnabled=!1,this.config.addEnabled=!1,this.config.searchEnabled=!1,this.config.entityTranslations=f.Mi.get(f.ck.NOTIFICATION_REQUEST),this.config.entityResources={},this.config.deleteEntityTitle=()=>this.translate.instant("notification.delete-request-title"),this.config.deleteEntityContent=()=>this.translate.instant("notification.delete-request-text"),this.config.deleteEntitiesTitle=r=>this.translate.instant("notification.delete-requests-title",{count:r}),this.config.deleteEntitiesContent=()=>this.translate.instant("notification.delete-requests-text"),this.config.deleteEntity=r=>this.notificationService.deleteNotificationRequest(r.id),this.config.entitiesFetchFunction=r=>this.notificationService.getNotificationRequests(r),this.config.cellActionDescriptors=this.configureCellActions(),this.config.onEntityAction=r=>this.onRequestAction(r),this.config.handleRowClick=(r,l)=>((r.target.getElementsByClassName("stats").length||"stats"===r.target.className)&&this.openStatsErrorDialog(r,l),!0),this.config.defaultSortOrder={property:"createdTime",direction:Pe.O.DESC},this.config.columns.push(new y.Qr("createdTime","common.created-time",this.datePipe,"170px"),new y.KK("status","notification.status","15%",r=>`<span style="display: flex;">${this.requestStatus(r.status)}${this.requestStats(r.stats)}</span>`,r=>this.requestStatusStyle(r.status)),new y.KK("deliveryMethods","notification.delivery-method.delivery-method","15%",r=>r.deliveryMethods.map(l=>this.translate.instant(M.d$.get(l).name)).join(", "),()=>({}),!1),new y.KK("templateName","notification.template","70%"))}resolve(t){return this.config}configureCellActions(){return[{name:this.translate.instant("notification.notify-again"),icon:"mdi:repeat-variant",isEnabled:t=>t.status!==M.D3.SCHEDULED,onAction:(t,i)=>this.createRequest(t,i)}]}createRequest(t,i,n=!1,o=!0){t&&t.stopPropagation(),this.dialog.open(qs.T,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{isAdd:n,request:i}}).afterClosed().subscribe(r=>{r&&o&&this.config.updateData()})}onRequestAction(t){switch(t.action){case"add":return this.createRequest(t.event,t.entity,!0),!0;case"add-without-update":return this.createRequest(t.event,t.entity,!0,!1),!0}return!1}requestStatus(t){const i=M.FA.get(t);let n="rgba(25, 128, 56, 0.08)";switch(t){case M.D3.SCHEDULED:n="rgba(48, 86, 128, 0.08)";break;case M.D3.PROCESSING:n="rgba(212, 125, 24, 0.08)"}return`<div style="border-radius: 12px; height: 24px; line-height: 24px; padding: 0 10px;\n                        width: fit-content; background-color: ${n}">\n                ${this.translate.instant(i)}\n            </div>`}requestStats(t){if(!t?.errors)return"";const i=t.totalErrors;return 0===i?"":`<div style="border-radius: 12px; height: 24px; line-height: 24px; padding: 0 10px; width: max-content; cursor: pointer;\n                        background-color: #D12730; color: #fff; font-weight: 500; margin-left: 8px" class="stats">\n                ${this.translate.instant("notification.fails",{count:i})} >\n            </div>`}requestStatusStyle(t){const i={fontSize:"14px",color:"#198038"};switch(t){case M.D3.SCHEDULED:i.color="#305680";break;case M.D3.PROCESSING:i.color="#D47D18"}return i}openStatsErrorDialog(t,i){t&&t.stopPropagation(),this.dialog.open(Po,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{notificationRequest:i}}).afterClosed().subscribe(()=>{})}static{this.\u0275fac=function(i){return new(i||Vi)(e.\u0275\u0275inject(Ke.J),e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(S.MatDialog),e.\u0275\u0275inject(p.DatePipe))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Vi,factory:Vi.\u0275fac})}}var dr=d(18500);class ko extends Ne.M{constructor(t){super(t),this.store=t}createTarget(t){this.entitiesTableConfig.onEntityAction({event:t,action:"add",entity:null})}static{this.\u0275fac=function(i){return new(i||ko)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:ko,selectors:[["tb-recipient-table-header"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:7,vars:3,consts:[[1,"flex","flex-full","flex-row","items-center","justify-end"],["mat-stroked-button","","color","primary",3,"click"],[1,"flex","flex-row","items-center","justify-start"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"button",1),e.\u0275\u0275listener("click",function(r){return n.createTarget(r)}),e.\u0275\u0275elementStart(2,"div",2)(3,"mat-icon"),e.\u0275\u0275text(4,"add"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()()()),2&i&&(e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(6,1,"notification.add-recipients")," "))},dependencies:[x.MatButton,E.MatIcon,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:10000px}']})}}class Bi{constructor(t,i,n,o){this.notificationService=t,this.translate=i,this.dialog=n,this.datePipe=o,this.config=new y.M7,this.config.entityType=f.ck.NOTIFICATION_TARGET,this.config.detailsPanelEnabled=!1,this.config.addEnabled=!1,this.config.rowPointer=!0,this.config.entityTranslations=f.Mi.get(f.ck.NOTIFICATION_TARGET),this.config.entityResources={},this.config.entitiesFetchFunction=r=>this.notificationService.getNotificationTargets(r),this.config.deleteEntityTitle=r=>this.translate.instant("notification.delete-recipient-title",{recipientName:r.name}),this.config.deleteEntityContent=()=>this.translate.instant("notification.delete-recipient-text"),this.config.deleteEntitiesTitle=r=>this.translate.instant("notification.delete-recipients-title",{count:r}),this.config.deleteEntitiesContent=()=>this.translate.instant("notification.delete-recipients-text"),this.config.deleteEntity=r=>this.notificationService.deleteNotificationTarget(r.id),this.config.cellActionDescriptors=this.configureCellActions(),this.config.headerComponent=ko,this.config.onEntityAction=r=>this.onTargetAction(r),this.config.defaultSortOrder={property:"createdTime",direction:Pe.O.DESC},this.config.handleRowClick=(r,l)=>(this.editTarget(r,l),!0),this.config.columns.push(new y.Qr("createdTime","common.created-time",this.datePipe,"170px"),new y.KK("name","notification.recipient-group","20%"),new y.KK("configuration.type","notification.type","20%",r=>this.translate.instant(M.S2.get(r.configuration.type)),()=>({}),!1),new y.KK("configuration.description","notification.description","60%",r=>r.configuration.description||"",()=>({}),!1))}resolve(t){return this.config}configureCellActions(){return[]}editTarget(t,i,n=!1){t&&t.stopPropagation(),this.dialog.open(dr.a,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{isAdd:n,target:i}}).afterClosed().subscribe(o=>{o&&this.config.updateData()})}onTargetAction(t){return"add"===t.action&&(this.editTarget(t.event,t.entity,!0),!0)}static{this.\u0275fac=function(i){return new(i||Bi)(e.\u0275\u0275inject(Ke.J),e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(S.MatDialog),e.\u0275\u0275inject(p.DatePipe))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Bi,factory:Bi.\u0275fac})}}var Lr=d(52514);class Lo extends Ne.M{constructor(t){super(t),this.store=t}createTemplate(t){this.entitiesTableConfig.onEntityAction({event:t,action:"add",entity:null})}static{this.\u0275fac=function(i){return new(i||Lo)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Lo,selectors:[["tb-template-table-header"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:7,vars:3,consts:[[1,"flex","flex-full","flex-row","items-center","justify-end"],["mat-stroked-button","","color","primary",3,"click"],[1,"flex","flex-row","items-center","justify-start"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"button",1),e.\u0275\u0275listener("click",function(r){return n.createTemplate(r)}),e.\u0275\u0275elementStart(2,"div",2)(3,"mat-icon"),e.\u0275\u0275text(4,"add"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()()()),2&i&&(e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(6,1,"notification.add-template")," "))},dependencies:[x.MatButton,E.MatIcon,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:10000px}']})}}class Gi{constructor(t,i,n,o){this.notificationService=t,this.translate=i,this.dialog=n,this.datePipe=o,this.config=new y.M7,this.config.entityType=f.ck.NOTIFICATION_TEMPLATE,this.config.detailsPanelEnabled=!1,this.config.addEnabled=!1,this.config.rowPointer=!0,this.config.entityTranslations=f.Mi.get(f.ck.NOTIFICATION_TEMPLATE),this.config.entityResources={},this.config.entitiesFetchFunction=r=>this.notificationService.getNotificationTemplates(r),this.config.deleteEntityTitle=r=>this.translate.instant("notification.delete-template-title",{templateName:r.name}),this.config.deleteEntityContent=()=>this.translate.instant("notification.delete-template-text"),this.config.deleteEntitiesTitle=r=>this.translate.instant("notification.delete-templates-title",{count:r}),this.config.deleteEntitiesContent=()=>this.translate.instant("notification.delete-templates-text"),this.config.deleteEntity=r=>this.notificationService.deleteNotificationTemplate(r.id),this.config.cellActionDescriptors=this.configureCellActions(),this.config.headerComponent=Lo,this.config.onEntityAction=r=>this.onTemplateAction(r),this.config.defaultSortOrder={property:"createdTime",direction:Pe.O.DESC},this.config.handleRowClick=(r,l)=>(this.editTemplate(r,l),!0),this.config.columns.push(new y.Qr("createdTime","common.created-time",this.datePipe,"170px"),new y.KK("notificationType","notification.type","20%",r=>this.translate.instant(M.iC.get(r.notificationType).name)),new y.KK("name","notification.template","80%"))}resolve(t){return this.config}configureCellActions(){return[{name:this.translate.instant("notification.copy-template"),icon:"content_copy",isEnabled:()=>!0,onAction:(t,i)=>this.editTemplate(t,i,!1,!0)}]}editTemplate(t,i,n=!1,o=!1){t&&t.stopPropagation(),this.dialog.open(Lr.J,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{isAdd:n,isCopy:o,template:i}}).afterClosed().subscribe(r=>{r&&this.config.updateData()})}onTemplateAction(t){return"add"===t.action&&(this.editTemplate(t.event,t.entity,!0),!0)}static{this.\u0275fac=function(i){return new(i||Gi)(e.\u0275\u0275inject(Ke.J),e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(S.MatDialog),e.\u0275\u0275inject(p.DatePipe))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:Gi,factory:Gi.\u0275fac})}}class Oo extends Ne.M{constructor(t){super(t),this.store=t}createTarget(t){this.entitiesTableConfig.onEntityAction({event:t,action:"add",entity:null})}static{this.\u0275fac=function(i){return new(i||Oo)(e.\u0275\u0275directiveInject(C.Store))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Oo,selectors:[["tb-rule-table-header"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:7,vars:3,consts:[[1,"flex","flex-full","flex-row","items-center","justify-end"],["mat-stroked-button","","color","primary",3,"click"],[1,"flex","flex-row","items-center","justify-start"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"button",1),e.\u0275\u0275listener("click",function(r){return n.createTarget(r)}),e.\u0275\u0275elementStart(2,"div",2)(3,"mat-icon"),e.\u0275\u0275text(4,"add"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()()()),2&i&&(e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(6,1,"notification.add-rule")," "))},dependencies:[x.MatButton,E.MatIcon,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:10000px}']})}}var Ro=d(4235),Ws=d(1440),$_=d(87263),$s=d(43881),z_=d(20011),H_=d(95412);function K_(a,t){1&a&&(e.\u0275\u0275elementStart(0,"div",8),e.\u0275\u0275text(1,"notification.first-recipient"),e.\u0275\u0275elementEnd())}function Y_(a,t){1&a&&(e.\u0275\u0275elementStart(0,"div",9)(1,"span",10),e.\u0275\u0275text(2,"notification.after"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"tb-timeinterval",11),e.\u0275\u0275elementStart(4,"span",12),e.\u0275\u0275text(5,"notification.notify"),e.\u0275\u0275elementEnd()())}class nn{constructor(t,i){this.fb=t,this.dialog=i,this.systemEscalation=!1,this.entityType=f.ck,this.notificationType=M._n,this.propagateChange=null,this.propagateChangePending=!1,this.destroy$=new fe.B}registerOnChange(t){this.propagateChange=t,this.propagateChangePending&&(this.propagateChangePending=!1,setTimeout(()=>{this.propagateChange(this.modelValue)},0))}registerOnTouched(t){}ngOnInit(){this.escalationFormGroup=this.fb.group({delayInSec:[0],targets:[null,s.Validators.required]}),this.escalationFormGroup.valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(()=>this.updateModel())}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setDisabledState(t){this.disabled=t,this.disabled?this.escalationFormGroup.disable({emitEvent:!1}):this.escalationFormGroup.enable({emitEvent:!1})}writeValue(t){this.propagateChangePending=!1,this.modelValue=t,this.modelValue.delayInSec=+t.delayInSec,(0,_.f1)(this.modelValue)&&this.escalationFormGroup.patchValue(this.modelValue,{emitEvent:!1}),!this.disabled&&!this.escalationFormGroup.valid&&this.updateModel()}createTarget(t,i){t&&t.stopPropagation(),i._elementRef.nativeElement.blur(),this.dialog.open(dr.a,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{}}).afterClosed().subscribe(n=>{if(n){let o=this.escalationFormGroup.get("targets").value;o||(o=[]),o.push(n.id.id),this.escalationFormGroup.get("targets").patchValue(o)}})}validate(t){return this.escalationFormGroup.valid?null:{escalation:{valid:!1}}}updateModel(){const t=this.escalationFormGroup.value;this.modelValue={...this.modelValue,...t},this.propagateChange?this.propagateChange(this.modelValue):this.propagateChangePending=!0}static{this.\u0275fac=function(i){return new(i||nn)(e.\u0275\u0275directiveInject(s.FormBuilder),e.\u0275\u0275directiveInject(S.MatDialog))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:nn,selectors:[["tb-escalation-form"]],inputs:{disabled:"disabled",systemEscalation:"systemEscalation"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>nn),multi:!0},{provide:s.NG_VALIDATORS,useExisting:(0,e.forwardRef)(()=>nn),multi:!0}])],decls:12,vars:13,consts:[["selectTime",""],["createTargetButton",""],[1,"flex","flex-col",3,"formGroup"],[1,"escalation","flex","flex-row","items-center","justify-center","xs:flex-col","xs:items-stretch","xs:justify-start"],["class","flex-1","translate","",4,"ngIf","ngIfElse"],["required","","formControlName","targets","subscriptSizing","dynamic",1,"flex-full","xs:max-h-60%","gt-xs:max-w-60%",3,"entityType","subType","placeholderText"],["mat-button","","matSuffix","",3,"click"],[2,"white-space","nowrap"],["translate","",1,"flex-1"],[1,"flex","flex-1","flex-row","items-center","justify-center","xs:flex-col"],["translate",""],["subscriptSizing","dynamic","formControlName","delayInSec","min","60000","max","604800000","disabledAdvanced",""],["translate","",1,"escalation-notify","flex-1"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"form",2)(1,"div",3),e.\u0275\u0275template(2,K_,2,0,"div",4)(3,Y_,6,0,"ng-template",null,0,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(5,"tb-entity-list",5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementStart(7,"button",6,1),e.\u0275\u0275listener("click",function(l){e.\u0275\u0275restoreView(o);const c=e.\u0275\u0275reference(8);return e.\u0275\u0275resetView(n.createTarget(l,c))}),e.\u0275\u0275elementStart(9,"span",7),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd()()()()()}if(2&i){const o=e.\u0275\u0275reference(4);e.\u0275\u0275property("formGroup",n.escalationFormGroup),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.systemEscalation)("ngIfElse",o),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("entityType",n.entityType.NOTIFICATION_TARGET),e.\u0275\u0275propertyInterpolate("subType",n.notificationType.ALARM),e.\u0275\u0275property("placeholderText",n.escalationFormGroup.get("targets").value?"":e.\u0275\u0275pipeBind1(6,9,"notification.add-recipient")),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("!hidden",n.disabled),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,11,"notification.create-new"))}},dependencies:[p.NgIf,H_.TimeintervalComponent,Yo.EntityListComponent,x.MatButton,v.MatSuffix,s.\u0275NgNoValidate,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,u.TranslateDirective,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]   .escalation[_ngcontent-%COMP%]{height:100%;min-height:74px;max-height:100%;border-radius:8px;background:#0000000a;padding:0 10px}[_nghost-%COMP%]   .escalation[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{padding-right:10px}[_nghost-%COMP%]   .escalation-notify[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   tb-timeinterval[_ngcontent-%COMP%]{min-width:100px;padding:0 10px}@media screen and (max-width: 599px){[_nghost-%COMP%]   .escalation[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{padding:10px 0 0}[_nghost-%COMP%]   tb-timeinterval[_ngcontent-%COMP%]{padding:0}}[_nghost-%COMP%]     .mat-mdc-form-field{min-width:100px}[_nghost-%COMP%]     .mat-mdc-form-field .mat-mdc-form-field-infix{width:100%}[_nghost-%COMP%]     .mat-mdc-form-field .mat-mdc-select{min-width:110px!important}']})}}function Q_(a,t){1&a&&e.\u0275\u0275element(0,"span",8)}function J_(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",9),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext().index,r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.removeEscalation(o))}),e.\u0275\u0275elementStart(2,"mat-icon"),e.\u0275\u0275text(3,"close"),e.\u0275\u0275elementEnd()()}2&a&&e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(1,1,"action.remove"))}function Z_(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div",4),e.\u0275\u0275element(1,"tb-escalation-form",5),e.\u0275\u0275template(2,Q_,1,0,"span",6)(3,J_,4,3,"button",7),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=t.index,o=t.last,r=e.\u0275\u0275nextContext();e.\u0275\u0275classProp("pb-2",!o),e.\u0275\u0275advance(),e.\u0275\u0275property("formControl",i)("systemEscalation",0===n),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",0===n),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",0!==n&&!r.disabled)}}function X_(a,t){1&a&&(e.\u0275\u0275elementStart(0,"div")(1,"span",10),e.\u0275\u0275text(2,"notification.no-rule"),e.\u0275\u0275elementEnd()())}function e2(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",11)(1,"button",12),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.addEscalation())}),e.\u0275\u0275elementStart(2,"span",13),e.\u0275\u0275text(3,"notification.add-stage"),e.\u0275\u0275elementEnd()()()}}class Nt{constructor(t,i){this.store=t,this.fb=i,this.destroy$=new fe.B,this.propagateChange=n=>{}}registerOnChange(t){this.propagateChange=t}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}registerOnTouched(t){}ngOnInit(){this.escalationsFormGroup=this.fb.group({escalations:this.fb.array([])}),this.escalationsFormGroup.valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(()=>this.updateModel())}get escalationsFormArray(){return this.escalationsFormGroup.get("escalations")}setDisabledState(t){this.disabled=t,this.disabled?this.escalationsFormGroup.disable({emitEvent:!1}):this.escalationsFormGroup.enable({emitEvent:!1})}writeValue(t){const i=[];for(const n in t)i.push({delayInSec:1e3*Number(n),targets:t[n]});if(0===i.length)this.addEscalation(0);else if(i?.length===this.escalationsFormArray.length)this.escalationsFormArray.patchValue(i,{emitEvent:!1});else{const n=[];i.forEach(o=>{n.push(this.fb.control(o,[s.Validators.required]))}),this.escalationsFormGroup.setControl("escalations",this.fb.array(n),{emitEvent:!1}),this.disabled?this.escalationsFormGroup.disable({emitEvent:!1}):this.escalationsFormGroup.enable({emitEvent:!1})}}removeEscalation(t){this.escalationsFormGroup.get("escalations").removeAt(t)}addEscalation(t=36e5){const i={delayInSec:t,targets:null};this.escalationsFormGroup.get("escalations").push(this.fb.control(i,[]),{emitEvent:!1})}validate(t){return this.escalationsFormGroup.valid?null:{escalation:{valid:!1}}}updateModel(){const t={};this.escalationsFormGroup.get("escalations").value.forEach(i=>t[i.delayInSec/1e3]=i.targets),this.propagateChange(t)}static{this.\u0275fac=function(i){return new(i||Nt)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(s.FormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Nt,selectors:[["tb-escalations-component"]],inputs:{required:"required",disabled:"disabled"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>Nt),multi:!0},{provide:s.NG_VALIDATORS,useExisting:(0,e.forwardRef)(()=>Nt),multi:!0}])],decls:4,vars:3,consts:[[1,"flex","flex-col"],["class","tb-tenant-profile-queues flex flex-row items-center",3,"pb-2",4,"ngFor","ngForOf"],[4,"ngIf"],["style","padding: 16px 0;",4,"ngIf"],[1,"tb-tenant-profile-queues","flex","flex-row","items-center"],[1,"flex-1",3,"formControl","systemEscalation"],["style","width: 48px;",4,"ngIf"],["mat-icon-button","","style","min-width: 40px;","type","button","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],[2,"width","48px"],["mat-icon-button","","type","button","matTooltipPosition","above",2,"min-width","40px",3,"click","matTooltip"],["translate","",1,"tb-prompt","flex","items-center","justify-center"],[2,"padding","16px 0"],["mat-raised-button","","color","primary","type","button",3,"click"],["translate",""]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,Z_,4,6,"div",1)(2,X_,3,0,"div",2)(3,e2,4,0,"div",3),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(),e.\u0275\u0275property("ngForOf",n.escalationsFormArray.controls),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n.escalationsFormArray.controls.length),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n.disabled))},dependencies:[p.NgForOf,p.NgIf,x.MatButton,x.MatIconButton,E.MatIcon,_e.MatTooltip,s.NgControlStatus,s.FormControlDirective,u.TranslateDirective,nn,u.TranslatePipe],encapsulation:2})}}(0,Ge.__decorate)([(0,_a.coerceBoolean)(),(0,Ge.__metadata)("design:type",Boolean)],Nt.prototype,"required",void 0);const t2=["addNotificationRule"];function n2(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",31)}function i2(a,t){1&a&&e.\u0275\u0275element(0,"div",32)}function a2(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-icon"),e.\u0275\u0275text(1,"check"),e.\u0275\u0275elementEnd())}function o2(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"notification.basic-settings"))}function r2(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"notification.rule-name-required")," "))}function s2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",33),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.triggerTypeTranslationMap.get(i))," ")}}function l2(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"notification.trigger.trigger-required")," "))}function d2(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"section",34)(1,"tb-entity-list",35),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementStart(5,"button",36,3),e.\u0275\u0275listener("click",function(o){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275reference(6),l=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(l.createTarget(o,r))}),e.\u0275\u0275elementStart(7,"span",37),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd()()()()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("subType",i.ruleNotificationForm.get("triggerType").value),e.\u0275\u0275propertyInterpolate("entityType",i.entityType.NOTIFICATION_TARGET),e.\u0275\u0275propertyInterpolate("labelText",e.\u0275\u0275pipeBind1(2,6,"notification.recipients")),e.\u0275\u0275propertyInterpolate("requiredText",e.\u0275\u0275pipeBind1(3,8,"notification.recipients-required")),e.\u0275\u0275propertyInterpolate("placeholderText",e.\u0275\u0275pipeBind1(4,10,"notification.recipient")),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,12,"notification.create-new"))}}function c2(a,t){1&a&&e.\u0275\u0275elementContainer(0)}function p2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"fieldset",38)(1,"legend",19),e.\u0275\u0275text(2,"notification.escalation-chain"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",39),e.\u0275\u0275text(4,"notification.recipients"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"tb-escalations-component",40),e.\u0275\u0275template(6,c2,1,0,"ng-container",41),e.\u0275\u0275elementEnd()),2&a){e.\u0275\u0275nextContext();const i=e.\u0275\u0275reference(40);e.\u0275\u0275advance(6),e.\u0275\u0275property("ngTemplateOutlet",i)}}function m2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",33),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.alarmSearchStatusTranslationMap.get(i))," ")}}function u2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"form",17)(1,"section",42)(2,"section",43)(3,"div",39),e.\u0275\u0275text(4,"notification.stop-escalation-alarm-status-become"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"mat-form-field",44)(6,"mat-label",19),e.\u0275\u0275text(7,"alarm.alarm-status-list"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"mat-select",45),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275template(10,m2,3,4,"mat-option",24),e.\u0275\u0275elementEnd()()()()()),2&a){let i;const n=e.\u0275\u0275nextContext();e.\u0275\u0275property("formGroup",n.alarmTemplateForm),e.\u0275\u0275advance(8),e.\u0275\u0275propertyInterpolate("placeholder",null!=(i=n.alarmTemplateForm.get("triggerConfig.clearRule.alarmStatuses").value)&&i.length?"":e.\u0275\u0275pipeBind1(9,3,"alarm.any-status")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",n.alarmSearchStatuses)}}function g2(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"notification.alarm-trigger-settings"))}function f2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",33),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.alarmSeverityTranslationMap.get(i))," ")}}function h2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",33),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.alarmActionTranslationMap.get(i))," ")}}function b2(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"notification.notify-on-required")," "))}function y2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-step",15),e.\u0275\u0275template(1,g2,2,3,"ng-template",16),e.\u0275\u0275elementStart(2,"form",17)(3,"section",42)(4,"fieldset",46)(5,"legend",19),e.\u0275\u0275text(6,"notification.filter"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(7,"tb-string-items-list",47),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementStart(10,"mat-form-field",48)(11,"mat-label",19),e.\u0275\u0275text(12,"alarm.alarm-severity-list"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"mat-select",49),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275template(15,f2,3,4,"mat-option",24),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(16,"mat-form-field",50)(17,"mat-label",19),e.\u0275\u0275text(18,"notification.notify-on"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"mat-select",51),e.\u0275\u0275template(20,h2,3,4,"mat-option",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(21,b2,3,3,"mat-error",21),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(22,"form",17)(23,"section",52)(24,"mat-form-field",18)(25,"mat-label",19),e.\u0275\u0275text(26,"notification.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(27,"input",53),e.\u0275\u0275elementEnd()()()()),2&a){let i,n;const o=e.\u0275\u0275nextContext();e.\u0275\u0275property("stepControl",o.alarmTemplateForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",o.alarmTemplateForm),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(8,9,"alarm.alarm-type-list")),e.\u0275\u0275propertyInterpolate("placeholder",null!=(i=o.alarmTemplateForm.get("triggerConfig.alarmTypes").value)&&i.length?"":e.\u0275\u0275pipeBind1(9,11,"alarm.any-type")),e.\u0275\u0275advance(6),e.\u0275\u0275propertyInterpolate("placeholder",null!=(n=o.alarmTemplateForm.get("triggerConfig.alarmSeverities").value)&&n.length?"":e.\u0275\u0275pipeBind1(14,13,"alarm.any-severity")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",o.alarmSeverities),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",o.alarmActions),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",o.alarmTemplateForm.get("triggerConfig.notifyOn").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("formGroup",o.ruleNotificationForm)}}function v2(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"notification.device-activity-trigger-settings"))}function C2(a,t){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"tb-entity-list",58),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementContainerEnd()),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(),e.\u0275\u0275propertyInterpolate("labelText",e.\u0275\u0275pipeBind1(2,4,"device.devices")),e.\u0275\u0275propertyInterpolate("placeholderText",e.\u0275\u0275pipeBind1(3,6,"device.devices")),e.\u0275\u0275propertyInterpolate("hint",e.\u0275\u0275pipeBind1(4,8,"notification.device-list-rule-hint")),e.\u0275\u0275property("entityType",i.entityType.DEVICE)}}function x2(a,t){if(1&a&&(e.\u0275\u0275element(0,"tb-entity-list",59),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275pipe(3,"translate")),2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("labelText",e.\u0275\u0275pipeBind1(1,4,"device-profile.device-profiles")),e.\u0275\u0275propertyInterpolate("placeholderText",e.\u0275\u0275pipeBind1(2,6,"device-profile.device-profiles")),e.\u0275\u0275propertyInterpolate("hint",e.\u0275\u0275pipeBind1(3,8,"notification.device-profiles-list-rule-hint")),e.\u0275\u0275property("entityType",i.entityType.DEVICE_PROFILE)}}function _2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",33),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.deviceEventTranslationMap.get(i))," ")}}function S2(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"notification.notify-on-required")," "))}function T2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-step",15),e.\u0275\u0275template(1,v2,2,3,"ng-template",16),e.\u0275\u0275elementStart(2,"form",17)(3,"section",42)(4,"div",54)(5,"mat-button-toggle-group",55)(6,"mat-button-toggle",56),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"mat-button-toggle",56),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(12,C2,5,10,"ng-container",57)(13,x2,4,10,"ng-template",null,4,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(15,"mat-form-field",50)(16,"mat-label",19),e.\u0275\u0275text(17,"notification.notify-on"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"mat-select",51),e.\u0275\u0275template(19,_2,3,4,"mat-option",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(20,S2,3,3,"mat-error",21),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(21,"form",17)(22,"section",52)(23,"mat-form-field",18)(24,"mat-label",19),e.\u0275\u0275text(25,"notification.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(26,"input",53),e.\u0275\u0275elementEnd()()()()),2&a){const i=e.\u0275\u0275reference(14),n=e.\u0275\u0275nextContext();e.\u0275\u0275property("stepControl",n.deviceInactivityTemplateForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.deviceInactivityTemplateForm),e.\u0275\u0275advance(4),e.\u0275\u0275property("value",!0),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,11,"device.device")),e.\u0275\u0275advance(2),e.\u0275\u0275property("value",!1),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,13,"device-profile.device-profile")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.deviceInactivityTemplateForm.get("triggerConfig.filterByDevice").value)("ngIfElse",i),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngForOf",n.deviceEvents),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.deviceInactivityTemplateForm.get("triggerConfig.notifyOn").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("formGroup",n.ruleNotificationForm)}}function I2(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"notification.entity-action-trigger-settings"))}function w2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-step",15),e.\u0275\u0275template(1,I2,2,3,"ng-template",16),e.\u0275\u0275elementStart(2,"form",17)(3,"fieldset",60)(4,"legend",19),e.\u0275\u0275text(5,"notification.filter"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(6,"tb-entity-type-list",61),e.\u0275\u0275elementStart(7,"section",62)(8,"span",63),e.\u0275\u0275text(9,"notification.status"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"mat-slide-toggle",64),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"mat-slide-toggle",65),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"mat-slide-toggle",66),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(19,"form",17)(20,"section",52)(21,"mat-form-field",18)(22,"mat-label",19),e.\u0275\u0275text(23,"notification.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(24,"input",53),e.\u0275\u0275elementEnd()()()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("stepControl",i.entityActionTemplateForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",i.entityActionTemplateForm),e.\u0275\u0275advance(4),e.\u0275\u0275property("allowedEntityTypes",i.allowEntityTypeForEntityAction),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,7,"notification.created")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,9,"notification.updated")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(18,11,"notification.deleted")),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",i.ruleNotificationForm)}}function E2(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"notification.alarm-comment-trigger-settings"))}function M2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",33),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.alarmSeverityTranslationMap.get(i))," ")}}function N2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",33),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.alarmSearchStatusTranslationMap.get(i))," ")}}function A2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-step",15),e.\u0275\u0275template(1,E2,2,3,"ng-template",16),e.\u0275\u0275elementStart(2,"form",17)(3,"section",42)(4,"fieldset",67)(5,"legend",19),e.\u0275\u0275text(6,"notification.filter"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(7,"tb-string-items-list",47),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementStart(10,"mat-form-field",48)(11,"mat-label",19),e.\u0275\u0275text(12,"alarm.alarm-severity-list"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"mat-select",49),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275template(15,M2,3,4,"mat-option",24),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(16,"mat-form-field",48)(17,"mat-label",19),e.\u0275\u0275text(18,"alarm.alarm-status-list"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"mat-select",45),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275template(21,N2,3,4,"mat-option",24),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(22,"section",68)(23,"mat-slide-toggle",69),e.\u0275\u0275text(24),e.\u0275\u0275pipe(25,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(26,"mat-slide-toggle",70),e.\u0275\u0275text(27),e.\u0275\u0275pipe(28,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(29,"form",17)(30,"section",52)(31,"mat-form-field",18)(32,"mat-label",19),e.\u0275\u0275text(33,"notification.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(34,"input",53),e.\u0275\u0275elementEnd()()()()),2&a){let i,n,o;const r=e.\u0275\u0275nextContext();e.\u0275\u0275property("stepControl",r.alarmCommentTemplateForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",r.alarmCommentTemplateForm),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(8,11,"alarm.alarm-type-list")),e.\u0275\u0275propertyInterpolate("placeholder",null!=(i=r.alarmCommentTemplateForm.get("triggerConfig.alarmTypes").value)&&i.length?"":e.\u0275\u0275pipeBind1(9,13,"alarm.any-type")),e.\u0275\u0275advance(6),e.\u0275\u0275propertyInterpolate("placeholder",null!=(n=r.alarmCommentTemplateForm.get("triggerConfig.alarmSeverities").value)&&n.length?"":e.\u0275\u0275pipeBind1(14,15,"alarm.any-severity")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",r.alarmSeverities),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("placeholder",null!=(o=r.alarmCommentTemplateForm.get("triggerConfig.alarmStatuses").value)&&o.length?"":e.\u0275\u0275pipeBind1(20,17,"alarm.any-status")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",r.alarmSearchStatuses),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(25,19,"notification.notify-only-user-comments")," "),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(28,21,"notification.notify-on-comment-update")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",r.ruleNotificationForm)}}function F2(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"notification.alarm-assignment-trigger-settings"))}function D2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",33),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.alarmSeverityTranslationMap.get(i))," ")}}function P2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",33),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.alarmSearchStatusTranslationMap.get(i))," ")}}function k2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",33),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.alarmAssignmentActionTranslationMap.get(i))," ")}}function L2(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"notification.notify-on-required")," "))}function O2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-step",15),e.\u0275\u0275template(1,F2,2,3,"ng-template",16),e.\u0275\u0275elementStart(2,"form",17)(3,"section",42)(4,"fieldset",67)(5,"legend",19),e.\u0275\u0275text(6,"notification.filter"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(7,"tb-string-items-list",47),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementStart(10,"mat-form-field",48)(11,"mat-label",19),e.\u0275\u0275text(12,"alarm.alarm-severity-list"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"mat-select",49),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275template(15,D2,3,4,"mat-option",24),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(16,"mat-form-field",48)(17,"mat-label",19),e.\u0275\u0275text(18,"alarm.alarm-status-list"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"mat-select",45),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275template(21,P2,3,4,"mat-option",24),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(22,"mat-form-field",50)(23,"mat-label",19),e.\u0275\u0275text(24,"notification.notify-on"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(25,"mat-select",51),e.\u0275\u0275template(26,k2,3,4,"mat-option",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(27,L2,3,3,"mat-error",21),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(28,"form",17)(29,"section",52)(30,"mat-form-field",18)(31,"mat-label",19),e.\u0275\u0275text(32,"notification.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(33,"input",53),e.\u0275\u0275elementEnd()()()()),2&a){let i,n,o;const r=e.\u0275\u0275nextContext();e.\u0275\u0275property("stepControl",r.alarmAssignmentTemplateForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",r.alarmAssignmentTemplateForm),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(8,11,"alarm.alarm-type-list")),e.\u0275\u0275propertyInterpolate("placeholder",null!=(i=r.alarmAssignmentTemplateForm.get("triggerConfig.alarmTypes").value)&&i.length?"":e.\u0275\u0275pipeBind1(9,13,"alarm.any-type")),e.\u0275\u0275advance(6),e.\u0275\u0275propertyInterpolate("placeholder",null!=(n=r.alarmAssignmentTemplateForm.get("triggerConfig.alarmSeverities").value)&&n.length?"":e.\u0275\u0275pipeBind1(14,15,"alarm.any-severity")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",r.alarmSeverities),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("placeholder",null!=(o=r.alarmAssignmentTemplateForm.get("triggerConfig.alarmStatuses").value)&&o.length?"":e.\u0275\u0275pipeBind1(20,17,"alarm.any-status")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",r.alarmSearchStatuses),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",r.alarmAssignmentActions),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",r.alarmAssignmentTemplateForm.get("triggerConfig.notifyOn").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("formGroup",r.ruleNotificationForm)}}function R2(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"notification.rule-engine-events-trigger-settings"))}function V2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",33),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.componentLifecycleEventTranslationMap.get(i))," ")}}function B2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",33),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.componentLifecycleEventTranslationMap.get(i))," ")}}function G2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"section")(1,"mat-form-field",48)(2,"mat-label",19),e.\u0275\u0275text(3,"rulenode.rule-node-events"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"mat-select",75),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275template(6,B2,3,4,"mat-option",24),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(7,"mat-slide-toggle",76),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd()()),2&a){let i;const n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("placeholder",null!=(i=n.ruleEngineEventsTemplateForm.get("triggerConfig.ruleNodeEvents").value)&&i.length?"":e.\u0275\u0275pipeBind1(5,3,"event.all-events")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",n.componentLifecycleEvents),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(9,5,"notification.only-rule-node-lifecycle-failures")," ")}}function j2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-step",15),e.\u0275\u0275template(1,R2,2,3,"ng-template",16),e.\u0275\u0275elementStart(2,"form",17)(3,"section",42)(4,"fieldset",67)(5,"legend",19),e.\u0275\u0275text(6,"notification.rule-engine-filter"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(7,"tb-entity-list",71),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275pipe(10,"translate"),e.\u0275\u0275elementStart(11,"mat-form-field",48)(12,"mat-label",19),e.\u0275\u0275text(13,"rulechain.rulechain-events"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"mat-select",72),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275template(16,V2,3,4,"mat-option",24),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(17,"mat-slide-toggle",73),e.\u0275\u0275text(18),e.\u0275\u0275pipe(19,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(20,"fieldset",67)(21,"legend",19),e.\u0275\u0275text(22,"notification.rule-node-filter"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(23,"mat-slide-toggle",74),e.\u0275\u0275text(24),e.\u0275\u0275pipe(25,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(26,G2,10,7,"section",21),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(27,"form",17)(28,"section",52)(29,"mat-form-field",18)(30,"mat-label",19),e.\u0275\u0275text(31,"notification.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(32,"input",53),e.\u0275\u0275elementEnd()()()()),2&a){let i;const n=e.\u0275\u0275nextContext();e.\u0275\u0275property("stepControl",n.ruleEngineEventsTemplateForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.ruleEngineEventsTemplateForm),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("labelText",e.\u0275\u0275pipeBind1(8,12,"rulechain.rulechains")),e.\u0275\u0275propertyInterpolate("placeholderText",e.\u0275\u0275pipeBind1(9,14,"rulechain.rulechains")),e.\u0275\u0275propertyInterpolate("hint",e.\u0275\u0275pipeBind1(10,16,"notification.rule-chain-list-rule-hint")),e.\u0275\u0275property("entityType",n.entityType.RULE_CHAIN),e.\u0275\u0275advance(7),e.\u0275\u0275propertyInterpolate("placeholder",null!=(i=n.ruleEngineEventsTemplateForm.get("triggerConfig.ruleChainEvents").value)&&i.length?"":e.\u0275\u0275pipeBind1(15,18,"event.all-events")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",n.componentLifecycleEvents),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(19,20,"notification.only-rule-chain-lifecycle-failures")," "),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(25,22,"notification.track-rule-node-events")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.ruleEngineEventsTemplateForm.get("triggerConfig.trackRuleNodeEvents").value),e.\u0275\u0275advance(),e.\u0275\u0275property("formGroup",n.ruleNotificationForm)}}function U2(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"notification.edge-trigger-settings"))}function q2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",33),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.edgeConnectionEventTranslationMap.get(i))," ")}}function W2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-step",15),e.\u0275\u0275template(1,U2,2,3,"ng-template",16),e.\u0275\u0275elementStart(2,"form",17)(3,"section",42)(4,"fieldset",46)(5,"legend",19),e.\u0275\u0275text(6,"notification.filter"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(7,"tb-entity-list",77),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275pipe(10,"translate"),e.\u0275\u0275elementStart(11,"mat-form-field",48)(12,"mat-label",19),e.\u0275\u0275text(13,"notification.notify-on"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"mat-select",78),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275template(16,q2,3,4,"mat-option",24),e.\u0275\u0275elementEnd()()()()(),e.\u0275\u0275elementStart(17,"form",17)(18,"section",52)(19,"mat-form-field",18)(20,"mat-label",19),e.\u0275\u0275text(21,"notification.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(22,"input",53),e.\u0275\u0275elementEnd()()()()),2&a){let i;const n=e.\u0275\u0275nextContext();e.\u0275\u0275property("stepControl",n.edgeConnectionTemplateForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.edgeConnectionTemplateForm),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("labelText",e.\u0275\u0275pipeBind1(8,9,"edge.edge-instances")),e.\u0275\u0275propertyInterpolate("placeholderText",e.\u0275\u0275pipeBind1(9,11,"edge.edge-instances")),e.\u0275\u0275propertyInterpolate("hint",e.\u0275\u0275pipeBind1(10,13,"notification.edge-list-rule-hint")),e.\u0275\u0275property("entityType",n.entityType.EDGE),e.\u0275\u0275advance(7),e.\u0275\u0275propertyInterpolate("placeholder",null!=(i=n.edgeConnectionTemplateForm.get("triggerConfig.notifyOn").value)&&i.length?"":e.\u0275\u0275pipeBind1(15,15,"event.all-events")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",n.edgeConnectionEvents),e.\u0275\u0275advance(),e.\u0275\u0275property("formGroup",n.ruleNotificationForm)}}function $2(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"notification.edge-trigger-settings"))}function z2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-step",15),e.\u0275\u0275template(1,$2,2,3,"ng-template",16),e.\u0275\u0275elementStart(2,"form",17)(3,"section",42)(4,"fieldset",46)(5,"legend",19),e.\u0275\u0275text(6,"notification.filter"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(7,"tb-entity-list",79),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(10,"form",17)(11,"section",52)(12,"mat-form-field",18)(13,"mat-label",19),e.\u0275\u0275text(14,"notification.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(15,"input",53),e.\u0275\u0275elementEnd()()()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("stepControl",i.edgeCommunicationFailureTemplateForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",i.edgeCommunicationFailureTemplateForm),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate("labelText",e.\u0275\u0275pipeBind1(8,6,"edge.edge-instances")),e.\u0275\u0275propertyInterpolate("hint",e.\u0275\u0275pipeBind1(9,8,"notification.edge-list-rule-hint")),e.\u0275\u0275property("entityType",i.entityType.EDGE),e.\u0275\u0275advance(3),e.\u0275\u0275property("formGroup",i.ruleNotificationForm)}}function H2(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"notification.entities-limit-trigger-settings"))}function K2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-step",15),e.\u0275\u0275template(1,H2,2,3,"ng-template",16),e.\u0275\u0275elementStart(2,"form",17)(3,"fieldset",60)(4,"legend",19),e.\u0275\u0275text(5,"notification.filter"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(6,"tb-entity-type-list",80),e.\u0275\u0275elementStart(7,"div",81)(8,"label",19),e.\u0275\u0275text(9,"notification.threshold"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"div",82)(11,"mat-slider",83),e.\u0275\u0275element(12,"input",84),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"mat-form-field",85),e.\u0275\u0275element(14,"input",86),e.\u0275\u0275elementEnd()()()()(),e.\u0275\u0275elementStart(15,"form",17)(16,"section",52)(17,"mat-form-field",18)(18,"mat-label",19),e.\u0275\u0275text(19,"notification.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(20,"input",53),e.\u0275\u0275elementEnd()()()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("stepControl",i.entitiesLimitTemplateForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",i.entitiesLimitTemplateForm),e.\u0275\u0275advance(4),e.\u0275\u0275property("allowedEntityTypes",i.allowEntityTypeForEntitiesLimit),e.\u0275\u0275advance(5),e.\u0275\u0275property("displayWith",i.formatLabel),e.\u0275\u0275advance(3),e.\u0275\u0275property("value",i.entitiesLimitTemplateForm.get("triggerConfig.threshold").value),e.\u0275\u0275advance(),e.\u0275\u0275property("formGroup",i.ruleNotificationForm)}}function Y2(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"notification.api-usage-trigger-settings"))}function Q2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",33),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.apiFeatureTranslationMap.get(i))," ")}}function J2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-option",33),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("value",i),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,n.apiUsageStateValueTranslationMap.get(i))," ")}}function Z2(a,t){1&a&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"notification.notify-on-required")," "))}function X2(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-step",15),e.\u0275\u0275template(1,Y2,2,3,"ng-template",16),e.\u0275\u0275elementStart(2,"form",17)(3,"section",42)(4,"mat-form-field",87)(5,"mat-label",19),e.\u0275\u0275text(6,"api-usage.api-features"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"mat-select",88),e.\u0275\u0275template(8,Q2,3,4,"mat-option",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"mat-hint"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(12,"mat-form-field",50)(13,"mat-label",19),e.\u0275\u0275text(14,"notification.notify-on"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"mat-select",51),e.\u0275\u0275template(16,J2,3,4,"mat-option",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(17,Z2,3,3,"mat-error",21),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(18,"form",17)(19,"section",52)(20,"mat-form-field",18)(21,"mat-label",19),e.\u0275\u0275text(22,"notification.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(23,"input",53),e.\u0275\u0275elementEnd()()()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("stepControl",i.apiUsageLimitTemplateForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",i.apiUsageLimitTemplateForm),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",i.apiFeatures),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,7,"notification.api-feature-hint")),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",i.apiUsageStateValues),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",i.apiUsageLimitTemplateForm.get("triggerConfig.notifyOn").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("formGroup",i.ruleNotificationForm)}}function eS(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"notification.new-platform-version-trigger-settings"))}function tS(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-step",15),e.\u0275\u0275template(1,eS,2,3,"ng-template",16),e.\u0275\u0275elementStart(2,"form",17)(3,"section",52)(4,"mat-form-field",18)(5,"mat-label",19),e.\u0275\u0275text(6,"notification.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(7,"input",53),e.\u0275\u0275elementEnd()()()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("stepControl",i.newPlatformVersionTemplateForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",i.ruleNotificationForm)}}function nS(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"notification.rate-limits-trigger-settings"))}function iS(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-step",15),e.\u0275\u0275template(1,nS,2,3,"ng-template",16),e.\u0275\u0275elementStart(2,"form",17)(3,"section",42),e.\u0275\u0275element(4,"tb-string-items-list",89),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(7,"form",17)(8,"section",52)(9,"mat-form-field",18)(10,"mat-label",19),e.\u0275\u0275text(11,"notification.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(12,"input",53),e.\u0275\u0275elementEnd()()()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("stepControl",i.rateLimitsTemplateForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",i.rateLimitsTemplateForm),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("label",e.\u0275\u0275pipeBind1(5,6,"notification.rate-limits")),e.\u0275\u0275propertyInterpolate("hint",e.\u0275\u0275pipeBind1(6,8,"notification.api-feature-hint")),e.\u0275\u0275property("predefinedValues",i.limitedApis),e.\u0275\u0275advance(3),e.\u0275\u0275property("formGroup",i.ruleNotificationForm)}}function aS(a,t){1&a&&(e.\u0275\u0275text(0),e.\u0275\u0275pipe(1,"translate")),2&a&&e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(1,1,"notification.task-processing-failure-trigger-settings"))}function oS(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"mat-step",15),e.\u0275\u0275template(1,aS,2,3,"ng-template",16),e.\u0275\u0275elementStart(2,"form",17)(3,"section",52)(4,"mat-form-field",18)(5,"mat-label",19),e.\u0275\u0275text(6,"notification.description"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(7,"input",53),e.\u0275\u0275elementEnd()()()()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275property("stepControl",i.taskProcessingFailureTemplateForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",i.ruleNotificationForm)}}function rS(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",90),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.backStep())}),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()}2&a&&(e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"action.back")))}class Vo extends se.m{constructor(t,i,n,o,r,l,c,m,h){super(t,i,n),this.store=t,this.router=i,this.dialogRef=n,this.data=o,this.breakpointObserver=r,this.fb=l,this.translate=c,this.notificationService=m,this.dialog=h,this.triggerType=M.P8,this.triggerTypeTranslationMap=M.YF,this.alarmSearchStatuses=[Mt.KG.ACTIVE,Mt.KG.CLEARED,Mt.KG.ACK,Mt.KG.UNACK],this.alarmSearchStatusTranslationMap=Mt.Gw,this.alarmSeverityTranslationMap=Mt.Fm,this.alarmSeverities=Object.keys(Mt.lM),this.alarmActions=Object.values(M.Wm),this.alarmActionTranslationMap=M.fY,this.alarmAssignmentActions=Object.values(M.vZ),this.alarmAssignmentActionTranslationMap=M.sQ,this.componentLifecycleEvents=Object.values(M.qc),this.componentLifecycleEventTranslationMap=M.nW,this.deviceEvents=Object.values(M.ZO),this.deviceEventTranslationMap=M.sW,this.apiUsageStateValues=Object.values(Ro.wt),this.apiUsageStateValueTranslationMap=Ro.Gn,this.apiFeatures=Object.values(Ro.n2),this.apiFeatureTranslationMap=Ro.WI,this.edgeConnectionEvents=Object.values(rr.CW),this.edgeConnectionEventTranslationMap=rr.LS,this.entityType=f.ck,this.isAdd=!0,this.allowEntityTypeForEntitiesLimit=[f.ck.DEVICE,f.ck.ASSET,f.ck.CUSTOMER,f.ck.USER,f.ck.DASHBOARD,f.ck.RULE_CHAIN],this.selectedIndex=0,this.dialogTitle="notification.edit-rule",this.destroy$=new fe.B,this.authState=(0,q.rW)(this.store),this.authUser=this.authState.authUser,this.triggerTypes=this.allowTriggerTypes(),(0,_.O9)(o.isAdd)&&(this.isAdd=o.isAdd),this.limitedApis=Object.values(Ws.v).map(T=>({name:this.translate.instant(Ws.q.get(T)),value:T})),this.stepperOrientation=this.breakpointObserver.observe(le.zV["gt-xs"]).pipe((0,ie.T)(({matches:T})=>T?"horizontal":"vertical")),this.ruleNotificationForm=this.fb.group({name:[null,s.Validators.required],enabled:[!0,s.Validators.required],templateId:[null,s.Validators.required],triggerType:[this.isSysAdmin()?M.P8.ENTITIES_LIMIT:M.P8.ALARM,s.Validators.required],recipientsConfig:this.fb.group({targets:[{value:null,disabled:!this.isSysAdmin()},s.Validators.required],escalationTable:[{value:null,disabled:this.isSysAdmin()},s.Validators.required]}),triggerConfig:[null],additionalConfig:this.fb.group({description:[""]})}),this.ruleNotificationForm.get("triggerType").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(T=>{T===M.P8.ALARM?(this.ruleNotificationForm.get("recipientsConfig.escalationTable").enable({emitEvent:!1}),this.ruleNotificationForm.get("recipientsConfig.targets").disable({emitEvent:!1})):(this.ruleNotificationForm.get("recipientsConfig.escalationTable").disable({emitEvent:!1}),this.ruleNotificationForm.get("recipientsConfig.targets").enable({emitEvent:!1}))}),this.ruleNotificationForm.get("recipientsConfig.escalationTable").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(()=>{this.countRecipientsChainConfig()>1?this.alarmTemplateForm.get("triggerConfig.clearRule").enable({emitEvent:!1}):this.alarmTemplateForm.get("triggerConfig.clearRule").disable({emitEvent:!1})}),this.edgeConnectionTemplateForm=this.fb.group({triggerConfig:this.fb.group({edges:[null],notifyOn:[null]})}),this.edgeCommunicationFailureTemplateForm=this.fb.group({triggerConfig:this.fb.group({edges:[null]})}),this.alarmTemplateForm=this.fb.group({triggerConfig:this.fb.group({alarmTypes:[null],alarmSeverities:[[]],clearRule:this.fb.group({alarmStatuses:[[]]}),notifyOn:[[M.Wm.CREATED],s.Validators.required]})}),this.deviceInactivityTemplateForm=this.fb.group({triggerConfig:this.fb.group({filterByDevice:[!0],devices:[null],deviceProfiles:[{value:null,disabled:!0}],notifyOn:[[M.ZO.INACTIVE],s.Validators.required]})}),this.deviceInactivityTemplateForm.get("triggerConfig.filterByDevice").valueChanges.pipe((0,j.Q)(this.destroy$)).subscribe(T=>{T?(this.deviceInactivityTemplateForm.get("triggerConfig.devices").enable({emitEvent:!1}),this.deviceInactivityTemplateForm.get("triggerConfig.deviceProfiles").disable({emitEvent:!1})):(this.deviceInactivityTemplateForm.get("triggerConfig.deviceProfiles").enable({emitEvent:!1}),this.deviceInactivityTemplateForm.get("triggerConfig.devices").disable({emitEvent:!1}))}),this.entityActionTemplateForm=this.fb.group({triggerConfig:this.fb.group({entityTypes:[[f.ck.DEVICE],s.Validators.required],created:[!1],updated:[!1],deleted:[!1]})}),this.alarmCommentTemplateForm=this.fb.group({triggerConfig:this.fb.group({alarmTypes:[null],alarmSeverities:[[]],alarmStatuses:[[]],onlyUserComments:[!1],notifyOnCommentUpdate:[!1]})}),this.alarmAssignmentTemplateForm=this.fb.group({triggerConfig:this.fb.group({alarmTypes:[null],alarmSeverities:[[]],alarmStatuses:[[]],notifyOn:[[M.vZ.ASSIGNED],s.Validators.required]})}),this.ruleEngineEventsTemplateForm=this.fb.group({triggerConfig:this.fb.group({ruleChains:[null],ruleChainEvents:[null],onlyRuleChainLifecycleFailures:[!1],trackRuleNodeEvents:[!1],ruleNodeEvents:[null],onlyRuleNodeLifecycleFailures:[!1]})}),this.entitiesLimitTemplateForm=this.fb.group({triggerConfig:this.fb.group({entityTypes:[],threshold:[.8,[s.Validators.min(0),s.Validators.max(1)]]})}),this.apiUsageLimitTemplateForm=this.fb.group({triggerConfig:this.fb.group({apiFeatures:[[]],notifyOn:[[Ro.wt.WARNING],s.Validators.required]})}),this.newPlatformVersionTemplateForm=this.fb.group({triggerConfig:this.fb.group({})}),this.rateLimitsTemplateForm=this.fb.group({triggerConfig:this.fb.group({apis:[]})}),this.taskProcessingFailureTemplateForm=this.fb.group({triggerConfig:this.fb.group({taskTypes:[]})}),this.triggerTypeFormsMap=new Map([[M.P8.ALARM,this.alarmTemplateForm],[M.P8.ALARM_COMMENT,this.alarmCommentTemplateForm],[M.P8.DEVICE_ACTIVITY,this.deviceInactivityTemplateForm],[M.P8.ENTITY_ACTION,this.entityActionTemplateForm],[M.P8.ALARM_ASSIGNMENT,this.alarmAssignmentTemplateForm],[M.P8.RULE_ENGINE_COMPONENT_LIFECYCLE_EVENT,this.ruleEngineEventsTemplateForm],[M.P8.ENTITIES_LIMIT,this.entitiesLimitTemplateForm],[M.P8.API_USAGE_LIMIT,this.apiUsageLimitTemplateForm],[M.P8.NEW_PLATFORM_VERSION,this.newPlatformVersionTemplateForm],[M.P8.RATE_LIMITS,this.rateLimitsTemplateForm],[M.P8.EDGE_COMMUNICATION_FAILURE,this.edgeCommunicationFailureTemplateForm],[M.P8.EDGE_CONNECTION,this.edgeConnectionTemplateForm],[M.P8.TASK_PROCESSING_FAILURE,this.taskProcessingFailureTemplateForm]]),(o.isAdd||o.isCopy)&&(this.dialogTitle="notification.add-rule"),this.ruleNotification=(0,_.Go)(this.data.rule),this.ruleNotification&&(this.data.isCopy?this.ruleNotification.name+=` (${this.translate.instant("action.copy")})`:this.ruleNotificationForm.get("triggerType").disable({emitEvent:!1}),this.ruleNotificationForm.reset({},{emitEvent:!1}),this.ruleNotificationForm.patchValue(this.ruleNotification,{emitEvent:!1}),this.ruleNotificationForm.get("triggerType").updateValueAndValidity({onlySelf:!0}),this.triggerTypeFormsMap.get(this.ruleNotification.triggerType).patchValue(this.ruleNotification,{emitEvent:!1}),this.ruleNotification.triggerType===M.P8.DEVICE_ACTIVITY&&this.deviceInactivityTemplateForm.get("triggerConfig.filterByDevice").patchValue(!!this.ruleNotification.triggerConfig.devices,{onlySelf:!0}))}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}changeStep(t){this.selectedIndex=t.selectedIndex,t.previouslySelectedIndex>t.selectedIndex&&(t.previouslySelectedStep.interacted=!1)}backStep(){this.addNotificationRule.previous()}nextStep(){this.selectedIndex>=this.maxStepperIndex?this.add():this.addNotificationRule.next()}nextStepLabel(){return 0!==this.selectedIndex?this.data.isAdd||this.data.isCopy?"action.add":"action.save":"action.next"}get maxStepperIndex(){return this.addNotificationRule?._steps?.length-1}add(){if(this.allValid()){let t=this.ruleNotificationForm.value;const i=this.ruleNotificationForm.get("triggerType").value,n=this.triggerTypeFormsMap.get(i);Object.assign(t,n.value),i===M.P8.DEVICE_ACTIVITY&&delete t.triggerConfig.filterByDevice,t.recipientsConfig.triggerType=i,t.triggerConfig.triggerType=i,this.ruleNotification&&!this.data.isCopy&&(t={...this.ruleNotification,...t}),this.notificationService.saveNotificationRule((0,_.XU)(t)).subscribe(o=>this.dialogRef.close(o))}}allValid(){return!this.addNotificationRule.steps.find((t,i)=>!!t.stepControl.invalid&&(t.interacted=!0,this.addNotificationRule.selectedIndex=i,!0))}cancel(){this.dialogRef.close(null)}createTarget(t,i){t&&t.stopPropagation(),i._elementRef.nativeElement.blur(),this.dialog.open(dr.a,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{}}).afterClosed().subscribe(n=>{if(n){let o=this.ruleNotificationForm.get("recipientsConfig.targets").value;o||(o=[]),o.push(n.id.id),this.ruleNotificationForm.get("recipientsConfig.targets").patchValue(o)}})}countRecipientsChainConfig(){return Object.keys(this.ruleNotificationForm.get("recipientsConfig.escalationTable").value??{}).length}formatLabel(t){return`${(100*t).toFixed()}%`}isSysAdmin(){return this.authUser.authority===g.s.SYS_ADMIN}allowTriggerTypes(){const t=new Set([M.P8.ENTITIES_LIMIT,M.P8.API_USAGE_LIMIT,M.P8.NEW_PLATFORM_VERSION,M.P8.RATE_LIMITS,M.P8.TASK_PROCESSING_FAILURE]);return this.isSysAdmin()?Array.from(t):Object.values(M.P8).filter(i=>!t.has(i))}get allowEntityTypeForEntityAction(){if(!this._allowEntityTypeForEntityAction){const t=new Set([f.ck.API_USAGE_STATE,f.ck.TENANT_PROFILE,f.ck.RPC,f.ck.QUEUE,f.ck.NOTIFICATION,f.ck.NOTIFICATION_REQUEST,f.ck.WIDGET_TYPE]);this._allowEntityTypeForEntityAction=Object.values(f.ck).filter(i=>!t.has(i))}return this._allowEntityTypeForEntityAction}static{this.\u0275fac=function(i){return new(i||Vo)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.Router),e.\u0275\u0275directiveInject(S.MatDialogRef),e.\u0275\u0275directiveInject(S.MAT_DIALOG_DATA),e.\u0275\u0275directiveInject(fs.BreakpointObserver),e.\u0275\u0275directiveInject(s.FormBuilder),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(Ke.J),e.\u0275\u0275directiveInject(S.MatDialog))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Vo,selectors:[["tb-rule-notification-dialog"]],viewQuery:function(i,n){if(1&i&&e.\u0275\u0275viewQuery(t2,7),2&i){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.addNotificationRule=o.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:61,vars:41,consts:[["addNotificationRule",""],["alarmTargesConfig",""],["clearRules",""],["createTargetButton",""],["deviceProfile",""],["color","primary"],[1,"flex-1"],["tb-help","ruleNotifications"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","",1,"xs:p-0"],["labelPosition","end",3,"selectionChange","linear","orientation"],["matStepperIcon","edit"],[3,"stepControl"],["matStepLabel",""],[3,"formGroup"],[1,"mat-block"],["translate",""],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","enabled",2,"margin-bottom","22px"],["formControlName","triggerType","required",""],[3,"value",4,"ngFor","ngForOf"],["required","","allowCreate","","allowEdit","","formControlName","templateId",3,"notificationTypes"],["formGroupName","recipientsConfig",4,"ngIf","ngIfElse"],[3,"stepControl",4,"ngIf"],["mat-dialog-actions","",1,"flex","flex-row"],["mat-stroked-button","",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",3,"click"],["color","warn","mode","indeterminate"],[2,"height","4px"],[3,"value"],["formGroupName","recipientsConfig"],["required","","formControlName","targets",3,"subType","entityType","labelText","requiredText","placeholderText"],["mat-button","","color","primary","matSuffix","",3,"click"],[2,"white-space","nowrap"],["formGroupName","recipientsConfig",1,"fields-group","tb-hierarchy"],["translate","",1,"mat-body-2"],["formControlName","escalationTable"],[4,"ngTemplateOutlet"],["formGroupName","triggerConfig"],["formGroupName","clearRule"],["floatLabel","always",1,"mat-block","flex-1",2,"margin-right","48px"],["formControlName","alarmStatuses","multiple","",3,"placeholder"],[1,"fields-group","tb-margin-before-field"],["editable","","floatLabel","always","formControlName","alarmTypes",3,"label","placeholder"],["floatLabel","always",1,"mat-block","flex-1"],["formControlName","alarmSeverities","multiple","",3,"placeholder"],[1,"mat-block","flex-1"],["formControlName","notifyOn","multiple",""],["formGroupName","additionalConfig"],["matInput","","formControlName","description"],[1,"flex","flex-1","items-center","justify-center"],["formControlName","filterByDevice",1,"tb-notification-unread-toggle-group",2,"width","250px"],[1,"flex-1",3,"value"],[4,"ngIf","ngIfElse"],["formControlName","devices","subscriptSizing","dynamic",3,"labelText","placeholderText","hint","entityType"],["formControlName","deviceProfiles","subscriptSizing","dynamic",3,"labelText","placeholderText","hint","entityType"],["formGroupName","triggerConfig",1,"fields-group","tb-margin"],["required","","ignoreAuthorityFilter","","formControlName","entityTypes",3,"allowedEntityTypes"],[1,"flex","flex-col","gap-2"],["translate","",1,"flex-1"],["formControlName","created"],["formControlName","updated"],["formControlName","deleted"],[1,"fields-group","tb-margin"],[1,"flex","flex-col"],["formControlName","onlyUserComments",2,"margin-bottom","12px"],["formControlName","notifyOnCommentUpdate",2,"margin-bottom","12px"],["formControlName","ruleChains","subscriptSizing","dynamic",3,"labelText","placeholderText","hint","entityType"],["formControlName","ruleChainEvents","multiple","",3,"placeholder"],["formControlName","onlyRuleChainLifecycleFailures"],["formControlName","trackRuleNodeEvents"],["formControlName","ruleNodeEvents","multiple","",3,"placeholder"],["formControlName","onlyRuleNodeLifecycleFailures"],["formControlName","edges","subscriptSizing","dynamic",3,"labelText","placeholderText","hint","entityType"],["formControlName","notifyOn","multiple","",3,"placeholder"],["formControlName","edges",3,"labelText","hint","entityType"],["formControlName","entityTypes","ignoreAuthorityFilter","",3,"allowedEntityTypes"],[1,"limit-slider-container","flex","flex-row","items-center","justify-start","xs:flex-col","xs:items-stretch"],[1,"flex","flex-1","flex-row","items-center","justify-start"],["min","0","max","1","step","0.01","discrete","",1,"flex-1",3,"displayWith"],["matSliderThumb","","formControlName","threshold"],[1,"limit-slider-value"],["matInput","","formControlName","threshold","type","number","step","0.01","min","0","max","1",3,"value"],["subscriptSizing","dynamic",1,"mat-block","flex-1"],["formControlName","apiFeatures","multiple",""],["formControlName","apis",3,"label","hint","predefinedValues"],["mat-stroked-button","",3,"click"]],template:function(i,n){if(1&i){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-toolbar",5)(1,"h2"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"span",6)(5,"div",7),e.\u0275\u0275elementStart(6,"button",8),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.cancel())}),e.\u0275\u0275elementStart(7,"mat-icon",9),e.\u0275\u0275text(8,"close"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(9,n2,1,0,"mat-progress-bar",10),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275template(11,i2,1,0,"div",11),e.\u0275\u0275pipe(12,"async"),e.\u0275\u0275elementStart(13,"div",12)(14,"mat-horizontal-stepper",13,0),e.\u0275\u0275pipe(16,"async"),e.\u0275\u0275listener("selectionChange",function(l){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.changeStep(l))}),e.\u0275\u0275template(17,a2,2,0,"ng-template",14),e.\u0275\u0275elementStart(18,"mat-step",15),e.\u0275\u0275template(19,o2,2,3,"ng-template",16),e.\u0275\u0275elementStart(20,"form",17)(21,"mat-form-field",18)(22,"mat-label",19),e.\u0275\u0275text(23,"notification.rule-name"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(24,"input",20),e.\u0275\u0275template(25,r2,3,3,"mat-error",21),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(26,"mat-slide-toggle",22),e.\u0275\u0275text(27),e.\u0275\u0275pipe(28,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(29,"mat-form-field",18)(30,"mat-label",19),e.\u0275\u0275text(31,"notification.trigger.trigger"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(32,"mat-select",23),e.\u0275\u0275template(33,s2,3,4,"mat-option",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(34,l2,3,3,"mat-error",21),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(35,"tb-template-autocomplete",25),e.\u0275\u0275template(36,d2,10,14,"section",26)(37,p2,7,1,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(39,u2,11,5,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(41,y2,28,15,"mat-step",27)(42,T2,27,15,"mat-step",27)(43,w2,25,13,"mat-step",27)(44,A2,35,23,"mat-step",27)(45,O2,34,19,"mat-step",27)(46,j2,33,24,"mat-step",27)(47,W2,23,17,"mat-step",27)(48,z2,16,10,"mat-step",27)(49,K2,21,6,"mat-step",27)(50,X2,24,9,"mat-step",27)(51,tS,8,2,"mat-step",27)(52,iS,13,10,"mat-step",27)(53,oS,8,2,"mat-step",27),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(54,"mat-divider"),e.\u0275\u0275elementStart(55,"div",28),e.\u0275\u0275template(56,rS,3,3,"button",29),e.\u0275\u0275element(57,"span",6),e.\u0275\u0275elementStart(58,"button",30),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(o),e.\u0275\u0275resetView(n.nextStep())}),e.\u0275\u0275text(59),e.\u0275\u0275pipe(60,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const o=e.\u0275\u0275reference(38);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,29,n.dialogTitle)),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(10,31,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!1===e.\u0275\u0275pipeBind1(12,33,n.isLoading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("linear",!0)("orientation",e.\u0275\u0275pipeBind1(16,35,n.stepperOrientation)),e.\u0275\u0275advance(4),e.\u0275\u0275property("stepControl",n.ruleNotificationForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.ruleNotificationForm),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",n.ruleNotificationForm.get("name").hasError("required")),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(28,37,"notification.rule-enable")," "),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",n.triggerTypes),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.ruleNotificationForm.get("triggerType").hasError("required")),e.\u0275\u0275advance(),e.\u0275\u0275property("notificationTypes",n.ruleNotificationForm.get("triggerType").value),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.ruleNotificationForm.get("triggerType").value!==n.triggerType.ALARM)("ngIfElse",o),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",n.ruleNotificationForm.get("triggerType").value===n.triggerType.ALARM),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.ruleNotificationForm.get("triggerType").value===n.triggerType.DEVICE_ACTIVITY),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.ruleNotificationForm.get("triggerType").value===n.triggerType.ENTITY_ACTION),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.ruleNotificationForm.get("triggerType").value===n.triggerType.ALARM_COMMENT),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.ruleNotificationForm.get("triggerType").value===n.triggerType.ALARM_ASSIGNMENT),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.ruleNotificationForm.get("triggerType").value===n.triggerType.RULE_ENGINE_COMPONENT_LIFECYCLE_EVENT),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.ruleNotificationForm.get("triggerType").value===n.triggerType.EDGE_CONNECTION),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.ruleNotificationForm.get("triggerType").value===n.triggerType.EDGE_COMMUNICATION_FAILURE),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.ruleNotificationForm.get("triggerType").value===n.triggerType.ENTITIES_LIMIT),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.ruleNotificationForm.get("triggerType").value===n.triggerType.API_USAGE_LIMIT),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.ruleNotificationForm.get("triggerType").value===n.triggerType.NEW_PLATFORM_VERSION),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.ruleNotificationForm.get("triggerType").value===n.triggerType.RATE_LIMITS),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",n.ruleNotificationForm.get("triggerType").value===n.triggerType.TASK_PROCESSING_FAILURE),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",n.selectedIndex>0),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(60,39,n.nextStepLabel()))}},dependencies:[p.NgForOf,p.NgIf,p.NgTemplateOutlet,be.HelpComponent,Yo.EntityListComponent,$_.EntityTypeListComponent,ba.StringItemsListComponent,x.MatButton,x.MatIconButton,rn.MatButtonToggleGroup,rn.MatButtonToggle,E.MatIcon,K.MatProgressBar,L.MatInput,v.MatFormField,v.MatLabel,v.MatHint,v.MatError,v.MatSuffix,ae.MatToolbar,S.MatDialogActions,S.MatDialogContent,ce.MatSelect,z.MatOption,Ye.MatDivider,pe.MatSlideToggle,$s.MatSlider,$s.MatSliderThumb,te.MatStep,te.MatStepLabel,te.MatStepper,te.MatStepperIcon,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NumberValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.MinValidator,s.MaxValidator,s.FormGroupDirective,s.FormControlName,s.FormGroupName,u.TranslateDirective,z_.TemplateAutocompleteComponent,Nt,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:900px;height:100%;max-width:100%;max-height:100vh;display:flex;flex-direction:column}[_nghost-%COMP%]   .tb-hint[_ngcontent-%COMP%]{margin-top:-1.25em;padding:0}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .fields-group.tb-margin[_ngcontent-%COMP%]{margin-bottom:12px}[_nghost-%COMP%]   .fields-group.tb-margin-before-field[_ngcontent-%COMP%]{margin-bottom:12px}[_nghost-%COMP%]   .fields-group.tb-hierarchy[_ngcontent-%COMP%]{padding:0 0 8px 16px}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{margin-bottom:8px;color:#000000b3;width:fit-content}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   .mat-body-2[_ngcontent-%COMP%]{margin-bottom:8px;color:#000000c2}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   .clear-button-space[_ngcontent-%COMP%]{margin-right:48px}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   .limit-slider-container[_ngcontent-%COMP%]   .limit-slider-value[_ngcontent-%COMP%]{margin-left:16px;min-width:25px;max-width:100px}[_nghost-%COMP%]   .limit-slider-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{text-align:center}@media screen and (min-width: 960px){[_nghost-%COMP%]   .history-time-input[_ngcontent-%COMP%]{min-width:364px}[_nghost-%COMP%]   .limit-slider-container[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{margin-right:16px;width:min-content;max-width:40%}}[_nghost-%COMP%]     .mat-mdc-dialog-content{display:flex;flex-direction:column;height:100%;padding:0!important;color:#000000de}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal{display:flex;height:100%;overflow:hidden}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-stepper-wrapper{flex:1 1 100%}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-content-container{height:700px;max-height:100%;width:100%;overflow-y:auto;scrollbar-gutter:stable}@media screen and (min-width: 960px){[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-content-container{min-width:500px}}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group.mat-button-toggle-group-appearance-standard{border:none;border-radius:18px;margin-bottom:8px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group.mat-button-toggle-group-appearance-standard .mat-button-toggle+.mat-button-toggle{border-left:none}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle{background:#0000000f;height:36px;align-items:center;display:flex}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle .mat-button-toggle-ripple{inset:2px;border-radius:18px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-button{color:#959595}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-focus-overlay{border-radius:18px;margin:2px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-checked .mat-button-toggle-button{background-color:#305680;color:#fff;border-radius:18px;margin-left:2px;margin-right:2px}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-appearance-standard .mat-button-toggle-label-content{line-height:34px;font-size:16px;font-weight:500}[_nghost-%COMP%]     .mat-button-toggle-group.tb-notification-unread-toggle-group .mat-button-toggle-checked.mat-button-toggle-appearance-standard:not(.mat-button-toggle-disabled):hover .mat-button-toggle-focus-overlay{opacity:.01}']})}}class ji{constructor(t,i,n,o){this.notificationService=t,this.translate=i,this.dialog=n,this.datePipe=o,this.config=new y.M7,this.config.entityType=f.ck.NOTIFICATION_RULE,this.config.detailsPanelEnabled=!1,this.config.addEnabled=!1,this.config.rowPointer=!0,this.config.entityTranslations=f.Mi.get(f.ck.NOTIFICATION_RULE),this.config.entityResources={},this.config.entitiesFetchFunction=r=>this.notificationService.getNotificationRules(r),this.config.deleteEntityTitle=r=>this.translate.instant("notification.delete-rule-title",{ruleName:r.name}),this.config.deleteEntityContent=()=>this.translate.instant("notification.delete-rule-text"),this.config.deleteEntitiesTitle=r=>this.translate.instant("notification.delete-rules-title",{count:r}),this.config.deleteEntitiesContent=()=>this.translate.instant("notification.delete-rules-text"),this.config.deleteEntity=r=>this.notificationService.deleteNotificationRule(r.id),this.config.cellActionDescriptors=this.configureCellActions(),this.config.headerComponent=Oo,this.config.onEntityAction=r=>this.onTargetAction(r),this.config.defaultSortOrder={property:"createdTime",direction:Pe.O.DESC},this.config.handleRowClick=(r,l)=>(this.editRule(r,l),!0),this.config.columns.push(new y.Qr("createdTime","common.created-time",this.datePipe,"170px"),new y.KK("name","notification.rule-name","30%"),new y.KK("templateName","notification.template","20%"),new y.KK("triggerType","notification.trigger.trigger","20%",r=>this.translate.instant(M.YF.get(r.triggerType))||"",()=>({}),!0),new y.KK("additionalConfig.description","notification.description","30%",r=>r.additionalConfig?.description||"",()=>({}),!1))}resolve(t){return this.config}configureCellActions(){return[{name:"",nameFunction:t=>this.translate.instant(t.enabled?"notification.rule-disable":"notification.rule-enable"),icon:"mdi:toggle-switch",isEnabled:()=>!0,iconFunction:t=>t.enabled?"mdi:toggle-switch":"mdi:toggle-switch-off-outline",onAction:(t,i)=>this.toggleEnableMode(t,i)},{name:this.translate.instant("notification.copy-rule"),icon:"content_copy",isEnabled:()=>!0,onAction:(t,i)=>this.editRule(t,i,!1,!0)}]}editRule(t,i,n=!1,o=!1){t&&t.stopPropagation(),this.dialog.open(Vo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{isAdd:n,isCopy:o,rule:i}}).afterClosed().subscribe(r=>{r&&this.config.updateData()})}onTargetAction(t){return"add"===t.action&&(this.editRule(t.event,t.entity,!0),!0)}toggleEnableMode(t,i){t&&t.stopPropagation();const n={...i,enabled:!i.enabled};this.notificationService.saveNotificationRule(n,{ignoreLoading:!0}).subscribe(o=>{i.enabled=o.enabled,this.config.getTable().detectChanges()})}static{this.\u0275fac=function(i){return new(i||ji)(e.\u0275\u0275inject(Ke.J),e.\u0275\u0275inject(u.TranslateService),e.\u0275\u0275inject(S.MatDialog),e.\u0275\u0275inject(p.DatePipe))}}static{this.\u0275prov=e.\u0275\u0275defineInjectable({token:ji,factory:ji.\u0275fac})}}var sS=d(98803);const lS=[{path:"notification",component:va.V,data:{auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER,g.s.SYS_ADMIN],breadcrumb:{menuId:F.D8.notifications_center},routerTabsHeaderComponent:sS.N},children:[{path:"",children:[],data:{auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER,g.s.SYS_ADMIN],redirectTo:"/notification/inbox"}},{path:"inbox",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER,g.s.SYS_ADMIN],title:"notification.inbox",breadcrumb:{menuId:F.D8.notification_inbox}},resolve:{entitiesTableConfig:Ri}},{path:"sent",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN,g.s.SYS_ADMIN],title:"notification.sent",breadcrumb:{menuId:F.D8.notification_sent}},resolve:{entitiesTableConfig:Vi}},{path:"templates",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN,g.s.SYS_ADMIN],title:"notification.templates",breadcrumb:{menuId:F.D8.notification_templates}},resolve:{entitiesTableConfig:Gi}},{path:"recipients",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN,g.s.SYS_ADMIN],title:"notification.recipients",breadcrumb:{menuId:F.D8.notification_recipients}},resolve:{entitiesTableConfig:Bi}},{path:"rules",component:G.EntitiesTableComponent,data:{auth:[g.s.TENANT_ADMIN,g.s.SYS_ADMIN],title:"notification.rules",breadcrumb:{menuId:F.D8.notification_rules}},resolve:{entitiesTableConfig:ji}}]}];class Ui{static{this.\u0275fac=function(i){return new(i||Ui)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Ui})}static{this.\u0275inj=e.\u0275\u0275defineInjector({providers:[Ri,Vi,Bi,Gi,ji],imports:[b.RouterModule.forChild(lS),b.RouterModule]})}}function dS(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",6)(1,"div",7)(2,"mat-checkbox",8),e.\u0275\u0275listener("click",function(){const o=e.\u0275\u0275restoreView(i).$implicit,r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.toggleDeliviryMethod(o))}),e.\u0275\u0275elementEnd()()()}if(2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("checked",n.getChecked(i))}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Ui,{imports:[b.RouterModule],exports:[b.RouterModule]});class qi{constructor(t){this.fb=t,this.deliveryMethods=[],this.notificationTemplateTypeTranslateMap=M.iC,this.propagateChange=null,this.valueChange$=null}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){}ngOnInit(){const t={};this.deliveryMethods.forEach(i=>{t[i]=!0}),this.notificationSettingsFormGroup=this.fb.group({name:[""],enabled:[!0],enabledDeliveryMethods:this.fb.group({...t})}),this.valueChange$=this.notificationSettingsFormGroup.valueChanges.subscribe(()=>{this.updateModel()})}ngOnDestroy(){this.valueChange$&&(this.valueChange$.unsubscribe(),this.valueChange$=null)}setDisabledState(t){this.disabled=t,this.disabled?this.notificationSettingsFormGroup.disable({emitEvent:!1}):this.notificationSettingsFormGroup.enable({emitEvent:!1})}getChecked(t){if(t)return this.notificationSettingsFormGroup.get("enabledDeliveryMethods").get(t).value;{const i=Object.values(this.notificationSettingsFormGroup.get("enabledDeliveryMethods").value),n=i.some(o=>!0===o);return n!==this.notificationSettingsFormGroup.get("enabled").value&&setTimeout(()=>this.notificationSettingsFormGroup.get("enabled").patchValue(n),0),i.every(o=>o)}}toggleDeliviryMethod(t){this.notificationSettingsFormGroup.get("enabledDeliveryMethods").get(t).patchValue(!this.notificationSettingsFormGroup.get("enabledDeliveryMethods").get(t).value)}changeInstanceTypeCheckBox(t){const i=(0,_.Go)(this.notificationSettingsFormGroup.get("enabledDeliveryMethods").value);Object.keys(i).forEach(n=>{i[n]=t}),this.notificationSettingsFormGroup.get("enabled").patchValue(t,{emitEvent:!1}),this.notificationSettingsFormGroup.get("enabledDeliveryMethods").patchValue(i),this.notificationSettingsFormGroup.markAsDirty()}getIndeterminate(){if(!this.notificationSettingsFormGroup.get("enabled").value)return!1;const t=Object.values(this.notificationSettingsFormGroup.get("enabledDeliveryMethods").value),i=t.filter(n=>n);return 0!==i.length&&i.length!==t.length}writeValue(t){(0,_.f1)(t)&&this.notificationSettingsFormGroup.patchValue(t,{emitEvent:!1})}updateModel(){this.propagateChange(this.notificationSettingsFormGroup.value)}static{this.\u0275fac=function(i){return new(i||qi)(e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:qi,selectors:[["tb-notification-setting-form"]],inputs:{disabled:"disabled",deliveryMethods:"deliveryMethods"},features:[e.\u0275\u0275ProvidersFeature([{provide:s.NG_VALUE_ACCESSOR,useExisting:(0,e.forwardRef)(()=>qi),multi:!0}])],decls:8,vars:9,consts:[[1,"flex","flex-col",3,"formGroup"],[1,"flex","flex-row",2,"height","48px"],[1,"flex","max-w-50%","flex-full","items-center","justify-start"],["color","primary",3,"click","change","checked","indeterminate"],[1,"notification-type"],["class","flex flex-1 flex-row",4,"ngFor","ngForOf"],[1,"flex","flex-1","flex-row"],[1,"flex","flex-1","items-center","justify-start"],["color","primary",3,"click","checked"]],template:function(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"form",0)(1,"div",1)(2,"div",2)(3,"mat-checkbox",3),e.\u0275\u0275listener("click",function(r){return r.stopPropagation()})("change",function(r){return n.changeInstanceTypeCheckBox(r.checked)}),e.\u0275\u0275elementStart(4,"span",4),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(7,dS,3,1,"div",5),e.\u0275\u0275elementEnd()()),2&i){let o;e.\u0275\u0275property("formGroup",n.notificationSettingsFormGroup),e.\u0275\u0275advance(3),e.\u0275\u0275property("checked",n.getChecked())("indeterminate",n.getIndeterminate()),e.\u0275\u0275advance(),e.\u0275\u0275classProp("notification-type-disabled",!n.notificationSettingsFormGroup.get("enabled").value),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(6,7,null==(o=n.notificationTemplateTypeTranslateMap.get(n.notificationSettingsFormGroup.get("name").value))?null:o.name)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",n.deliveryMethods)}},dependencies:[p.NgForOf,Te.MatCheckbox,s.\u0275NgNoValidate,s.NgControlStatusGroup,s.FormGroupDirective,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]   .notification-type[_ngcontent-%COMP%]{font-size:14px}[_nghost-%COMP%]   .notification-type-disabled[_ngcontent-%COMP%]{color:#00000061}']})}}function cS(a,t){1&a&&e.\u0275\u0275element(0,"mat-progress-bar",20)}function pS(a,t){1&a&&e.\u0275\u0275element(0,"div",21)}function mS(a,t){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",22)(1,"div",23)(2,"mat-checkbox",24),e.\u0275\u0275listener("change",function(o){const r=e.\u0275\u0275restoreView(i).$implicit,l=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(l.changeInstanceTypeCheckBox(o.checked,r))})("click",function(o){return e.\u0275\u0275restoreView(i),e.\u0275\u0275resetView(o.stopPropagation())}),e.\u0275\u0275elementStart(3,"mat-label"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()()()}if(2&a){const i=t.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("checked",n.getChecked(i))("indeterminate",n.getIndeterminate(i)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(5,3,n.notificationDeliveryMethodInfoMap.get(i).name))}}function uS(a,t){1&a&&e.\u0275\u0275element(0,"mat-divider")}function gS(a,t){if(1&a&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275element(1,"tb-notification-setting-form",25),e.\u0275\u0275template(2,uS,1,0,"mat-divider",26),e.\u0275\u0275elementEnd()),2&a){const i=t.$implicit,n=t.last,o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(),e.\u0275\u0275property("formControl",i)("deliveryMethods",o.notificationDeliveryMethods),e.\u0275\u0275advance(),e.\u0275\u0275property("ngIf",!n)}}class Bo extends de.H{constructor(t,i,n,o,r,l){super(t),this.store=t,this.route=i,this.translate=n,this.dialogService=o,this.notificationService=r,this.fb=l,this.notificationDeliveryMethodInfoMap=M.d$,this.deliveryMethods=new Set([M.Fd.SLACK,M.Fd.MICROSOFT_TEAMS]),this.getChecked=(c=null)=>{const m=this.notificationSettings.get("prefs").value;return(0,_.f1)(c)?(0,_.f1)(m)&&m.every(h=>h.enabledDeliveryMethods[c]):(0,_.f1)(m)&&m.every(h=>h.enabled)},this.getSomeChecked=()=>{const c=this.notificationSettings.get("prefs").value;return(0,_.f1)(c)&&c.some(m=>m.enabled)},this.getIndeterminate=(c=null)=>{const m=this.notificationSettings.get("prefs").value;if((0,_.f1)(m)){const h=(0,_.f1)(c)?m.filter(T=>T.enabledDeliveryMethods[c]):m.filter(T=>T.enabled);return 0!==h.length&&h.length!==m.length}return!1},this.changeInstanceTypeCheckBox=(c,m=null)=>{const h=(0,_.Go)(this.notificationSettings.get("prefs").value);(0,_.f1)(m)?h.forEach(T=>T.enabledDeliveryMethods[m]=c):h.forEach(T=>{T.enabled=c,T.enabledDeliveryMethods=Object.keys(T.enabledDeliveryMethods).reduce((N,O)=>({...N,[O]:c}),{})}),this.notificationSettings.get("prefs").patchValue(h,{emitEvent:!1}),this.notificationSettings.markAsDirty()},this.notificationService.getAvailableDeliveryMethods({ignoreLoading:!0}).subscribe(c=>{this.notificationDeliveryMethods=c.filter(m=>!this.deliveryMethods.has(m)),this.patchNotificationSettings(this.route.snapshot.data.userSettings)})}ngOnInit(){this.buildNotificationSettingsForm()}buildNotificationSettingsForm(){this.notificationSettings=this.fb.group({prefs:this.fb.array([])})}patchNotificationSettings(t){const i=[];t.prefs&&this.prepareNotificationSettings(t.prefs).forEach(n=>i.push(this.fb.control(n,[s.Validators.required]))),this.notificationSettings.setControl("prefs",this.fb.array(i),{emitEvent:!1})}prepareNotificationSettings(t){return Object.entries(t).map(i=>{if(i[1].name=i[0],!i[1].enabled&&Object.values(i[1].enabledDeliveryMethods).some(n=>!0===n)){const n=(0,_.Go)(i[1].enabledDeliveryMethods);Object.keys(n).forEach(o=>{n[o]=!1}),i[1].enabledDeliveryMethods=n}return i[1].enabledDeliveryMethods=Object.assign(this.notificationDeliveryMethods.reduce((n,o)=>({...n,[o]:!0}),{}),i[1].enabledDeliveryMethods),i[1]})}resetSettings(){this.dialogService.confirm(this.translate.instant("notification.settings.reset-all-title"),this.translate.instant("notification.settings.reset-all-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){const i=this.prepareNotificationSettings(this.route.snapshot.data.userSettings.prefs),n=[];this.notificationSettings.reset({}),i&&i.forEach(o=>{o.enabled=!0,o.enabledDeliveryMethods=this.notificationDeliveryMethods.reduce((r,l)=>({...r,[l]:!0}),{}),n.push(this.fb.control(o,[s.Validators.required]))}),this.notificationSettings.setControl("prefs",this.fb.array(n),{emitEvent:!1}),this.save()}})}get notificationSettingsFormArray(){return this.notificationSettings.get("prefs")}save(){const t={prefs:{}};this.notificationSettings.getRawValue().prefs.forEach(i=>{const n=i.name;delete i.name,t.prefs[n]=i}),this.notificationService.saveNotificationUserSettings(t).subscribe(i=>{this.notificationSettings.get("prefs").reset({}),this.patchNotificationSettings(i)})}confirmForm(){return this.notificationSettings}static{this.\u0275fac=function(i){return new(i||Bo)(e.\u0275\u0275directiveInject(C.Store),e.\u0275\u0275directiveInject(b.ActivatedRoute),e.\u0275\u0275directiveInject(u.TranslateService),e.\u0275\u0275directiveInject(Ce.o),e.\u0275\u0275directiveInject(Ke.J),e.\u0275\u0275directiveInject(s.UntypedFormBuilder))}}static{this.\u0275cmp=e.\u0275\u0275defineComponent({type:Bo,selectors:[["tb-notification-settings"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:33,vars:23,consts:[["appearance","outlined",1,"settings-card","tb-absolute-fill"],[1,"flex","flex-1","flex-row","items-start","justify-between","xs:flex-col","xs:justify-start","xs:gap-2"],[1,"flex","flex-1","flex-col"],["translate","",1,"mat-headline-5"],[1,"flex","flex-col"],["mat-button","","color","primary",3,"click","disabled"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[2,"padding-top","16px","overflow","hidden"],[1,"notification-form",3,"formGroup"],[1,"notification-section"],[1,"notification-section-block"],[1,"flex","flex-row","items-center","justify-start",2,"height","44px"],[1,"max-w-50%","flex-full"],["color","warn",3,"click","change","indeterminate","checked"],["translate",""],["class","flex-1",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"flex","flex-row","items-start","justify-end",2,"padding","16px"],["mat-button","","mat-raised-button","","color","primary","type","button",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[1,"flex-1"],[1,"flex","flex-1","items-center","justify-start"],["color","warn",3,"change","click","checked","indeterminate"],[3,"formControl","deliveryMethods"],[4,"ngIf"]],template:function(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div")(1,"mat-card",0)(2,"mat-card-header")(3,"div",1)(4,"div",2)(5,"span",3),e.\u0275\u0275text(6,"notification.settings.notification-settings"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(7,"div",4)(8,"button",5),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275listener("click",function(){return n.resetSettings()}),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275template(12,cS,1,0,"mat-progress-bar",6),e.\u0275\u0275pipe(13,"async"),e.\u0275\u0275template(14,pS,1,0,"div",7),e.\u0275\u0275pipe(15,"async"),e.\u0275\u0275elementStart(16,"mat-card-content",8)(17,"form",9)(18,"section",10)(19,"div",11)(20,"div",12)(21,"div",13)(22,"mat-checkbox",14),e.\u0275\u0275listener("click",function(r){return r.stopPropagation()})("change",function(r){return n.changeInstanceTypeCheckBox(r.checked)}),e.\u0275\u0275elementStart(23,"mat-label",15),e.\u0275\u0275text(24,"notification.settings.type"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(25,mS,6,5,"div",16),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(26,"mat-divider"),e.\u0275\u0275template(27,gS,3,3,"div",17),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(28,"div",18)(29,"button",19),e.\u0275\u0275pipe(30,"async"),e.\u0275\u0275listener("click",function(){return n.save()}),e.\u0275\u0275text(31),e.\u0275\u0275pipe(32,"translate"),e.\u0275\u0275elementEnd()()()()),2&i&&(e.\u0275\u0275advance(8),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(9,11,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,13,"notification.settings.reset-all")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(13,15,n.isLoading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(15,17,n.isLoading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("formGroup",n.notificationSettings),e.\u0275\u0275advance(5),e.\u0275\u0275property("indeterminate",n.getIndeterminate())("checked",n.getChecked()),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",n.notificationDeliveryMethods),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",n.notificationSettingsFormArray.controls),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(30,19,n.isLoading$)||n.notificationSettings.invalid||!n.notificationSettings.dirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(32,21,"action.save")," "))},dependencies:[p.NgForOf,p.NgIf,x.MatButton,Te.MatCheckbox,D.MatCard,D.MatCardContent,D.MatCardHeader,K.MatProgressBar,v.MatLabel,Ye.MatDivider,s.\u0275NgNoValidate,s.NgControlStatus,s.NgControlStatusGroup,s.FormControlDirective,s.FormGroupDirective,u.TranslateDirective,qi,p.AsyncPipe,u.TranslatePipe],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}@media screen and (min-width: 960px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-headline-5[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .notification-form[_ngcontent-%COMP%]{height:100%;min-height:min-content;max-height:min-content}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .notification-section[_ngcontent-%COMP%]{height:100%;border:1px solid rgba(0,0,0,.12);overflow:scroll}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .notification-section-block[_ngcontent-%COMP%]{min-width:470px}']})}}var zs=d(10731),fS=d(5172);class Wi{static{this.\u0275fac=function(i){return new(i||Wi)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Wi})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,Ui,k.I]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Wi,{declarations:[Fo,Do,Po,qs.T,dr.a,ko,Lr.J,Lo,nn,Nt,Vo,Oo,Bo,qi,zs.l,fS.h],imports:[p.CommonModule,w.G,Ui,k.I]}),e.\u0275\u0275setComponentScope(Lr.J,[p.NgForOf,p.NgIf,be.HelpComponent,x.MatButton,x.MatIconButton,E.MatIcon,K.MatProgressBar,L.MatInput,v.MatFormField,v.MatLabel,v.MatError,ae.MatToolbar,S.MatDialogActions,S.MatDialogContent,ce.MatSelect,z.MatOption,Ye.MatDivider,pe.MatSlideToggle,te.MatStep,te.MatStepLabel,te.MatStepper,te.MatStepperIcon,te.MatStepContent,s.\u0275NgNoValidate,s.DefaultValueAccessor,s.NgControlStatus,s.NgControlStatusGroup,s.RequiredValidator,s.FormGroupDirective,s.FormControlName,s.FormGroupName,u.TranslateDirective,zs.l],[p.AsyncPipe,u.TranslatePipe]);const hS=[{path:"notificationSettings",component:Bo,canDeactivate:[P.L],data:{auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],title:"account.notification-settings",breadcrumb:{label:"account.notification-settings",icon:"settings"}},resolve:{userSettings:()=>(0,e.inject)(Ke.J).getNotificationUserSettings()}}],bS=[{path:"account",component:va.V,data:{auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],showMainLoadingBar:!1,breadcrumb:{label:"account.account",icon:"account_circle"},useChildrenRoutesForTabs:!0},resolve:{replaceUrl:()=>(0,q.rW)((0,e.inject)(C.Store)).forceFullscreen},children:[{path:"",children:[],data:{auth:[g.s.SYS_ADMIN,g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],redirectTo:"/account/profile"}},...dh,...gb,...hS]}];class $i{static{this.\u0275fac=function(i){return new(i||$i)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:$i})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[b.RouterModule.forChild(bS),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope($i,{imports:[b.RouterModule],exports:[b.RouterModule]});class zi{static{this.\u0275fac=function(i){return new(i||zi)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:zi})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,$i]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(zi,{imports:[p.CommonModule,$i]});var cr=d(5681),Hs=d(50931);class Hi{static{this.\u0275fac=function(i){return new(i||Hi)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Hi})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,cr.WidgetSettingsCommonModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Hi,{declarations:[Ct,bt,Ut,qa,Xe,yt,Wa,et,vt,$a],imports:[p.CommonModule,w.G,cr.WidgetSettingsCommonModule],exports:[Ct]}),e.\u0275\u0275setComponentScope(Xe,[p.NgForOf,p.NgIf,Hs.TbErrorComponent,x.MatButton,x.MatIconButton,E.MatIcon,_e.MatTooltip,Qe.CdkDropList,Qe.CdkDrag,Qe.CdkDragHandle,s.NgControlStatus,s.FormControlDirective,u.TranslateDirective,yt],[u.TranslatePipe]),e.\u0275\u0275setComponentScope(et,[p.NgForOf,p.NgIf,Hs.TbErrorComponent,x.MatButton,x.MatIconButton,E.MatIcon,_e.MatTooltip,Qe.CdkDropList,Qe.CdkDrag,Qe.CdkDragHandle,s.NgControlStatus,s.FormControlDirective,u.TranslateDirective,vt],[u.TranslatePipe]);class Ki{static{this.\u0275fac=function(i){return new(i||Ki)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Ki})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,k.I,Hi,vn,cr.WidgetSettingsCommonModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Ki,{declarations:[Ua,za],imports:[p.CommonModule,w.G,k.I,Hi,vn,cr.WidgetSettingsCommonModule]});class Yi{static{this.\u0275fac=function(i){return new(i||Yi)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Yi})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.CommonModule,w.G,k.I,Di]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Yi,{imports:[p.CommonModule,w.G,k.I,Di]});const vS=[{path:"developers",component:d(36851).G,data:{auth:[g.s.TENANT_ADMIN,g.s.CUSTOMER_USER],breadcrumb:{menuId:F.D8.developers},isPage:!0}}];class Qi{static{this.\u0275fac=function(i){return new(i||Qi)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Qi})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[b.RouterModule.forChild(vS),b.RouterModule]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Qi,{imports:[b.RouterModule],exports:[b.RouterModule]});class Ji{static{this.\u0275fac=function(i){return new(i||Ji)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Ji})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[Qi]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Ji,{imports:[Qi]});class Go{static{this.\u0275fac=function(i){return new(i||Go)}}static{this.\u0275mod=e.\u0275\u0275defineNgModule({type:Go})}static{this.\u0275inj=e.\u0275\u0275defineInjector({imports:[Tn,wn,Nn,kn,bi,Vn,yi,Ei,Ni,ki,Oi,Wi,ti,ii,Fi,_i,oi,Qn,ui,gi,fi,Jn,Ci,Yi,Ti,Xn,wi,zi,Ki,Ji]})}}(typeof ngJitMode>"u"||ngJitMode)&&e.\u0275\u0275setNgModuleScope(Go,{exports:[Tn,wn,Nn,kn,bi,Vn,yi,Ei,Ni,ki,Oi,Wi,ti,ii,Fi,_i,oi,Qn,ui,gi,fi,Jn,Ci,Yi,Ti,Xn,wi,zi,Ki,Ji]})}}]);