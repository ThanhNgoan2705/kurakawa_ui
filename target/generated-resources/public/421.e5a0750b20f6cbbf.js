"use strict";(self.webpackChunkthingsboard=self.webpackChunkthingsboard||[]).push([[421],{10421:(j,R,C)=>{C.r(R),C.d(R,{CanvasDigitalGauge:()=>v,Drawings:()=>M});var Y=C(18062),S=C(97323),z=C(27997),k=C(96771),P=C(42415),I=Y.GenericOptions,D=Y.BaseGauge;const L={...I,gaugeType:"arc",gaugeWithScale:.75,dashThickness:0,roundedLineCap:!1,gaugeColor:"#777",barColorProcessor:k.U9.fromSettings((0,k.sj)("blue")),symbol:"",hideValue:!1,hideMinMax:!1,fontTitle:"Roboto",fontValue:"Roboto",fontMinMaxSize:10,fontMinMaxStyle:"normal",fontMinMaxWeight:"500",colorMinMax:"#eee",fontMinMax:"Roboto",fontLabelSize:8,fontLabelStyle:"normal",fontLabelWeight:"500",colorLabel:"#eee",fontLabel:"Roboto",neonGlowBrightness:0,colorTicks:"gray",tickWidth:4,ticks:[],isMobile:!1};D.initialize("CanvasDigitalGauge",L);class M{static font(e,i,r){return e["font"+i+"Style"]+" "+e["font"+i+"Weight"]+" "+e["font"+i+"Size"]*r+"px "+e["font"+i]}static normalizedValue(e){const i=e.value,r=e.minValue,l=e.maxValue,n=.01*(l-r);return{normal:i<r?r:i>l?l:i,indented:i<r?r-n:i>l?l+n:i}}static verifyError(e){if(!(e instanceof DOMException&&2152923147===e.result))throw e}}class v extends D{static{this.heightCache={}}constructor(e){e={...L,...e||{}},super(v.configure(e)),this.initValueClone()}static configure(e){e.value>e.maxValue&&(e.value=e.maxValue),e.value<e.minValue&&(e.value=e.minValue),"donut"===e.gaugeType&&((0,z.f1)(e.donutStartAngle)||(e.donutStartAngle=1.5*Math.PI),(0,z.f1)(e.donutEndAngle)||(e.donutEndAngle=e.donutStartAngle+2*Math.PI)),e.ticksValue=[];for(const i of e.ticks)null!==i&&e.ticksValue.push(v.normalizeValue(i,e.minValue,e.maxValue));return e.neonGlowBrightness&&(e.neonColorTitle=(0,S.A)(e.colorTitle).brighten(e.neonGlowBrightness).toRgbString(),e.neonColorLabel=(0,S.A)(e.colorLabel).brighten(e.neonGlowBrightness).toRgbString(),e.neonColorValue=(0,S.A)(e.colorValue).brighten(e.neonGlowBrightness).toRgbString(),e.neonColorMinMax=(0,S.A)(e.colorMinMax).brighten(e.neonGlowBrightness).toRgbString()),e}static normalizeValue(e,i,r){const l=(e-i)/(r-i);return l<=0?0:l>=1?1:l}initValueClone(){const e=this.canvas;this.elementValueClone=e.element.cloneNode(!0),this.contextValueClone=this.elementValueClone.getContext("2d"),this.elementValueClone.initialized=!1,this.contextValueClone.translate(e.drawX,e.drawY),this.contextValueClone.save(),this.elementProgressClone=e.element.cloneNode(!0),this.contextProgressClone=this.elementProgressClone.getContext("2d"),this.elementProgressClone.initialized=!1,this.contextProgressClone.translate(e.drawX,e.drawY),this.contextProgressClone.save()}destroy(){this.contextValueClone=null,this.elementValueClone=null,this.contextProgressClone=null,this.elementProgressClone=null,super.destroy()}update(e){this.canvas.onRedraw=null;const i=super.update(e);return this.initValueClone(),this.canvas.onRedraw=this.draw.bind(this),this.draw(),i}set timestamp(e){this.options.timestamp=e,this.draw()}get timestamp(){return this.options.timestamp}draw(){try{const e=this.canvas;if(!e.drawWidth||!e.drawHeight)return this;const[i,r,l,n]=[-e.drawX,-e.drawY,e.drawWidth,e.drawHeight],a=this.options,s=e.elementClone;if(!s.initialized){const o=e.contextClone;o.clearRect(i,r,l,n),o.save();const u=e.context;u.barDimensions=function O(t,e,i,r,l,n){t.barDimensions={baseX:i,baseY:r,width:l,height:n};const a=t.barDimensions;let s=1;"horizontalBar"===e.gaugeType?s=""===e.title?2.5:2:"verticalBar"===e.gaugeType?s=e.hideMinMax?.35:.5:"arc"===e.gaugeType&&(s=1.5),l/n>s?(a.width=n*s,a.height=n):(a.width=l,a.height=l/s),a.origBaseX=a.baseX,a.origBaseY=a.baseY,a.baseX+=(l-a.width)/2,a.baseY+=(n-a.height)/2,"donut"===e.gaugeType?a.fontSizeFactor=Math.max(a.width,a.height)/125:"verticalBar"===e.gaugeType||"arc"===e.gaugeType&&""===e.title?a.fontSizeFactor=Math.max(a.width,a.height)/150:a.fontSizeFactor=Math.max(a.width,a.height)/200;const f=e.gaugeWidthScale;if(e.neonGlowBrightness&&(e.fontTitleHeight=T(e,"Title",a.fontSizeFactor),e.fontLabelHeight=T(e,"Label",a.fontSizeFactor),e.fontValueHeight=T(e,"Value",a.fontSizeFactor),e.fontMinMaxHeight=T(e,"MinMax",a.fontSizeFactor)),"donut"===e.gaugeType){if(a.Ro=a.width/2-a.width/20,a.Cy=a.baseY+a.height/2,e.title&&"string"==typeof e.title&&e.title.length>0){let h=T(e,"Title",a.fontSizeFactor).height;h+=2*a.fontSizeFactor,a.titleY=a.baseY+h,h+=2*a.fontSizeFactor,a.Cy+=h/2,a.Ro-=h/2}a.Ri=a.Ro-a.width/6.666666666666667*f*1.2,a.Cx=a.baseX+a.width/2}else"arc"===e.gaugeType?(e.title&&"string"==typeof e.title&&e.title.length>0?(a.Ro=a.width/2-a.width/7,a.Ri=a.Ro-a.width/6.666666666666667*f):(a.Ro=a.width/2-4*a.fontSizeFactor,a.Ri=a.Ro-a.width/6.666666666666667*f*1.2),a.Cx=a.baseX+a.width/2,a.Cy=a.baseY+a.height/1.25):"verticalBar"===e.gaugeType?(a.Ro=a.width/2-a.width/10,a.Ri=a.Ro-a.width/6.666666666666667*f*(e.hideMinMax?4:2.5)):(a.Ro=a.width/2-a.width/10,a.Ri=a.Ro-a.width/6.666666666666667*f);if(a.strokeWidth=a.Ro-a.Ri,a.Rm=a.Ri+.5*a.strokeWidth,a.fontValueBaseline="alphabetic",a.fontMinMaxBaseline="alphabetic",a.fontMinMaxAlign="center","donut"===e.gaugeType)if(a.fontValueBaseline="middle",e.showUnitTitle||e.showTimestamp){const h=T(e,"Value",a.fontSizeFactor).height,u=h+T(e,"Label",a.fontSizeFactor).height;a.labelY=a.Cy+u/2,a.timeseriesLabelY=B(e,a.labelY,a.fontSizeFactor),a.valueY=a.Cy-u/2+h/2}else a.valueY=a.Cy;else if("arc"===e.gaugeType)a.titleY=a.Cy-a.Ro-12*a.fontSizeFactor,a.valueY=a.Cy,a.labelY=a.Cy+(8+e.fontLabelSize)*a.fontSizeFactor,a.timeseriesLabelY=B(e,a.labelY,a.fontSizeFactor),a.minY=a.maxY=a.labelY,e.roundedLineCap&&(a.minY+=a.strokeWidth/2,a.maxY+=a.strokeWidth/2),a.minX=a.Cx-a.Rm,a.maxX=a.Cx+a.Rm;else if("horizontalBar"===e.gaugeType)if(a.titleY=a.baseY+4*a.fontSizeFactor+(""===e.title?0:e.fontTitleSize*a.fontSizeFactor),a.titleBottom=a.titleY+(""===e.title?0:4)*a.fontSizeFactor,a.valueY=a.titleBottom+(e.hideValue?0:e.fontValueSize*a.fontSizeFactor),a.barTop=a.valueY+8*a.fontSizeFactor,a.barBottom=a.barTop+a.strokeWidth,!e.hideMinMax||e.showUnitTitle||e.showTimestamp){t.font=M.font(e,"MinMax",a.fontSizeFactor);const h=t.measureText(e.minValue+"").width,o=t.measureText(e.maxValue+"").width,u=Math.max(h,o);a.minX=a.origBaseX+u/2+e.fontMinMaxSize/3*a.fontSizeFactor,a.maxX=a.origBaseX+l+-u/2-e.fontMinMaxSize/3*a.fontSizeFactor,a.barLeft=a.minX,a.barRight=a.maxX,a.labelY=a.barBottom+(8+e.fontLabelSize)*a.fontSizeFactor,a.timeseriesLabelY=B(e,a.labelY,a.fontSizeFactor),a.minY=a.maxY=a.labelY}else a.labelY=a.barBottom,a.timeseriesLabelY=B(e,a.labelY,a.fontSizeFactor),a.barLeft=a.origBaseX+e.fontMinMaxSize/3*a.fontSizeFactor,a.barRight=a.origBaseX+l+-e.fontMinMaxSize/3*a.fontSizeFactor;else"verticalBar"===e.gaugeType&&(a.titleY=a.baseY+((""===e.title?0:e.fontTitleSize)+8)*a.fontSizeFactor,a.titleBottom=a.titleY+(""===e.title?0:4)*a.fontSizeFactor,a.valueY=a.titleBottom+(e.hideValue?0:e.fontValueSize*a.fontSizeFactor),a.barTop=a.valueY+8*a.fontSizeFactor,a.labelY=a.baseY+a.height,a.timeseriesLabelY=B(e,a.labelY,a.fontSizeFactor),e.showUnitTitle||e.showTimestamp?a.barBottom=a.labelY-e.fontLabelSize*a.fontSizeFactor:a.barBottom=a.labelY,a.minX=a.maxX=a.baseX+a.width/2+a.strokeWidth/2+e.fontMinMaxSize/3*a.fontSizeFactor,a.minY=a.barBottom,a.maxY=a.barTop,a.fontMinMaxBaseline="middle",a.fontMinMaxAlign="left");if(e.dashThickness){let h;"donut"===e.gaugeType?h=Math.PI*a.Rm*2:"arc"===e.gaugeType?h=Math.PI*a.Rm:"horizontalBar"===e.gaugeType?h=a.barRight-a.barLeft:"verticalBar"===e.gaugeType&&(h=a.barBottom-a.barTop);let o=Math.floor(h/(e.dashThickness*a.fontSizeFactor));o="donut"===e.gaugeType?(1|o)-1:o-1|1,a.dashLength=Math.ceil(h/o)}return a}(o,a,i,r,l,n),this.contextValueClone.barDimensions=u.barDimensions,this.contextProgressClone.barDimensions=u.barDimensions,function U(t,e){const{barLeft:i,barRight:r,barTop:l,barBottom:n,width:a,baseX:s,strokeWidth:d}=t.barDimensions;t.barDimensions.dashLength&&t.setLineDash([t.barDimensions.dashLength]),t.beginPath(),t.strokeStyle=e.gaugeColor,t.lineWidth=d,e.roundedLineCap&&(t.lineCap="round"),"donut"===e.gaugeType?(t.arc(t.barDimensions.Cx,t.barDimensions.Cy,t.barDimensions.Rm,e.donutStartAngle,e.donutEndAngle),t.stroke()):"arc"===e.gaugeType?(t.arc(t.barDimensions.Cx,t.barDimensions.Cy,t.barDimensions.Rm,Math.PI,2*Math.PI),t.stroke()):"horizontalBar"===e.gaugeType?(t.moveTo(i,l+d/2),t.lineTo(r,l+d/2),t.stroke()):"verticalBar"===e.gaugeType&&(t.moveTo(s+a/2,n),t.lineTo(s+a/2,l),t.stroke())}(o,a),function _(t,e){if(!e.title||"string"!=typeof e.title)return;const{titleY:i,width:r,baseX:l,fontSizeFactor:n}=t.barDimensions,a=Math.round(l+r/2),s=i;t.save(),t.textAlign="center",t.font=M.font(e,"Title",n),t.lineWidth=0,V(t,e,"Title",e.title.toUpperCase(),a,s),t.restore()}(o,a),a.showUnitTitle&&A(o,a,a.unitTitle,"labelY"),function H(t,e){if(e.hideMinMax||"donut"===e.gaugeType)return;const{minY:i,maxY:r,minX:l,maxX:n,fontSizeFactor:a,fontMinMaxAlign:s,fontMinMaxBaseline:d}=t.barDimensions;t.save(),t.textAlign=s,t.textBaseline=d,t.font=M.font(e,"MinMax",a),t.lineWidth=0,V(t,e,"MinMax",e.minValue+"",l,i),V(t,e,"MinMax",e.maxValue+"",n,r),t.restore()}(o,a),s.initialized=!0}let d=!1;if(!this.elementValueClone.initialized||(0,z.O9)(this._value)&&this.elementValueClone.renderedValue!==this._value||a.showTimestamp&&this.elementValueClone.renderedTimestamp!==this.timestamp){(0,z.O9)(this._value)&&(this.elementValueClone.renderedValue=this._value),(0,z.b0)(this.elementValueClone.renderedValue)&&(this.elementValueClone.renderedValue=this.value);const o=this.contextValueClone;o.clearRect(i,r,l,n),o.drawImage(e.elementClone,i,r,l,n),function K(t,e,i){if(e.hideValue)return;const{valueY:r,baseX:l,width:n,fontSizeFactor:a,fontValueBaseline:s}=t.barDimensions,d=Math.round(l+n/2),f=r;let h=e.valueText||(0,z.ji)(i,e.valueDec);h+=e.symbol,t.save(),t.textAlign="center",t.textBaseline=s,t.font=M.font(e,"Value",a),t.lineWidth=0,V(t,e,"Value",h,d,f),t.restore()}(o,a,this.elementValueClone.renderedValue),a.showTimestamp&&(A(o,a,a.labelTimestamp,"timeseriesLabelY"),this.elementValueClone.renderedTimestamp=this.timestamp),this.elementValueClone.initialized=!0,d=!0}const f=(M.normalizedValue(a).normal-a.minValue)/(a.maxValue-a.minValue),h=f.toFixed(3);if(!this.elementProgressClone.initialized||this.elementProgressClone.renderedProgress!==h||d){const o=this.contextProgressClone;o.clearRect(i,r,l,n),o.drawImage(this.elementValueClone,i,r,l,n),Number(h)>0&&function N(t,e,i){let r;t.save(),e.barColorProcessor.update(e.value);const l=(0,S.A)(e.barColorProcessor.color);e.neonGlowBrightness?t.currentColor=r=l.brighten(e.neonGlowBrightness).toRgbString():t.currentColor=t.strokeStyle=l.toRgbString();const{barLeft:n,barRight:a,barTop:s,baseX:d,width:f,barBottom:h,Cx:o,Cy:u,Rm:m,Ro:b,Ri:g,strokeWidth:c}=t.barDimensions;t.barDimensions.dashLength&&t.setLineDash([t.barDimensions.dashLength]),t.lineWidth=c,e.roundedLineCap?t.lineCap="round":t.lineCap="butt","donut"===e.gaugeType?(e.neonGlowBrightness&&(t.strokeStyle=r),t.beginPath(),t.arc(o,u,m,e.donutStartAngle,e.donutStartAngle+(e.donutEndAngle-e.donutStartAngle)*i),t.stroke(),e.neonGlowBrightness&&!e.isMobile&&W(t,o,u,g,m,b,r,i,!0,e.donutStartAngle,e.donutEndAngle),G(t,e.ticksValue,o,u,g,m,b,e.donutStartAngle,e.donutEndAngle-e.donutStartAngle,e.colorTicks,e.tickWidth)):"arc"===e.gaugeType?(e.neonGlowBrightness&&(t.strokeStyle=r),t.beginPath(),t.arc(o,u,m,Math.PI,Math.PI+Math.PI*i),t.stroke(),e.neonGlowBrightness&&!e.isMobile&&W(t,o,u,g,m,b,r,i,!1),G(t,e.ticksValue,o,u,g,m,b,Math.PI,Math.PI,e.colorTicks,e.tickWidth)):"horizontalBar"===e.gaugeType?(e.neonGlowBrightness&&(t.strokeStyle=r),t.beginPath(),t.moveTo(n,s+c/2),t.lineTo(n+(a-n)*i,s+c/2),t.stroke(),e.neonGlowBrightness&&!e.isMobile&&F(t,n,s+c/2,n+(a-n)*i,s+c/2,r,c,!1),X(t,e.ticksValue,n,s,a-n,c,!1,e.colorTicks,e.tickWidth)):"verticalBar"===e.gaugeType&&(e.neonGlowBrightness&&(t.strokeStyle=r),t.beginPath(),t.moveTo(d+f/2,h),t.lineTo(d+f/2,h-(h-s)*i),t.stroke(),e.neonGlowBrightness&&!e.isMobile&&F(t,d+f/2,h,d+f/2,h-(h-s)*i,r,c,!0),X(t,e.ticksValue,d+f/2,s,s-h,c,!0,e.colorTicks,e.tickWidth)),t.restore()}(o,a,f),this.elementProgressClone.initialized=!0,this.elementProgressClone.renderedProgress=h}this.canvas.commit(),e.context.clearRect(i,r,l,n),e.context.drawImage(this.elementProgressClone,i,r,l,n),super.draw()}catch(e){M.verifyError(e)}return this}getValueColor(){if(this.contextProgressClone){let e=this.contextProgressClone.currentColor;const i=this.options;if(!e){i.barColorProcessor.update(i.value);const r=(0,S.A)(i.barColorProcessor.color);e=i.neonGlowBrightness?r.brighten(i.neonGlowBrightness).toRgbString():r.toRgbString()}return e}return"#000"}}function B(t,e,i){return t.showUnitTitle?e+t.fontLabelSize*i*1.2:e}function T(t,e,i){const r="font-style:"+t["font"+e+"Style"]+";font-weight:"+t["font"+e+"Weight"]+";font-size:"+t["font"+e+"Size"]*i+"px;font-family:"+t["font"+e];let l=v.heightCache[r];if(!l){const n={fontFamily:t["font"+e],fontSize:t["font"+e+"Size"]*i+"px",fontWeight:t["font"+e+"Weight"],fontStyle:t["font"+e+"Style"]},a=P("<span>Hg</span>").css(n),s=P('<div style="display: inline-block; width: 1px; height: 0;"></div>'),d=P("<div></div>");d.append(a,s),P("body").append(d);try{l={},s.css({verticalAlign:"baseline"}),l.ascent=s.offset().top-a.offset().top,s.css({verticalAlign:"bottom"}),l.height=s.offset().top-a.offset().top,l.descent=l.height-l.ascent}finally{d.remove()}v.heightCache[r]=l}return l}function V(t,e,i,r,l,n){t.fillStyle=e[(e.neonGlowBrightness?"neonColor":"color")+i],t.fillText(r,l,n)}function A(t,e,i,r){if(!i||""===i)return;const{baseX:l,width:n,fontSizeFactor:a}=t.barDimensions,s=Math.round(l+n/2),d=t.barDimensions[r];t.save(),t.textAlign="center",t.font=M.font(e,"Label",a),t.lineWidth=0,V(t,e,"Label",i,s,d),t.restore()}function W(t,e,i,r,l,n,a,s,d,f,h){t.setLineDash([]);const o=n-r,u=.55,m=o*u;t.lineWidth=o+m;const b=u/3.1,g=t.createRadialGradient(e,i,r-m/2,e,i,n+m/2),c=(0,S.A)(a).setAlpha(.5).toRgbString(),w=(0,S.A)(a).setAlpha(0).toRgbString();g.addColorStop(0,w),g.addColorStop(b,c),g.addColorStop(1-b,c),g.addColorStop(1,w),t.strokeStyle=g,t.beginPath();const y=.01*Math.PI;d?t.arc(e,i,l,f-y,f+(h-f)*s+y):t.arc(e,i,l,Math.PI-y,Math.PI+Math.PI*s+y),t.stroke()}function F(t,e,i,r,l,n,a,s){t.setLineDash([]);const d=.55,f=a*d;t.lineWidth=a+f;const h=d/3.1,o=s?e-t.lineWidth/2:0,u=s?0:i-t.lineWidth/2,m=s?e+t.lineWidth/2:0,b=s?0:i+t.lineWidth/2,g=t.createLinearGradient(o,u,m,b),c=(0,S.A)(n).setAlpha(.5).toRgbString(),w=(0,S.A)(n).setAlpha(0).toRgbString();g.addColorStop(0,w),g.addColorStop(h,c),g.addColorStop(1-h,c),g.addColorStop(1,w),t.strokeStyle=g;const y=s?0:.05*t.lineWidth,E=s?.05*t.lineWidth:0;t.beginPath(),t.moveTo(e-y,i+E),t.lineTo(r+y,l-E),t.stroke()}function G(t,e,i,r,l,n,a,s,d,f,h){if(!e.length)return;const o=a-l;t.beginPath(),t.lineWidth=h,t.strokeStyle=f;for(const u of e){const m=s+u*d,b=i+(l+o)*Math.cos(m),g=r+(l+o)*Math.sin(m),c=i+l*Math.cos(m),w=r+l*Math.sin(m);t.moveTo(b,g),t.lineTo(c,w)}t.stroke()}function X(t,e,i,r,l,n,a,s,d){if(e.length){t.beginPath(),t.lineWidth=d,t.strokeStyle=s;for(const f of e){const h=f*l;a?(t.moveTo(i-n/2,r+h-l),t.lineTo(i+n/2,r+h-l)):(t.moveTo(i+h,r),t.lineTo(i+h,r+n))}t.stroke()}}}}]);